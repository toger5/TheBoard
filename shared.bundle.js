/*! For license information please see shared.bundle.js.LICENSE.txt */
(()=>{var e,t={9713:e=>{e.exports=function(e,t,i){return t in e?Object.defineProperty(e,t,{value:i,enumerable:!0,configurable:!0,writable:!0}):e[t]=i,e},e.exports.default=e.exports,e.exports.__esModule=!0},5318:e=>{e.exports=function(e){return e&&e.__esModule?e:{default:e}},e.exports.default=e.exports,e.exports.__esModule=!0},862:(e,t,i)=>{var n=i(8).default;function r(e){if("function"!=typeof WeakMap)return null;var t=new WeakMap,i=new WeakMap;return(r=function(e){return e?i:t})(e)}e.exports=function(e,t){if(!t&&e&&e.__esModule)return e;if(null===e||"object"!==n(e)&&"function"!=typeof e)return{default:e};var i=r(t);if(i&&i.has(e))return i.get(e);var s={},o=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var a in e)if("default"!==a&&Object.prototype.hasOwnProperty.call(e,a)){var c=o?Object.getOwnPropertyDescriptor(e,a):null;c&&(c.get||c.set)?Object.defineProperty(s,a,c):s[a]=e[a]}return s.default=e,i&&i.set(e,s),s},e.exports.default=e.exports,e.exports.__esModule=!0},8:e=>{function t(i){return"function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?(e.exports=t=function(e){return typeof e},e.exports.default=e.exports,e.exports.__esModule=!0):(e.exports=t=function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},e.exports.default=e.exports,e.exports.__esModule=!0),t(i)}e.exports=t,e.exports.default=e.exports,e.exports.__esModule=!0},1234:function(e,t){!function(e){"use strict";var t={3:"abstract boolean byte char class double enum export extends final float goto implements import int interface long native package private protected public short static super synchronized throws transient volatile",5:"class enum extends super const export import",6:"enum",strict:"implements interface let package private protected public static yield",strictBind:"eval arguments"},i="break case catch continue debugger default do else finally for function if return switch throw try var while with null true false instanceof typeof void delete new in this",n={5:i,"5module":i+" export import",6:i+" const class extends export import super"},r=/^in(stanceof)?$/,s="ªµºÀ-ÖØ-öø-ˁˆ-ˑˠ-ˤˬˮͰ-ʹͶͷͺ-ͽͿΆΈ-ΊΌΎ-ΡΣ-ϵϷ-ҁҊ-ԯԱ-Ֆՙՠ-ֈא-תׯ-ײؠ-يٮٯٱ-ۓەۥۦۮۯۺ-ۼۿܐܒ-ܯݍ-ޥޱߊ-ߪߴߵߺࠀ-ࠕࠚࠤࠨࡀ-ࡘࡠ-ࡪࢠ-ࢴࢶ-ࣇऄ-हऽॐक़-ॡॱ-ঀঅ-ঌএঐও-নপ-রলশ-হঽৎড়ঢ়য়-ৡৰৱৼਅ-ਊਏਐਓ-ਨਪ-ਰਲਲ਼ਵਸ਼ਸਹਖ਼-ੜਫ਼ੲ-ੴઅ-ઍએ-ઑઓ-નપ-રલળવ-હઽૐૠૡૹଅ-ଌଏଐଓ-ନପ-ରଲଳଵ-ହଽଡ଼ଢ଼ୟ-ୡୱஃஅ-ஊஎ-ஐஒ-கஙசஜஞடணதந-பம-ஹௐఅ-ఌఎ-ఐఒ-నప-హఽౘ-ౚౠౡಀಅ-ಌಎ-ಐಒ-ನಪ-ಳವ-ಹಽೞೠೡೱೲഄ-ഌഎ-ഐഒ-ഺഽൎൔ-ൖൟ-ൡൺ-ൿඅ-ඖක-නඳ-රලව-ෆก-ะาำเ-ๆກຂຄຆ-ຊຌ-ຣລວ-ະາຳຽເ-ໄໆໜ-ໟༀཀ-ཇཉ-ཬྈ-ྌက-ဪဿၐ-ၕၚ-ၝၡၥၦၮ-ၰၵ-ႁႎႠ-ჅჇჍა-ჺჼ-ቈቊ-ቍቐ-ቖቘቚ-ቝበ-ኈኊ-ኍነ-ኰኲ-ኵኸ-ኾዀዂ-ዅወ-ዖዘ-ጐጒ-ጕጘ-ፚᎀ-ᎏᎠ-Ᏽᏸ-ᏽᐁ-ᙬᙯ-ᙿᚁ-ᚚᚠ-ᛪᛮ-ᛸᜀ-ᜌᜎ-ᜑᜠ-ᜱᝀ-ᝑᝠ-ᝬᝮ-ᝰក-ឳៗៜᠠ-ᡸᢀ-ᢨᢪᢰ-ᣵᤀ-ᤞᥐ-ᥭᥰ-ᥴᦀ-ᦫᦰ-ᧉᨀ-ᨖᨠ-ᩔᪧᬅ-ᬳᭅ-ᭋᮃ-ᮠᮮᮯᮺ-ᯥᰀ-ᰣᱍ-ᱏᱚ-ᱽᲀ-ᲈᲐ-ᲺᲽ-Ჿᳩ-ᳬᳮ-ᳳᳵᳶᳺᴀ-ᶿḀ-ἕἘ-Ἕἠ-ὅὈ-Ὅὐ-ὗὙὛὝὟ-ώᾀ-ᾴᾶ-ᾼιῂ-ῄῆ-ῌῐ-ΐῖ-Ίῠ-Ῥῲ-ῴῶ-ῼⁱⁿₐ-ₜℂℇℊ-ℓℕ℘-ℝℤΩℨK-ℹℼ-ℿⅅ-ⅉⅎⅠ-ↈⰀ-Ⱞⰰ-ⱞⱠ-ⳤⳫ-ⳮⳲⳳⴀ-ⴥⴧⴭⴰ-ⵧⵯⶀ-ⶖⶠ-ⶦⶨ-ⶮⶰ-ⶶⶸ-ⶾⷀ-ⷆⷈ-ⷎⷐ-ⷖⷘ-ⷞ々-〇〡-〩〱-〵〸-〼ぁ-ゖ゛-ゟァ-ヺー-ヿㄅ-ㄯㄱ-ㆎㆠ-ㆿㇰ-ㇿ㐀-䶿一-鿼ꀀ-ꒌꓐ-ꓽꔀ-ꘌꘐ-ꘟꘪꘫꙀ-ꙮꙿ-ꚝꚠ-ꛯꜗ-ꜟꜢ-ꞈꞋ-ꞿꟂ-ꟊꟵ-ꠁꠃ-ꠅꠇ-ꠊꠌ-ꠢꡀ-ꡳꢂ-ꢳꣲ-ꣷꣻꣽꣾꤊ-ꤥꤰ-ꥆꥠ-ꥼꦄ-ꦲꧏꧠ-ꧤꧦ-ꧯꧺ-ꧾꨀ-ꨨꩀ-ꩂꩄ-ꩋꩠ-ꩶꩺꩾ-ꪯꪱꪵꪶꪹ-ꪽꫀꫂꫛ-ꫝꫠ-ꫪꫲ-ꫴꬁ-ꬆꬉ-ꬎꬑ-ꬖꬠ-ꬦꬨ-ꬮꬰ-ꭚꭜ-ꭩꭰ-ꯢ가-힣ힰ-ퟆퟋ-ퟻ豈-舘並-龎ﬀ-ﬆﬓ-ﬗיִײַ-ﬨשׁ-זּטּ-לּמּנּסּףּפּצּ-ﮱﯓ-ﴽﵐ-ﶏﶒ-ﷇﷰ-ﷻﹰ-ﹴﹶ-ﻼＡ-Ｚａ-ｚｦ-ﾾￂ-ￇￊ-ￏￒ-ￗￚ-ￜ",o="‌‍·̀-ͯ·҃-֑҇-ׇֽֿׁׂׅׄؐ-ًؚ-٩ٰۖ-ۜ۟-۪ۤۧۨ-ۭ۰-۹ܑܰ-݊ަ-ް߀-߉߫-߽߳ࠖ-࠙ࠛ-ࠣࠥ-ࠧࠩ-࡙࠭-࡛࣓-ࣣ࣡-ःऺ-़ा-ॏ॑-ॗॢॣ०-९ঁ-ঃ়া-ৄেৈো-্ৗৢৣ০-৯৾ਁ-ਃ਼ਾ-ੂੇੈੋ-੍ੑ੦-ੱੵઁ-ઃ઼ા-ૅે-ૉો-્ૢૣ૦-૯ૺ-૿ଁ-ଃ଼ା-ୄେୈୋ-୍୕-ୗୢୣ୦-୯ஂா-ூெ-ைொ-்ௗ௦-௯ఀ-ఄా-ౄె-ైొ-్ౕౖౢౣ౦-౯ಁ-ಃ಼ಾ-ೄೆ-ೈೊ-್ೕೖೢೣ೦-೯ഀ-ഃ഻഼ാ-ൄെ-ൈൊ-്ൗൢൣ൦-൯ඁ-ඃ්ා-ුූෘ-ෟ෦-෯ෲෳัิ-ฺ็-๎๐-๙ັິ-ຼ່-ໍ໐-໙༘༙༠-༩༹༵༷༾༿ཱ-྄྆྇ྍ-ྗྙ-ྼ࿆ါ-ှ၀-၉ၖ-ၙၞ-ၠၢ-ၤၧ-ၭၱ-ၴႂ-ႍႏ-ႝ፝-፟፩-፱ᜒ-᜔ᜲ-᜴ᝒᝓᝲᝳ឴-៓៝០-៩᠋-᠍᠐-᠙ᢩᤠ-ᤫᤰ-᤻᥆-᥏᧐-᧚ᨗ-ᨛᩕ-ᩞ᩠-᩿᩼-᪉᪐-᪙᪰-᪽ᪿᫀᬀ-ᬄ᬴-᭄᭐-᭙᭫-᭳ᮀ-ᮂᮡ-ᮭ᮰-᮹᯦-᯳ᰤ-᰷᱀-᱉᱐-᱙᳐-᳔᳒-᳨᳭᳴᳷-᳹᷀-᷹᷻-᷿‿⁀⁔⃐-⃥⃜⃡-⃰⳯-⵿⳱ⷠ-〪ⷿ-゙゚〯꘠-꘩꙯ꙴ-꙽ꚞꚟ꛰꛱ꠂ꠆ꠋꠣ-ꠧ꠬ꢀꢁꢴ-ꣅ꣐-꣙꣠-꣱ꣿ-꤉ꤦ-꤭ꥇ-꥓ꦀ-ꦃ꦳-꧀꧐-꧙ꧥ꧰-꧹ꨩ-ꨶꩃꩌꩍ꩐-꩙ꩻ-ꩽꪰꪲ-ꪴꪷꪸꪾ꪿꫁ꫫ-ꫯꫵ꫶ꯣ-ꯪ꯬꯭꯰-꯹ﬞ︀-️︠-︯︳︴﹍-﹏０-９＿",a=new RegExp("["+s+"]"),c=new RegExp("["+s+o+"]");s=o=null;var l=[0,11,2,25,2,18,2,1,2,14,3,13,35,122,70,52,268,28,4,48,48,31,14,29,6,37,11,29,3,35,5,7,2,4,43,157,19,35,5,35,5,39,9,51,157,310,10,21,11,7,153,5,3,0,2,43,2,1,4,0,3,22,11,22,10,30,66,18,2,1,11,21,11,25,71,55,7,1,65,0,16,3,2,2,2,28,43,28,4,28,36,7,2,27,28,53,11,21,11,18,14,17,111,72,56,50,14,50,14,35,349,41,7,1,79,28,11,0,9,21,107,20,28,22,13,52,76,44,33,24,27,35,30,0,3,0,9,34,4,0,13,47,15,3,22,0,2,0,36,17,2,24,85,6,2,0,2,3,2,14,2,9,8,46,39,7,3,1,3,21,2,6,2,1,2,4,4,0,19,0,13,4,159,52,19,3,21,2,31,47,21,1,2,0,185,46,42,3,37,47,21,0,60,42,14,0,72,26,230,43,117,63,32,7,3,0,3,7,2,1,2,23,16,0,2,0,95,7,3,38,17,0,2,0,29,0,11,39,8,0,22,0,12,45,20,0,35,56,264,8,2,36,18,0,50,29,113,6,2,1,2,37,22,0,26,5,2,1,2,31,15,0,328,18,190,0,80,921,103,110,18,195,2749,1070,4050,582,8634,568,8,30,114,29,19,47,17,3,32,20,6,18,689,63,129,74,6,0,67,12,65,1,2,0,29,6135,9,1237,43,8,8952,286,50,2,18,3,9,395,2309,106,6,12,4,8,8,9,5991,84,2,70,2,1,3,0,3,1,3,3,2,11,2,0,2,6,2,64,2,3,3,7,2,6,2,27,2,3,2,4,2,0,4,6,2,339,3,24,2,24,2,30,2,24,2,30,2,24,2,30,2,24,2,30,2,24,2,7,2357,44,11,6,17,0,370,43,1301,196,60,67,8,0,1205,3,2,26,2,1,2,0,3,0,2,9,2,3,2,0,2,0,7,0,5,0,2,0,2,0,2,2,2,1,2,0,3,0,2,0,2,0,2,0,2,0,2,1,2,0,3,3,2,6,2,3,2,3,2,0,2,9,2,16,6,2,2,4,2,16,4421,42717,35,4148,12,221,3,5761,15,7472,3104,541,1507,4938],h=[509,0,227,0,150,4,294,9,1368,2,2,1,6,3,41,2,5,0,166,1,574,3,9,9,370,1,154,10,176,2,54,14,32,9,16,3,46,10,54,9,7,2,37,13,2,9,6,1,45,0,13,2,49,13,9,3,2,11,83,11,7,0,161,11,6,9,7,3,56,1,2,6,3,1,3,2,10,0,11,1,3,6,4,4,193,17,10,9,5,0,82,19,13,9,214,6,3,8,28,1,83,16,16,9,82,12,9,9,84,14,5,9,243,14,166,9,71,5,2,1,3,3,2,0,2,1,13,9,120,6,3,6,4,0,29,9,41,6,2,3,9,0,10,10,47,15,406,7,2,7,17,9,57,21,2,13,123,5,4,0,2,1,2,6,2,0,9,9,49,4,2,1,2,4,9,9,330,3,19306,9,135,4,60,6,26,9,1014,0,2,54,8,3,82,0,12,1,19628,1,5319,4,4,5,9,7,3,6,31,3,149,2,1418,49,513,54,5,49,9,0,15,0,23,4,2,14,1361,6,2,16,3,6,2,1,2,4,262,6,10,9,419,13,1495,6,110,6,6,9,4759,9,787719,239];function u(e,t){for(var i=65536,n=0;n<t.length;n+=2){if((i+=t[n])>e)return!1;if((i+=t[n+1])>=e)return!0}}function d(e,t){return e<65?36===e:e<91||(e<97?95===e:e<123||(e<=65535?e>=170&&a.test(String.fromCharCode(e)):!1!==t&&u(e,l)))}function p(e,t){return e<48?36===e:e<58||!(e<65)&&(e<91||(e<97?95===e:e<123||(e<=65535?e>=170&&c.test(String.fromCharCode(e)):!1!==t&&(u(e,l)||u(e,h)))))}var g=function(e,t){void 0===t&&(t={}),this.label=e,this.keyword=t.keyword,this.beforeExpr=!!t.beforeExpr,this.startsExpr=!!t.startsExpr,this.isLoop=!!t.isLoop,this.isAssign=!!t.isAssign,this.prefix=!!t.prefix,this.postfix=!!t.postfix,this.binop=t.binop||null,this.updateContext=null};function f(e,t){return new g(e,{beforeExpr:!0,binop:t})}var m={beforeExpr:!0},v={startsExpr:!0},y={};function _(e,t){return void 0===t&&(t={}),t.keyword=e,y[e]=new g(e,t)}var S={num:new g("num",v),regexp:new g("regexp",v),string:new g("string",v),name:new g("name",v),privateId:new g("privateId",v),eof:new g("eof"),bracketL:new g("[",{beforeExpr:!0,startsExpr:!0}),bracketR:new g("]"),braceL:new g("{",{beforeExpr:!0,startsExpr:!0}),braceR:new g("}"),parenL:new g("(",{beforeExpr:!0,startsExpr:!0}),parenR:new g(")"),comma:new g(",",m),semi:new g(";",m),colon:new g(":",m),dot:new g("."),question:new g("?",m),questionDot:new g("?."),arrow:new g("=>",m),template:new g("template"),invalidTemplate:new g("invalidTemplate"),ellipsis:new g("...",m),backQuote:new g("`",v),dollarBraceL:new g("${",{beforeExpr:!0,startsExpr:!0}),eq:new g("=",{beforeExpr:!0,isAssign:!0}),assign:new g("_=",{beforeExpr:!0,isAssign:!0}),incDec:new g("++/--",{prefix:!0,postfix:!0,startsExpr:!0}),prefix:new g("!/~",{beforeExpr:!0,prefix:!0,startsExpr:!0}),logicalOR:f("||",1),logicalAND:f("&&",2),bitwiseOR:f("|",3),bitwiseXOR:f("^",4),bitwiseAND:f("&",5),equality:f("==/!=/===/!==",6),relational:f("</>/<=/>=",7),bitShift:f("<</>>/>>>",8),plusMin:new g("+/-",{beforeExpr:!0,binop:9,prefix:!0,startsExpr:!0}),modulo:f("%",10),star:f("*",10),slash:f("/",10),starstar:new g("**",{beforeExpr:!0}),coalesce:f("??",1),_break:_("break"),_case:_("case",m),_catch:_("catch"),_continue:_("continue"),_debugger:_("debugger"),_default:_("default",m),_do:_("do",{isLoop:!0,beforeExpr:!0}),_else:_("else",m),_finally:_("finally"),_for:_("for",{isLoop:!0}),_function:_("function",v),_if:_("if"),_return:_("return",m),_switch:_("switch"),_throw:_("throw",m),_try:_("try"),_var:_("var"),_const:_("const"),_while:_("while",{isLoop:!0}),_with:_("with"),_new:_("new",{beforeExpr:!0,startsExpr:!0}),_this:_("this",v),_super:_("super",v),_class:_("class",v),_extends:_("extends",m),_export:_("export"),_import:_("import",v),_null:_("null",v),_true:_("true",v),_false:_("false",v),_in:_("in",{beforeExpr:!0,binop:7}),_instanceof:_("instanceof",{beforeExpr:!0,binop:7}),_typeof:_("typeof",{beforeExpr:!0,prefix:!0,startsExpr:!0}),_void:_("void",{beforeExpr:!0,prefix:!0,startsExpr:!0}),_delete:_("delete",{beforeExpr:!0,prefix:!0,startsExpr:!0})},b=/\r\n?|\n|\u2028|\u2029/,w=new RegExp(b.source,"g");function E(e,t){return 10===e||13===e||!t&&(8232===e||8233===e)}var I=/[\u1680\u2000-\u200a\u202f\u205f\u3000\ufeff]/,k=/(?:\s|\/\/.*|\/\*[^]*?\*\/)*/g,T=Object.prototype,C=T.hasOwnProperty,x=T.toString;function R(e,t){return C.call(e,t)}var O=Array.isArray||function(e){return"[object Array]"===x.call(e)};function A(e){return new RegExp("^(?:"+e.replace(/ /g,"|")+")$")}var P=function(e,t){this.line=e,this.column=t};P.prototype.offset=function(e){return new P(this.line,this.column+e)};var D=function(e,t,i){this.start=t,this.end=i,null!==e.sourceFile&&(this.source=e.sourceFile)};function M(e,t){for(var i=1,n=0;;){w.lastIndex=n;var r=w.exec(e);if(!(r&&r.index<t))return new P(i,t-n);++i,n=r.index+r[0].length}}var N={ecmaVersion:null,sourceType:"script",onInsertedSemicolon:null,onTrailingComma:null,allowReserved:null,allowReturnOutsideFunction:!1,allowImportExportEverywhere:!1,allowAwaitOutsideFunction:null,allowSuperOutsideMethod:null,allowHashBang:!1,locations:!1,onToken:null,onComment:null,ranges:!1,program:null,sourceFile:null,directSourceFile:null,preserveParens:!1},B=!1;function U(e){var t={};for(var i in N)t[i]=e&&R(e,i)?e[i]:N[i];if("latest"===t.ecmaVersion?t.ecmaVersion=1e8:null==t.ecmaVersion?(!B&&"object"==typeof console&&console.warn&&(B=!0,console.warn("Since Acorn 8.0.0, options.ecmaVersion is required.\nDefaulting to 2020, but this will stop working in the future.")),t.ecmaVersion=11):t.ecmaVersion>=2015&&(t.ecmaVersion-=2009),null==t.allowReserved&&(t.allowReserved=t.ecmaVersion<5),O(t.onToken)){var n=t.onToken;t.onToken=function(e){return n.push(e)}}return O(t.onComment)&&(t.onComment=function(e,t){return function(i,n,r,s,o,a){var c={type:i?"Block":"Line",value:n,start:r,end:s};e.locations&&(c.loc=new D(this,o,a)),e.ranges&&(c.range=[r,s]),t.push(c)}}(t,t.onComment)),t}function L(e,t){return 2|(e?4:0)|(t?8:0)}var K=function(e,i,r){this.options=e=U(e),this.sourceFile=e.sourceFile,this.keywords=A(n[e.ecmaVersion>=6?6:"module"===e.sourceType?"5module":5]);var s="";!0!==e.allowReserved&&(s=t[e.ecmaVersion>=6?6:5===e.ecmaVersion?5:3],"module"===e.sourceType&&(s+=" await")),this.reservedWords=A(s);var o=(s?s+" ":"")+t.strict;this.reservedWordsStrict=A(o),this.reservedWordsStrictBind=A(o+" "+t.strictBind),this.input=String(i),this.containsEsc=!1,r?(this.pos=r,this.lineStart=this.input.lastIndexOf("\n",r-1)+1,this.curLine=this.input.slice(0,this.lineStart).split(b).length):(this.pos=this.lineStart=0,this.curLine=1),this.type=S.eof,this.value=null,this.start=this.end=this.pos,this.startLoc=this.endLoc=this.curPosition(),this.lastTokEndLoc=this.lastTokStartLoc=null,this.lastTokStart=this.lastTokEnd=this.pos,this.context=this.initialContext(),this.exprAllowed=!0,this.inModule="module"===e.sourceType,this.strict=this.inModule||this.strictDirective(this.pos),this.potentialArrowAt=-1,this.potentialArrowInForAwait=!1,this.yieldPos=this.awaitPos=this.awaitIdentPos=0,this.labels=[],this.undefinedExports=Object.create(null),0===this.pos&&e.allowHashBang&&"#!"===this.input.slice(0,2)&&this.skipLineComment(2),this.scopeStack=[],this.enterScope(1),this.regexpState=null,this.privateNameStack=[]},j={inFunction:{configurable:!0},inGenerator:{configurable:!0},inAsync:{configurable:!0},canAwait:{configurable:!0},allowSuper:{configurable:!0},allowDirectSuper:{configurable:!0},treatFunctionsAsVar:{configurable:!0},inNonArrowFunction:{configurable:!0}};K.prototype.parse=function(){var e=this.options.program||this.startNode();return this.nextToken(),this.parseTopLevel(e)},j.inFunction.get=function(){return(2&this.currentVarScope().flags)>0},j.inGenerator.get=function(){return(8&this.currentVarScope().flags)>0&&!this.currentVarScope().inClassFieldInit},j.inAsync.get=function(){return(4&this.currentVarScope().flags)>0&&!this.currentVarScope().inClassFieldInit},j.canAwait.get=function(){for(var e=this.scopeStack.length-1;e>=0;e--){var t=this.scopeStack[e];if(t.inClassFieldInit)return!1;if(2&t.flags)return(4&t.flags)>0}return this.inModule&&this.options.ecmaVersion>=13||this.options.allowAwaitOutsideFunction},j.allowSuper.get=function(){var e=this.currentThisScope(),t=e.flags,i=e.inClassFieldInit;return(64&t)>0||i||this.options.allowSuperOutsideMethod},j.allowDirectSuper.get=function(){return(128&this.currentThisScope().flags)>0},j.treatFunctionsAsVar.get=function(){return this.treatFunctionsAsVarInScope(this.currentScope())},j.inNonArrowFunction.get=function(){var e=this.currentThisScope(),t=e.flags,i=e.inClassFieldInit;return(2&t)>0||i},K.extend=function(){for(var e=[],t=arguments.length;t--;)e[t]=arguments[t];for(var i=this,n=0;n<e.length;n++)i=e[n](i);return i},K.parse=function(e,t){return new this(t,e).parse()},K.parseExpressionAt=function(e,t,i){var n=new this(i,e,t);return n.nextToken(),n.parseExpression()},K.tokenizer=function(e,t){return new this(t,e)},Object.defineProperties(K.prototype,j);var F=K.prototype,q=/^(?:'((?:\\.|[^'\\])*?)'|"((?:\\.|[^"\\])*?)")/;function V(){this.shorthandAssign=this.trailingComma=this.parenthesizedAssign=this.parenthesizedBind=this.doubleProto=-1}F.strictDirective=function(e){for(;;){k.lastIndex=e,e+=k.exec(this.input)[0].length;var t=q.exec(this.input.slice(e));if(!t)return!1;if("use strict"===(t[1]||t[2])){k.lastIndex=e+t[0].length;var i=k.exec(this.input),n=i.index+i[0].length,r=this.input.charAt(n);return";"===r||"}"===r||b.test(i[0])&&!(/[(`.[+\-/*%<>=,?^&]/.test(r)||"!"===r&&"="===this.input.charAt(n+1))}e+=t[0].length,k.lastIndex=e,e+=k.exec(this.input)[0].length,";"===this.input[e]&&e++}},F.eat=function(e){return this.type===e&&(this.next(),!0)},F.isContextual=function(e){return this.type===S.name&&this.value===e&&!this.containsEsc},F.eatContextual=function(e){return!!this.isContextual(e)&&(this.next(),!0)},F.expectContextual=function(e){this.eatContextual(e)||this.unexpected()},F.canInsertSemicolon=function(){return this.type===S.eof||this.type===S.braceR||b.test(this.input.slice(this.lastTokEnd,this.start))},F.insertSemicolon=function(){if(this.canInsertSemicolon())return this.options.onInsertedSemicolon&&this.options.onInsertedSemicolon(this.lastTokEnd,this.lastTokEndLoc),!0},F.semicolon=function(){this.eat(S.semi)||this.insertSemicolon()||this.unexpected()},F.afterTrailingComma=function(e,t){if(this.type===e)return this.options.onTrailingComma&&this.options.onTrailingComma(this.lastTokStart,this.lastTokStartLoc),t||this.next(),!0},F.expect=function(e){this.eat(e)||this.unexpected()},F.unexpected=function(e){this.raise(null!=e?e:this.start,"Unexpected token")},F.checkPatternErrors=function(e,t){if(e){e.trailingComma>-1&&this.raiseRecoverable(e.trailingComma,"Comma is not permitted after the rest element");var i=t?e.parenthesizedAssign:e.parenthesizedBind;i>-1&&this.raiseRecoverable(i,"Parenthesized pattern")}},F.checkExpressionErrors=function(e,t){if(!e)return!1;var i=e.shorthandAssign,n=e.doubleProto;if(!t)return i>=0||n>=0;i>=0&&this.raise(i,"Shorthand property assignments are valid only in destructuring patterns"),n>=0&&this.raiseRecoverable(n,"Redefinition of __proto__ property")},F.checkYieldAwaitInDefaultParams=function(){this.yieldPos&&(!this.awaitPos||this.yieldPos<this.awaitPos)&&this.raise(this.yieldPos,"Yield expression cannot be a default value"),this.awaitPos&&this.raise(this.awaitPos,"Await expression cannot be a default value")},F.isSimpleAssignTarget=function(e){return"ParenthesizedExpression"===e.type?this.isSimpleAssignTarget(e.expression):"Identifier"===e.type||"MemberExpression"===e.type};var $=K.prototype;$.parseTopLevel=function(e){var t=Object.create(null);for(e.body||(e.body=[]);this.type!==S.eof;){var i=this.parseStatement(null,!0,t);e.body.push(i)}if(this.inModule)for(var n=0,r=Object.keys(this.undefinedExports);n<r.length;n+=1){var s=r[n];this.raiseRecoverable(this.undefinedExports[s].start,"Export '"+s+"' is not defined")}return this.adaptDirectivePrologue(e.body),this.next(),e.sourceType=this.options.sourceType,this.finishNode(e,"Program")};var G={kind:"loop"},H={kind:"switch"};$.isLet=function(e){if(this.options.ecmaVersion<6||!this.isContextual("let"))return!1;k.lastIndex=this.pos;var t=k.exec(this.input),i=this.pos+t[0].length,n=this.input.charCodeAt(i);if(91===n||92===n||n>55295&&n<56320)return!0;if(e)return!1;if(123===n)return!0;if(d(n,!0)){for(var s=i+1;p(n=this.input.charCodeAt(s),!0);)++s;if(92===n||n>55295&&n<56320)return!0;var o=this.input.slice(i,s);if(!r.test(o))return!0}return!1},$.isAsyncFunction=function(){if(this.options.ecmaVersion<8||!this.isContextual("async"))return!1;k.lastIndex=this.pos;var e,t=k.exec(this.input),i=this.pos+t[0].length;return!(b.test(this.input.slice(this.pos,i))||"function"!==this.input.slice(i,i+8)||i+8!==this.input.length&&(p(e=this.input.charCodeAt(i+8))||e>55295&&e<56320))},$.parseStatement=function(e,t,i){var n,r=this.type,s=this.startNode();switch(this.isLet(e)&&(r=S._var,n="let"),r){case S._break:case S._continue:return this.parseBreakContinueStatement(s,r.keyword);case S._debugger:return this.parseDebuggerStatement(s);case S._do:return this.parseDoStatement(s);case S._for:return this.parseForStatement(s);case S._function:return e&&(this.strict||"if"!==e&&"label"!==e)&&this.options.ecmaVersion>=6&&this.unexpected(),this.parseFunctionStatement(s,!1,!e);case S._class:return e&&this.unexpected(),this.parseClass(s,!0);case S._if:return this.parseIfStatement(s);case S._return:return this.parseReturnStatement(s);case S._switch:return this.parseSwitchStatement(s);case S._throw:return this.parseThrowStatement(s);case S._try:return this.parseTryStatement(s);case S._const:case S._var:return n=n||this.value,e&&"var"!==n&&this.unexpected(),this.parseVarStatement(s,n);case S._while:return this.parseWhileStatement(s);case S._with:return this.parseWithStatement(s);case S.braceL:return this.parseBlock(!0,s);case S.semi:return this.parseEmptyStatement(s);case S._export:case S._import:if(this.options.ecmaVersion>10&&r===S._import){k.lastIndex=this.pos;var o=k.exec(this.input),a=this.pos+o[0].length,c=this.input.charCodeAt(a);if(40===c||46===c)return this.parseExpressionStatement(s,this.parseExpression())}return this.options.allowImportExportEverywhere||(t||this.raise(this.start,"'import' and 'export' may only appear at the top level"),this.inModule||this.raise(this.start,"'import' and 'export' may appear only with 'sourceType: module'")),r===S._import?this.parseImport(s):this.parseExport(s,i);default:if(this.isAsyncFunction())return e&&this.unexpected(),this.next(),this.parseFunctionStatement(s,!0,!e);var l=this.value,h=this.parseExpression();return r===S.name&&"Identifier"===h.type&&this.eat(S.colon)?this.parseLabeledStatement(s,l,h,e):this.parseExpressionStatement(s,h)}},$.parseBreakContinueStatement=function(e,t){var i="break"===t;this.next(),this.eat(S.semi)||this.insertSemicolon()?e.label=null:this.type!==S.name?this.unexpected():(e.label=this.parseIdent(),this.semicolon());for(var n=0;n<this.labels.length;++n){var r=this.labels[n];if(null==e.label||r.name===e.label.name){if(null!=r.kind&&(i||"loop"===r.kind))break;if(e.label&&i)break}}return n===this.labels.length&&this.raise(e.start,"Unsyntactic "+t),this.finishNode(e,i?"BreakStatement":"ContinueStatement")},$.parseDebuggerStatement=function(e){return this.next(),this.semicolon(),this.finishNode(e,"DebuggerStatement")},$.parseDoStatement=function(e){return this.next(),this.labels.push(G),e.body=this.parseStatement("do"),this.labels.pop(),this.expect(S._while),e.test=this.parseParenExpression(),this.options.ecmaVersion>=6?this.eat(S.semi):this.semicolon(),this.finishNode(e,"DoWhileStatement")},$.parseForStatement=function(e){this.next();var t=this.options.ecmaVersion>=9&&this.canAwait&&this.eatContextual("await")?this.lastTokStart:-1;if(this.labels.push(G),this.enterScope(0),this.expect(S.parenL),this.type===S.semi)return t>-1&&this.unexpected(t),this.parseFor(e,null);var i=this.isLet();if(this.type===S._var||this.type===S._const||i){var n=this.startNode(),r=i?"let":this.value;return this.next(),this.parseVar(n,!0,r),this.finishNode(n,"VariableDeclaration"),(this.type===S._in||this.options.ecmaVersion>=6&&this.isContextual("of"))&&1===n.declarations.length?(this.options.ecmaVersion>=9&&(this.type===S._in?t>-1&&this.unexpected(t):e.await=t>-1),this.parseForIn(e,n)):(t>-1&&this.unexpected(t),this.parseFor(e,n))}var s=new V,o=this.parseExpression(!(t>-1)||"await",s);return this.type===S._in||this.options.ecmaVersion>=6&&this.isContextual("of")?(this.options.ecmaVersion>=9&&(this.type===S._in?t>-1&&this.unexpected(t):e.await=t>-1),this.toAssignable(o,!1,s),this.checkLValPattern(o),this.parseForIn(e,o)):(this.checkExpressionErrors(s,!0),t>-1&&this.unexpected(t),this.parseFor(e,o))},$.parseFunctionStatement=function(e,t,i){return this.next(),this.parseFunction(e,W|(i?0:Y),!1,t)},$.parseIfStatement=function(e){return this.next(),e.test=this.parseParenExpression(),e.consequent=this.parseStatement("if"),e.alternate=this.eat(S._else)?this.parseStatement("if"):null,this.finishNode(e,"IfStatement")},$.parseReturnStatement=function(e){return this.inFunction||this.options.allowReturnOutsideFunction||this.raise(this.start,"'return' outside of function"),this.next(),this.eat(S.semi)||this.insertSemicolon()?e.argument=null:(e.argument=this.parseExpression(),this.semicolon()),this.finishNode(e,"ReturnStatement")},$.parseSwitchStatement=function(e){var t;this.next(),e.discriminant=this.parseParenExpression(),e.cases=[],this.expect(S.braceL),this.labels.push(H),this.enterScope(0);for(var i=!1;this.type!==S.braceR;)if(this.type===S._case||this.type===S._default){var n=this.type===S._case;t&&this.finishNode(t,"SwitchCase"),e.cases.push(t=this.startNode()),t.consequent=[],this.next(),n?t.test=this.parseExpression():(i&&this.raiseRecoverable(this.lastTokStart,"Multiple default clauses"),i=!0,t.test=null),this.expect(S.colon)}else t||this.unexpected(),t.consequent.push(this.parseStatement(null));return this.exitScope(),t&&this.finishNode(t,"SwitchCase"),this.next(),this.labels.pop(),this.finishNode(e,"SwitchStatement")},$.parseThrowStatement=function(e){return this.next(),b.test(this.input.slice(this.lastTokEnd,this.start))&&this.raise(this.lastTokEnd,"Illegal newline after throw"),e.argument=this.parseExpression(),this.semicolon(),this.finishNode(e,"ThrowStatement")};var z=[];$.parseTryStatement=function(e){if(this.next(),e.block=this.parseBlock(),e.handler=null,this.type===S._catch){var t=this.startNode();if(this.next(),this.eat(S.parenL)){t.param=this.parseBindingAtom();var i="Identifier"===t.param.type;this.enterScope(i?32:0),this.checkLValPattern(t.param,i?4:2),this.expect(S.parenR)}else this.options.ecmaVersion<10&&this.unexpected(),t.param=null,this.enterScope(0);t.body=this.parseBlock(!1),this.exitScope(),e.handler=this.finishNode(t,"CatchClause")}return e.finalizer=this.eat(S._finally)?this.parseBlock():null,e.handler||e.finalizer||this.raise(e.start,"Missing catch or finally clause"),this.finishNode(e,"TryStatement")},$.parseVarStatement=function(e,t){return this.next(),this.parseVar(e,!1,t),this.semicolon(),this.finishNode(e,"VariableDeclaration")},$.parseWhileStatement=function(e){return this.next(),e.test=this.parseParenExpression(),this.labels.push(G),e.body=this.parseStatement("while"),this.labels.pop(),this.finishNode(e,"WhileStatement")},$.parseWithStatement=function(e){return this.strict&&this.raise(this.start,"'with' in strict mode"),this.next(),e.object=this.parseParenExpression(),e.body=this.parseStatement("with"),this.finishNode(e,"WithStatement")},$.parseEmptyStatement=function(e){return this.next(),this.finishNode(e,"EmptyStatement")},$.parseLabeledStatement=function(e,t,i,n){for(var r=0,s=this.labels;r<s.length;r+=1)s[r].name===t&&this.raise(i.start,"Label '"+t+"' is already declared");for(var o=this.type.isLoop?"loop":this.type===S._switch?"switch":null,a=this.labels.length-1;a>=0;a--){var c=this.labels[a];if(c.statementStart!==e.start)break;c.statementStart=this.start,c.kind=o}return this.labels.push({name:t,kind:o,statementStart:this.start}),e.body=this.parseStatement(n?-1===n.indexOf("label")?n+"label":n:"label"),this.labels.pop(),e.label=i,this.finishNode(e,"LabeledStatement")},$.parseExpressionStatement=function(e,t){return e.expression=t,this.semicolon(),this.finishNode(e,"ExpressionStatement")},$.parseBlock=function(e,t,i){for(void 0===e&&(e=!0),void 0===t&&(t=this.startNode()),t.body=[],this.expect(S.braceL),e&&this.enterScope(0);this.type!==S.braceR;){var n=this.parseStatement(null);t.body.push(n)}return i&&(this.strict=!1),this.next(),e&&this.exitScope(),this.finishNode(t,"BlockStatement")},$.parseFor=function(e,t){return e.init=t,this.expect(S.semi),e.test=this.type===S.semi?null:this.parseExpression(),this.expect(S.semi),e.update=this.type===S.parenR?null:this.parseExpression(),this.expect(S.parenR),e.body=this.parseStatement("for"),this.exitScope(),this.labels.pop(),this.finishNode(e,"ForStatement")},$.parseForIn=function(e,t){var i=this.type===S._in;return this.next(),"VariableDeclaration"===t.type&&null!=t.declarations[0].init&&(!i||this.options.ecmaVersion<8||this.strict||"var"!==t.kind||"Identifier"!==t.declarations[0].id.type)&&this.raise(t.start,(i?"for-in":"for-of")+" loop variable declaration may not have an initializer"),e.left=t,e.right=i?this.parseExpression():this.parseMaybeAssign(),this.expect(S.parenR),e.body=this.parseStatement("for"),this.exitScope(),this.labels.pop(),this.finishNode(e,i?"ForInStatement":"ForOfStatement")},$.parseVar=function(e,t,i){for(e.declarations=[],e.kind=i;;){var n=this.startNode();if(this.parseVarId(n,i),this.eat(S.eq)?n.init=this.parseMaybeAssign(t):"const"!==i||this.type===S._in||this.options.ecmaVersion>=6&&this.isContextual("of")?"Identifier"===n.id.type||t&&(this.type===S._in||this.isContextual("of"))?n.init=null:this.raise(this.lastTokEnd,"Complex binding patterns require an initialization value"):this.unexpected(),e.declarations.push(this.finishNode(n,"VariableDeclarator")),!this.eat(S.comma))break}return e},$.parseVarId=function(e,t){e.id=this.parseBindingAtom(),this.checkLValPattern(e.id,"var"===t?1:2,!1)};var W=1,Y=2;function J(e,t){var i=t.key.name,n=e[i],r="true";return"MethodDefinition"!==t.type||"get"!==t.kind&&"set"!==t.kind||(r=(t.static?"s":"i")+t.kind),"iget"===n&&"iset"===r||"iset"===n&&"iget"===r||"sget"===n&&"sset"===r||"sset"===n&&"sget"===r?(e[i]="true",!1):!!n||(e[i]=r,!1)}function Q(e,t){var i=e.computed,n=e.key;return!i&&("Identifier"===n.type&&n.name===t||"Literal"===n.type&&n.value===t)}$.parseFunction=function(e,t,i,n){this.initFunction(e),(this.options.ecmaVersion>=9||this.options.ecmaVersion>=6&&!n)&&(this.type===S.star&&t&Y&&this.unexpected(),e.generator=this.eat(S.star)),this.options.ecmaVersion>=8&&(e.async=!!n),t&W&&(e.id=4&t&&this.type!==S.name?null:this.parseIdent(),!e.id||t&Y||this.checkLValSimple(e.id,this.strict||e.generator||e.async?this.treatFunctionsAsVar?1:2:3));var r=this.yieldPos,s=this.awaitPos,o=this.awaitIdentPos;return this.yieldPos=0,this.awaitPos=0,this.awaitIdentPos=0,this.enterScope(L(e.async,e.generator)),t&W||(e.id=this.type===S.name?this.parseIdent():null),this.parseFunctionParams(e),this.parseFunctionBody(e,i,!1),this.yieldPos=r,this.awaitPos=s,this.awaitIdentPos=o,this.finishNode(e,t&W?"FunctionDeclaration":"FunctionExpression")},$.parseFunctionParams=function(e){this.expect(S.parenL),e.params=this.parseBindingList(S.parenR,!1,this.options.ecmaVersion>=8),this.checkYieldAwaitInDefaultParams()},$.parseClass=function(e,t){this.next();var i=this.strict;this.strict=!0,this.parseClassId(e,t),this.parseClassSuper(e);var n=this.enterClassBody(),r=this.startNode(),s=!1;for(r.body=[],this.expect(S.braceL);this.type!==S.braceR;){var o=this.parseClassElement(null!==e.superClass);o&&(r.body.push(o),"MethodDefinition"===o.type&&"constructor"===o.kind?(s&&this.raise(o.start,"Duplicate constructor in the same class"),s=!0):"PrivateIdentifier"===o.key.type&&J(n,o)&&this.raiseRecoverable(o.key.start,"Identifier '#"+o.key.name+"' has already been declared"))}return this.strict=i,this.next(),e.body=this.finishNode(r,"ClassBody"),this.exitClassBody(),this.finishNode(e,t?"ClassDeclaration":"ClassExpression")},$.parseClassElement=function(e){if(this.eat(S.semi))return null;var t=this.options.ecmaVersion,i=this.startNode(),n="",r=!1,s=!1,o="method";if(i.static=!1,this.eatContextual("static")&&(this.isClassElementNameStart()||this.type===S.star?i.static=!0:n="static"),!n&&t>=8&&this.eatContextual("async")&&(!this.isClassElementNameStart()&&this.type!==S.star||this.canInsertSemicolon()?n="async":s=!0),!n&&(t>=9||!s)&&this.eat(S.star)&&(r=!0),!n&&!s&&!r){var a=this.value;(this.eatContextual("get")||this.eatContextual("set"))&&(this.isClassElementNameStart()?o=a:n=a)}if(n?(i.computed=!1,i.key=this.startNodeAt(this.lastTokStart,this.lastTokStartLoc),i.key.name=n,this.finishNode(i.key,"Identifier")):this.parseClassElementName(i),t<13||this.type===S.parenL||"method"!==o||r||s){var c=!i.static&&Q(i,"constructor"),l=c&&e;c&&"method"!==o&&this.raise(i.key.start,"Constructor can't have get/set modifier"),i.kind=c?"constructor":o,this.parseClassMethod(i,r,s,l)}else this.parseClassField(i);return i},$.isClassElementNameStart=function(){return this.type===S.name||this.type===S.privateId||this.type===S.num||this.type===S.string||this.type===S.bracketL||this.type.keyword},$.parseClassElementName=function(e){this.type===S.privateId?("constructor"===this.value&&this.raise(this.start,"Classes can't have an element named '#constructor'"),e.computed=!1,e.key=this.parsePrivateIdent()):this.parsePropertyName(e)},$.parseClassMethod=function(e,t,i,n){var r=e.key;"constructor"===e.kind?(t&&this.raise(r.start,"Constructor can't be a generator"),i&&this.raise(r.start,"Constructor can't be an async method")):e.static&&Q(e,"prototype")&&this.raise(r.start,"Classes may not have a static property named prototype");var s=e.value=this.parseMethod(t,i,n);return"get"===e.kind&&0!==s.params.length&&this.raiseRecoverable(s.start,"getter should have no params"),"set"===e.kind&&1!==s.params.length&&this.raiseRecoverable(s.start,"setter should have exactly one param"),"set"===e.kind&&"RestElement"===s.params[0].type&&this.raiseRecoverable(s.params[0].start,"Setter cannot use rest params"),this.finishNode(e,"MethodDefinition")},$.parseClassField=function(e){if(Q(e,"constructor")?this.raise(e.key.start,"Classes can't have a field named 'constructor'"):e.static&&Q(e,"prototype")&&this.raise(e.key.start,"Classes can't have a static field named 'prototype'"),this.eat(S.eq)){var t=this.currentThisScope(),i=t.inClassFieldInit;t.inClassFieldInit=!0,e.value=this.parseMaybeAssign(),t.inClassFieldInit=i}else e.value=null;return this.semicolon(),this.finishNode(e,"PropertyDefinition")},$.parseClassId=function(e,t){this.type===S.name?(e.id=this.parseIdent(),t&&this.checkLValSimple(e.id,2,!1)):(!0===t&&this.unexpected(),e.id=null)},$.parseClassSuper=function(e){e.superClass=this.eat(S._extends)?this.parseExprSubscripts():null},$.enterClassBody=function(){var e={declared:Object.create(null),used:[]};return this.privateNameStack.push(e),e.declared},$.exitClassBody=function(){for(var e=this.privateNameStack.pop(),t=e.declared,i=e.used,n=this.privateNameStack.length,r=0===n?null:this.privateNameStack[n-1],s=0;s<i.length;++s){var o=i[s];R(t,o.name)||(r?r.used.push(o):this.raiseRecoverable(o.start,"Private field '#"+o.name+"' must be declared in an enclosing class"))}},$.parseExport=function(e,t){if(this.next(),this.eat(S.star))return this.options.ecmaVersion>=11&&(this.eatContextual("as")?(e.exported=this.parseIdent(!0),this.checkExport(t,e.exported.name,this.lastTokStart)):e.exported=null),this.expectContextual("from"),this.type!==S.string&&this.unexpected(),e.source=this.parseExprAtom(),this.semicolon(),this.finishNode(e,"ExportAllDeclaration");if(this.eat(S._default)){var i;if(this.checkExport(t,"default",this.lastTokStart),this.type===S._function||(i=this.isAsyncFunction())){var n=this.startNode();this.next(),i&&this.next(),e.declaration=this.parseFunction(n,4|W,!1,i)}else if(this.type===S._class){var r=this.startNode();e.declaration=this.parseClass(r,"nullableID")}else e.declaration=this.parseMaybeAssign(),this.semicolon();return this.finishNode(e,"ExportDefaultDeclaration")}if(this.shouldParseExportStatement())e.declaration=this.parseStatement(null),"VariableDeclaration"===e.declaration.type?this.checkVariableExport(t,e.declaration.declarations):this.checkExport(t,e.declaration.id.name,e.declaration.id.start),e.specifiers=[],e.source=null;else{if(e.declaration=null,e.specifiers=this.parseExportSpecifiers(t),this.eatContextual("from"))this.type!==S.string&&this.unexpected(),e.source=this.parseExprAtom();else{for(var s=0,o=e.specifiers;s<o.length;s+=1){var a=o[s];this.checkUnreserved(a.local),this.checkLocalExport(a.local)}e.source=null}this.semicolon()}return this.finishNode(e,"ExportNamedDeclaration")},$.checkExport=function(e,t,i){e&&(R(e,t)&&this.raiseRecoverable(i,"Duplicate export '"+t+"'"),e[t]=!0)},$.checkPatternExport=function(e,t){var i=t.type;if("Identifier"===i)this.checkExport(e,t.name,t.start);else if("ObjectPattern"===i)for(var n=0,r=t.properties;n<r.length;n+=1){var s=r[n];this.checkPatternExport(e,s)}else if("ArrayPattern"===i)for(var o=0,a=t.elements;o<a.length;o+=1){var c=a[o];c&&this.checkPatternExport(e,c)}else"Property"===i?this.checkPatternExport(e,t.value):"AssignmentPattern"===i?this.checkPatternExport(e,t.left):"RestElement"===i?this.checkPatternExport(e,t.argument):"ParenthesizedExpression"===i&&this.checkPatternExport(e,t.expression)},$.checkVariableExport=function(e,t){if(e)for(var i=0,n=t;i<n.length;i+=1){var r=n[i];this.checkPatternExport(e,r.id)}},$.shouldParseExportStatement=function(){return"var"===this.type.keyword||"const"===this.type.keyword||"class"===this.type.keyword||"function"===this.type.keyword||this.isLet()||this.isAsyncFunction()},$.parseExportSpecifiers=function(e){var t=[],i=!0;for(this.expect(S.braceL);!this.eat(S.braceR);){if(i)i=!1;else if(this.expect(S.comma),this.afterTrailingComma(S.braceR))break;var n=this.startNode();n.local=this.parseIdent(!0),n.exported=this.eatContextual("as")?this.parseIdent(!0):n.local,this.checkExport(e,n.exported.name,n.exported.start),t.push(this.finishNode(n,"ExportSpecifier"))}return t},$.parseImport=function(e){return this.next(),this.type===S.string?(e.specifiers=z,e.source=this.parseExprAtom()):(e.specifiers=this.parseImportSpecifiers(),this.expectContextual("from"),e.source=this.type===S.string?this.parseExprAtom():this.unexpected()),this.semicolon(),this.finishNode(e,"ImportDeclaration")},$.parseImportSpecifiers=function(){var e=[],t=!0;if(this.type===S.name){var i=this.startNode();if(i.local=this.parseIdent(),this.checkLValSimple(i.local,2),e.push(this.finishNode(i,"ImportDefaultSpecifier")),!this.eat(S.comma))return e}if(this.type===S.star){var n=this.startNode();return this.next(),this.expectContextual("as"),n.local=this.parseIdent(),this.checkLValSimple(n.local,2),e.push(this.finishNode(n,"ImportNamespaceSpecifier")),e}for(this.expect(S.braceL);!this.eat(S.braceR);){if(t)t=!1;else if(this.expect(S.comma),this.afterTrailingComma(S.braceR))break;var r=this.startNode();r.imported=this.parseIdent(!0),this.eatContextual("as")?r.local=this.parseIdent():(this.checkUnreserved(r.imported),r.local=r.imported),this.checkLValSimple(r.local,2),e.push(this.finishNode(r,"ImportSpecifier"))}return e},$.adaptDirectivePrologue=function(e){for(var t=0;t<e.length&&this.isDirectiveCandidate(e[t]);++t)e[t].directive=e[t].expression.raw.slice(1,-1)},$.isDirectiveCandidate=function(e){return"ExpressionStatement"===e.type&&"Literal"===e.expression.type&&"string"==typeof e.expression.value&&('"'===this.input[e.start]||"'"===this.input[e.start])};var X=K.prototype;X.toAssignable=function(e,t,i){if(this.options.ecmaVersion>=6&&e)switch(e.type){case"Identifier":this.inAsync&&"await"===e.name&&this.raise(e.start,"Cannot use 'await' as identifier inside an async function");break;case"ObjectPattern":case"ArrayPattern":case"AssignmentPattern":case"RestElement":break;case"ObjectExpression":e.type="ObjectPattern",i&&this.checkPatternErrors(i,!0);for(var n=0,r=e.properties;n<r.length;n+=1){var s=r[n];this.toAssignable(s,t),"RestElement"!==s.type||"ArrayPattern"!==s.argument.type&&"ObjectPattern"!==s.argument.type||this.raise(s.argument.start,"Unexpected token")}break;case"Property":"init"!==e.kind&&this.raise(e.key.start,"Object pattern can't contain getter or setter"),this.toAssignable(e.value,t);break;case"ArrayExpression":e.type="ArrayPattern",i&&this.checkPatternErrors(i,!0),this.toAssignableList(e.elements,t);break;case"SpreadElement":e.type="RestElement",this.toAssignable(e.argument,t),"AssignmentPattern"===e.argument.type&&this.raise(e.argument.start,"Rest elements cannot have a default value");break;case"AssignmentExpression":"="!==e.operator&&this.raise(e.left.end,"Only '=' operator can be used for specifying default value."),e.type="AssignmentPattern",delete e.operator,this.toAssignable(e.left,t);break;case"ParenthesizedExpression":this.toAssignable(e.expression,t,i);break;case"ChainExpression":this.raiseRecoverable(e.start,"Optional chaining cannot appear in left-hand side");break;case"MemberExpression":if(!t)break;default:this.raise(e.start,"Assigning to rvalue")}else i&&this.checkPatternErrors(i,!0);return e},X.toAssignableList=function(e,t){for(var i=e.length,n=0;n<i;n++){var r=e[n];r&&this.toAssignable(r,t)}if(i){var s=e[i-1];6===this.options.ecmaVersion&&t&&s&&"RestElement"===s.type&&"Identifier"!==s.argument.type&&this.unexpected(s.argument.start)}return e},X.parseSpread=function(e){var t=this.startNode();return this.next(),t.argument=this.parseMaybeAssign(!1,e),this.finishNode(t,"SpreadElement")},X.parseRestBinding=function(){var e=this.startNode();return this.next(),6===this.options.ecmaVersion&&this.type!==S.name&&this.unexpected(),e.argument=this.parseBindingAtom(),this.finishNode(e,"RestElement")},X.parseBindingAtom=function(){if(this.options.ecmaVersion>=6)switch(this.type){case S.bracketL:var e=this.startNode();return this.next(),e.elements=this.parseBindingList(S.bracketR,!0,!0),this.finishNode(e,"ArrayPattern");case S.braceL:return this.parseObj(!0)}return this.parseIdent()},X.parseBindingList=function(e,t,i){for(var n=[],r=!0;!this.eat(e);)if(r?r=!1:this.expect(S.comma),t&&this.type===S.comma)n.push(null);else{if(i&&this.afterTrailingComma(e))break;if(this.type===S.ellipsis){var s=this.parseRestBinding();this.parseBindingListItem(s),n.push(s),this.type===S.comma&&this.raise(this.start,"Comma is not permitted after the rest element"),this.expect(e);break}var o=this.parseMaybeDefault(this.start,this.startLoc);this.parseBindingListItem(o),n.push(o)}return n},X.parseBindingListItem=function(e){return e},X.parseMaybeDefault=function(e,t,i){if(i=i||this.parseBindingAtom(),this.options.ecmaVersion<6||!this.eat(S.eq))return i;var n=this.startNodeAt(e,t);return n.left=i,n.right=this.parseMaybeAssign(),this.finishNode(n,"AssignmentPattern")},X.checkLValSimple=function(e,t,i){void 0===t&&(t=0);var n=0!==t;switch(e.type){case"Identifier":this.strict&&this.reservedWordsStrictBind.test(e.name)&&this.raiseRecoverable(e.start,(n?"Binding ":"Assigning to ")+e.name+" in strict mode"),n&&(2===t&&"let"===e.name&&this.raiseRecoverable(e.start,"let is disallowed as a lexically bound name"),i&&(R(i,e.name)&&this.raiseRecoverable(e.start,"Argument name clash"),i[e.name]=!0),5!==t&&this.declareName(e.name,t,e.start));break;case"ChainExpression":this.raiseRecoverable(e.start,"Optional chaining cannot appear in left-hand side");break;case"MemberExpression":n&&this.raiseRecoverable(e.start,"Binding member expression");break;case"ParenthesizedExpression":return n&&this.raiseRecoverable(e.start,"Binding parenthesized expression"),this.checkLValSimple(e.expression,t,i);default:this.raise(e.start,(n?"Binding":"Assigning to")+" rvalue")}},X.checkLValPattern=function(e,t,i){switch(void 0===t&&(t=0),e.type){case"ObjectPattern":for(var n=0,r=e.properties;n<r.length;n+=1){var s=r[n];this.checkLValInnerPattern(s,t,i)}break;case"ArrayPattern":for(var o=0,a=e.elements;o<a.length;o+=1){var c=a[o];c&&this.checkLValInnerPattern(c,t,i)}break;default:this.checkLValSimple(e,t,i)}},X.checkLValInnerPattern=function(e,t,i){switch(void 0===t&&(t=0),e.type){case"Property":this.checkLValInnerPattern(e.value,t,i);break;case"AssignmentPattern":this.checkLValPattern(e.left,t,i);break;case"RestElement":this.checkLValPattern(e.argument,t,i);break;default:this.checkLValPattern(e,t,i)}};var Z=K.prototype;function ee(e){return"MemberExpression"===e.type&&"PrivateIdentifier"===e.property.type||"ChainExpression"===e.type&&ee(e.expression)}Z.checkPropClash=function(e,t,i){if(!(this.options.ecmaVersion>=9&&"SpreadElement"===e.type||this.options.ecmaVersion>=6&&(e.computed||e.method||e.shorthand))){var n,r=e.key;switch(r.type){case"Identifier":n=r.name;break;case"Literal":n=String(r.value);break;default:return}var s=e.kind;if(this.options.ecmaVersion>=6)"__proto__"===n&&"init"===s&&(t.proto&&(i?i.doubleProto<0&&(i.doubleProto=r.start):this.raiseRecoverable(r.start,"Redefinition of __proto__ property")),t.proto=!0);else{var o=t[n="$"+n];o?("init"===s?this.strict&&o.init||o.get||o.set:o.init||o[s])&&this.raiseRecoverable(r.start,"Redefinition of property"):o=t[n]={init:!1,get:!1,set:!1},o[s]=!0}}},Z.parseExpression=function(e,t){var i=this.start,n=this.startLoc,r=this.parseMaybeAssign(e,t);if(this.type===S.comma){var s=this.startNodeAt(i,n);for(s.expressions=[r];this.eat(S.comma);)s.expressions.push(this.parseMaybeAssign(e,t));return this.finishNode(s,"SequenceExpression")}return r},Z.parseMaybeAssign=function(e,t,i){if(this.isContextual("yield")){if(this.inGenerator)return this.parseYield(e);this.exprAllowed=!1}var n=!1,r=-1,s=-1;t?(r=t.parenthesizedAssign,s=t.trailingComma,t.parenthesizedAssign=t.trailingComma=-1):(t=new V,n=!0);var o=this.start,a=this.startLoc;this.type!==S.parenL&&this.type!==S.name||(this.potentialArrowAt=this.start,this.potentialArrowInForAwait="await"===e);var c=this.parseMaybeConditional(e,t);if(i&&(c=i.call(this,c,o,a)),this.type.isAssign){var l=this.startNodeAt(o,a);return l.operator=this.value,this.type===S.eq&&(c=this.toAssignable(c,!1,t)),n||(t.parenthesizedAssign=t.trailingComma=t.doubleProto=-1),t.shorthandAssign>=c.start&&(t.shorthandAssign=-1),this.type===S.eq?this.checkLValPattern(c):this.checkLValSimple(c),l.left=c,this.next(),l.right=this.parseMaybeAssign(e),this.finishNode(l,"AssignmentExpression")}return n&&this.checkExpressionErrors(t,!0),r>-1&&(t.parenthesizedAssign=r),s>-1&&(t.trailingComma=s),c},Z.parseMaybeConditional=function(e,t){var i=this.start,n=this.startLoc,r=this.parseExprOps(e,t);if(this.checkExpressionErrors(t))return r;if(this.eat(S.question)){var s=this.startNodeAt(i,n);return s.test=r,s.consequent=this.parseMaybeAssign(),this.expect(S.colon),s.alternate=this.parseMaybeAssign(e),this.finishNode(s,"ConditionalExpression")}return r},Z.parseExprOps=function(e,t){var i=this.start,n=this.startLoc,r=this.parseMaybeUnary(t,!1);return this.checkExpressionErrors(t)||r.start===i&&"ArrowFunctionExpression"===r.type?r:this.parseExprOp(r,i,n,-1,e)},Z.parseExprOp=function(e,t,i,n,r){var s=this.type.binop;if(null!=s&&(!r||this.type!==S._in)&&s>n){var o=this.type===S.logicalOR||this.type===S.logicalAND,a=this.type===S.coalesce;a&&(s=S.logicalAND.binop);var c=this.value;this.next();var l=this.start,h=this.startLoc,u=this.parseExprOp(this.parseMaybeUnary(null,!1),l,h,s,r),d=this.buildBinary(t,i,e,u,c,o||a);return(o&&this.type===S.coalesce||a&&(this.type===S.logicalOR||this.type===S.logicalAND))&&this.raiseRecoverable(this.start,"Logical expressions and coalesce expressions cannot be mixed. Wrap either by parentheses"),this.parseExprOp(d,t,i,n,r)}return e},Z.buildBinary=function(e,t,i,n,r,s){var o=this.startNodeAt(e,t);return o.left=i,o.operator=r,o.right=n,this.finishNode(o,s?"LogicalExpression":"BinaryExpression")},Z.parseMaybeUnary=function(e,t,i){var n,r=this.start,s=this.startLoc;if(this.isContextual("await")&&this.canAwait)n=this.parseAwait(),t=!0;else if(this.type.prefix){var o=this.startNode(),a=this.type===S.incDec;o.operator=this.value,o.prefix=!0,this.next(),o.argument=this.parseMaybeUnary(null,!0,a),this.checkExpressionErrors(e,!0),a?this.checkLValSimple(o.argument):this.strict&&"delete"===o.operator&&"Identifier"===o.argument.type?this.raiseRecoverable(o.start,"Deleting local variable in strict mode"):"delete"===o.operator&&ee(o.argument)?this.raiseRecoverable(o.start,"Private fields can not be deleted"):t=!0,n=this.finishNode(o,a?"UpdateExpression":"UnaryExpression")}else{if(n=this.parseExprSubscripts(e),this.checkExpressionErrors(e))return n;for(;this.type.postfix&&!this.canInsertSemicolon();){var c=this.startNodeAt(r,s);c.operator=this.value,c.prefix=!1,c.argument=n,this.checkLValSimple(n),this.next(),n=this.finishNode(c,"UpdateExpression")}}return i||!this.eat(S.starstar)?n:t?void this.unexpected(this.lastTokStart):this.buildBinary(r,s,n,this.parseMaybeUnary(null,!1),"**",!1)},Z.parseExprSubscripts=function(e){var t=this.start,i=this.startLoc,n=this.parseExprAtom(e);if("ArrowFunctionExpression"===n.type&&")"!==this.input.slice(this.lastTokStart,this.lastTokEnd))return n;var r=this.parseSubscripts(n,t,i);return e&&"MemberExpression"===r.type&&(e.parenthesizedAssign>=r.start&&(e.parenthesizedAssign=-1),e.parenthesizedBind>=r.start&&(e.parenthesizedBind=-1),e.trailingComma>=r.start&&(e.trailingComma=-1)),r},Z.parseSubscripts=function(e,t,i,n){for(var r=this.options.ecmaVersion>=8&&"Identifier"===e.type&&"async"===e.name&&this.lastTokEnd===e.end&&!this.canInsertSemicolon()&&e.end-e.start==5&&this.potentialArrowAt===e.start,s=!1;;){var o=this.parseSubscript(e,t,i,n,r,s);if(o.optional&&(s=!0),o===e||"ArrowFunctionExpression"===o.type){if(s){var a=this.startNodeAt(t,i);a.expression=o,o=this.finishNode(a,"ChainExpression")}return o}e=o}},Z.parseSubscript=function(e,t,i,n,r,s){var o=this.options.ecmaVersion>=11,a=o&&this.eat(S.questionDot);n&&a&&this.raise(this.lastTokStart,"Optional chaining cannot appear in the callee of new expressions");var c=this.eat(S.bracketL);if(c||a&&this.type!==S.parenL&&this.type!==S.backQuote||this.eat(S.dot)){var l=this.startNodeAt(t,i);l.object=e,c?(l.property=this.parseExpression(),this.expect(S.bracketR)):this.type===S.privateId&&"Super"!==e.type?l.property=this.parsePrivateIdent():l.property=this.parseIdent("never"!==this.options.allowReserved),l.computed=!!c,o&&(l.optional=a),e=this.finishNode(l,"MemberExpression")}else if(!n&&this.eat(S.parenL)){var h=new V,u=this.yieldPos,d=this.awaitPos,p=this.awaitIdentPos;this.yieldPos=0,this.awaitPos=0,this.awaitIdentPos=0;var g=this.parseExprList(S.parenR,this.options.ecmaVersion>=8,!1,h);if(r&&!a&&!this.canInsertSemicolon()&&this.eat(S.arrow))return this.checkPatternErrors(h,!1),this.checkYieldAwaitInDefaultParams(),this.awaitIdentPos>0&&this.raise(this.awaitIdentPos,"Cannot use 'await' as identifier inside an async function"),this.yieldPos=u,this.awaitPos=d,this.awaitIdentPos=p,this.parseArrowExpression(this.startNodeAt(t,i),g,!0);this.checkExpressionErrors(h,!0),this.yieldPos=u||this.yieldPos,this.awaitPos=d||this.awaitPos,this.awaitIdentPos=p||this.awaitIdentPos;var f=this.startNodeAt(t,i);f.callee=e,f.arguments=g,o&&(f.optional=a),e=this.finishNode(f,"CallExpression")}else if(this.type===S.backQuote){(a||s)&&this.raise(this.start,"Optional chaining cannot appear in the tag of tagged template expressions");var m=this.startNodeAt(t,i);m.tag=e,m.quasi=this.parseTemplate({isTagged:!0}),e=this.finishNode(m,"TaggedTemplateExpression")}return e},Z.parseExprAtom=function(e){this.type===S.slash&&this.readRegexp();var t,i=this.potentialArrowAt===this.start;switch(this.type){case S._super:return this.allowSuper||this.raise(this.start,"'super' keyword outside a method"),t=this.startNode(),this.next(),this.type!==S.parenL||this.allowDirectSuper||this.raise(t.start,"super() call outside constructor of a subclass"),this.type!==S.dot&&this.type!==S.bracketL&&this.type!==S.parenL&&this.unexpected(),this.finishNode(t,"Super");case S._this:return t=this.startNode(),this.next(),this.finishNode(t,"ThisExpression");case S.name:var n=this.start,r=this.startLoc,s=this.containsEsc,o=this.parseIdent(!1);if(this.options.ecmaVersion>=8&&!s&&"async"===o.name&&!this.canInsertSemicolon()&&this.eat(S._function))return this.parseFunction(this.startNodeAt(n,r),0,!1,!0);if(i&&!this.canInsertSemicolon()){if(this.eat(S.arrow))return this.parseArrowExpression(this.startNodeAt(n,r),[o],!1);if(this.options.ecmaVersion>=8&&"async"===o.name&&this.type===S.name&&!s&&(!this.potentialArrowInForAwait||"of"!==this.value||this.containsEsc))return o=this.parseIdent(!1),!this.canInsertSemicolon()&&this.eat(S.arrow)||this.unexpected(),this.parseArrowExpression(this.startNodeAt(n,r),[o],!0)}return o;case S.regexp:var a=this.value;return(t=this.parseLiteral(a.value)).regex={pattern:a.pattern,flags:a.flags},t;case S.num:case S.string:return this.parseLiteral(this.value);case S._null:case S._true:case S._false:return(t=this.startNode()).value=this.type===S._null?null:this.type===S._true,t.raw=this.type.keyword,this.next(),this.finishNode(t,"Literal");case S.parenL:var c=this.start,l=this.parseParenAndDistinguishExpression(i);return e&&(e.parenthesizedAssign<0&&!this.isSimpleAssignTarget(l)&&(e.parenthesizedAssign=c),e.parenthesizedBind<0&&(e.parenthesizedBind=c)),l;case S.bracketL:return t=this.startNode(),this.next(),t.elements=this.parseExprList(S.bracketR,!0,!0,e),this.finishNode(t,"ArrayExpression");case S.braceL:return this.parseObj(!1,e);case S._function:return t=this.startNode(),this.next(),this.parseFunction(t,0);case S._class:return this.parseClass(this.startNode(),!1);case S._new:return this.parseNew();case S.backQuote:return this.parseTemplate();case S._import:return this.options.ecmaVersion>=11?this.parseExprImport():this.unexpected();default:this.unexpected()}},Z.parseExprImport=function(){var e=this.startNode();this.containsEsc&&this.raiseRecoverable(this.start,"Escape sequence in keyword import");var t=this.parseIdent(!0);switch(this.type){case S.parenL:return this.parseDynamicImport(e);case S.dot:return e.meta=t,this.parseImportMeta(e);default:this.unexpected()}},Z.parseDynamicImport=function(e){if(this.next(),e.source=this.parseMaybeAssign(),!this.eat(S.parenR)){var t=this.start;this.eat(S.comma)&&this.eat(S.parenR)?this.raiseRecoverable(t,"Trailing comma is not allowed in import()"):this.unexpected(t)}return this.finishNode(e,"ImportExpression")},Z.parseImportMeta=function(e){this.next();var t=this.containsEsc;return e.property=this.parseIdent(!0),"meta"!==e.property.name&&this.raiseRecoverable(e.property.start,"The only valid meta property for import is 'import.meta'"),t&&this.raiseRecoverable(e.start,"'import.meta' must not contain escaped characters"),"module"===this.options.sourceType||this.options.allowImportExportEverywhere||this.raiseRecoverable(e.start,"Cannot use 'import.meta' outside a module"),this.finishNode(e,"MetaProperty")},Z.parseLiteral=function(e){var t=this.startNode();return t.value=e,t.raw=this.input.slice(this.start,this.end),110===t.raw.charCodeAt(t.raw.length-1)&&(t.bigint=t.raw.slice(0,-1).replace(/_/g,"")),this.next(),this.finishNode(t,"Literal")},Z.parseParenExpression=function(){this.expect(S.parenL);var e=this.parseExpression();return this.expect(S.parenR),e},Z.parseParenAndDistinguishExpression=function(e){var t,i=this.start,n=this.startLoc,r=this.options.ecmaVersion>=8;if(this.options.ecmaVersion>=6){this.next();var s,o=this.start,a=this.startLoc,c=[],l=!0,h=!1,u=new V,d=this.yieldPos,p=this.awaitPos;for(this.yieldPos=0,this.awaitPos=0;this.type!==S.parenR;){if(l?l=!1:this.expect(S.comma),r&&this.afterTrailingComma(S.parenR,!0)){h=!0;break}if(this.type===S.ellipsis){s=this.start,c.push(this.parseParenItem(this.parseRestBinding())),this.type===S.comma&&this.raise(this.start,"Comma is not permitted after the rest element");break}c.push(this.parseMaybeAssign(!1,u,this.parseParenItem))}var g=this.start,f=this.startLoc;if(this.expect(S.parenR),e&&!this.canInsertSemicolon()&&this.eat(S.arrow))return this.checkPatternErrors(u,!1),this.checkYieldAwaitInDefaultParams(),this.yieldPos=d,this.awaitPos=p,this.parseParenArrowList(i,n,c);c.length&&!h||this.unexpected(this.lastTokStart),s&&this.unexpected(s),this.checkExpressionErrors(u,!0),this.yieldPos=d||this.yieldPos,this.awaitPos=p||this.awaitPos,c.length>1?((t=this.startNodeAt(o,a)).expressions=c,this.finishNodeAt(t,"SequenceExpression",g,f)):t=c[0]}else t=this.parseParenExpression();if(this.options.preserveParens){var m=this.startNodeAt(i,n);return m.expression=t,this.finishNode(m,"ParenthesizedExpression")}return t},Z.parseParenItem=function(e){return e},Z.parseParenArrowList=function(e,t,i){return this.parseArrowExpression(this.startNodeAt(e,t),i)};var te=[];Z.parseNew=function(){this.containsEsc&&this.raiseRecoverable(this.start,"Escape sequence in keyword new");var e=this.startNode(),t=this.parseIdent(!0);if(this.options.ecmaVersion>=6&&this.eat(S.dot)){e.meta=t;var i=this.containsEsc;return e.property=this.parseIdent(!0),"target"!==e.property.name&&this.raiseRecoverable(e.property.start,"The only valid meta property for new is 'new.target'"),i&&this.raiseRecoverable(e.start,"'new.target' must not contain escaped characters"),this.inNonArrowFunction||this.raiseRecoverable(e.start,"'new.target' can only be used in functions"),this.finishNode(e,"MetaProperty")}var n=this.start,r=this.startLoc,s=this.type===S._import;return e.callee=this.parseSubscripts(this.parseExprAtom(),n,r,!0),s&&"ImportExpression"===e.callee.type&&this.raise(n,"Cannot use new with import()"),this.eat(S.parenL)?e.arguments=this.parseExprList(S.parenR,this.options.ecmaVersion>=8,!1):e.arguments=te,this.finishNode(e,"NewExpression")},Z.parseTemplateElement=function(e){var t=e.isTagged,i=this.startNode();return this.type===S.invalidTemplate?(t||this.raiseRecoverable(this.start,"Bad escape sequence in untagged template literal"),i.value={raw:this.value,cooked:null}):i.value={raw:this.input.slice(this.start,this.end).replace(/\r\n?/g,"\n"),cooked:this.value},this.next(),i.tail=this.type===S.backQuote,this.finishNode(i,"TemplateElement")},Z.parseTemplate=function(e){void 0===e&&(e={});var t=e.isTagged;void 0===t&&(t=!1);var i=this.startNode();this.next(),i.expressions=[];var n=this.parseTemplateElement({isTagged:t});for(i.quasis=[n];!n.tail;)this.type===S.eof&&this.raise(this.pos,"Unterminated template literal"),this.expect(S.dollarBraceL),i.expressions.push(this.parseExpression()),this.expect(S.braceR),i.quasis.push(n=this.parseTemplateElement({isTagged:t}));return this.next(),this.finishNode(i,"TemplateLiteral")},Z.isAsyncProp=function(e){return!e.computed&&"Identifier"===e.key.type&&"async"===e.key.name&&(this.type===S.name||this.type===S.num||this.type===S.string||this.type===S.bracketL||this.type.keyword||this.options.ecmaVersion>=9&&this.type===S.star)&&!b.test(this.input.slice(this.lastTokEnd,this.start))},Z.parseObj=function(e,t){var i=this.startNode(),n=!0,r={};for(i.properties=[],this.next();!this.eat(S.braceR);){if(n)n=!1;else if(this.expect(S.comma),this.options.ecmaVersion>=5&&this.afterTrailingComma(S.braceR))break;var s=this.parseProperty(e,t);e||this.checkPropClash(s,r,t),i.properties.push(s)}return this.finishNode(i,e?"ObjectPattern":"ObjectExpression")},Z.parseProperty=function(e,t){var i,n,r,s,o=this.startNode();if(this.options.ecmaVersion>=9&&this.eat(S.ellipsis))return e?(o.argument=this.parseIdent(!1),this.type===S.comma&&this.raise(this.start,"Comma is not permitted after the rest element"),this.finishNode(o,"RestElement")):(this.type===S.parenL&&t&&(t.parenthesizedAssign<0&&(t.parenthesizedAssign=this.start),t.parenthesizedBind<0&&(t.parenthesizedBind=this.start)),o.argument=this.parseMaybeAssign(!1,t),this.type===S.comma&&t&&t.trailingComma<0&&(t.trailingComma=this.start),this.finishNode(o,"SpreadElement"));this.options.ecmaVersion>=6&&(o.method=!1,o.shorthand=!1,(e||t)&&(r=this.start,s=this.startLoc),e||(i=this.eat(S.star)));var a=this.containsEsc;return this.parsePropertyName(o),!e&&!a&&this.options.ecmaVersion>=8&&!i&&this.isAsyncProp(o)?(n=!0,i=this.options.ecmaVersion>=9&&this.eat(S.star),this.parsePropertyName(o,t)):n=!1,this.parsePropertyValue(o,e,i,n,r,s,t,a),this.finishNode(o,"Property")},Z.parsePropertyValue=function(e,t,i,n,r,s,o,a){if((i||n)&&this.type===S.colon&&this.unexpected(),this.eat(S.colon))e.value=t?this.parseMaybeDefault(this.start,this.startLoc):this.parseMaybeAssign(!1,o),e.kind="init";else if(this.options.ecmaVersion>=6&&this.type===S.parenL)t&&this.unexpected(),e.kind="init",e.method=!0,e.value=this.parseMethod(i,n);else if(t||a||!(this.options.ecmaVersion>=5)||e.computed||"Identifier"!==e.key.type||"get"!==e.key.name&&"set"!==e.key.name||this.type===S.comma||this.type===S.braceR||this.type===S.eq)this.options.ecmaVersion>=6&&!e.computed&&"Identifier"===e.key.type?((i||n)&&this.unexpected(),this.checkUnreserved(e.key),"await"!==e.key.name||this.awaitIdentPos||(this.awaitIdentPos=r),e.kind="init",t?e.value=this.parseMaybeDefault(r,s,this.copyNode(e.key)):this.type===S.eq&&o?(o.shorthandAssign<0&&(o.shorthandAssign=this.start),e.value=this.parseMaybeDefault(r,s,this.copyNode(e.key))):e.value=this.copyNode(e.key),e.shorthand=!0):this.unexpected();else{(i||n)&&this.unexpected(),e.kind=e.key.name,this.parsePropertyName(e),e.value=this.parseMethod(!1);var c="get"===e.kind?0:1;if(e.value.params.length!==c){var l=e.value.start;"get"===e.kind?this.raiseRecoverable(l,"getter should have no params"):this.raiseRecoverable(l,"setter should have exactly one param")}else"set"===e.kind&&"RestElement"===e.value.params[0].type&&this.raiseRecoverable(e.value.params[0].start,"Setter cannot use rest params")}},Z.parsePropertyName=function(e){if(this.options.ecmaVersion>=6){if(this.eat(S.bracketL))return e.computed=!0,e.key=this.parseMaybeAssign(),this.expect(S.bracketR),e.key;e.computed=!1}return e.key=this.type===S.num||this.type===S.string?this.parseExprAtom():this.parseIdent("never"!==this.options.allowReserved)},Z.initFunction=function(e){e.id=null,this.options.ecmaVersion>=6&&(e.generator=e.expression=!1),this.options.ecmaVersion>=8&&(e.async=!1)},Z.parseMethod=function(e,t,i){var n=this.startNode(),r=this.yieldPos,s=this.awaitPos,o=this.awaitIdentPos;return this.initFunction(n),this.options.ecmaVersion>=6&&(n.generator=e),this.options.ecmaVersion>=8&&(n.async=!!t),this.yieldPos=0,this.awaitPos=0,this.awaitIdentPos=0,this.enterScope(64|L(t,n.generator)|(i?128:0)),this.expect(S.parenL),n.params=this.parseBindingList(S.parenR,!1,this.options.ecmaVersion>=8),this.checkYieldAwaitInDefaultParams(),this.parseFunctionBody(n,!1,!0),this.yieldPos=r,this.awaitPos=s,this.awaitIdentPos=o,this.finishNode(n,"FunctionExpression")},Z.parseArrowExpression=function(e,t,i){var n=this.yieldPos,r=this.awaitPos,s=this.awaitIdentPos;return this.enterScope(16|L(i,!1)),this.initFunction(e),this.options.ecmaVersion>=8&&(e.async=!!i),this.yieldPos=0,this.awaitPos=0,this.awaitIdentPos=0,e.params=this.toAssignableList(t,!0),this.parseFunctionBody(e,!0,!1),this.yieldPos=n,this.awaitPos=r,this.awaitIdentPos=s,this.finishNode(e,"ArrowFunctionExpression")},Z.parseFunctionBody=function(e,t,i){var n=t&&this.type!==S.braceL,r=this.strict,s=!1;if(n)e.body=this.parseMaybeAssign(),e.expression=!0,this.checkParams(e,!1);else{var o=this.options.ecmaVersion>=7&&!this.isSimpleParamList(e.params);r&&!o||(s=this.strictDirective(this.end))&&o&&this.raiseRecoverable(e.start,"Illegal 'use strict' directive in function with non-simple parameter list");var a=this.labels;this.labels=[],s&&(this.strict=!0),this.checkParams(e,!r&&!s&&!t&&!i&&this.isSimpleParamList(e.params)),this.strict&&e.id&&this.checkLValSimple(e.id,5),e.body=this.parseBlock(!1,void 0,s&&!r),e.expression=!1,this.adaptDirectivePrologue(e.body.body),this.labels=a}this.exitScope()},Z.isSimpleParamList=function(e){for(var t=0,i=e;t<i.length;t+=1)if("Identifier"!==i[t].type)return!1;return!0},Z.checkParams=function(e,t){for(var i=Object.create(null),n=0,r=e.params;n<r.length;n+=1){var s=r[n];this.checkLValInnerPattern(s,1,t?null:i)}},Z.parseExprList=function(e,t,i,n){for(var r=[],s=!0;!this.eat(e);){if(s)s=!1;else if(this.expect(S.comma),t&&this.afterTrailingComma(e))break;var o=void 0;i&&this.type===S.comma?o=null:this.type===S.ellipsis?(o=this.parseSpread(n),n&&this.type===S.comma&&n.trailingComma<0&&(n.trailingComma=this.start)):o=this.parseMaybeAssign(!1,n),r.push(o)}return r},Z.checkUnreserved=function(e){var t=e.start,i=e.end,n=e.name;this.inGenerator&&"yield"===n&&this.raiseRecoverable(t,"Cannot use 'yield' as identifier inside a generator"),this.inAsync&&"await"===n&&this.raiseRecoverable(t,"Cannot use 'await' as identifier inside an async function"),this.currentThisScope().inClassFieldInit&&"arguments"===n&&this.raiseRecoverable(t,"Cannot use 'arguments' in class field initializer"),this.keywords.test(n)&&this.raise(t,"Unexpected keyword '"+n+"'"),this.options.ecmaVersion<6&&-1!==this.input.slice(t,i).indexOf("\\")||(this.strict?this.reservedWordsStrict:this.reservedWords).test(n)&&(this.inAsync||"await"!==n||this.raiseRecoverable(t,"Cannot use keyword 'await' outside an async function"),this.raiseRecoverable(t,"The keyword '"+n+"' is reserved"))},Z.parseIdent=function(e,t){var i=this.startNode();return this.type===S.name?i.name=this.value:this.type.keyword?(i.name=this.type.keyword,"class"!==i.name&&"function"!==i.name||this.lastTokEnd===this.lastTokStart+1&&46===this.input.charCodeAt(this.lastTokStart)||this.context.pop()):this.unexpected(),this.next(!!e),this.finishNode(i,"Identifier"),e||(this.checkUnreserved(i),"await"!==i.name||this.awaitIdentPos||(this.awaitIdentPos=i.start)),i},Z.parsePrivateIdent=function(){var e=this.startNode();return this.type===S.privateId?e.name=this.value:this.unexpected(),this.next(),this.finishNode(e,"PrivateIdentifier"),0===this.privateNameStack.length?this.raise(e.start,"Private field '#"+e.name+"' must be declared in an enclosing class"):this.privateNameStack[this.privateNameStack.length-1].used.push(e),e},Z.parseYield=function(e){this.yieldPos||(this.yieldPos=this.start);var t=this.startNode();return this.next(),this.type===S.semi||this.canInsertSemicolon()||this.type!==S.star&&!this.type.startsExpr?(t.delegate=!1,t.argument=null):(t.delegate=this.eat(S.star),t.argument=this.parseMaybeAssign(e)),this.finishNode(t,"YieldExpression")},Z.parseAwait=function(){this.awaitPos||(this.awaitPos=this.start);var e=this.startNode();return this.next(),e.argument=this.parseMaybeUnary(null,!0),this.finishNode(e,"AwaitExpression")};var ie=K.prototype;ie.raise=function(e,t){var i=M(this.input,e);t+=" ("+i.line+":"+i.column+")";var n=new SyntaxError(t);throw n.pos=e,n.loc=i,n.raisedAt=this.pos,n},ie.raiseRecoverable=ie.raise,ie.curPosition=function(){if(this.options.locations)return new P(this.curLine,this.pos-this.lineStart)};var ne=K.prototype,re=function(e){this.flags=e,this.var=[],this.lexical=[],this.functions=[],this.inClassFieldInit=!1};ne.enterScope=function(e){this.scopeStack.push(new re(e))},ne.exitScope=function(){this.scopeStack.pop()},ne.treatFunctionsAsVarInScope=function(e){return 2&e.flags||!this.inModule&&1&e.flags},ne.declareName=function(e,t,i){var n=!1;if(2===t){var r=this.currentScope();n=r.lexical.indexOf(e)>-1||r.functions.indexOf(e)>-1||r.var.indexOf(e)>-1,r.lexical.push(e),this.inModule&&1&r.flags&&delete this.undefinedExports[e]}else if(4===t)this.currentScope().lexical.push(e);else if(3===t){var s=this.currentScope();n=this.treatFunctionsAsVar?s.lexical.indexOf(e)>-1:s.lexical.indexOf(e)>-1||s.var.indexOf(e)>-1,s.functions.push(e)}else for(var o=this.scopeStack.length-1;o>=0;--o){var a=this.scopeStack[o];if(a.lexical.indexOf(e)>-1&&!(32&a.flags&&a.lexical[0]===e)||!this.treatFunctionsAsVarInScope(a)&&a.functions.indexOf(e)>-1){n=!0;break}if(a.var.push(e),this.inModule&&1&a.flags&&delete this.undefinedExports[e],3&a.flags)break}n&&this.raiseRecoverable(i,"Identifier '"+e+"' has already been declared")},ne.checkLocalExport=function(e){-1===this.scopeStack[0].lexical.indexOf(e.name)&&-1===this.scopeStack[0].var.indexOf(e.name)&&(this.undefinedExports[e.name]=e)},ne.currentScope=function(){return this.scopeStack[this.scopeStack.length-1]},ne.currentVarScope=function(){for(var e=this.scopeStack.length-1;;e--){var t=this.scopeStack[e];if(3&t.flags)return t}},ne.currentThisScope=function(){for(var e=this.scopeStack.length-1;;e--){var t=this.scopeStack[e];if(3&t.flags&&!(16&t.flags))return t}};var se=function(e,t,i){this.type="",this.start=t,this.end=0,e.options.locations&&(this.loc=new D(e,i)),e.options.directSourceFile&&(this.sourceFile=e.options.directSourceFile),e.options.ranges&&(this.range=[t,0])},oe=K.prototype;function ae(e,t,i,n){return e.type=t,e.end=i,this.options.locations&&(e.loc.end=n),this.options.ranges&&(e.range[1]=i),e}oe.startNode=function(){return new se(this,this.start,this.startLoc)},oe.startNodeAt=function(e,t){return new se(this,e,t)},oe.finishNode=function(e,t){return ae.call(this,e,t,this.lastTokEnd,this.lastTokEndLoc)},oe.finishNodeAt=function(e,t,i,n){return ae.call(this,e,t,i,n)},oe.copyNode=function(e){var t=new se(this,e.start,this.startLoc);for(var i in e)t[i]=e[i];return t};var ce=function(e,t,i,n,r){this.token=e,this.isExpr=!!t,this.preserveSpace=!!i,this.override=n,this.generator=!!r},le={b_stat:new ce("{",!1),b_expr:new ce("{",!0),b_tmpl:new ce("${",!1),p_stat:new ce("(",!1),p_expr:new ce("(",!0),q_tmpl:new ce("`",!0,!0,(function(e){return e.tryReadTemplateToken()})),f_stat:new ce("function",!1),f_expr:new ce("function",!0),f_expr_gen:new ce("function",!0,!1,null,!0),f_gen:new ce("function",!1,!1,null,!0)},he=K.prototype;he.initialContext=function(){return[le.b_stat]},he.braceIsBlock=function(e){var t=this.curContext();return t===le.f_expr||t===le.f_stat||(e!==S.colon||t!==le.b_stat&&t!==le.b_expr?e===S._return||e===S.name&&this.exprAllowed?b.test(this.input.slice(this.lastTokEnd,this.start)):e===S._else||e===S.semi||e===S.eof||e===S.parenR||e===S.arrow||(e===S.braceL?t===le.b_stat:e!==S._var&&e!==S._const&&e!==S.name&&!this.exprAllowed):!t.isExpr)},he.inGeneratorContext=function(){for(var e=this.context.length-1;e>=1;e--){var t=this.context[e];if("function"===t.token)return t.generator}return!1},he.updateContext=function(e){var t,i=this.type;i.keyword&&e===S.dot?this.exprAllowed=!1:(t=i.updateContext)?t.call(this,e):this.exprAllowed=i.beforeExpr},S.parenR.updateContext=S.braceR.updateContext=function(){if(1!==this.context.length){var e=this.context.pop();e===le.b_stat&&"function"===this.curContext().token&&(e=this.context.pop()),this.exprAllowed=!e.isExpr}else this.exprAllowed=!0},S.braceL.updateContext=function(e){this.context.push(this.braceIsBlock(e)?le.b_stat:le.b_expr),this.exprAllowed=!0},S.dollarBraceL.updateContext=function(){this.context.push(le.b_tmpl),this.exprAllowed=!0},S.parenL.updateContext=function(e){var t=e===S._if||e===S._for||e===S._with||e===S._while;this.context.push(t?le.p_stat:le.p_expr),this.exprAllowed=!0},S.incDec.updateContext=function(){},S._function.updateContext=S._class.updateContext=function(e){!e.beforeExpr||e===S._else||e===S.semi&&this.curContext()!==le.p_stat||e===S._return&&b.test(this.input.slice(this.lastTokEnd,this.start))||(e===S.colon||e===S.braceL)&&this.curContext()===le.b_stat?this.context.push(le.f_stat):this.context.push(le.f_expr),this.exprAllowed=!1},S.backQuote.updateContext=function(){this.curContext()===le.q_tmpl?this.context.pop():this.context.push(le.q_tmpl),this.exprAllowed=!1},S.star.updateContext=function(e){if(e===S._function){var t=this.context.length-1;this.context[t]===le.f_expr?this.context[t]=le.f_expr_gen:this.context[t]=le.f_gen}this.exprAllowed=!0},S.name.updateContext=function(e){var t=!1;this.options.ecmaVersion>=6&&e!==S.dot&&("of"===this.value&&!this.exprAllowed||"yield"===this.value&&this.inGeneratorContext())&&(t=!0),this.exprAllowed=t};var ue="ASCII ASCII_Hex_Digit AHex Alphabetic Alpha Any Assigned Bidi_Control Bidi_C Bidi_Mirrored Bidi_M Case_Ignorable CI Cased Changes_When_Casefolded CWCF Changes_When_Casemapped CWCM Changes_When_Lowercased CWL Changes_When_NFKC_Casefolded CWKCF Changes_When_Titlecased CWT Changes_When_Uppercased CWU Dash Default_Ignorable_Code_Point DI Deprecated Dep Diacritic Dia Emoji Emoji_Component Emoji_Modifier Emoji_Modifier_Base Emoji_Presentation Extender Ext Grapheme_Base Gr_Base Grapheme_Extend Gr_Ext Hex_Digit Hex IDS_Binary_Operator IDSB IDS_Trinary_Operator IDST ID_Continue IDC ID_Start IDS Ideographic Ideo Join_Control Join_C Logical_Order_Exception LOE Lowercase Lower Math Noncharacter_Code_Point NChar Pattern_Syntax Pat_Syn Pattern_White_Space Pat_WS Quotation_Mark QMark Radical Regional_Indicator RI Sentence_Terminal STerm Soft_Dotted SD Terminal_Punctuation Term Unified_Ideograph UIdeo Uppercase Upper Variation_Selector VS White_Space space XID_Continue XIDC XID_Start XIDS",de=ue+" Extended_Pictographic",pe={9:ue,10:de,11:de,12:de+" EBase EComp EMod EPres ExtPict"},ge="Cased_Letter LC Close_Punctuation Pe Connector_Punctuation Pc Control Cc cntrl Currency_Symbol Sc Dash_Punctuation Pd Decimal_Number Nd digit Enclosing_Mark Me Final_Punctuation Pf Format Cf Initial_Punctuation Pi Letter L Letter_Number Nl Line_Separator Zl Lowercase_Letter Ll Mark M Combining_Mark Math_Symbol Sm Modifier_Letter Lm Modifier_Symbol Sk Nonspacing_Mark Mn Number N Open_Punctuation Ps Other C Other_Letter Lo Other_Number No Other_Punctuation Po Other_Symbol So Paragraph_Separator Zp Private_Use Co Punctuation P punct Separator Z Space_Separator Zs Spacing_Mark Mc Surrogate Cs Symbol S Titlecase_Letter Lt Unassigned Cn Uppercase_Letter Lu",fe="Adlam Adlm Ahom Ahom Anatolian_Hieroglyphs Hluw Arabic Arab Armenian Armn Avestan Avst Balinese Bali Bamum Bamu Bassa_Vah Bass Batak Batk Bengali Beng Bhaiksuki Bhks Bopomofo Bopo Brahmi Brah Braille Brai Buginese Bugi Buhid Buhd Canadian_Aboriginal Cans Carian Cari Caucasian_Albanian Aghb Chakma Cakm Cham Cham Cherokee Cher Common Zyyy Coptic Copt Qaac Cuneiform Xsux Cypriot Cprt Cyrillic Cyrl Deseret Dsrt Devanagari Deva Duployan Dupl Egyptian_Hieroglyphs Egyp Elbasan Elba Ethiopic Ethi Georgian Geor Glagolitic Glag Gothic Goth Grantha Gran Greek Grek Gujarati Gujr Gurmukhi Guru Han Hani Hangul Hang Hanunoo Hano Hatran Hatr Hebrew Hebr Hiragana Hira Imperial_Aramaic Armi Inherited Zinh Qaai Inscriptional_Pahlavi Phli Inscriptional_Parthian Prti Javanese Java Kaithi Kthi Kannada Knda Katakana Kana Kayah_Li Kali Kharoshthi Khar Khmer Khmr Khojki Khoj Khudawadi Sind Lao Laoo Latin Latn Lepcha Lepc Limbu Limb Linear_A Lina Linear_B Linb Lisu Lisu Lycian Lyci Lydian Lydi Mahajani Mahj Malayalam Mlym Mandaic Mand Manichaean Mani Marchen Marc Masaram_Gondi Gonm Meetei_Mayek Mtei Mende_Kikakui Mend Meroitic_Cursive Merc Meroitic_Hieroglyphs Mero Miao Plrd Modi Modi Mongolian Mong Mro Mroo Multani Mult Myanmar Mymr Nabataean Nbat New_Tai_Lue Talu Newa Newa Nko Nkoo Nushu Nshu Ogham Ogam Ol_Chiki Olck Old_Hungarian Hung Old_Italic Ital Old_North_Arabian Narb Old_Permic Perm Old_Persian Xpeo Old_South_Arabian Sarb Old_Turkic Orkh Oriya Orya Osage Osge Osmanya Osma Pahawh_Hmong Hmng Palmyrene Palm Pau_Cin_Hau Pauc Phags_Pa Phag Phoenician Phnx Psalter_Pahlavi Phlp Rejang Rjng Runic Runr Samaritan Samr Saurashtra Saur Sharada Shrd Shavian Shaw Siddham Sidd SignWriting Sgnw Sinhala Sinh Sora_Sompeng Sora Soyombo Soyo Sundanese Sund Syloti_Nagri Sylo Syriac Syrc Tagalog Tglg Tagbanwa Tagb Tai_Le Tale Tai_Tham Lana Tai_Viet Tavt Takri Takr Tamil Taml Tangut Tang Telugu Telu Thaana Thaa Thai Thai Tibetan Tibt Tifinagh Tfng Tirhuta Tirh Ugaritic Ugar Vai Vaii Warang_Citi Wara Yi Yiii Zanabazar_Square Zanb",me=fe+" Dogra Dogr Gunjala_Gondi Gong Hanifi_Rohingya Rohg Makasar Maka Medefaidrin Medf Old_Sogdian Sogo Sogdian Sogd",ve=me+" Elymaic Elym Nandinagari Nand Nyiakeng_Puachue_Hmong Hmnp Wancho Wcho",ye={9:fe,10:me,11:ve,12:ve+" Chorasmian Chrs Diak Dives_Akuru Khitan_Small_Script Kits Yezi Yezidi"},_e={};function Se(e){var t=_e[e]={binary:A(pe[e]+" "+ge),nonBinary:{General_Category:A(ge),Script:A(ye[e])}};t.nonBinary.Script_Extensions=t.nonBinary.Script,t.nonBinary.gc=t.nonBinary.General_Category,t.nonBinary.sc=t.nonBinary.Script,t.nonBinary.scx=t.nonBinary.Script_Extensions}Se(9),Se(10),Se(11),Se(12);var be=K.prototype,we=function(e){this.parser=e,this.validFlags="gim"+(e.options.ecmaVersion>=6?"uy":"")+(e.options.ecmaVersion>=9?"s":"")+(e.options.ecmaVersion>=13?"d":""),this.unicodeProperties=_e[e.options.ecmaVersion>=12?12:e.options.ecmaVersion],this.source="",this.flags="",this.start=0,this.switchU=!1,this.switchN=!1,this.pos=0,this.lastIntValue=0,this.lastStringValue="",this.lastAssertionIsQuantifiable=!1,this.numCapturingParens=0,this.maxBackReference=0,this.groupNames=[],this.backReferenceNames=[]};function Ee(e){return e<=65535?String.fromCharCode(e):(e-=65536,String.fromCharCode(55296+(e>>10),56320+(1023&e)))}function Ie(e){return 36===e||e>=40&&e<=43||46===e||63===e||e>=91&&e<=94||e>=123&&e<=125}function ke(e){return e>=65&&e<=90||e>=97&&e<=122}function Te(e){return ke(e)||95===e}function Ce(e){return Te(e)||xe(e)}function xe(e){return e>=48&&e<=57}function Re(e){return e>=48&&e<=57||e>=65&&e<=70||e>=97&&e<=102}function Oe(e){return e>=65&&e<=70?e-65+10:e>=97&&e<=102?e-97+10:e-48}function Ae(e){return e>=48&&e<=55}we.prototype.reset=function(e,t,i){var n=-1!==i.indexOf("u");this.start=0|e,this.source=t+"",this.flags=i,this.switchU=n&&this.parser.options.ecmaVersion>=6,this.switchN=n&&this.parser.options.ecmaVersion>=9},we.prototype.raise=function(e){this.parser.raiseRecoverable(this.start,"Invalid regular expression: /"+this.source+"/: "+e)},we.prototype.at=function(e,t){void 0===t&&(t=!1);var i=this.source,n=i.length;if(e>=n)return-1;var r=i.charCodeAt(e);if(!t&&!this.switchU||r<=55295||r>=57344||e+1>=n)return r;var s=i.charCodeAt(e+1);return s>=56320&&s<=57343?(r<<10)+s-56613888:r},we.prototype.nextIndex=function(e,t){void 0===t&&(t=!1);var i=this.source,n=i.length;if(e>=n)return n;var r,s=i.charCodeAt(e);return!t&&!this.switchU||s<=55295||s>=57344||e+1>=n||(r=i.charCodeAt(e+1))<56320||r>57343?e+1:e+2},we.prototype.current=function(e){return void 0===e&&(e=!1),this.at(this.pos,e)},we.prototype.lookahead=function(e){return void 0===e&&(e=!1),this.at(this.nextIndex(this.pos,e),e)},we.prototype.advance=function(e){void 0===e&&(e=!1),this.pos=this.nextIndex(this.pos,e)},we.prototype.eat=function(e,t){return void 0===t&&(t=!1),this.current(t)===e&&(this.advance(t),!0)},be.validateRegExpFlags=function(e){for(var t=e.validFlags,i=e.flags,n=0;n<i.length;n++){var r=i.charAt(n);-1===t.indexOf(r)&&this.raise(e.start,"Invalid regular expression flag"),i.indexOf(r,n+1)>-1&&this.raise(e.start,"Duplicate regular expression flag")}},be.validateRegExpPattern=function(e){this.regexp_pattern(e),!e.switchN&&this.options.ecmaVersion>=9&&e.groupNames.length>0&&(e.switchN=!0,this.regexp_pattern(e))},be.regexp_pattern=function(e){e.pos=0,e.lastIntValue=0,e.lastStringValue="",e.lastAssertionIsQuantifiable=!1,e.numCapturingParens=0,e.maxBackReference=0,e.groupNames.length=0,e.backReferenceNames.length=0,this.regexp_disjunction(e),e.pos!==e.source.length&&(e.eat(41)&&e.raise("Unmatched ')'"),(e.eat(93)||e.eat(125))&&e.raise("Lone quantifier brackets")),e.maxBackReference>e.numCapturingParens&&e.raise("Invalid escape");for(var t=0,i=e.backReferenceNames;t<i.length;t+=1){var n=i[t];-1===e.groupNames.indexOf(n)&&e.raise("Invalid named capture referenced")}},be.regexp_disjunction=function(e){for(this.regexp_alternative(e);e.eat(124);)this.regexp_alternative(e);this.regexp_eatQuantifier(e,!0)&&e.raise("Nothing to repeat"),e.eat(123)&&e.raise("Lone quantifier brackets")},be.regexp_alternative=function(e){for(;e.pos<e.source.length&&this.regexp_eatTerm(e););},be.regexp_eatTerm=function(e){return this.regexp_eatAssertion(e)?(e.lastAssertionIsQuantifiable&&this.regexp_eatQuantifier(e)&&e.switchU&&e.raise("Invalid quantifier"),!0):!!(e.switchU?this.regexp_eatAtom(e):this.regexp_eatExtendedAtom(e))&&(this.regexp_eatQuantifier(e),!0)},be.regexp_eatAssertion=function(e){var t=e.pos;if(e.lastAssertionIsQuantifiable=!1,e.eat(94)||e.eat(36))return!0;if(e.eat(92)){if(e.eat(66)||e.eat(98))return!0;e.pos=t}if(e.eat(40)&&e.eat(63)){var i=!1;if(this.options.ecmaVersion>=9&&(i=e.eat(60)),e.eat(61)||e.eat(33))return this.regexp_disjunction(e),e.eat(41)||e.raise("Unterminated group"),e.lastAssertionIsQuantifiable=!i,!0}return e.pos=t,!1},be.regexp_eatQuantifier=function(e,t){return void 0===t&&(t=!1),!!this.regexp_eatQuantifierPrefix(e,t)&&(e.eat(63),!0)},be.regexp_eatQuantifierPrefix=function(e,t){return e.eat(42)||e.eat(43)||e.eat(63)||this.regexp_eatBracedQuantifier(e,t)},be.regexp_eatBracedQuantifier=function(e,t){var i=e.pos;if(e.eat(123)){var n=0,r=-1;if(this.regexp_eatDecimalDigits(e)&&(n=e.lastIntValue,e.eat(44)&&this.regexp_eatDecimalDigits(e)&&(r=e.lastIntValue),e.eat(125)))return-1!==r&&r<n&&!t&&e.raise("numbers out of order in {} quantifier"),!0;e.switchU&&!t&&e.raise("Incomplete quantifier"),e.pos=i}return!1},be.regexp_eatAtom=function(e){return this.regexp_eatPatternCharacters(e)||e.eat(46)||this.regexp_eatReverseSolidusAtomEscape(e)||this.regexp_eatCharacterClass(e)||this.regexp_eatUncapturingGroup(e)||this.regexp_eatCapturingGroup(e)},be.regexp_eatReverseSolidusAtomEscape=function(e){var t=e.pos;if(e.eat(92)){if(this.regexp_eatAtomEscape(e))return!0;e.pos=t}return!1},be.regexp_eatUncapturingGroup=function(e){var t=e.pos;if(e.eat(40)){if(e.eat(63)&&e.eat(58)){if(this.regexp_disjunction(e),e.eat(41))return!0;e.raise("Unterminated group")}e.pos=t}return!1},be.regexp_eatCapturingGroup=function(e){if(e.eat(40)){if(this.options.ecmaVersion>=9?this.regexp_groupSpecifier(e):63===e.current()&&e.raise("Invalid group"),this.regexp_disjunction(e),e.eat(41))return e.numCapturingParens+=1,!0;e.raise("Unterminated group")}return!1},be.regexp_eatExtendedAtom=function(e){return e.eat(46)||this.regexp_eatReverseSolidusAtomEscape(e)||this.regexp_eatCharacterClass(e)||this.regexp_eatUncapturingGroup(e)||this.regexp_eatCapturingGroup(e)||this.regexp_eatInvalidBracedQuantifier(e)||this.regexp_eatExtendedPatternCharacter(e)},be.regexp_eatInvalidBracedQuantifier=function(e){return this.regexp_eatBracedQuantifier(e,!0)&&e.raise("Nothing to repeat"),!1},be.regexp_eatSyntaxCharacter=function(e){var t=e.current();return!!Ie(t)&&(e.lastIntValue=t,e.advance(),!0)},be.regexp_eatPatternCharacters=function(e){for(var t=e.pos,i=0;-1!==(i=e.current())&&!Ie(i);)e.advance();return e.pos!==t},be.regexp_eatExtendedPatternCharacter=function(e){var t=e.current();return!(-1===t||36===t||t>=40&&t<=43||46===t||63===t||91===t||94===t||124===t||(e.advance(),0))},be.regexp_groupSpecifier=function(e){if(e.eat(63)){if(this.regexp_eatGroupName(e))return-1!==e.groupNames.indexOf(e.lastStringValue)&&e.raise("Duplicate capture group name"),void e.groupNames.push(e.lastStringValue);e.raise("Invalid group")}},be.regexp_eatGroupName=function(e){if(e.lastStringValue="",e.eat(60)){if(this.regexp_eatRegExpIdentifierName(e)&&e.eat(62))return!0;e.raise("Invalid capture group name")}return!1},be.regexp_eatRegExpIdentifierName=function(e){if(e.lastStringValue="",this.regexp_eatRegExpIdentifierStart(e)){for(e.lastStringValue+=Ee(e.lastIntValue);this.regexp_eatRegExpIdentifierPart(e);)e.lastStringValue+=Ee(e.lastIntValue);return!0}return!1},be.regexp_eatRegExpIdentifierStart=function(e){var t=e.pos,i=this.options.ecmaVersion>=11,n=e.current(i);return e.advance(i),92===n&&this.regexp_eatRegExpUnicodeEscapeSequence(e,i)&&(n=e.lastIntValue),function(e){return d(e,!0)||36===e||95===e}(n)?(e.lastIntValue=n,!0):(e.pos=t,!1)},be.regexp_eatRegExpIdentifierPart=function(e){var t=e.pos,i=this.options.ecmaVersion>=11,n=e.current(i);return e.advance(i),92===n&&this.regexp_eatRegExpUnicodeEscapeSequence(e,i)&&(n=e.lastIntValue),function(e){return p(e,!0)||36===e||95===e||8204===e||8205===e}(n)?(e.lastIntValue=n,!0):(e.pos=t,!1)},be.regexp_eatAtomEscape=function(e){return!!(this.regexp_eatBackReference(e)||this.regexp_eatCharacterClassEscape(e)||this.regexp_eatCharacterEscape(e)||e.switchN&&this.regexp_eatKGroupName(e))||(e.switchU&&(99===e.current()&&e.raise("Invalid unicode escape"),e.raise("Invalid escape")),!1)},be.regexp_eatBackReference=function(e){var t=e.pos;if(this.regexp_eatDecimalEscape(e)){var i=e.lastIntValue;if(e.switchU)return i>e.maxBackReference&&(e.maxBackReference=i),!0;if(i<=e.numCapturingParens)return!0;e.pos=t}return!1},be.regexp_eatKGroupName=function(e){if(e.eat(107)){if(this.regexp_eatGroupName(e))return e.backReferenceNames.push(e.lastStringValue),!0;e.raise("Invalid named reference")}return!1},be.regexp_eatCharacterEscape=function(e){return this.regexp_eatControlEscape(e)||this.regexp_eatCControlLetter(e)||this.regexp_eatZero(e)||this.regexp_eatHexEscapeSequence(e)||this.regexp_eatRegExpUnicodeEscapeSequence(e,!1)||!e.switchU&&this.regexp_eatLegacyOctalEscapeSequence(e)||this.regexp_eatIdentityEscape(e)},be.regexp_eatCControlLetter=function(e){var t=e.pos;if(e.eat(99)){if(this.regexp_eatControlLetter(e))return!0;e.pos=t}return!1},be.regexp_eatZero=function(e){return 48===e.current()&&!xe(e.lookahead())&&(e.lastIntValue=0,e.advance(),!0)},be.regexp_eatControlEscape=function(e){var t=e.current();return 116===t?(e.lastIntValue=9,e.advance(),!0):110===t?(e.lastIntValue=10,e.advance(),!0):118===t?(e.lastIntValue=11,e.advance(),!0):102===t?(e.lastIntValue=12,e.advance(),!0):114===t&&(e.lastIntValue=13,e.advance(),!0)},be.regexp_eatControlLetter=function(e){var t=e.current();return!!ke(t)&&(e.lastIntValue=t%32,e.advance(),!0)},be.regexp_eatRegExpUnicodeEscapeSequence=function(e,t){void 0===t&&(t=!1);var i,n=e.pos,r=t||e.switchU;if(e.eat(117)){if(this.regexp_eatFixedHexDigits(e,4)){var s=e.lastIntValue;if(r&&s>=55296&&s<=56319){var o=e.pos;if(e.eat(92)&&e.eat(117)&&this.regexp_eatFixedHexDigits(e,4)){var a=e.lastIntValue;if(a>=56320&&a<=57343)return e.lastIntValue=1024*(s-55296)+(a-56320)+65536,!0}e.pos=o,e.lastIntValue=s}return!0}if(r&&e.eat(123)&&this.regexp_eatHexDigits(e)&&e.eat(125)&&((i=e.lastIntValue)>=0&&i<=1114111))return!0;r&&e.raise("Invalid unicode escape"),e.pos=n}return!1},be.regexp_eatIdentityEscape=function(e){if(e.switchU)return!!this.regexp_eatSyntaxCharacter(e)||!!e.eat(47)&&(e.lastIntValue=47,!0);var t=e.current();return!(99===t||e.switchN&&107===t||(e.lastIntValue=t,e.advance(),0))},be.regexp_eatDecimalEscape=function(e){e.lastIntValue=0;var t=e.current();if(t>=49&&t<=57){do{e.lastIntValue=10*e.lastIntValue+(t-48),e.advance()}while((t=e.current())>=48&&t<=57);return!0}return!1},be.regexp_eatCharacterClassEscape=function(e){var t=e.current();if(function(e){return 100===e||68===e||115===e||83===e||119===e||87===e}(t))return e.lastIntValue=-1,e.advance(),!0;if(e.switchU&&this.options.ecmaVersion>=9&&(80===t||112===t)){if(e.lastIntValue=-1,e.advance(),e.eat(123)&&this.regexp_eatUnicodePropertyValueExpression(e)&&e.eat(125))return!0;e.raise("Invalid property name")}return!1},be.regexp_eatUnicodePropertyValueExpression=function(e){var t=e.pos;if(this.regexp_eatUnicodePropertyName(e)&&e.eat(61)){var i=e.lastStringValue;if(this.regexp_eatUnicodePropertyValue(e)){var n=e.lastStringValue;return this.regexp_validateUnicodePropertyNameAndValue(e,i,n),!0}}if(e.pos=t,this.regexp_eatLoneUnicodePropertyNameOrValue(e)){var r=e.lastStringValue;return this.regexp_validateUnicodePropertyNameOrValue(e,r),!0}return!1},be.regexp_validateUnicodePropertyNameAndValue=function(e,t,i){R(e.unicodeProperties.nonBinary,t)||e.raise("Invalid property name"),e.unicodeProperties.nonBinary[t].test(i)||e.raise("Invalid property value")},be.regexp_validateUnicodePropertyNameOrValue=function(e,t){e.unicodeProperties.binary.test(t)||e.raise("Invalid property name")},be.regexp_eatUnicodePropertyName=function(e){var t=0;for(e.lastStringValue="";Te(t=e.current());)e.lastStringValue+=Ee(t),e.advance();return""!==e.lastStringValue},be.regexp_eatUnicodePropertyValue=function(e){var t=0;for(e.lastStringValue="";Ce(t=e.current());)e.lastStringValue+=Ee(t),e.advance();return""!==e.lastStringValue},be.regexp_eatLoneUnicodePropertyNameOrValue=function(e){return this.regexp_eatUnicodePropertyValue(e)},be.regexp_eatCharacterClass=function(e){if(e.eat(91)){if(e.eat(94),this.regexp_classRanges(e),e.eat(93))return!0;e.raise("Unterminated character class")}return!1},be.regexp_classRanges=function(e){for(;this.regexp_eatClassAtom(e);){var t=e.lastIntValue;if(e.eat(45)&&this.regexp_eatClassAtom(e)){var i=e.lastIntValue;!e.switchU||-1!==t&&-1!==i||e.raise("Invalid character class"),-1!==t&&-1!==i&&t>i&&e.raise("Range out of order in character class")}}},be.regexp_eatClassAtom=function(e){var t=e.pos;if(e.eat(92)){if(this.regexp_eatClassEscape(e))return!0;if(e.switchU){var i=e.current();(99===i||Ae(i))&&e.raise("Invalid class escape"),e.raise("Invalid escape")}e.pos=t}var n=e.current();return 93!==n&&(e.lastIntValue=n,e.advance(),!0)},be.regexp_eatClassEscape=function(e){var t=e.pos;if(e.eat(98))return e.lastIntValue=8,!0;if(e.switchU&&e.eat(45))return e.lastIntValue=45,!0;if(!e.switchU&&e.eat(99)){if(this.regexp_eatClassControlLetter(e))return!0;e.pos=t}return this.regexp_eatCharacterClassEscape(e)||this.regexp_eatCharacterEscape(e)},be.regexp_eatClassControlLetter=function(e){var t=e.current();return!(!xe(t)&&95!==t||(e.lastIntValue=t%32,e.advance(),0))},be.regexp_eatHexEscapeSequence=function(e){var t=e.pos;if(e.eat(120)){if(this.regexp_eatFixedHexDigits(e,2))return!0;e.switchU&&e.raise("Invalid escape"),e.pos=t}return!1},be.regexp_eatDecimalDigits=function(e){var t=e.pos,i=0;for(e.lastIntValue=0;xe(i=e.current());)e.lastIntValue=10*e.lastIntValue+(i-48),e.advance();return e.pos!==t},be.regexp_eatHexDigits=function(e){var t=e.pos,i=0;for(e.lastIntValue=0;Re(i=e.current());)e.lastIntValue=16*e.lastIntValue+Oe(i),e.advance();return e.pos!==t},be.regexp_eatLegacyOctalEscapeSequence=function(e){if(this.regexp_eatOctalDigit(e)){var t=e.lastIntValue;if(this.regexp_eatOctalDigit(e)){var i=e.lastIntValue;t<=3&&this.regexp_eatOctalDigit(e)?e.lastIntValue=64*t+8*i+e.lastIntValue:e.lastIntValue=8*t+i}else e.lastIntValue=t;return!0}return!1},be.regexp_eatOctalDigit=function(e){var t=e.current();return Ae(t)?(e.lastIntValue=t-48,e.advance(),!0):(e.lastIntValue=0,!1)},be.regexp_eatFixedHexDigits=function(e,t){var i=e.pos;e.lastIntValue=0;for(var n=0;n<t;++n){var r=e.current();if(!Re(r))return e.pos=i,!1;e.lastIntValue=16*e.lastIntValue+Oe(r),e.advance()}return!0};var Pe=function(e){this.type=e.type,this.value=e.value,this.start=e.start,this.end=e.end,e.options.locations&&(this.loc=new D(e,e.startLoc,e.endLoc)),e.options.ranges&&(this.range=[e.start,e.end])},De=K.prototype;function Me(e){return"function"!=typeof BigInt?null:BigInt(e.replace(/_/g,""))}function Ne(e){return e<=65535?String.fromCharCode(e):(e-=65536,String.fromCharCode(55296+(e>>10),56320+(1023&e)))}De.next=function(e){!e&&this.type.keyword&&this.containsEsc&&this.raiseRecoverable(this.start,"Escape sequence in keyword "+this.type.keyword),this.options.onToken&&this.options.onToken(new Pe(this)),this.lastTokEnd=this.end,this.lastTokStart=this.start,this.lastTokEndLoc=this.endLoc,this.lastTokStartLoc=this.startLoc,this.nextToken()},De.getToken=function(){return this.next(),new Pe(this)},"undefined"!=typeof Symbol&&(De[Symbol.iterator]=function(){var e=this;return{next:function(){var t=e.getToken();return{done:t.type===S.eof,value:t}}}}),De.curContext=function(){return this.context[this.context.length-1]},De.nextToken=function(){var e=this.curContext();return e&&e.preserveSpace||this.skipSpace(),this.start=this.pos,this.options.locations&&(this.startLoc=this.curPosition()),this.pos>=this.input.length?this.finishToken(S.eof):e.override?e.override(this):void this.readToken(this.fullCharCodeAtPos())},De.readToken=function(e){return d(e,this.options.ecmaVersion>=6)||92===e?this.readWord():this.getTokenFromCode(e)},De.fullCharCodeAtPos=function(){var e=this.input.charCodeAt(this.pos);if(e<=55295||e>=56320)return e;var t=this.input.charCodeAt(this.pos+1);return t<=56319||t>=57344?e:(e<<10)+t-56613888},De.skipBlockComment=function(){var e,t=this.options.onComment&&this.curPosition(),i=this.pos,n=this.input.indexOf("*/",this.pos+=2);if(-1===n&&this.raise(this.pos-2,"Unterminated comment"),this.pos=n+2,this.options.locations)for(w.lastIndex=i;(e=w.exec(this.input))&&e.index<this.pos;)++this.curLine,this.lineStart=e.index+e[0].length;this.options.onComment&&this.options.onComment(!0,this.input.slice(i+2,n),i,this.pos,t,this.curPosition())},De.skipLineComment=function(e){for(var t=this.pos,i=this.options.onComment&&this.curPosition(),n=this.input.charCodeAt(this.pos+=e);this.pos<this.input.length&&!E(n);)n=this.input.charCodeAt(++this.pos);this.options.onComment&&this.options.onComment(!1,this.input.slice(t+e,this.pos),t,this.pos,i,this.curPosition())},De.skipSpace=function(){e:for(;this.pos<this.input.length;){var e=this.input.charCodeAt(this.pos);switch(e){case 32:case 160:++this.pos;break;case 13:10===this.input.charCodeAt(this.pos+1)&&++this.pos;case 10:case 8232:case 8233:++this.pos,this.options.locations&&(++this.curLine,this.lineStart=this.pos);break;case 47:switch(this.input.charCodeAt(this.pos+1)){case 42:this.skipBlockComment();break;case 47:this.skipLineComment(2);break;default:break e}break;default:if(!(e>8&&e<14||e>=5760&&I.test(String.fromCharCode(e))))break e;++this.pos}}},De.finishToken=function(e,t){this.end=this.pos,this.options.locations&&(this.endLoc=this.curPosition());var i=this.type;this.type=e,this.value=t,this.updateContext(i)},De.readToken_dot=function(){var e=this.input.charCodeAt(this.pos+1);if(e>=48&&e<=57)return this.readNumber(!0);var t=this.input.charCodeAt(this.pos+2);return this.options.ecmaVersion>=6&&46===e&&46===t?(this.pos+=3,this.finishToken(S.ellipsis)):(++this.pos,this.finishToken(S.dot))},De.readToken_slash=function(){var e=this.input.charCodeAt(this.pos+1);return this.exprAllowed?(++this.pos,this.readRegexp()):61===e?this.finishOp(S.assign,2):this.finishOp(S.slash,1)},De.readToken_mult_modulo_exp=function(e){var t=this.input.charCodeAt(this.pos+1),i=1,n=42===e?S.star:S.modulo;return this.options.ecmaVersion>=7&&42===e&&42===t&&(++i,n=S.starstar,t=this.input.charCodeAt(this.pos+2)),61===t?this.finishOp(S.assign,i+1):this.finishOp(n,i)},De.readToken_pipe_amp=function(e){var t=this.input.charCodeAt(this.pos+1);return t===e?this.options.ecmaVersion>=12&&61===this.input.charCodeAt(this.pos+2)?this.finishOp(S.assign,3):this.finishOp(124===e?S.logicalOR:S.logicalAND,2):61===t?this.finishOp(S.assign,2):this.finishOp(124===e?S.bitwiseOR:S.bitwiseAND,1)},De.readToken_caret=function(){return 61===this.input.charCodeAt(this.pos+1)?this.finishOp(S.assign,2):this.finishOp(S.bitwiseXOR,1)},De.readToken_plus_min=function(e){var t=this.input.charCodeAt(this.pos+1);return t===e?45!==t||this.inModule||62!==this.input.charCodeAt(this.pos+2)||0!==this.lastTokEnd&&!b.test(this.input.slice(this.lastTokEnd,this.pos))?this.finishOp(S.incDec,2):(this.skipLineComment(3),this.skipSpace(),this.nextToken()):61===t?this.finishOp(S.assign,2):this.finishOp(S.plusMin,1)},De.readToken_lt_gt=function(e){var t=this.input.charCodeAt(this.pos+1),i=1;return t===e?(i=62===e&&62===this.input.charCodeAt(this.pos+2)?3:2,61===this.input.charCodeAt(this.pos+i)?this.finishOp(S.assign,i+1):this.finishOp(S.bitShift,i)):33!==t||60!==e||this.inModule||45!==this.input.charCodeAt(this.pos+2)||45!==this.input.charCodeAt(this.pos+3)?(61===t&&(i=2),this.finishOp(S.relational,i)):(this.skipLineComment(4),this.skipSpace(),this.nextToken())},De.readToken_eq_excl=function(e){var t=this.input.charCodeAt(this.pos+1);return 61===t?this.finishOp(S.equality,61===this.input.charCodeAt(this.pos+2)?3:2):61===e&&62===t&&this.options.ecmaVersion>=6?(this.pos+=2,this.finishToken(S.arrow)):this.finishOp(61===e?S.eq:S.prefix,1)},De.readToken_question=function(){var e=this.options.ecmaVersion;if(e>=11){var t=this.input.charCodeAt(this.pos+1);if(46===t){var i=this.input.charCodeAt(this.pos+2);if(i<48||i>57)return this.finishOp(S.questionDot,2)}if(63===t)return e>=12&&61===this.input.charCodeAt(this.pos+2)?this.finishOp(S.assign,3):this.finishOp(S.coalesce,2)}return this.finishOp(S.question,1)},De.readToken_numberSign=function(){var e=35;if(this.options.ecmaVersion>=13&&(++this.pos,d(e=this.fullCharCodeAtPos(),!0)||92===e))return this.finishToken(S.privateId,this.readWord1());this.raise(this.pos,"Unexpected character '"+Ne(e)+"'")},De.getTokenFromCode=function(e){switch(e){case 46:return this.readToken_dot();case 40:return++this.pos,this.finishToken(S.parenL);case 41:return++this.pos,this.finishToken(S.parenR);case 59:return++this.pos,this.finishToken(S.semi);case 44:return++this.pos,this.finishToken(S.comma);case 91:return++this.pos,this.finishToken(S.bracketL);case 93:return++this.pos,this.finishToken(S.bracketR);case 123:return++this.pos,this.finishToken(S.braceL);case 125:return++this.pos,this.finishToken(S.braceR);case 58:return++this.pos,this.finishToken(S.colon);case 96:if(this.options.ecmaVersion<6)break;return++this.pos,this.finishToken(S.backQuote);case 48:var t=this.input.charCodeAt(this.pos+1);if(120===t||88===t)return this.readRadixNumber(16);if(this.options.ecmaVersion>=6){if(111===t||79===t)return this.readRadixNumber(8);if(98===t||66===t)return this.readRadixNumber(2)}case 49:case 50:case 51:case 52:case 53:case 54:case 55:case 56:case 57:return this.readNumber(!1);case 34:case 39:return this.readString(e);case 47:return this.readToken_slash();case 37:case 42:return this.readToken_mult_modulo_exp(e);case 124:case 38:return this.readToken_pipe_amp(e);case 94:return this.readToken_caret();case 43:case 45:return this.readToken_plus_min(e);case 60:case 62:return this.readToken_lt_gt(e);case 61:case 33:return this.readToken_eq_excl(e);case 63:return this.readToken_question();case 126:return this.finishOp(S.prefix,1);case 35:return this.readToken_numberSign()}this.raise(this.pos,"Unexpected character '"+Ne(e)+"'")},De.finishOp=function(e,t){var i=this.input.slice(this.pos,this.pos+t);return this.pos+=t,this.finishToken(e,i)},De.readRegexp=function(){for(var e,t,i=this.pos;;){this.pos>=this.input.length&&this.raise(i,"Unterminated regular expression");var n=this.input.charAt(this.pos);if(b.test(n)&&this.raise(i,"Unterminated regular expression"),e)e=!1;else{if("["===n)t=!0;else if("]"===n&&t)t=!1;else if("/"===n&&!t)break;e="\\"===n}++this.pos}var r=this.input.slice(i,this.pos);++this.pos;var s=this.pos,o=this.readWord1();this.containsEsc&&this.unexpected(s);var a=this.regexpState||(this.regexpState=new we(this));a.reset(i,r,o),this.validateRegExpFlags(a),this.validateRegExpPattern(a);var c=null;try{c=new RegExp(r,o)}catch(e){}return this.finishToken(S.regexp,{pattern:r,flags:o,value:c})},De.readInt=function(e,t,i){for(var n=this.options.ecmaVersion>=12&&void 0===t,r=i&&48===this.input.charCodeAt(this.pos),s=this.pos,o=0,a=0,c=0,l=null==t?1/0:t;c<l;++c,++this.pos){var h=this.input.charCodeAt(this.pos),u=void 0;if(n&&95===h)r&&this.raiseRecoverable(this.pos,"Numeric separator is not allowed in legacy octal numeric literals"),95===a&&this.raiseRecoverable(this.pos,"Numeric separator must be exactly one underscore"),0===c&&this.raiseRecoverable(this.pos,"Numeric separator is not allowed at the first of digits"),a=h;else{if((u=h>=97?h-97+10:h>=65?h-65+10:h>=48&&h<=57?h-48:1/0)>=e)break;a=h,o=o*e+u}}return n&&95===a&&this.raiseRecoverable(this.pos-1,"Numeric separator is not allowed at the last of digits"),this.pos===s||null!=t&&this.pos-s!==t?null:o},De.readRadixNumber=function(e){var t=this.pos;this.pos+=2;var i=this.readInt(e);return null==i&&this.raise(this.start+2,"Expected number in radix "+e),this.options.ecmaVersion>=11&&110===this.input.charCodeAt(this.pos)?(i=Me(this.input.slice(t,this.pos)),++this.pos):d(this.fullCharCodeAtPos())&&this.raise(this.pos,"Identifier directly after number"),this.finishToken(S.num,i)},De.readNumber=function(e){var t=this.pos;e||null!==this.readInt(10,void 0,!0)||this.raise(t,"Invalid number");var i=this.pos-t>=2&&48===this.input.charCodeAt(t);i&&this.strict&&this.raise(t,"Invalid number");var n=this.input.charCodeAt(this.pos);if(!i&&!e&&this.options.ecmaVersion>=11&&110===n){var r=Me(this.input.slice(t,this.pos));return++this.pos,d(this.fullCharCodeAtPos())&&this.raise(this.pos,"Identifier directly after number"),this.finishToken(S.num,r)}i&&/[89]/.test(this.input.slice(t,this.pos))&&(i=!1),46!==n||i||(++this.pos,this.readInt(10),n=this.input.charCodeAt(this.pos)),69!==n&&101!==n||i||(43!==(n=this.input.charCodeAt(++this.pos))&&45!==n||++this.pos,null===this.readInt(10)&&this.raise(t,"Invalid number")),d(this.fullCharCodeAtPos())&&this.raise(this.pos,"Identifier directly after number");var s,o=(s=this.input.slice(t,this.pos),i?parseInt(s,8):parseFloat(s.replace(/_/g,"")));return this.finishToken(S.num,o)},De.readCodePoint=function(){var e;if(123===this.input.charCodeAt(this.pos)){this.options.ecmaVersion<6&&this.unexpected();var t=++this.pos;e=this.readHexChar(this.input.indexOf("}",this.pos)-this.pos),++this.pos,e>1114111&&this.invalidStringToken(t,"Code point out of bounds")}else e=this.readHexChar(4);return e},De.readString=function(e){for(var t="",i=++this.pos;;){this.pos>=this.input.length&&this.raise(this.start,"Unterminated string constant");var n=this.input.charCodeAt(this.pos);if(n===e)break;92===n?(t+=this.input.slice(i,this.pos),t+=this.readEscapedChar(!1),i=this.pos):(E(n,this.options.ecmaVersion>=10)&&this.raise(this.start,"Unterminated string constant"),++this.pos)}return t+=this.input.slice(i,this.pos++),this.finishToken(S.string,t)};var Be={};De.tryReadTemplateToken=function(){this.inTemplateElement=!0;try{this.readTmplToken()}catch(e){if(e!==Be)throw e;this.readInvalidTemplateToken()}this.inTemplateElement=!1},De.invalidStringToken=function(e,t){if(this.inTemplateElement&&this.options.ecmaVersion>=9)throw Be;this.raise(e,t)},De.readTmplToken=function(){for(var e="",t=this.pos;;){this.pos>=this.input.length&&this.raise(this.start,"Unterminated template");var i=this.input.charCodeAt(this.pos);if(96===i||36===i&&123===this.input.charCodeAt(this.pos+1))return this.pos!==this.start||this.type!==S.template&&this.type!==S.invalidTemplate?(e+=this.input.slice(t,this.pos),this.finishToken(S.template,e)):36===i?(this.pos+=2,this.finishToken(S.dollarBraceL)):(++this.pos,this.finishToken(S.backQuote));if(92===i)e+=this.input.slice(t,this.pos),e+=this.readEscapedChar(!0),t=this.pos;else if(E(i)){switch(e+=this.input.slice(t,this.pos),++this.pos,i){case 13:10===this.input.charCodeAt(this.pos)&&++this.pos;case 10:e+="\n";break;default:e+=String.fromCharCode(i)}this.options.locations&&(++this.curLine,this.lineStart=this.pos),t=this.pos}else++this.pos}},De.readInvalidTemplateToken=function(){for(;this.pos<this.input.length;this.pos++)switch(this.input[this.pos]){case"\\":++this.pos;break;case"$":if("{"!==this.input[this.pos+1])break;case"`":return this.finishToken(S.invalidTemplate,this.input.slice(this.start,this.pos))}this.raise(this.start,"Unterminated template")},De.readEscapedChar=function(e){var t=this.input.charCodeAt(++this.pos);switch(++this.pos,t){case 110:return"\n";case 114:return"\r";case 120:return String.fromCharCode(this.readHexChar(2));case 117:return Ne(this.readCodePoint());case 116:return"\t";case 98:return"\b";case 118:return"\v";case 102:return"\f";case 13:10===this.input.charCodeAt(this.pos)&&++this.pos;case 10:return this.options.locations&&(this.lineStart=this.pos,++this.curLine),"";case 56:case 57:if(this.strict&&this.invalidStringToken(this.pos-1,"Invalid escape sequence"),e){var i=this.pos-1;return this.invalidStringToken(i,"Invalid escape sequence in template string"),null}default:if(t>=48&&t<=55){var n=this.input.substr(this.pos-1,3).match(/^[0-7]+/)[0],r=parseInt(n,8);return r>255&&(n=n.slice(0,-1),r=parseInt(n,8)),this.pos+=n.length-1,t=this.input.charCodeAt(this.pos),"0"===n&&56!==t&&57!==t||!this.strict&&!e||this.invalidStringToken(this.pos-1-n.length,e?"Octal literal in template string":"Octal literal in strict mode"),String.fromCharCode(r)}return E(t)?"":String.fromCharCode(t)}},De.readHexChar=function(e){var t=this.pos,i=this.readInt(16,e);return null===i&&this.invalidStringToken(t,"Bad character escape sequence"),i},De.readWord1=function(){this.containsEsc=!1;for(var e="",t=!0,i=this.pos,n=this.options.ecmaVersion>=6;this.pos<this.input.length;){var r=this.fullCharCodeAtPos();if(p(r,n))this.pos+=r<=65535?1:2;else{if(92!==r)break;this.containsEsc=!0,e+=this.input.slice(i,this.pos);var s=this.pos;117!==this.input.charCodeAt(++this.pos)&&this.invalidStringToken(this.pos,"Expecting Unicode escape sequence \\uXXXX"),++this.pos;var o=this.readCodePoint();(t?d:p)(o,n)||this.invalidStringToken(s,"Invalid Unicode escape"),e+=Ne(o),i=this.pos}t=!1}return e+this.input.slice(i,this.pos)},De.readWord=function(){var e=this.readWord1(),t=S.name;return this.keywords.test(e)&&(t=y[e]),this.finishToken(t,e)};var Ue="8.4.1";K.acorn={Parser:K,version:Ue,defaultOptions:N,Position:P,SourceLocation:D,getLineInfo:M,Node:se,TokenType:g,tokTypes:S,keywordTypes:y,TokContext:ce,tokContexts:le,isIdentifierChar:p,isIdentifierStart:d,Token:Pe,isNewLine:E,lineBreak:b,lineBreakG:w,nonASCIIwhitespace:I},e.Node=se,e.Parser=K,e.Position=P,e.SourceLocation=D,e.TokContext=ce,e.Token=Pe,e.TokenType=g,e.defaultOptions=N,e.getLineInfo=M,e.isIdentifierChar=p,e.isIdentifierStart=d,e.isNewLine=E,e.keywordTypes=y,e.lineBreak=b,e.lineBreakG=w,e.nonASCIIwhitespace=I,e.parse=function(e,t){return K.parse(e,t)},e.parseExpressionAt=function(e,t,i){return K.parseExpressionAt(e,t,i)},e.tokContexts=le,e.tokTypes=S,e.tokenizer=function(e,t){return K.tokenizer(e,t)},e.version=Ue,Object.defineProperty(e,"__esModule",{value:!0})}(t)},9141:e=>{"use strict";for(var t=/[\\\"\x00-\x1F]/g,i={},n=0;n<32;++n)i[String.fromCharCode(n)]="\\U"+("0000"+n.toString(16)).slice(-4).toUpperCase();function r(e){return t.lastIndex=0,e.replace(t,(function(e){return i[e]}))}i["\b"]="\\b",i["\t"]="\\t",i["\n"]="\\n",i["\f"]="\\f",i["\r"]="\\r",i['"']='\\"',i["\\"]="\\\\",e.exports={stringify:function e(t){switch(typeof t){case"string":return'"'+r(t)+'"';case"number":return isFinite(t)?t:"null";case"boolean":return t;case"object":return null===t?"null":Array.isArray(t)?function(t){for(var i="[",n="",r=0;r<t.length;++r)n+=i,i=",",n+=e(t[r]);return","!=i?"[]":n+"]"}(t):function(t){var i="{",n="",s=Object.keys(t);s.sort();for(var o=0;o<s.length;++o){var a=s[o];n+=i+'"'+r(a)+'":',i=",",n+=e(t[a])}return","!=i?"{}":n+"}"}(t);default:throw new Error("Cannot stringify: "+typeof t)}}}},8162:(e,t,i)=>{"use strict";var n=i(9509).Buffer;e.exports=function(e){if(e.length>=255)throw new TypeError("Alphabet too long");for(var t=new Uint8Array(256),i=0;i<t.length;i++)t[i]=255;for(var r=0;r<e.length;r++){var s=e.charAt(r),o=s.charCodeAt(0);if(255!==t[o])throw new TypeError(s+" is ambiguous");t[o]=r}var a=e.length,c=e.charAt(0),l=Math.log(a)/Math.log(256),h=Math.log(256)/Math.log(a);function u(e){if("string"!=typeof e)throw new TypeError("Expected String");if(0===e.length)return n.alloc(0);var i=0;if(" "!==e[i]){for(var r=0,s=0;e[i]===c;)r++,i++;for(var o=(e.length-i)*l+1>>>0,h=new Uint8Array(o);e[i];){var u=t[e.charCodeAt(i)];if(255===u)return;for(var d=0,p=o-1;(0!==u||d<s)&&-1!==p;p--,d++)u+=a*h[p]>>>0,h[p]=u%256>>>0,u=u/256>>>0;if(0!==u)throw new Error("Non-zero carry");s=d,i++}if(" "!==e[i]){for(var g=o-s;g!==o&&0===h[g];)g++;var f=n.allocUnsafe(r+(o-g));f.fill(0,0,r);for(var m=r;g!==o;)f[m++]=h[g++];return f}}}return{encode:function(t){if((Array.isArray(t)||t instanceof Uint8Array)&&(t=n.from(t)),!n.isBuffer(t))throw new TypeError("Expected Buffer");if(0===t.length)return"";for(var i=0,r=0,s=0,o=t.length;s!==o&&0===t[s];)s++,i++;for(var l=(o-s)*h+1>>>0,u=new Uint8Array(l);s!==o;){for(var d=t[s],p=0,g=l-1;(0!==d||p<r)&&-1!==g;g--,p++)d+=256*u[g]>>>0,u[g]=d%a>>>0,d=d/a>>>0;if(0!==d)throw new Error("Non-zero carry");r=p,s++}for(var f=l-r;f!==l&&0===u[f];)f++;for(var m=c.repeat(i);f<l;++f)m+=e.charAt(u[f]);return m},decodeUnsafe:u,decode:function(e){var t=u(e);if(t)return t;throw new Error("Non-base"+a+" character")}}}},9742:(e,t)=>{"use strict";t.byteLength=function(e){var t=c(e),i=t[0],n=t[1];return 3*(i+n)/4-n},t.toByteArray=function(e){var t,i,s=c(e),o=s[0],a=s[1],l=new r(function(e,t,i){return 3*(t+i)/4-i}(0,o,a)),h=0,u=a>0?o-4:o;for(i=0;i<u;i+=4)t=n[e.charCodeAt(i)]<<18|n[e.charCodeAt(i+1)]<<12|n[e.charCodeAt(i+2)]<<6|n[e.charCodeAt(i+3)],l[h++]=t>>16&255,l[h++]=t>>8&255,l[h++]=255&t;return 2===a&&(t=n[e.charCodeAt(i)]<<2|n[e.charCodeAt(i+1)]>>4,l[h++]=255&t),1===a&&(t=n[e.charCodeAt(i)]<<10|n[e.charCodeAt(i+1)]<<4|n[e.charCodeAt(i+2)]>>2,l[h++]=t>>8&255,l[h++]=255&t),l},t.fromByteArray=function(e){for(var t,n=e.length,r=n%3,s=[],o=16383,a=0,c=n-r;a<c;a+=o)s.push(l(e,a,a+o>c?c:a+o));return 1===r?(t=e[n-1],s.push(i[t>>2]+i[t<<4&63]+"==")):2===r&&(t=(e[n-2]<<8)+e[n-1],s.push(i[t>>10]+i[t>>4&63]+i[t<<2&63]+"=")),s.join("")};for(var i=[],n=[],r="undefined"!=typeof Uint8Array?Uint8Array:Array,s="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",o=0,a=s.length;o<a;++o)i[o]=s[o],n[s.charCodeAt(o)]=o;function c(e){var t=e.length;if(t%4>0)throw new Error("Invalid string. Length must be a multiple of 4");var i=e.indexOf("=");return-1===i&&(i=t),[i,i===t?0:4-i%4]}function l(e,t,n){for(var r,s,o=[],a=t;a<n;a+=3)r=(e[a]<<16&16711680)+(e[a+1]<<8&65280)+(255&e[a+2]),o.push(i[(s=r)>>18&63]+i[s>>12&63]+i[s>>6&63]+i[63&s]);return o.join("")}n["-".charCodeAt(0)]=62,n["_".charCodeAt(0)]=63},4770:function(e,t){var i,n;void 0===(n="function"==typeof(i=function(){var e=XMLHttpRequest;if(!e)throw new Error("missing XMLHttpRequest");t.log={trace:n,debug:n,info:n,warn:n,error:n};function t(s,o){if("function"!=typeof o)throw new Error("Bad callback given: "+o);if(!s)throw new Error("No options given");var a=s.onResponse;if((s="string"==typeof s?{uri:s}:JSON.parse(JSON.stringify(s))).onResponse=a,s.verbose&&(t.log=function(){var e,t,i={},s=["trace","debug","info","warn","error"];for(t=0;t<s.length;t++)i[e=s[t]]=n,"undefined"!=typeof console&&console&&console[e]&&(i[e]=r(console,e));return i}()),s.url&&(s.uri=s.url,delete s.url),!s.uri&&""!==s.uri)throw new Error("options.uri is a required argument");if("string"!=typeof s.uri)throw new Error("options.uri must be a string");for(var c=["proxy","_redirectsFollowed","maxRedirects","followRedirect"],l=0;l<c.length;l++)if(s[c[l]])throw new Error("options."+c[l]+" is not supported");if(s.callback=o,s.method=s.method||"GET",s.headers=s.headers||{},s.body=s.body||null,s.timeout=s.timeout||t.DEFAULT_TIMEOUT,s.headers.host)throw new Error("Options.headers.host is not supported");s.json&&(s.headers.accept=s.headers.accept||"application/json","GET"!==s.method&&(s.headers["content-type"]="application/json"),"boolean"!=typeof s.json?s.body=JSON.stringify(s.json):"string"!=typeof s.body&&(s.body=JSON.stringify(s.body)));var h=function(e){var t=[];for(var i in e)e.hasOwnProperty(i)&&t.push(encodeURIComponent(i)+"="+encodeURIComponent(e[i]));return t.join("&")};if(s.qs){var u="string"==typeof s.qs?s.qs:h(s.qs);-1!==s.uri.indexOf("?")?s.uri=s.uri+"&"+u:s.uri=s.uri+"?"+u}if(s.form){if("string"==typeof s.form)throw"form name unsupported";if("POST"===s.method){var d=(s.encoding||"application/x-www-form-urlencoded").toLowerCase();switch(s.headers["content-type"]=d,d){case"application/x-www-form-urlencoded":s.body=h(s.form).replace(/%20/g,"+");break;case"multipart/form-data":var p=function(e){var t={};t.boundry="-------------------------------"+Math.floor(1e9*Math.random());var i=[];for(var n in e)e.hasOwnProperty(n)&&i.push("--"+t.boundry+'\nContent-Disposition: form-data; name="'+n+'"\n\n'+e[n]+"\n");return i.push("--"+t.boundry+"--"),t.body=i.join(""),t.length=t.body.length,t.type="multipart/form-data; boundary="+t.boundry,t}(s.form);s.body=p.body,s.headers["content-type"]=p.type;break;default:throw new Error("unsupported encoding:"+d)}}}return s.onResponse=s.onResponse||n,!0===s.onResponse&&(s.onResponse=o,s.callback=n),!s.headers.authorization&&s.auth&&(s.headers.authorization="Basic "+function(e){var t,i,n,r,s,o="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=",a=0,c=0,l="",h=[];if(!e)return e;do{t=(s=e.charCodeAt(a++)<<16|e.charCodeAt(a++)<<8|e.charCodeAt(a++))>>18&63,i=s>>12&63,n=s>>6&63,r=63&s,h[c++]=o.charAt(t)+o.charAt(i)+o.charAt(n)+o.charAt(r)}while(a<e.length);switch(l=h.join(""),e.length%3){case 1:l=l.slice(0,-2)+"==";break;case 2:l=l.slice(0,-1)+"="}return l}(s.auth.username+":"+s.auth.password)),function(n){var r=new e,s=!1,o=function(e){var t,i=/^([\w\+\.\-]+:)(?:\/\/([^\/?#:]*)(?::(\d+))?)?/;try{t=location.href}catch(e){(t=document.createElement("a")).href="",t=t.href}var n=i.exec(t.toLowerCase())||[],r=i.exec(e.toLowerCase());return!(!r||r[1]==n[1]&&r[2]==n[2]&&(r[3]||("http:"===r[1]?80:443))==(n[3]||("http:"===n[1]?80:443)))}(n.uri),a="withCredentials"in r;if(i+=1,r.seq_id=i,r.id=i+": "+n.method+" "+n.uri,r._id=r.id,o&&!a){var c=new Error("Browser does not support cross-origin request: "+n.uri);return c.cors="unsupported",n.callback(c,r)}function l(){s=!0;var e=new Error("ETIMEDOUT");return e.code="ETIMEDOUT",e.duration=n.timeout,t.log.error("Timeout",{id:r._id,milliseconds:n.timeout}),n.callback(e,r)}r.timeoutTimer=setTimeout(l,n.timeout);var h={response:!1,loading:!1,end:!1};return r.onreadystatechange=u,r.open(n.method,n.uri,!0),o&&(r.withCredentials=!!n.withCredentials),r.send(n.body),r;function u(i){if(s)return t.log.debug("Ignoring timed out state change",{state:r.readyState,id:r.id});if(t.log.debug("State change",{state:r.readyState,id:r.id,timed_out:s}),r.readyState===e.OPENED)for(var o in t.log.debug("Request started",{id:r.id}),n.headers)r.setRequestHeader(o,n.headers[o]);else r.readyState===e.HEADERS_RECEIVED?d():r.readyState===e.LOADING?(d(),p()):r.readyState===e.DONE&&(d(),p(),g())}function d(){if(!h.response){if(h.response=!0,t.log.debug("Got response",{id:r.id,status:r.status}),clearTimeout(r.timeoutTimer),r.statusCode=r.status,o&&0==r.statusCode){var e=new Error("CORS request rejected: "+n.uri);return e.cors="rejected",h.loading=!0,h.end=!0,n.callback(e,r)}n.onResponse(null,r)}}function p(){h.loading||(h.loading=!0,t.log.debug("Response body loading",{id:r.id}))}function g(){if(!h.end){if(h.end=!0,t.log.debug("Request done",{id:r.id}),r.body=r.responseText,n.json)try{r.body=JSON.parse(r.responseText)}catch(e){return n.callback(e,r)}n.callback(null,r,r.body)}}}(s)}var i=0;function n(){}function r(e,t){return function(i,n){return"object"==typeof n&&(i+=" "+JSON.stringify(n)),e[t].call(e,i)}}return t.withCredentials=!1,t.DEFAULT_TIMEOUT=18e4,t.defaults=function(e,i){var n=function(t){return function(i,n){for(var r in i="string"==typeof i?{uri:i}:JSON.parse(JSON.stringify(i)),e)void 0===i[r]&&(i[r]=e[r]);return t(i,n)}},r=n(t);return r.get=n(t.get),r.post=n(t.post),r.put=n(t.put),r.head=n(t.head),r},["get","put","post","head"].forEach((function(e){var i=e.toUpperCase();t[e.toLowerCase()]=function(e){"string"==typeof e?e={method:i,uri:e}:(e=JSON.parse(JSON.stringify(e))).method=i;var n=[e].concat(Array.prototype.slice.apply(arguments,[1]));return t.apply(this,n)}})),t.couch=function(e,i){return"string"==typeof e&&(e={uri:e}),e.json=!0,e.body&&(e.json=e.body),delete e.body,i=i||n,t(e,(function(e,t,n){if(e)return i(e,t,n);if((t.statusCode<200||t.statusCode>299)&&n.error){for(var r in e=new Error("CouchDB error: "+(n.error.reason||n.error.error)),n)e[r]=n[r];return i(e,t,n)}return i(e,t,n)}))},t})?i.apply(t,[]):i)||(e.exports=n)},7191:(e,t,i)=>{var n=i(8162);e.exports=n("123456789ABCDEFGHJKLMNPQRSTUVWXYZabcdefghijkmnopqrstuvwxyz")},8764:(e,t,i)=>{"use strict";const n=i(9742),r=i(645),s="function"==typeof Symbol&&"function"==typeof Symbol.for?Symbol.for("nodejs.util.inspect.custom"):null;t.Buffer=c,t.SlowBuffer=function(e){return+e!=e&&(e=0),c.alloc(+e)},t.INSPECT_MAX_BYTES=50;const o=2147483647;function a(e){if(e>o)throw new RangeError('The value "'+e+'" is invalid for option "size"');const t=new Uint8Array(e);return Object.setPrototypeOf(t,c.prototype),t}function c(e,t,i){if("number"==typeof e){if("string"==typeof t)throw new TypeError('The "string" argument must be of type string. Received type number');return u(e)}return l(e,t,i)}function l(e,t,i){if("string"==typeof e)return function(e,t){if("string"==typeof t&&""!==t||(t="utf8"),!c.isEncoding(t))throw new TypeError("Unknown encoding: "+t);const i=0|f(e,t);let n=a(i);const r=n.write(e,t);return r!==i&&(n=n.slice(0,r)),n}(e,t);if(ArrayBuffer.isView(e))return function(e){if(Y(e,Uint8Array)){const t=new Uint8Array(e);return p(t.buffer,t.byteOffset,t.byteLength)}return d(e)}(e);if(null==e)throw new TypeError("The first argument must be one of type string, Buffer, ArrayBuffer, Array, or Array-like Object. Received type "+typeof e);if(Y(e,ArrayBuffer)||e&&Y(e.buffer,ArrayBuffer))return p(e,t,i);if("undefined"!=typeof SharedArrayBuffer&&(Y(e,SharedArrayBuffer)||e&&Y(e.buffer,SharedArrayBuffer)))return p(e,t,i);if("number"==typeof e)throw new TypeError('The "value" argument must not be of type number. Received type number');const n=e.valueOf&&e.valueOf();if(null!=n&&n!==e)return c.from(n,t,i);const r=function(e){if(c.isBuffer(e)){const t=0|g(e.length),i=a(t);return 0===i.length||e.copy(i,0,0,t),i}return void 0!==e.length?"number"!=typeof e.length||J(e.length)?a(0):d(e):"Buffer"===e.type&&Array.isArray(e.data)?d(e.data):void 0}(e);if(r)return r;if("undefined"!=typeof Symbol&&null!=Symbol.toPrimitive&&"function"==typeof e[Symbol.toPrimitive])return c.from(e[Symbol.toPrimitive]("string"),t,i);throw new TypeError("The first argument must be one of type string, Buffer, ArrayBuffer, Array, or Array-like Object. Received type "+typeof e)}function h(e){if("number"!=typeof e)throw new TypeError('"size" argument must be of type number');if(e<0)throw new RangeError('The value "'+e+'" is invalid for option "size"')}function u(e){return h(e),a(e<0?0:0|g(e))}function d(e){const t=e.length<0?0:0|g(e.length),i=a(t);for(let n=0;n<t;n+=1)i[n]=255&e[n];return i}function p(e,t,i){if(t<0||e.byteLength<t)throw new RangeError('"offset" is outside of buffer bounds');if(e.byteLength<t+(i||0))throw new RangeError('"length" is outside of buffer bounds');let n;return n=void 0===t&&void 0===i?new Uint8Array(e):void 0===i?new Uint8Array(e,t):new Uint8Array(e,t,i),Object.setPrototypeOf(n,c.prototype),n}function g(e){if(e>=o)throw new RangeError("Attempt to allocate Buffer larger than maximum size: 0x"+o.toString(16)+" bytes");return 0|e}function f(e,t){if(c.isBuffer(e))return e.length;if(ArrayBuffer.isView(e)||Y(e,ArrayBuffer))return e.byteLength;if("string"!=typeof e)throw new TypeError('The "string" argument must be one of type string, Buffer, or ArrayBuffer. Received type '+typeof e);const i=e.length,n=arguments.length>2&&!0===arguments[2];if(!n&&0===i)return 0;let r=!1;for(;;)switch(t){case"ascii":case"latin1":case"binary":return i;case"utf8":case"utf-8":return H(e).length;case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return 2*i;case"hex":return i>>>1;case"base64":return z(e).length;default:if(r)return n?-1:H(e).length;t=(""+t).toLowerCase(),r=!0}}function m(e,t,i){let n=!1;if((void 0===t||t<0)&&(t=0),t>this.length)return"";if((void 0===i||i>this.length)&&(i=this.length),i<=0)return"";if((i>>>=0)<=(t>>>=0))return"";for(e||(e="utf8");;)switch(e){case"hex":return O(this,t,i);case"utf8":case"utf-8":return T(this,t,i);case"ascii":return x(this,t,i);case"latin1":case"binary":return R(this,t,i);case"base64":return k(this,t,i);case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return A(this,t,i);default:if(n)throw new TypeError("Unknown encoding: "+e);e=(e+"").toLowerCase(),n=!0}}function v(e,t,i){const n=e[t];e[t]=e[i],e[i]=n}function y(e,t,i,n,r){if(0===e.length)return-1;if("string"==typeof i?(n=i,i=0):i>2147483647?i=2147483647:i<-2147483648&&(i=-2147483648),J(i=+i)&&(i=r?0:e.length-1),i<0&&(i=e.length+i),i>=e.length){if(r)return-1;i=e.length-1}else if(i<0){if(!r)return-1;i=0}if("string"==typeof t&&(t=c.from(t,n)),c.isBuffer(t))return 0===t.length?-1:_(e,t,i,n,r);if("number"==typeof t)return t&=255,"function"==typeof Uint8Array.prototype.indexOf?r?Uint8Array.prototype.indexOf.call(e,t,i):Uint8Array.prototype.lastIndexOf.call(e,t,i):_(e,[t],i,n,r);throw new TypeError("val must be string, number or Buffer")}function _(e,t,i,n,r){let s,o=1,a=e.length,c=t.length;if(void 0!==n&&("ucs2"===(n=String(n).toLowerCase())||"ucs-2"===n||"utf16le"===n||"utf-16le"===n)){if(e.length<2||t.length<2)return-1;o=2,a/=2,c/=2,i/=2}function l(e,t){return 1===o?e[t]:e.readUInt16BE(t*o)}if(r){let n=-1;for(s=i;s<a;s++)if(l(e,s)===l(t,-1===n?0:s-n)){if(-1===n&&(n=s),s-n+1===c)return n*o}else-1!==n&&(s-=s-n),n=-1}else for(i+c>a&&(i=a-c),s=i;s>=0;s--){let i=!0;for(let n=0;n<c;n++)if(l(e,s+n)!==l(t,n)){i=!1;break}if(i)return s}return-1}function S(e,t,i,n){i=Number(i)||0;const r=e.length-i;n?(n=Number(n))>r&&(n=r):n=r;const s=t.length;let o;for(n>s/2&&(n=s/2),o=0;o<n;++o){const n=parseInt(t.substr(2*o,2),16);if(J(n))return o;e[i+o]=n}return o}function b(e,t,i,n){return W(H(t,e.length-i),e,i,n)}function w(e,t,i,n){return W(function(e){const t=[];for(let i=0;i<e.length;++i)t.push(255&e.charCodeAt(i));return t}(t),e,i,n)}function E(e,t,i,n){return W(z(t),e,i,n)}function I(e,t,i,n){return W(function(e,t){let i,n,r;const s=[];for(let o=0;o<e.length&&!((t-=2)<0);++o)i=e.charCodeAt(o),n=i>>8,r=i%256,s.push(r),s.push(n);return s}(t,e.length-i),e,i,n)}function k(e,t,i){return 0===t&&i===e.length?n.fromByteArray(e):n.fromByteArray(e.slice(t,i))}function T(e,t,i){i=Math.min(e.length,i);const n=[];let r=t;for(;r<i;){const t=e[r];let s=null,o=t>239?4:t>223?3:t>191?2:1;if(r+o<=i){let i,n,a,c;switch(o){case 1:t<128&&(s=t);break;case 2:i=e[r+1],128==(192&i)&&(c=(31&t)<<6|63&i,c>127&&(s=c));break;case 3:i=e[r+1],n=e[r+2],128==(192&i)&&128==(192&n)&&(c=(15&t)<<12|(63&i)<<6|63&n,c>2047&&(c<55296||c>57343)&&(s=c));break;case 4:i=e[r+1],n=e[r+2],a=e[r+3],128==(192&i)&&128==(192&n)&&128==(192&a)&&(c=(15&t)<<18|(63&i)<<12|(63&n)<<6|63&a,c>65535&&c<1114112&&(s=c))}}null===s?(s=65533,o=1):s>65535&&(s-=65536,n.push(s>>>10&1023|55296),s=56320|1023&s),n.push(s),r+=o}return function(e){const t=e.length;if(t<=C)return String.fromCharCode.apply(String,e);let i="",n=0;for(;n<t;)i+=String.fromCharCode.apply(String,e.slice(n,n+=C));return i}(n)}t.kMaxLength=o,c.TYPED_ARRAY_SUPPORT=function(){try{const e=new Uint8Array(1),t={foo:function(){return 42}};return Object.setPrototypeOf(t,Uint8Array.prototype),Object.setPrototypeOf(e,t),42===e.foo()}catch(e){return!1}}(),c.TYPED_ARRAY_SUPPORT||"undefined"==typeof console||"function"!=typeof console.error||console.error("This browser lacks typed array (Uint8Array) support which is required by `buffer` v5.x. Use `buffer` v4.x if you require old browser support."),Object.defineProperty(c.prototype,"parent",{enumerable:!0,get:function(){if(c.isBuffer(this))return this.buffer}}),Object.defineProperty(c.prototype,"offset",{enumerable:!0,get:function(){if(c.isBuffer(this))return this.byteOffset}}),c.poolSize=8192,c.from=function(e,t,i){return l(e,t,i)},Object.setPrototypeOf(c.prototype,Uint8Array.prototype),Object.setPrototypeOf(c,Uint8Array),c.alloc=function(e,t,i){return function(e,t,i){return h(e),e<=0?a(e):void 0!==t?"string"==typeof i?a(e).fill(t,i):a(e).fill(t):a(e)}(e,t,i)},c.allocUnsafe=function(e){return u(e)},c.allocUnsafeSlow=function(e){return u(e)},c.isBuffer=function(e){return null!=e&&!0===e._isBuffer&&e!==c.prototype},c.compare=function(e,t){if(Y(e,Uint8Array)&&(e=c.from(e,e.offset,e.byteLength)),Y(t,Uint8Array)&&(t=c.from(t,t.offset,t.byteLength)),!c.isBuffer(e)||!c.isBuffer(t))throw new TypeError('The "buf1", "buf2" arguments must be one of type Buffer or Uint8Array');if(e===t)return 0;let i=e.length,n=t.length;for(let r=0,s=Math.min(i,n);r<s;++r)if(e[r]!==t[r]){i=e[r],n=t[r];break}return i<n?-1:n<i?1:0},c.isEncoding=function(e){switch(String(e).toLowerCase()){case"hex":case"utf8":case"utf-8":case"ascii":case"latin1":case"binary":case"base64":case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return!0;default:return!1}},c.concat=function(e,t){if(!Array.isArray(e))throw new TypeError('"list" argument must be an Array of Buffers');if(0===e.length)return c.alloc(0);let i;if(void 0===t)for(t=0,i=0;i<e.length;++i)t+=e[i].length;const n=c.allocUnsafe(t);let r=0;for(i=0;i<e.length;++i){let t=e[i];if(Y(t,Uint8Array))r+t.length>n.length?(c.isBuffer(t)||(t=c.from(t)),t.copy(n,r)):Uint8Array.prototype.set.call(n,t,r);else{if(!c.isBuffer(t))throw new TypeError('"list" argument must be an Array of Buffers');t.copy(n,r)}r+=t.length}return n},c.byteLength=f,c.prototype._isBuffer=!0,c.prototype.swap16=function(){const e=this.length;if(e%2!=0)throw new RangeError("Buffer size must be a multiple of 16-bits");for(let t=0;t<e;t+=2)v(this,t,t+1);return this},c.prototype.swap32=function(){const e=this.length;if(e%4!=0)throw new RangeError("Buffer size must be a multiple of 32-bits");for(let t=0;t<e;t+=4)v(this,t,t+3),v(this,t+1,t+2);return this},c.prototype.swap64=function(){const e=this.length;if(e%8!=0)throw new RangeError("Buffer size must be a multiple of 64-bits");for(let t=0;t<e;t+=8)v(this,t,t+7),v(this,t+1,t+6),v(this,t+2,t+5),v(this,t+3,t+4);return this},c.prototype.toString=function(){const e=this.length;return 0===e?"":0===arguments.length?T(this,0,e):m.apply(this,arguments)},c.prototype.toLocaleString=c.prototype.toString,c.prototype.equals=function(e){if(!c.isBuffer(e))throw new TypeError("Argument must be a Buffer");return this===e||0===c.compare(this,e)},c.prototype.inspect=function(){let e="";const i=t.INSPECT_MAX_BYTES;return e=this.toString("hex",0,i).replace(/(.{2})/g,"$1 ").trim(),this.length>i&&(e+=" ... "),"<Buffer "+e+">"},s&&(c.prototype[s]=c.prototype.inspect),c.prototype.compare=function(e,t,i,n,r){if(Y(e,Uint8Array)&&(e=c.from(e,e.offset,e.byteLength)),!c.isBuffer(e))throw new TypeError('The "target" argument must be one of type Buffer or Uint8Array. Received type '+typeof e);if(void 0===t&&(t=0),void 0===i&&(i=e?e.length:0),void 0===n&&(n=0),void 0===r&&(r=this.length),t<0||i>e.length||n<0||r>this.length)throw new RangeError("out of range index");if(n>=r&&t>=i)return 0;if(n>=r)return-1;if(t>=i)return 1;if(this===e)return 0;let s=(r>>>=0)-(n>>>=0),o=(i>>>=0)-(t>>>=0);const a=Math.min(s,o),l=this.slice(n,r),h=e.slice(t,i);for(let e=0;e<a;++e)if(l[e]!==h[e]){s=l[e],o=h[e];break}return s<o?-1:o<s?1:0},c.prototype.includes=function(e,t,i){return-1!==this.indexOf(e,t,i)},c.prototype.indexOf=function(e,t,i){return y(this,e,t,i,!0)},c.prototype.lastIndexOf=function(e,t,i){return y(this,e,t,i,!1)},c.prototype.write=function(e,t,i,n){if(void 0===t)n="utf8",i=this.length,t=0;else if(void 0===i&&"string"==typeof t)n=t,i=this.length,t=0;else{if(!isFinite(t))throw new Error("Buffer.write(string, encoding, offset[, length]) is no longer supported");t>>>=0,isFinite(i)?(i>>>=0,void 0===n&&(n="utf8")):(n=i,i=void 0)}const r=this.length-t;if((void 0===i||i>r)&&(i=r),e.length>0&&(i<0||t<0)||t>this.length)throw new RangeError("Attempt to write outside buffer bounds");n||(n="utf8");let s=!1;for(;;)switch(n){case"hex":return S(this,e,t,i);case"utf8":case"utf-8":return b(this,e,t,i);case"ascii":case"latin1":case"binary":return w(this,e,t,i);case"base64":return E(this,e,t,i);case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return I(this,e,t,i);default:if(s)throw new TypeError("Unknown encoding: "+n);n=(""+n).toLowerCase(),s=!0}},c.prototype.toJSON=function(){return{type:"Buffer",data:Array.prototype.slice.call(this._arr||this,0)}};const C=4096;function x(e,t,i){let n="";i=Math.min(e.length,i);for(let r=t;r<i;++r)n+=String.fromCharCode(127&e[r]);return n}function R(e,t,i){let n="";i=Math.min(e.length,i);for(let r=t;r<i;++r)n+=String.fromCharCode(e[r]);return n}function O(e,t,i){const n=e.length;(!t||t<0)&&(t=0),(!i||i<0||i>n)&&(i=n);let r="";for(let n=t;n<i;++n)r+=Q[e[n]];return r}function A(e,t,i){const n=e.slice(t,i);let r="";for(let e=0;e<n.length-1;e+=2)r+=String.fromCharCode(n[e]+256*n[e+1]);return r}function P(e,t,i){if(e%1!=0||e<0)throw new RangeError("offset is not uint");if(e+t>i)throw new RangeError("Trying to access beyond buffer length")}function D(e,t,i,n,r,s){if(!c.isBuffer(e))throw new TypeError('"buffer" argument must be a Buffer instance');if(t>r||t<s)throw new RangeError('"value" argument is out of bounds');if(i+n>e.length)throw new RangeError("Index out of range")}function M(e,t,i,n,r){q(t,n,r,e,i,7);let s=Number(t&BigInt(4294967295));e[i++]=s,s>>=8,e[i++]=s,s>>=8,e[i++]=s,s>>=8,e[i++]=s;let o=Number(t>>BigInt(32)&BigInt(4294967295));return e[i++]=o,o>>=8,e[i++]=o,o>>=8,e[i++]=o,o>>=8,e[i++]=o,i}function N(e,t,i,n,r){q(t,n,r,e,i,7);let s=Number(t&BigInt(4294967295));e[i+7]=s,s>>=8,e[i+6]=s,s>>=8,e[i+5]=s,s>>=8,e[i+4]=s;let o=Number(t>>BigInt(32)&BigInt(4294967295));return e[i+3]=o,o>>=8,e[i+2]=o,o>>=8,e[i+1]=o,o>>=8,e[i]=o,i+8}function B(e,t,i,n,r,s){if(i+n>e.length)throw new RangeError("Index out of range");if(i<0)throw new RangeError("Index out of range")}function U(e,t,i,n,s){return t=+t,i>>>=0,s||B(e,0,i,4),r.write(e,t,i,n,23,4),i+4}function L(e,t,i,n,s){return t=+t,i>>>=0,s||B(e,0,i,8),r.write(e,t,i,n,52,8),i+8}c.prototype.slice=function(e,t){const i=this.length;(e=~~e)<0?(e+=i)<0&&(e=0):e>i&&(e=i),(t=void 0===t?i:~~t)<0?(t+=i)<0&&(t=0):t>i&&(t=i),t<e&&(t=e);const n=this.subarray(e,t);return Object.setPrototypeOf(n,c.prototype),n},c.prototype.readUintLE=c.prototype.readUIntLE=function(e,t,i){e>>>=0,t>>>=0,i||P(e,t,this.length);let n=this[e],r=1,s=0;for(;++s<t&&(r*=256);)n+=this[e+s]*r;return n},c.prototype.readUintBE=c.prototype.readUIntBE=function(e,t,i){e>>>=0,t>>>=0,i||P(e,t,this.length);let n=this[e+--t],r=1;for(;t>0&&(r*=256);)n+=this[e+--t]*r;return n},c.prototype.readUint8=c.prototype.readUInt8=function(e,t){return e>>>=0,t||P(e,1,this.length),this[e]},c.prototype.readUint16LE=c.prototype.readUInt16LE=function(e,t){return e>>>=0,t||P(e,2,this.length),this[e]|this[e+1]<<8},c.prototype.readUint16BE=c.prototype.readUInt16BE=function(e,t){return e>>>=0,t||P(e,2,this.length),this[e]<<8|this[e+1]},c.prototype.readUint32LE=c.prototype.readUInt32LE=function(e,t){return e>>>=0,t||P(e,4,this.length),(this[e]|this[e+1]<<8|this[e+2]<<16)+16777216*this[e+3]},c.prototype.readUint32BE=c.prototype.readUInt32BE=function(e,t){return e>>>=0,t||P(e,4,this.length),16777216*this[e]+(this[e+1]<<16|this[e+2]<<8|this[e+3])},c.prototype.readBigUInt64LE=X((function(e){V(e>>>=0,"offset");const t=this[e],i=this[e+7];void 0!==t&&void 0!==i||$(e,this.length-8);const n=t+256*this[++e]+65536*this[++e]+this[++e]*2**24,r=this[++e]+256*this[++e]+65536*this[++e]+i*2**24;return BigInt(n)+(BigInt(r)<<BigInt(32))})),c.prototype.readBigUInt64BE=X((function(e){V(e>>>=0,"offset");const t=this[e],i=this[e+7];void 0!==t&&void 0!==i||$(e,this.length-8);const n=t*2**24+65536*this[++e]+256*this[++e]+this[++e],r=this[++e]*2**24+65536*this[++e]+256*this[++e]+i;return(BigInt(n)<<BigInt(32))+BigInt(r)})),c.prototype.readIntLE=function(e,t,i){e>>>=0,t>>>=0,i||P(e,t,this.length);let n=this[e],r=1,s=0;for(;++s<t&&(r*=256);)n+=this[e+s]*r;return r*=128,n>=r&&(n-=Math.pow(2,8*t)),n},c.prototype.readIntBE=function(e,t,i){e>>>=0,t>>>=0,i||P(e,t,this.length);let n=t,r=1,s=this[e+--n];for(;n>0&&(r*=256);)s+=this[e+--n]*r;return r*=128,s>=r&&(s-=Math.pow(2,8*t)),s},c.prototype.readInt8=function(e,t){return e>>>=0,t||P(e,1,this.length),128&this[e]?-1*(255-this[e]+1):this[e]},c.prototype.readInt16LE=function(e,t){e>>>=0,t||P(e,2,this.length);const i=this[e]|this[e+1]<<8;return 32768&i?4294901760|i:i},c.prototype.readInt16BE=function(e,t){e>>>=0,t||P(e,2,this.length);const i=this[e+1]|this[e]<<8;return 32768&i?4294901760|i:i},c.prototype.readInt32LE=function(e,t){return e>>>=0,t||P(e,4,this.length),this[e]|this[e+1]<<8|this[e+2]<<16|this[e+3]<<24},c.prototype.readInt32BE=function(e,t){return e>>>=0,t||P(e,4,this.length),this[e]<<24|this[e+1]<<16|this[e+2]<<8|this[e+3]},c.prototype.readBigInt64LE=X((function(e){V(e>>>=0,"offset");const t=this[e],i=this[e+7];void 0!==t&&void 0!==i||$(e,this.length-8);const n=this[e+4]+256*this[e+5]+65536*this[e+6]+(i<<24);return(BigInt(n)<<BigInt(32))+BigInt(t+256*this[++e]+65536*this[++e]+this[++e]*2**24)})),c.prototype.readBigInt64BE=X((function(e){V(e>>>=0,"offset");const t=this[e],i=this[e+7];void 0!==t&&void 0!==i||$(e,this.length-8);const n=(t<<24)+65536*this[++e]+256*this[++e]+this[++e];return(BigInt(n)<<BigInt(32))+BigInt(this[++e]*2**24+65536*this[++e]+256*this[++e]+i)})),c.prototype.readFloatLE=function(e,t){return e>>>=0,t||P(e,4,this.length),r.read(this,e,!0,23,4)},c.prototype.readFloatBE=function(e,t){return e>>>=0,t||P(e,4,this.length),r.read(this,e,!1,23,4)},c.prototype.readDoubleLE=function(e,t){return e>>>=0,t||P(e,8,this.length),r.read(this,e,!0,52,8)},c.prototype.readDoubleBE=function(e,t){return e>>>=0,t||P(e,8,this.length),r.read(this,e,!1,52,8)},c.prototype.writeUintLE=c.prototype.writeUIntLE=function(e,t,i,n){e=+e,t>>>=0,i>>>=0,n||D(this,e,t,i,Math.pow(2,8*i)-1,0);let r=1,s=0;for(this[t]=255&e;++s<i&&(r*=256);)this[t+s]=e/r&255;return t+i},c.prototype.writeUintBE=c.prototype.writeUIntBE=function(e,t,i,n){e=+e,t>>>=0,i>>>=0,n||D(this,e,t,i,Math.pow(2,8*i)-1,0);let r=i-1,s=1;for(this[t+r]=255&e;--r>=0&&(s*=256);)this[t+r]=e/s&255;return t+i},c.prototype.writeUint8=c.prototype.writeUInt8=function(e,t,i){return e=+e,t>>>=0,i||D(this,e,t,1,255,0),this[t]=255&e,t+1},c.prototype.writeUint16LE=c.prototype.writeUInt16LE=function(e,t,i){return e=+e,t>>>=0,i||D(this,e,t,2,65535,0),this[t]=255&e,this[t+1]=e>>>8,t+2},c.prototype.writeUint16BE=c.prototype.writeUInt16BE=function(e,t,i){return e=+e,t>>>=0,i||D(this,e,t,2,65535,0),this[t]=e>>>8,this[t+1]=255&e,t+2},c.prototype.writeUint32LE=c.prototype.writeUInt32LE=function(e,t,i){return e=+e,t>>>=0,i||D(this,e,t,4,4294967295,0),this[t+3]=e>>>24,this[t+2]=e>>>16,this[t+1]=e>>>8,this[t]=255&e,t+4},c.prototype.writeUint32BE=c.prototype.writeUInt32BE=function(e,t,i){return e=+e,t>>>=0,i||D(this,e,t,4,4294967295,0),this[t]=e>>>24,this[t+1]=e>>>16,this[t+2]=e>>>8,this[t+3]=255&e,t+4},c.prototype.writeBigUInt64LE=X((function(e,t=0){return M(this,e,t,BigInt(0),BigInt("0xffffffffffffffff"))})),c.prototype.writeBigUInt64BE=X((function(e,t=0){return N(this,e,t,BigInt(0),BigInt("0xffffffffffffffff"))})),c.prototype.writeIntLE=function(e,t,i,n){if(e=+e,t>>>=0,!n){const n=Math.pow(2,8*i-1);D(this,e,t,i,n-1,-n)}let r=0,s=1,o=0;for(this[t]=255&e;++r<i&&(s*=256);)e<0&&0===o&&0!==this[t+r-1]&&(o=1),this[t+r]=(e/s>>0)-o&255;return t+i},c.prototype.writeIntBE=function(e,t,i,n){if(e=+e,t>>>=0,!n){const n=Math.pow(2,8*i-1);D(this,e,t,i,n-1,-n)}let r=i-1,s=1,o=0;for(this[t+r]=255&e;--r>=0&&(s*=256);)e<0&&0===o&&0!==this[t+r+1]&&(o=1),this[t+r]=(e/s>>0)-o&255;return t+i},c.prototype.writeInt8=function(e,t,i){return e=+e,t>>>=0,i||D(this,e,t,1,127,-128),e<0&&(e=255+e+1),this[t]=255&e,t+1},c.prototype.writeInt16LE=function(e,t,i){return e=+e,t>>>=0,i||D(this,e,t,2,32767,-32768),this[t]=255&e,this[t+1]=e>>>8,t+2},c.prototype.writeInt16BE=function(e,t,i){return e=+e,t>>>=0,i||D(this,e,t,2,32767,-32768),this[t]=e>>>8,this[t+1]=255&e,t+2},c.prototype.writeInt32LE=function(e,t,i){return e=+e,t>>>=0,i||D(this,e,t,4,2147483647,-2147483648),this[t]=255&e,this[t+1]=e>>>8,this[t+2]=e>>>16,this[t+3]=e>>>24,t+4},c.prototype.writeInt32BE=function(e,t,i){return e=+e,t>>>=0,i||D(this,e,t,4,2147483647,-2147483648),e<0&&(e=4294967295+e+1),this[t]=e>>>24,this[t+1]=e>>>16,this[t+2]=e>>>8,this[t+3]=255&e,t+4},c.prototype.writeBigInt64LE=X((function(e,t=0){return M(this,e,t,-BigInt("0x8000000000000000"),BigInt("0x7fffffffffffffff"))})),c.prototype.writeBigInt64BE=X((function(e,t=0){return N(this,e,t,-BigInt("0x8000000000000000"),BigInt("0x7fffffffffffffff"))})),c.prototype.writeFloatLE=function(e,t,i){return U(this,e,t,!0,i)},c.prototype.writeFloatBE=function(e,t,i){return U(this,e,t,!1,i)},c.prototype.writeDoubleLE=function(e,t,i){return L(this,e,t,!0,i)},c.prototype.writeDoubleBE=function(e,t,i){return L(this,e,t,!1,i)},c.prototype.copy=function(e,t,i,n){if(!c.isBuffer(e))throw new TypeError("argument should be a Buffer");if(i||(i=0),n||0===n||(n=this.length),t>=e.length&&(t=e.length),t||(t=0),n>0&&n<i&&(n=i),n===i)return 0;if(0===e.length||0===this.length)return 0;if(t<0)throw new RangeError("targetStart out of bounds");if(i<0||i>=this.length)throw new RangeError("Index out of range");if(n<0)throw new RangeError("sourceEnd out of bounds");n>this.length&&(n=this.length),e.length-t<n-i&&(n=e.length-t+i);const r=n-i;return this===e&&"function"==typeof Uint8Array.prototype.copyWithin?this.copyWithin(t,i,n):Uint8Array.prototype.set.call(e,this.subarray(i,n),t),r},c.prototype.fill=function(e,t,i,n){if("string"==typeof e){if("string"==typeof t?(n=t,t=0,i=this.length):"string"==typeof i&&(n=i,i=this.length),void 0!==n&&"string"!=typeof n)throw new TypeError("encoding must be a string");if("string"==typeof n&&!c.isEncoding(n))throw new TypeError("Unknown encoding: "+n);if(1===e.length){const t=e.charCodeAt(0);("utf8"===n&&t<128||"latin1"===n)&&(e=t)}}else"number"==typeof e?e&=255:"boolean"==typeof e&&(e=Number(e));if(t<0||this.length<t||this.length<i)throw new RangeError("Out of range index");if(i<=t)return this;let r;if(t>>>=0,i=void 0===i?this.length:i>>>0,e||(e=0),"number"==typeof e)for(r=t;r<i;++r)this[r]=e;else{const s=c.isBuffer(e)?e:c.from(e,n),o=s.length;if(0===o)throw new TypeError('The value "'+e+'" is invalid for argument "value"');for(r=0;r<i-t;++r)this[r+t]=s[r%o]}return this};const K={};function j(e,t,i){K[e]=class extends i{constructor(){super(),Object.defineProperty(this,"message",{value:t.apply(this,arguments),writable:!0,configurable:!0}),this.name=`${this.name} [${e}]`,this.stack,delete this.name}get code(){return e}set code(e){Object.defineProperty(this,"code",{configurable:!0,enumerable:!0,value:e,writable:!0})}toString(){return`${this.name} [${e}]: ${this.message}`}}}function F(e){let t="",i=e.length;const n="-"===e[0]?1:0;for(;i>=n+4;i-=3)t=`_${e.slice(i-3,i)}${t}`;return`${e.slice(0,i)}${t}`}function q(e,t,i,n,r,s){if(e>i||e<t){const n="bigint"==typeof t?"n":"";let r;throw r=s>3?0===t||t===BigInt(0)?`>= 0${n} and < 2${n} ** ${8*(s+1)}${n}`:`>= -(2${n} ** ${8*(s+1)-1}${n}) and < 2 ** ${8*(s+1)-1}${n}`:`>= ${t}${n} and <= ${i}${n}`,new K.ERR_OUT_OF_RANGE("value",r,e)}!function(e,t,i){V(t,"offset"),void 0!==e[t]&&void 0!==e[t+i]||$(t,e.length-(i+1))}(n,r,s)}function V(e,t){if("number"!=typeof e)throw new K.ERR_INVALID_ARG_TYPE(t,"number",e)}function $(e,t,i){if(Math.floor(e)!==e)throw V(e,i),new K.ERR_OUT_OF_RANGE(i||"offset","an integer",e);if(t<0)throw new K.ERR_BUFFER_OUT_OF_BOUNDS;throw new K.ERR_OUT_OF_RANGE(i||"offset",`>= ${i?1:0} and <= ${t}`,e)}j("ERR_BUFFER_OUT_OF_BOUNDS",(function(e){return e?`${e} is outside of buffer bounds`:"Attempt to access memory outside buffer bounds"}),RangeError),j("ERR_INVALID_ARG_TYPE",(function(e,t){return`The "${e}" argument must be of type number. Received type ${typeof t}`}),TypeError),j("ERR_OUT_OF_RANGE",(function(e,t,i){let n=`The value of "${e}" is out of range.`,r=i;return Number.isInteger(i)&&Math.abs(i)>2**32?r=F(String(i)):"bigint"==typeof i&&(r=String(i),(i>BigInt(2)**BigInt(32)||i<-(BigInt(2)**BigInt(32)))&&(r=F(r)),r+="n"),n+=` It must be ${t}. Received ${r}`,n}),RangeError);const G=/[^+/0-9A-Za-z-_]/g;function H(e,t){let i;t=t||1/0;const n=e.length;let r=null;const s=[];for(let o=0;o<n;++o){if(i=e.charCodeAt(o),i>55295&&i<57344){if(!r){if(i>56319){(t-=3)>-1&&s.push(239,191,189);continue}if(o+1===n){(t-=3)>-1&&s.push(239,191,189);continue}r=i;continue}if(i<56320){(t-=3)>-1&&s.push(239,191,189),r=i;continue}i=65536+(r-55296<<10|i-56320)}else r&&(t-=3)>-1&&s.push(239,191,189);if(r=null,i<128){if((t-=1)<0)break;s.push(i)}else if(i<2048){if((t-=2)<0)break;s.push(i>>6|192,63&i|128)}else if(i<65536){if((t-=3)<0)break;s.push(i>>12|224,i>>6&63|128,63&i|128)}else{if(!(i<1114112))throw new Error("Invalid code point");if((t-=4)<0)break;s.push(i>>18|240,i>>12&63|128,i>>6&63|128,63&i|128)}}return s}function z(e){return n.toByteArray(function(e){if((e=(e=e.split("=")[0]).trim().replace(G,"")).length<2)return"";for(;e.length%4!=0;)e+="=";return e}(e))}function W(e,t,i,n){let r;for(r=0;r<n&&!(r+i>=t.length||r>=e.length);++r)t[r+i]=e[r];return r}function Y(e,t){return e instanceof t||null!=e&&null!=e.constructor&&null!=e.constructor.name&&e.constructor.name===t.name}function J(e){return e!=e}const Q=function(){const e="0123456789abcdef",t=new Array(256);for(let i=0;i<16;++i){const n=16*i;for(let r=0;r<16;++r)t[n+r]=e[i]+e[r]}return t}();function X(e){return"undefined"==typeof BigInt?Z:e}function Z(){throw new Error("BigInt not supported")}},1924:(e,t,i)=>{"use strict";var n=i(210),r=i(5559),s=r(n("String.prototype.indexOf"));e.exports=function(e,t){var i=n(e,!!t);return"function"==typeof i&&s(e,".prototype.")>-1?r(i):i}},5559:(e,t,i)=>{"use strict";var n=i(8612),r=i(210),s=r("%Function.prototype.apply%"),o=r("%Function.prototype.call%"),a=r("%Reflect.apply%",!0)||n.call(o,s),c=r("%Object.getOwnPropertyDescriptor%",!0),l=r("%Object.defineProperty%",!0),h=r("%Math.max%");if(l)try{l({},"a",{value:1})}catch(e){l=null}e.exports=function(e){var t=a(n,o,arguments);if(c&&l){var i=c(t,"length");i.configurable&&l(t,"length",{value:1+h(0,e.length-(arguments.length-1))})}return t};var u=function(){return a(n,s,arguments)};l?l(e.exports,"apply",{value:u}):e.exports.apply=u},7811:(e,t)=>{"use strict";var i=/; *([!#$%&'*+.^_`|~0-9A-Za-z-]+) *= *("(?:[\u000b\u0020\u0021\u0023-\u005b\u005d-\u007e\u0080-\u00ff]|\\[\u000b\u0020-\u00ff])*"|[!#$%&'*+.^_`|~0-9A-Za-z-]+) */g,n=/^[\u000b\u0020-\u007e\u0080-\u00ff]+$/,r=/^[!#$%&'*+.^_`|~0-9A-Za-z-]+$/,s=/\\([\u000b\u0020-\u00ff])/g,o=/([\\"])/g,a=/^[!#$%&'*+.^_`|~0-9A-Za-z-]+\/[!#$%&'*+.^_`|~0-9A-Za-z-]+$/;function c(e){var t=String(e);if(r.test(t))return t;if(t.length>0&&!n.test(t))throw new TypeError("invalid parameter value");return'"'+t.replace(o,"\\$1")+'"'}function l(e){this.parameters=Object.create(null),this.type=e}t.format=function(e){if(!e||"object"!=typeof e)throw new TypeError("argument obj is required");var t=e.parameters,i=e.type;if(!i||!a.test(i))throw new TypeError("invalid type");var n=i;if(t&&"object"==typeof t)for(var s,o=Object.keys(t).sort(),l=0;l<o.length;l++){if(s=o[l],!r.test(s))throw new TypeError("invalid parameter name");n+="; "+s+"="+c(t[s])}return n},t.parse=function(e){if(!e)throw new TypeError("argument string is required");var t="object"==typeof e?function(e){var t;if("function"==typeof e.getHeader?t=e.getHeader("content-type"):"object"==typeof e.headers&&(t=e.headers&&e.headers["content-type"]),"string"!=typeof t)throw new TypeError("content-type header is missing from object");return t}(e):e;if("string"!=typeof t)throw new TypeError("argument string is required to be a string");var n=t.indexOf(";"),r=-1!==n?t.substr(0,n).trim():t.trim();if(!a.test(r))throw new TypeError("invalid media type");var o=new l(r.toLowerCase());if(-1!==n){var c,h,u;for(i.lastIndex=n;h=i.exec(t);){if(h.index!==n)throw new TypeError("invalid parameter format");n+=h[0].length,c=h[1].toLowerCase(),'"'===(u=h[2])[0]&&(u=u.substr(1,u.length-2).replace(s,"$1")),o.parameters[c]=u}if(n!==t.length)throw new TypeError("invalid parameter format")}return o}},7187:e=>{"use strict";var t,i="object"==typeof Reflect?Reflect:null,n=i&&"function"==typeof i.apply?i.apply:function(e,t,i){return Function.prototype.apply.call(e,t,i)};t=i&&"function"==typeof i.ownKeys?i.ownKeys:Object.getOwnPropertySymbols?function(e){return Object.getOwnPropertyNames(e).concat(Object.getOwnPropertySymbols(e))}:function(e){return Object.getOwnPropertyNames(e)};var r=Number.isNaN||function(e){return e!=e};function s(){s.init.call(this)}e.exports=s,e.exports.once=function(e,t){return new Promise((function(i,n){function r(i){e.removeListener(t,s),n(i)}function s(){"function"==typeof e.removeListener&&e.removeListener("error",r),i([].slice.call(arguments))}f(e,t,s,{once:!0}),"error"!==t&&function(e,t,i){"function"==typeof e.on&&f(e,"error",t,{once:!0})}(e,r)}))},s.EventEmitter=s,s.prototype._events=void 0,s.prototype._eventsCount=0,s.prototype._maxListeners=void 0;var o=10;function a(e){if("function"!=typeof e)throw new TypeError('The "listener" argument must be of type Function. Received type '+typeof e)}function c(e){return void 0===e._maxListeners?s.defaultMaxListeners:e._maxListeners}function l(e,t,i,n){var r,s,o,l;if(a(i),void 0===(s=e._events)?(s=e._events=Object.create(null),e._eventsCount=0):(void 0!==s.newListener&&(e.emit("newListener",t,i.listener?i.listener:i),s=e._events),o=s[t]),void 0===o)o=s[t]=i,++e._eventsCount;else if("function"==typeof o?o=s[t]=n?[i,o]:[o,i]:n?o.unshift(i):o.push(i),(r=c(e))>0&&o.length>r&&!o.warned){o.warned=!0;var h=new Error("Possible EventEmitter memory leak detected. "+o.length+" "+String(t)+" listeners added. Use emitter.setMaxListeners() to increase limit");h.name="MaxListenersExceededWarning",h.emitter=e,h.type=t,h.count=o.length,l=h,console&&console.warn&&console.warn(l)}return e}function h(){if(!this.fired)return this.target.removeListener(this.type,this.wrapFn),this.fired=!0,0===arguments.length?this.listener.call(this.target):this.listener.apply(this.target,arguments)}function u(e,t,i){var n={fired:!1,wrapFn:void 0,target:e,type:t,listener:i},r=h.bind(n);return r.listener=i,n.wrapFn=r,r}function d(e,t,i){var n=e._events;if(void 0===n)return[];var r=n[t];return void 0===r?[]:"function"==typeof r?i?[r.listener||r]:[r]:i?function(e){for(var t=new Array(e.length),i=0;i<t.length;++i)t[i]=e[i].listener||e[i];return t}(r):g(r,r.length)}function p(e){var t=this._events;if(void 0!==t){var i=t[e];if("function"==typeof i)return 1;if(void 0!==i)return i.length}return 0}function g(e,t){for(var i=new Array(t),n=0;n<t;++n)i[n]=e[n];return i}function f(e,t,i,n){if("function"==typeof e.on)n.once?e.once(t,i):e.on(t,i);else{if("function"!=typeof e.addEventListener)throw new TypeError('The "emitter" argument must be of type EventEmitter. Received type '+typeof e);e.addEventListener(t,(function r(s){n.once&&e.removeEventListener(t,r),i(s)}))}}Object.defineProperty(s,"defaultMaxListeners",{enumerable:!0,get:function(){return o},set:function(e){if("number"!=typeof e||e<0||r(e))throw new RangeError('The value of "defaultMaxListeners" is out of range. It must be a non-negative number. Received '+e+".");o=e}}),s.init=function(){void 0!==this._events&&this._events!==Object.getPrototypeOf(this)._events||(this._events=Object.create(null),this._eventsCount=0),this._maxListeners=this._maxListeners||void 0},s.prototype.setMaxListeners=function(e){if("number"!=typeof e||e<0||r(e))throw new RangeError('The value of "n" is out of range. It must be a non-negative number. Received '+e+".");return this._maxListeners=e,this},s.prototype.getMaxListeners=function(){return c(this)},s.prototype.emit=function(e){for(var t=[],i=1;i<arguments.length;i++)t.push(arguments[i]);var r="error"===e,s=this._events;if(void 0!==s)r=r&&void 0===s.error;else if(!r)return!1;if(r){var o;if(t.length>0&&(o=t[0]),o instanceof Error)throw o;var a=new Error("Unhandled error."+(o?" ("+o.message+")":""));throw a.context=o,a}var c=s[e];if(void 0===c)return!1;if("function"==typeof c)n(c,this,t);else{var l=c.length,h=g(c,l);for(i=0;i<l;++i)n(h[i],this,t)}return!0},s.prototype.addListener=function(e,t){return l(this,e,t,!1)},s.prototype.on=s.prototype.addListener,s.prototype.prependListener=function(e,t){return l(this,e,t,!0)},s.prototype.once=function(e,t){return a(t),this.on(e,u(this,e,t)),this},s.prototype.prependOnceListener=function(e,t){return a(t),this.prependListener(e,u(this,e,t)),this},s.prototype.removeListener=function(e,t){var i,n,r,s,o;if(a(t),void 0===(n=this._events))return this;if(void 0===(i=n[e]))return this;if(i===t||i.listener===t)0==--this._eventsCount?this._events=Object.create(null):(delete n[e],n.removeListener&&this.emit("removeListener",e,i.listener||t));else if("function"!=typeof i){for(r=-1,s=i.length-1;s>=0;s--)if(i[s]===t||i[s].listener===t){o=i[s].listener,r=s;break}if(r<0)return this;0===r?i.shift():function(e,t){for(;t+1<e.length;t++)e[t]=e[t+1];e.pop()}(i,r),1===i.length&&(n[e]=i[0]),void 0!==n.removeListener&&this.emit("removeListener",e,o||t)}return this},s.prototype.off=s.prototype.removeListener,s.prototype.removeAllListeners=function(e){var t,i,n;if(void 0===(i=this._events))return this;if(void 0===i.removeListener)return 0===arguments.length?(this._events=Object.create(null),this._eventsCount=0):void 0!==i[e]&&(0==--this._eventsCount?this._events=Object.create(null):delete i[e]),this;if(0===arguments.length){var r,s=Object.keys(i);for(n=0;n<s.length;++n)"removeListener"!==(r=s[n])&&this.removeAllListeners(r);return this.removeAllListeners("removeListener"),this._events=Object.create(null),this._eventsCount=0,this}if("function"==typeof(t=i[e]))this.removeListener(e,t);else if(void 0!==t)for(n=t.length-1;n>=0;n--)this.removeListener(e,t[n]);return this},s.prototype.listeners=function(e){return d(this,e,!0)},s.prototype.rawListeners=function(e){return d(this,e,!1)},s.listenerCount=function(e,t){return"function"==typeof e.listenerCount?e.listenerCount(t):p.call(e,t)},s.prototype.listenerCount=p,s.prototype.eventNames=function(){return this._eventsCount>0?t(this._events):[]}},7648:e=>{"use strict";var t="Function.prototype.bind called on incompatible ",i=Array.prototype.slice,n=Object.prototype.toString,r="[object Function]";e.exports=function(e){var s=this;if("function"!=typeof s||n.call(s)!==r)throw new TypeError(t+s);for(var o,a=i.call(arguments,1),c=function(){if(this instanceof o){var t=s.apply(this,a.concat(i.call(arguments)));return Object(t)===t?t:this}return s.apply(e,a.concat(i.call(arguments)))},l=Math.max(0,s.length-a.length),h=[],u=0;u<l;u++)h.push("$"+u);if(o=Function("binder","return function ("+h.join(",")+"){ return binder.apply(this,arguments); }")(c),s.prototype){var d=function(){};d.prototype=s.prototype,o.prototype=new d,d.prototype=null}return o}},8612:(e,t,i)=>{"use strict";var n=i(7648);e.exports=Function.prototype.bind||n},210:(e,t,i)=>{"use strict";var n,r=SyntaxError,s=Function,o=TypeError,a=function(e){try{return s('"use strict"; return ('+e+").constructor;")()}catch(e){}},c=Object.getOwnPropertyDescriptor;if(c)try{c({},"")}catch(e){c=null}var l=function(){throw new o},h=c?function(){try{return l}catch(e){try{return c(arguments,"callee").get}catch(e){return l}}}():l,u=i(1405)(),d=Object.getPrototypeOf||function(e){return e.__proto__},p={},g="undefined"==typeof Uint8Array?n:d(Uint8Array),f={"%AggregateError%":"undefined"==typeof AggregateError?n:AggregateError,"%Array%":Array,"%ArrayBuffer%":"undefined"==typeof ArrayBuffer?n:ArrayBuffer,"%ArrayIteratorPrototype%":u?d([][Symbol.iterator]()):n,"%AsyncFromSyncIteratorPrototype%":n,"%AsyncFunction%":p,"%AsyncGenerator%":p,"%AsyncGeneratorFunction%":p,"%AsyncIteratorPrototype%":p,"%Atomics%":"undefined"==typeof Atomics?n:Atomics,"%BigInt%":"undefined"==typeof BigInt?n:BigInt,"%Boolean%":Boolean,"%DataView%":"undefined"==typeof DataView?n:DataView,"%Date%":Date,"%decodeURI%":decodeURI,"%decodeURIComponent%":decodeURIComponent,"%encodeURI%":encodeURI,"%encodeURIComponent%":encodeURIComponent,"%Error%":Error,"%eval%":eval,"%EvalError%":EvalError,"%Float32Array%":"undefined"==typeof Float32Array?n:Float32Array,"%Float64Array%":"undefined"==typeof Float64Array?n:Float64Array,"%FinalizationRegistry%":"undefined"==typeof FinalizationRegistry?n:FinalizationRegistry,"%Function%":s,"%GeneratorFunction%":p,"%Int8Array%":"undefined"==typeof Int8Array?n:Int8Array,"%Int16Array%":"undefined"==typeof Int16Array?n:Int16Array,"%Int32Array%":"undefined"==typeof Int32Array?n:Int32Array,"%isFinite%":isFinite,"%isNaN%":isNaN,"%IteratorPrototype%":u?d(d([][Symbol.iterator]())):n,"%JSON%":"object"==typeof JSON?JSON:n,"%Map%":"undefined"==typeof Map?n:Map,"%MapIteratorPrototype%":"undefined"!=typeof Map&&u?d((new Map)[Symbol.iterator]()):n,"%Math%":Math,"%Number%":Number,"%Object%":Object,"%parseFloat%":parseFloat,"%parseInt%":parseInt,"%Promise%":"undefined"==typeof Promise?n:Promise,"%Proxy%":"undefined"==typeof Proxy?n:Proxy,"%RangeError%":RangeError,"%ReferenceError%":ReferenceError,"%Reflect%":"undefined"==typeof Reflect?n:Reflect,"%RegExp%":RegExp,"%Set%":"undefined"==typeof Set?n:Set,"%SetIteratorPrototype%":"undefined"!=typeof Set&&u?d((new Set)[Symbol.iterator]()):n,"%SharedArrayBuffer%":"undefined"==typeof SharedArrayBuffer?n:SharedArrayBuffer,"%String%":String,"%StringIteratorPrototype%":u?d(""[Symbol.iterator]()):n,"%Symbol%":u?Symbol:n,"%SyntaxError%":r,"%ThrowTypeError%":h,"%TypedArray%":g,"%TypeError%":o,"%Uint8Array%":"undefined"==typeof Uint8Array?n:Uint8Array,"%Uint8ClampedArray%":"undefined"==typeof Uint8ClampedArray?n:Uint8ClampedArray,"%Uint16Array%":"undefined"==typeof Uint16Array?n:Uint16Array,"%Uint32Array%":"undefined"==typeof Uint32Array?n:Uint32Array,"%URIError%":URIError,"%WeakMap%":"undefined"==typeof WeakMap?n:WeakMap,"%WeakRef%":"undefined"==typeof WeakRef?n:WeakRef,"%WeakSet%":"undefined"==typeof WeakSet?n:WeakSet},m=function e(t){var i;if("%AsyncFunction%"===t)i=a("async function () {}");else if("%GeneratorFunction%"===t)i=a("function* () {}");else if("%AsyncGeneratorFunction%"===t)i=a("async function* () {}");else if("%AsyncGenerator%"===t){var n=e("%AsyncGeneratorFunction%");n&&(i=n.prototype)}else if("%AsyncIteratorPrototype%"===t){var r=e("%AsyncGenerator%");r&&(i=d(r.prototype))}return f[t]=i,i},v={"%ArrayBufferPrototype%":["ArrayBuffer","prototype"],"%ArrayPrototype%":["Array","prototype"],"%ArrayProto_entries%":["Array","prototype","entries"],"%ArrayProto_forEach%":["Array","prototype","forEach"],"%ArrayProto_keys%":["Array","prototype","keys"],"%ArrayProto_values%":["Array","prototype","values"],"%AsyncFunctionPrototype%":["AsyncFunction","prototype"],"%AsyncGenerator%":["AsyncGeneratorFunction","prototype"],"%AsyncGeneratorPrototype%":["AsyncGeneratorFunction","prototype","prototype"],"%BooleanPrototype%":["Boolean","prototype"],"%DataViewPrototype%":["DataView","prototype"],"%DatePrototype%":["Date","prototype"],"%ErrorPrototype%":["Error","prototype"],"%EvalErrorPrototype%":["EvalError","prototype"],"%Float32ArrayPrototype%":["Float32Array","prototype"],"%Float64ArrayPrototype%":["Float64Array","prototype"],"%FunctionPrototype%":["Function","prototype"],"%Generator%":["GeneratorFunction","prototype"],"%GeneratorPrototype%":["GeneratorFunction","prototype","prototype"],"%Int8ArrayPrototype%":["Int8Array","prototype"],"%Int16ArrayPrototype%":["Int16Array","prototype"],"%Int32ArrayPrototype%":["Int32Array","prototype"],"%JSONParse%":["JSON","parse"],"%JSONStringify%":["JSON","stringify"],"%MapPrototype%":["Map","prototype"],"%NumberPrototype%":["Number","prototype"],"%ObjectPrototype%":["Object","prototype"],"%ObjProto_toString%":["Object","prototype","toString"],"%ObjProto_valueOf%":["Object","prototype","valueOf"],"%PromisePrototype%":["Promise","prototype"],"%PromiseProto_then%":["Promise","prototype","then"],"%Promise_all%":["Promise","all"],"%Promise_reject%":["Promise","reject"],"%Promise_resolve%":["Promise","resolve"],"%RangeErrorPrototype%":["RangeError","prototype"],"%ReferenceErrorPrototype%":["ReferenceError","prototype"],"%RegExpPrototype%":["RegExp","prototype"],"%SetPrototype%":["Set","prototype"],"%SharedArrayBufferPrototype%":["SharedArrayBuffer","prototype"],"%StringPrototype%":["String","prototype"],"%SymbolPrototype%":["Symbol","prototype"],"%SyntaxErrorPrototype%":["SyntaxError","prototype"],"%TypedArrayPrototype%":["TypedArray","prototype"],"%TypeErrorPrototype%":["TypeError","prototype"],"%Uint8ArrayPrototype%":["Uint8Array","prototype"],"%Uint8ClampedArrayPrototype%":["Uint8ClampedArray","prototype"],"%Uint16ArrayPrototype%":["Uint16Array","prototype"],"%Uint32ArrayPrototype%":["Uint32Array","prototype"],"%URIErrorPrototype%":["URIError","prototype"],"%WeakMapPrototype%":["WeakMap","prototype"],"%WeakSetPrototype%":["WeakSet","prototype"]},y=i(8612),_=i(7642),S=y.call(Function.call,Array.prototype.concat),b=y.call(Function.apply,Array.prototype.splice),w=y.call(Function.call,String.prototype.replace),E=y.call(Function.call,String.prototype.slice),I=/[^%.[\]]+|\[(?:(-?\d+(?:\.\d+)?)|(["'])((?:(?!\2)[^\\]|\\.)*?)\2)\]|(?=(?:\.|\[\])(?:\.|\[\]|%$))/g,k=/\\(\\)?/g,T=function(e){var t=E(e,0,1),i=E(e,-1);if("%"===t&&"%"!==i)throw new r("invalid intrinsic syntax, expected closing `%`");if("%"===i&&"%"!==t)throw new r("invalid intrinsic syntax, expected opening `%`");var n=[];return w(e,I,(function(e,t,i,r){n[n.length]=i?w(r,k,"$1"):t||e})),n},C=function(e,t){var i,n=e;if(_(v,n)&&(n="%"+(i=v[n])[0]+"%"),_(f,n)){var s=f[n];if(s===p&&(s=m(n)),void 0===s&&!t)throw new o("intrinsic "+e+" exists, but is not available. Please file an issue!");return{alias:i,name:n,value:s}}throw new r("intrinsic "+e+" does not exist!")};e.exports=function(e,t){if("string"!=typeof e||0===e.length)throw new o("intrinsic name must be a non-empty string");if(arguments.length>1&&"boolean"!=typeof t)throw new o('"allowMissing" argument must be a boolean');var i=T(e),n=i.length>0?i[0]:"",s=C("%"+n+"%",t),a=s.name,l=s.value,h=!1,u=s.alias;u&&(n=u[0],b(i,S([0,1],u)));for(var d=1,p=!0;d<i.length;d+=1){var g=i[d],m=E(g,0,1),v=E(g,-1);if(('"'===m||"'"===m||"`"===m||'"'===v||"'"===v||"`"===v)&&m!==v)throw new r("property names with quotes must have matching quotes");if("constructor"!==g&&p||(h=!0),_(f,a="%"+(n+="."+g)+"%"))l=f[a];else if(null!=l){if(!(g in l)){if(!t)throw new o("base intrinsic for "+e+" exists, but the property is not available.");return}if(c&&d+1>=i.length){var y=c(l,g);l=(p=!!y)&&"get"in y&&!("originalValue"in y.get)?y.get:l[g]}else p=_(l,g),l=l[g];p&&!h&&(f[a]=l)}}return l}},1405:(e,t,i)=>{"use strict";var n="undefined"!=typeof Symbol&&Symbol,r=i(5419);e.exports=function(){return"function"==typeof n&&"function"==typeof Symbol&&"symbol"==typeof n("foo")&&"symbol"==typeof Symbol("bar")&&r()}},5419:e=>{"use strict";e.exports=function(){if("function"!=typeof Symbol||"function"!=typeof Object.getOwnPropertySymbols)return!1;if("symbol"==typeof Symbol.iterator)return!0;var e={},t=Symbol("test"),i=Object(t);if("string"==typeof t)return!1;if("[object Symbol]"!==Object.prototype.toString.call(t))return!1;if("[object Symbol]"!==Object.prototype.toString.call(i))return!1;for(t in e[t]=42,e)return!1;if("function"==typeof Object.keys&&0!==Object.keys(e).length)return!1;if("function"==typeof Object.getOwnPropertyNames&&0!==Object.getOwnPropertyNames(e).length)return!1;var n=Object.getOwnPropertySymbols(e);if(1!==n.length||n[0]!==t)return!1;if(!Object.prototype.propertyIsEnumerable.call(e,t))return!1;if("function"==typeof Object.getOwnPropertyDescriptor){var r=Object.getOwnPropertyDescriptor(e,t);if(42!==r.value||!0!==r.enumerable)return!1}return!0}},7642:(e,t,i)=>{"use strict";var n=i(8612);e.exports=n.call(Function.call,Object.prototype.hasOwnProperty)},645:(e,t)=>{t.read=function(e,t,i,n,r){var s,o,a=8*r-n-1,c=(1<<a)-1,l=c>>1,h=-7,u=i?r-1:0,d=i?-1:1,p=e[t+u];for(u+=d,s=p&(1<<-h)-1,p>>=-h,h+=a;h>0;s=256*s+e[t+u],u+=d,h-=8);for(o=s&(1<<-h)-1,s>>=-h,h+=n;h>0;o=256*o+e[t+u],u+=d,h-=8);if(0===s)s=1-l;else{if(s===c)return o?NaN:1/0*(p?-1:1);o+=Math.pow(2,n),s-=l}return(p?-1:1)*o*Math.pow(2,s-n)},t.write=function(e,t,i,n,r,s){var o,a,c,l=8*s-r-1,h=(1<<l)-1,u=h>>1,d=23===r?Math.pow(2,-24)-Math.pow(2,-77):0,p=n?0:s-1,g=n?1:-1,f=t<0||0===t&&1/t<0?1:0;for(t=Math.abs(t),isNaN(t)||t===1/0?(a=isNaN(t)?1:0,o=h):(o=Math.floor(Math.log(t)/Math.LN2),t*(c=Math.pow(2,-o))<1&&(o--,c*=2),(t+=o+u>=1?d/c:d*Math.pow(2,1-u))*c>=2&&(o++,c/=2),o+u>=h?(a=0,o=h):o+u>=1?(a=(t*c-1)*Math.pow(2,r),o+=u):(a=t*Math.pow(2,u-1)*Math.pow(2,r),o=0));r>=8;e[i+p]=255&a,p+=g,a/=256,r-=8);for(o=o<<r|a,l+=r;l>0;e[i+p]=255&o,p+=g,o/=256,l-=8);e[i+p-g]|=128*f}},2043:function(e,t,i){var n,r;!function(s,o){"use strict";void 0===(r="function"==typeof(n=function(){var e=function(){},t="undefined",i=typeof window!==t&&typeof window.navigator!==t&&/Trident\/|MSIE /.test(window.navigator.userAgent),n=["trace","debug","info","warn","error"];function r(e,t){var i=e[t];if("function"==typeof i.bind)return i.bind(e);try{return Function.prototype.bind.call(i,e)}catch(t){return function(){return Function.prototype.apply.apply(i,[e,arguments])}}}function s(){console.log&&(console.log.apply?console.log.apply(console,arguments):Function.prototype.apply.apply(console.log,[console,arguments])),console.trace&&console.trace()}function o(n){return"debug"===n&&(n="log"),typeof console!==t&&("trace"===n&&i?s:void 0!==console[n]?r(console,n):void 0!==console.log?r(console,"log"):e)}function a(t,i){for(var r=0;r<n.length;r++){var s=n[r];this[s]=r<t?e:this.methodFactory(s,t,i)}this.log=this.debug}function c(e,i,n){return function(){typeof console!==t&&(a.call(this,i,n),this[e].apply(this,arguments))}}function l(e,t,i){return o(e)||c.apply(this,arguments)}function h(e,i,r){var s,o=this,c="loglevel";function h(){var e;if(typeof window!==t&&c){try{e=window.localStorage[c]}catch(e){}if(typeof e===t)try{var i=window.document.cookie,n=i.indexOf(encodeURIComponent(c)+"=");-1!==n&&(e=/^([^;]+)/.exec(i.slice(n))[1])}catch(e){}return void 0===o.levels[e]&&(e=void 0),e}}"string"==typeof e?c+=":"+e:"symbol"==typeof e&&(c=void 0),o.name=e,o.levels={TRACE:0,DEBUG:1,INFO:2,WARN:3,ERROR:4,SILENT:5},o.methodFactory=r||l,o.getLevel=function(){return s},o.setLevel=function(i,r){if("string"==typeof i&&void 0!==o.levels[i.toUpperCase()]&&(i=o.levels[i.toUpperCase()]),!("number"==typeof i&&i>=0&&i<=o.levels.SILENT))throw"log.setLevel() called with invalid level: "+i;if(s=i,!1!==r&&function(e){var i=(n[e]||"silent").toUpperCase();if(typeof window!==t&&c){try{return void(window.localStorage[c]=i)}catch(e){}try{window.document.cookie=encodeURIComponent(c)+"="+i+";"}catch(e){}}}(i),a.call(o,i,e),typeof console===t&&i<o.levels.SILENT)return"No console available for logging"},o.setDefaultLevel=function(e){h()||o.setLevel(e,!1)},o.enableAll=function(e){o.setLevel(o.levels.TRACE,e)},o.disableAll=function(e){o.setLevel(o.levels.SILENT,e)};var u=h();null==u&&(u=null==i?"WARN":i),o.setLevel(u,!1)}var u=new h,d={};u.getLogger=function(e){if("symbol"!=typeof e&&"string"!=typeof e||""===e)throw new TypeError("You must supply a name when creating a logger.");var t=d[e];return t||(t=d[e]=new h(e,u.getLevel(),u.methodFactory)),t};var p=typeof window!==t?window.log:void 0;return u.noConflict=function(){return typeof window!==t&&window.log===u&&(window.log=p),u},u.getLoggers=function(){return d},u.default=u,u})?n.call(t,i,t,e):n)||(e.exports=r)}()},2481:(e,t,i)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.UNSTABLE_MSC3089_BRANCH=t.UNSTABLE_MSC3089_LEAF=t.UNSTABLE_MSC3089_TREE_SUBTYPE=t.UNSTABLE_MSC3088_ENABLED=t.UNSTABLE_MSC3088_PURPOSE=t.RoomType=t.RoomCreateTypeField=t.MsgType=t.RelationType=t.EventType=void 0;var n=i(7048);let r,s,o,a;t.EventType=r,function(e){e.RoomCanonicalAlias="m.room.canonical_alias",e.RoomCreate="m.room.create",e.RoomJoinRules="m.room.join_rules",e.RoomMember="m.room.member",e.RoomThirdPartyInvite="m.room.third_party_invite",e.RoomPowerLevels="m.room.power_levels",e.RoomName="m.room.name",e.RoomTopic="m.room.topic",e.RoomAvatar="m.room.avatar",e.RoomPinnedEvents="m.room.pinned_events",e.RoomEncryption="m.room.encryption",e.RoomHistoryVisibility="m.room.history_visibility",e.RoomGuestAccess="m.room.guest_access",e.RoomServerAcl="m.room.server_acl",e.RoomTombstone="m.room.tombstone",e.RoomAliases="m.room.aliases",e.SpaceChild="m.space.child",e.SpaceParent="m.space.parent",e.RoomRedaction="m.room.redaction",e.RoomMessage="m.room.message",e.RoomMessageEncrypted="m.room.encrypted",e.Sticker="m.sticker",e.CallInvite="m.call.invite",e.CallCandidates="m.call.candidates",e.CallAnswer="m.call.answer",e.CallHangup="m.call.hangup",e.CallReject="m.call.reject",e.CallSelectAnswer="m.call.select_answer",e.CallNegotiate="m.call.negotiate",e.CallReplaces="m.call.replaces",e.CallAssertedIdentity="m.call.asserted_identity",e.CallAssertedIdentityPrefix="org.matrix.call.asserted_identity",e.KeyVerificationRequest="m.key.verification.request",e.KeyVerificationStart="m.key.verification.start",e.KeyVerificationCancel="m.key.verification.cancel",e.KeyVerificationMac="m.key.verification.mac",e.KeyVerificationDone="m.key.verification.done",e.RoomMessageFeedback="m.room.message.feedback",e.Reaction="m.reaction",e.Typing="m.typing",e.Receipt="m.receipt",e.Presence="m.presence",e.FullyRead="m.fully_read",e.Tag="m.tag",e.SpaceOrder="org.matrix.msc3230.space_order",e.PushRules="m.push_rules",e.Direct="m.direct",e.IgnoredUserList="m.ignored_user_list",e.RoomKey="m.room_key",e.RoomKeyRequest="m.room_key_request",e.ForwardedRoomKey="m.forwarded_room_key",e.Dummy="m.dummy"}(r||(t.EventType=r={})),t.RelationType=s,function(e){e.Annotation="m.annotation",e.Replace="m.replace"}(s||(t.RelationType=s={})),t.MsgType=o,function(e){e.Text="m.text",e.Emote="m.emote",e.Notice="m.notice",e.Image="m.image",e.File="m.file",e.Audio="m.audio",e.Location="m.location",e.Video="m.video"}(o||(t.MsgType=o={})),t.RoomCreateTypeField="type",t.RoomType=a,function(e){e.Space="m.space"}(a||(t.RoomType=a={}));const c=new n.UnstableValue("m.room.purpose","org.matrix.msc3088.purpose");t.UNSTABLE_MSC3088_PURPOSE=c;const l=new n.UnstableValue("m.enabled","org.matrix.msc3088.enabled");t.UNSTABLE_MSC3088_ENABLED=l;const h=new n.UnstableValue("m.data_tree","org.matrix.msc3089.data_tree");t.UNSTABLE_MSC3089_TREE_SUBTYPE=h;const u=new n.UnstableValue("m.leaf","org.matrix.msc3089.leaf");t.UNSTABLE_MSC3089_LEAF=u;const d=new n.UnstableValue("m.branch","org.matrix.msc3089.branch");t.UNSTABLE_MSC3089_BRANCH=d},4702:(e,t)=>{"use strict";let i,n;Object.defineProperty(t,"__esModule",{value:!0}),t.Preset=t.Visibility=void 0,t.Visibility=i,function(e){e.Public="public",e.Private="private"}(i||(t.Visibility=i={})),t.Preset=n,function(e){e.PrivateChat="private_chat",e.TrustedPrivateChat="trusted_private_chat",e.PublicChat="public_chat"}(n||(t.Preset=n={}))},7048:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.UnstableValue=t.NamespacedValue=void 0;class i{constructor(e,t){if(this.stable=e,this.unstable=t,!this.unstable&&!this.stable)throw new Error("One of stable or unstable values must be supplied")}get name(){return this.stable?this.stable:this.unstable}get altName(){return this.stable?this.unstable:null}matches(e){return this.name===e||this.altName===e}findIn(e){let t;return this.name&&(t=null==e?void 0:e[this.name]),!t&&this.altName&&(t=null==e?void 0:e[this.altName]),t}includedIn(e){let t=!1;return this.name&&(t=e.includes(this.name)),!t&&this.altName&&(t=e.includes(this.altName)),t}}t.NamespacedValue=i,t.UnstableValue=class extends i{constructor(e,t){if(super(e,t),!this.unstable)throw new Error("Unstable value must be supplied")}get name(){return this.unstable}get altName(){return this.stable}}},771:(e,t,i)=>{"use strict";var n=i(5318);Object.defineProperty(t,"__esModule",{value:!0}),t.ReEmitter=void 0;var r=n(i(9713));t.ReEmitter=class{constructor(e){(0,r.default)(this,"target",void 0),this.target=e}reEmit(e,t){for(const i of t){const t=(...t)=>{"error"===i&&0===this.target.listenerCount("error")||this.target.emit(i,...t,e)};e.on(i,t)}}}},9118:(e,t,i)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.AutoDiscovery=void 0;var n=i(7434),r=i(8575);class s{static get ERROR_INVALID(){return"Invalid homeserver discovery response"}static get ERROR_GENERIC_FAILURE(){return"Failed to get autodiscovery configuration from server"}static get ERROR_INVALID_HS_BASE_URL(){return"Invalid base_url for m.homeserver"}static get ERROR_INVALID_HOMESERVER(){return"Homeserver URL does not appear to be a valid Matrix homeserver"}static get ERROR_INVALID_IS_BASE_URL(){return"Invalid base_url for m.identity_server"}static get ERROR_INVALID_IDENTITY_SERVER(){return"Identity server URL does not appear to be a valid identity server"}static get ERROR_INVALID_IS(){return"Invalid identity server discovery response"}static get ERROR_MISSING_WELLKNOWN(){return"No .well-known JSON file found"}static get ERROR_INVALID_JSON(){return"Invalid JSON"}static get ALL_ERRORS(){return[s.ERROR_INVALID,s.ERROR_GENERIC_FAILURE,s.ERROR_INVALID_HS_BASE_URL,s.ERROR_INVALID_HOMESERVER,s.ERROR_INVALID_IS_BASE_URL,s.ERROR_INVALID_IDENTITY_SERVER,s.ERROR_INVALID_IS,s.ERROR_MISSING_WELLKNOWN,s.ERROR_INVALID_JSON]}static get FAIL_ERROR(){return"FAIL_ERROR"}static get FAIL_PROMPT(){return"FAIL_PROMPT"}static get PROMPT(){return"PROMPT"}static get SUCCESS(){return"SUCCESS"}static async fromDiscoveryConfig(e){const t={"m.homeserver":{state:s.FAIL_ERROR,error:s.ERROR_INVALID,base_url:null},"m.identity_server":{state:s.PROMPT,error:null,base_url:null}};if(!e||!e["m.homeserver"])return n.logger.error("No m.homeserver key in config"),t["m.homeserver"].state=s.FAIL_PROMPT,t["m.homeserver"].error=s.ERROR_INVALID,Promise.resolve(t);if(!e["m.homeserver"].base_url)return n.logger.error("No m.homeserver base_url in config"),t["m.homeserver"].state=s.FAIL_PROMPT,t["m.homeserver"].error=s.ERROR_INVALID_HS_BASE_URL,Promise.resolve(t);const i=this._sanitizeWellKnownUrl(e["m.homeserver"].base_url);if(!i)return n.logger.error("Invalid base_url for m.homeserver"),t["m.homeserver"].error=s.ERROR_INVALID_HS_BASE_URL,Promise.resolve(t);const r=await this._fetchWellKnownObject(`${i}/_matrix/client/versions`);if(!r||!r.raw.versions)return n.logger.error("Invalid /versions response"),t["m.homeserver"].error=s.ERROR_INVALID_HOMESERVER,t["m.homeserver"].base_url=i,Promise.resolve(t);t["m.homeserver"]={state:s.SUCCESS,error:null,base_url:i};let o="";if(e["m.identity_server"]){const i={"m.homeserver":t["m.homeserver"],"m.identity_server":{state:s.FAIL_PROMPT,error:s.ERROR_INVALID_IS,base_url:null}};if(o=this._sanitizeWellKnownUrl(e["m.identity_server"].base_url),!o)return n.logger.error("Invalid base_url for m.identity_server"),i["m.identity_server"].error=s.ERROR_INVALID_IS_BASE_URL,Promise.resolve(i);const r=await this._fetchWellKnownObject(`${o}/_matrix/identity/api/v1`);if(!r||!r.raw||"SUCCESS"!==r.action)return n.logger.error("Invalid /api/v1 response"),i["m.identity_server"].error=s.ERROR_INVALID_IDENTITY_SERVER,i["m.identity_server"].base_url=o,Promise.resolve(i)}return o&&o.length>0&&(t["m.identity_server"]={state:s.SUCCESS,error:null,base_url:o}),Object.keys(e).map((i=>{if("m.homeserver"===i||"m.identity_server"===i){const n=["error","state","base_url"];for(const r of Object.keys(e[i]))n.includes(r)||(t[i][r]=e[i][r])}else t[i]=e[i]})),Promise.resolve(t)}static async findClientConfig(e){if(!e||"string"!=typeof e||0===e.length)throw new Error("'domain' must be a string of non-zero length");const t={"m.homeserver":{state:s.FAIL_ERROR,error:s.ERROR_INVALID,base_url:null},"m.identity_server":{state:s.PROMPT,error:null,base_url:null}},i=await this._fetchWellKnownObject(`https://${e}/.well-known/matrix/client`);return i&&"SUCCESS"===i.action?s.fromDiscoveryConfig(i.raw):(n.logger.error("No response or error when parsing .well-known"),i.reason&&n.logger.error(i.reason),"IGNORE"===i.action?t["m.homeserver"]={state:s.PROMPT,error:null,base_url:null}:(t["m.homeserver"].state=s.FAIL_PROMPT,t["m.homeserver"].error=s.ERROR_INVALID),Promise.resolve(t))}static async getRawClientConfig(e){if(!e||"string"!=typeof e||0===e.length)throw new Error("'domain' must be a string of non-zero length");const t=await this._fetchWellKnownObject(`https://${e}/.well-known/matrix/client`);return t&&t.raw||{}}static _sanitizeWellKnownUrl(e){if(!e)return!1;try{let t=null;try{t=r.URL?new r.URL(e):new URL(e)}catch(i){t=new URL(e)}if(!t||!t.hostname)return!1;if("http:"!==t.protocol&&"https:"!==t.protocol)return!1;const i=t.port?`:${t.port}`:"",n=t.pathname?t.pathname:"";let s=`${t.protocol}//${t.hostname}${i}${n}`;return s.endsWith("/")&&(s=s.substring(0,s.length-1)),s}catch(e){return n.logger.error(e),!1}}static async _fetchWellKnownObject(e){return new Promise((function(t,n){const r=i(8070).getRequest();if(!r)throw new Error("No request library available");r({method:"GET",uri:e,timeout:5e3},((e,i,n)=>{if(e||i&&(i.statusCode<200||i.statusCode>=300)){let n="FAIL_PROMPT",r=(e?e.message:null)||"General failure";return i&&404===i.statusCode&&(n="IGNORE",r=s.ERROR_MISSING_WELLKNOWN),void t({raw:{},action:n,reason:r,error:e})}try{t({raw:JSON.parse(n),action:"SUCCESS"})}catch(e){let i=s.ERROR_INVALID;"SyntaxError"===e.name&&(i=s.ERROR_INVALID_JSON),t({raw:{},action:"FAIL_PROMPT",reason:i,error:e})}}))}))}}t.AutoDiscovery=s},8743:(e,t,i)=>{"use strict";var n=i(5318),r=i(862);Object.defineProperty(t,"__esModule",{value:!0});var s={};t.default=void 0;var o=r(i(8070));Object.keys(o).forEach((function(e){"default"!==e&&"__esModule"!==e&&(Object.prototype.hasOwnProperty.call(s,e)||e in t&&t[e]===o[e]||Object.defineProperty(t,e,{enumerable:!0,get:function(){return o[e]}}))}));var a=n(i(4770)),c=n(i(1241));let l;o.request((function(e,t){return e.qs=c.default.stringify(e.qs||{},e.qsStringifyOptions),(0,a.default)(e,t)}));try{l=i.g.indexedDB}catch(e){}l&&o.setCryptoStoreFactory((function(){return new o.IndexedDBCryptoStore(l,"matrix-js-sdk:crypto")}));var h=o;t.default=h,i.g.matrixcs=o},2168:(e,t,i)=>{"use strict";var n=i(862),r=i(5318);Object.defineProperty(t,"__esModule",{value:!0}),t.MatrixClient=t.RoomVersionStability=t.PendingEventOrdering=t.CRYPTO_ENABLED=void 0;var s=r(i(9713)),o=i(7187),a=i(4551),c=i(4369),l=i(5641),h=i(9679),u=i(7906),d=i(2931),p=n(i(3102)),g=i(8910),f=i(1707),m=i(9118),v=n(i(2772)),y=i(771),_=i(635),S=i(7434),b=i(1415),w=i(7715),E=i(2600),I=i(4077),k=i(1597),T=i(3998),C=i(3667),x=i(1398),R=i(4830),O=i(8070),A=i(9180),P=n(i(4656)),D=i(764),M=i(2481),N=i(4702),B=i(1166),U=r(i(8575)),L=i(8401),K=i(5537),j=i(6170);function F(e,t){var i=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),i.push.apply(i,n)}return i}function q(e){for(var t=1;t<arguments.length;t++){var i=null!=arguments[t]?arguments[t]:{};t%2?F(Object(i),!0).forEach((function(t){(0,s.default)(e,t,i[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(i)):F(Object(i)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(i,t))}))}return e}const V=(0,E.isCryptoAvailable)();t.CRYPTO_ENABLED=V;const $=6e5;let G,H;var z;t.PendingEventOrdering=G,function(e){e.Chronological="chronological",e.Detached="detached"}(G||(t.PendingEventOrdering=G={})),t.RoomVersionStability=H,function(e){e.Stable="stable",e.Unstable="unstable"}(H||(t.RoomVersionStability=H={})),function(e){e.MasterKey="master_key",e.SelfSigningKey="self_signing_key",e.UserSigningKey="user_signing_key"}(z||(z={}));class W extends o.EventEmitter{constructor(e){super(),(0,s.default)(this,"reEmitter",new y.ReEmitter(this)),(0,s.default)(this,"olmVersion",null),(0,s.default)(this,"usingExternalCrypto",!1),(0,s.default)(this,"store",void 0),(0,s.default)(this,"deviceId",void 0),(0,s.default)(this,"credentials",void 0),(0,s.default)(this,"pickleKey",void 0),(0,s.default)(this,"scheduler",void 0),(0,s.default)(this,"clientRunning",!1),(0,s.default)(this,"timelineSupport",!1),(0,s.default)(this,"urlPreviewCache",{}),(0,s.default)(this,"unstableClientRelationAggregation",!1),(0,s.default)(this,"identityServer",void 0),(0,s.default)(this,"sessionStore",void 0),(0,s.default)(this,"http",void 0),(0,s.default)(this,"crypto",void 0),(0,s.default)(this,"cryptoCallbacks",void 0),(0,s.default)(this,"callEventHandler",void 0),(0,s.default)(this,"supportsCallTransfer",!1),(0,s.default)(this,"forceTURN",!1),(0,s.default)(this,"iceCandidatePoolSize",0),(0,s.default)(this,"idBaseUrl",void 0),(0,s.default)(this,"baseUrl",void 0),(0,s.default)(this,"canSupportVoip",!1),(0,s.default)(this,"peekSync",null),(0,s.default)(this,"isGuestAccount",!1),(0,s.default)(this,"ongoingScrollbacks",{}),(0,s.default)(this,"notifTimelineSet",null),(0,s.default)(this,"cryptoStore",void 0),(0,s.default)(this,"verificationMethods",void 0),(0,s.default)(this,"fallbackICEServerAllowed",!1),(0,s.default)(this,"roomList",void 0),(0,s.default)(this,"syncApi",void 0),(0,s.default)(this,"pushRules",void 0),(0,s.default)(this,"syncLeftRoomsPromise",void 0),(0,s.default)(this,"syncedLeftRooms",!1),(0,s.default)(this,"clientOpts",void 0),(0,s.default)(this,"clientWellKnownIntervalID",void 0),(0,s.default)(this,"canResetTimelineCallback",void 0),(0,s.default)(this,"pushProcessor",new f.PushProcessor(this)),(0,s.default)(this,"serverVersionsPromise",void 0),(0,s.default)(this,"cachedCapabilities",void 0),(0,s.default)(this,"clientWellKnown",void 0),(0,s.default)(this,"clientWellKnownPromise",void 0),(0,s.default)(this,"turnServers",[]),(0,s.default)(this,"turnServersExpiry",0),(0,s.default)(this,"checkTurnServersIntervalID",void 0),(0,s.default)(this,"exportedOlmDeviceToImport",void 0),(0,s.default)(this,"txnCtr",0),(0,s.default)(this,"startCallEventHandler",(()=>{this.isInitialSyncComplete()&&(this.callEventHandler.start(),this.off("sync",this.startCallEventHandler))})),e.baseUrl=p.ensureNoTrailingSlash(e.baseUrl),e.idBaseUrl=p.ensureNoTrailingSlash(e.idBaseUrl),this.baseUrl=e.baseUrl,this.idBaseUrl=e.idBaseUrl,this.usingExternalCrypto=e.usingExternalCrypto,this.store=e.store||new l.StubStore,this.deviceId=e.deviceId||null;const t=e.userId||null;this.credentials={userId:t},this.http=new w.MatrixHttpApi(this,{baseUrl:e.baseUrl,idBaseUrl:e.idBaseUrl,accessToken:e.accessToken,request:e.request,prefix:w.PREFIX_R0,onlyData:!0,extraParams:e.queryParams,localTimeoutMs:e.localTimeoutMs,useAuthorizationHeader:e.useAuthorizationHeader}),e.deviceToImport?this.deviceId?S.logger.warn("not importing device because device ID is provided to constructor independently of exported data"):this.credentials.userId?S.logger.warn("not importing device because user ID is provided to constructor independently of exported data"):e.deviceToImport.deviceId?(this.deviceId=e.deviceToImport.deviceId,this.credentials.userId=e.deviceToImport.userId,this.exportedOlmDeviceToImport=e.deviceToImport.olmDevice):S.logger.warn("not importing device because no device ID in exported data"):e.pickleKey&&(this.pickleKey=e.pickleKey),this.scheduler=e.scheduler,this.scheduler&&this.scheduler.setProcessFunction((async e=>{const t=this.getRoom(e.getRoomId());e.status!==c.EventStatus.SENDING&&this.updatePendingEventStatus(t,e,c.EventStatus.SENDING);const i=await this.sendEventHttpRequest(e);return t&&t.updatePendingEvent(e,c.EventStatus.SENT,i.event_id),i})),(0,h.createNewMatrixCall)(this,void 0,void 0)&&(this.callEventHandler=new d.CallEventHandler(this),this.canSupportVoip=!0,this.on("sync",this.startCallEventHandler)),this.timelineSupport=Boolean(e.timelineSupport),this.unstableClientRelationAggregation=!!e.unstableClientRelationAggregation,this.cryptoStore=e.cryptoStore,this.sessionStore=e.sessionStore,this.verificationMethods=e.verificationMethods,this.cryptoCallbacks=e.cryptoCallbacks||{},this.forceTURN=e.forceTURN||!1,this.iceCandidatePoolSize=void 0===e.iceCandidatePoolSize?0:e.iceCandidatePoolSize,this.supportsCallTransfer=e.supportsCallTransfer||!1,this.fallbackICEServerAllowed=e.fallbackICEServerAllowed||!1,this.roomList=new _.RoomList(this.cryptoStore),this.on("Event.decrypted",(e=>{const t=e.getPushActions(),i=this.pushProcessor.actionsForEvent(e);e.setPushActions(i);const n=this.getRoom(e.getRoomId());if(!n)return;const r=n.getUnreadNotificationCount(O.NotificationCountType.Highlight),s=!(!t||!t.tweaks||!t.tweaks.highlight),o=!(!i||!i.tweaks||!i.tweaks.highlight);if((s!==o||r>0)&&!n.hasUserReadEvent(this.getUserId(),e.getId())){let e=r;o&&!s&&e++,!o&&s&&e--,n.setUnreadNotificationCount(O.NotificationCountType.Highlight,e),n.getUnreadNotificationCount(O.NotificationCountType.Total)<e&&n.setUnreadNotificationCount(O.NotificationCountType.Total,e)}})),this.on("Room.receipt",((e,t)=>{if(t&&this.isRoomEncrypted(t.roomId)){const i=e.getContent();if(!(Object.keys(i).filter((e=>Object.keys(i[e]["m.read"]).includes(this.getUserId()))).length>0))return;const n=20,r=t.getLiveTimeline().getEvents();let s=0;for(let e=r.length-1;e>=0;e--){if(e===r.length-n)return;const i=r[e];if(t.hasUserReadEvent(this.getUserId(),i.getId()))break;const o=this.getPushActionsForEvent(i);s+=o.tweaks&&o.tweaks.highlight?1:0}t.setUnreadNotificationCount("highlight",s)}}))}async startClient(e){if(this.clientRunning)return;this.clientRunning=!0,"number"==typeof e&&(e={initialSyncLimit:e});const t=this.getUserId();t&&this.store.storeUser(new T.User(t)),this.crypto&&(this.crypto.uploadDeviceKeys(),this.crypto.start()),this.canSupportVoip&&(this.checkTurnServersIntervalID=setInterval((()=>{this.checkTurnServers()}),$),this.checkTurnServers()),this.syncApi&&(S.logger.error("Still have sync object whilst not running: stopping old one"),this.syncApi.stop()),this.clientOpts=Object.assign({},e),this.clientOpts.crypto=this.crypto,this.clientOpts.canResetEntireTimeline=e=>!!this.canResetTimelineCallback&&this.canResetTimelineCallback(e),this.syncApi=new a.SyncApi(this,this.clientOpts),this.syncApi.sync(),void 0!==this.clientOpts.clientWellKnownPollPeriod&&(this.clientWellKnownIntervalID=setInterval((()=>{this.fetchClientWellKnown()}),1e3*this.clientOpts.clientWellKnownPollPeriod),this.fetchClientWellKnown())}stopClient(){var e,t,n,r;S.logger.log("stopping MatrixClient"),this.clientRunning=!1,null===(e=this.syncApi)||void 0===e||e.stop(),this.syncApi=null,null===(t=this.crypto)||void 0===t||t.stop(),null===(n=this.peekSync)||void 0===n||n.stopPeeking(),null===(r=this.callEventHandler)||void 0===r||r.stop(),this.callEventHandler=null,i.g.clearInterval(this.checkTurnServersIntervalID),void 0!==this.clientWellKnownIntervalID&&i.g.clearInterval(this.clientWellKnownIntervalID)}async rehydrateDevice(){if(this.crypto)throw new Error("Cannot rehydrate device after crypto is initialized");if(!this.cryptoCallbacks.getDehydrationKey)return;const e=await this.getDehydratedDevice();if(!e)return;if(!e.device_data||!e.device_id)return void S.logger.info("no dehydrated device found");const t=new i.g.Olm.Account;try{const i=e.device_data;if(i.algorithm!==R.DEHYDRATION_ALGORITHM)return void S.logger.warn("Wrong algorithm for dehydrated device");S.logger.log("unpickling dehydrated device");const n=await this.cryptoCallbacks.getDehydrationKey(i,(e=>{t.unpickle(new Uint8Array(e),i.account)}));if(t.unpickle(n,i.account),S.logger.log("unpickled device"),!0===(await this.http.authedRequest(void 0,"POST","/dehydrated_device/claim",void 0,{device_id:e.device_id},{prefix:"/_matrix/client/unstable/org.matrix.msc2697.v2"})).success){this.deviceId=e.device_id,S.logger.info("using dehydrated device");const i=this.pickleKey||"DEFAULT_KEY";return this.exportedOlmDeviceToImport={pickledAccount:t.pickle(i),sessions:[],pickleKey:i},t.free(),this.deviceId}return t.free(),void S.logger.info("not using dehydrated device")}catch(e){t.free(),S.logger.warn("could not unpickle",e)}}async getDehydratedDevice(){try{return await this.http.authedRequest(void 0,"GET","/dehydrated_device",void 0,void 0,{prefix:"/_matrix/client/unstable/org.matrix.msc2697.v2"})}catch(e){return void S.logger.info("could not get dehydrated device",e.toString())}}async setDehydrationKey(e,t,i){if(this.crypto)return await this.crypto.dehydrationManager.setKeyAndQueueDehydration(e,t,i);S.logger.warn("not dehydrating device if crypto is not enabled")}async createDehydratedDevice(e,t,i){if(this.crypto)return await this.crypto.dehydrationManager.setKey(e,t,i),await this.crypto.dehydrationManager.dehydrateDevice();S.logger.warn("not dehydrating device if crypto is not enabled")}async exportDevice(){if(this.crypto)return{userId:this.credentials.userId,deviceId:this.deviceId,olmDevice:await this.crypto.olmDevice.export()};S.logger.warn("not exporting device if crypto is not enabled")}clearStores(){if(this.clientRunning)throw new Error("Cannot clear stores while client is running");const e=[];return e.push(this.store.deleteAllData()),this.cryptoStore&&e.push(this.cryptoStore.deleteAllData()),Promise.all(e).then()}getUserId(){return this.credentials&&this.credentials.userId?this.credentials.userId:null}getDomain(){return this.credentials&&this.credentials.userId?this.credentials.userId.replace(/^.*?:/,""):null}getUserIdLocalpart(){return this.credentials&&this.credentials.userId?this.credentials.userId.split(":")[0].substring(1):null}getDeviceId(){return this.deviceId}supportsVoip(){return this.canSupportVoip}setForceTURN(e){this.forceTURN=e}setSupportsCallTransfer(e){this.supportsCallTransfer=e}createCall(e){return(0,h.createNewMatrixCall)(this,e)}getSyncState(){return this.syncApi?this.syncApi.getSyncState():null}getSyncStateData(){return this.syncApi?this.syncApi.getSyncStateData():null}isInitialSyncComplete(){const e=this.getSyncState();return!!e&&(e===A.SyncState.Prepared||e===A.SyncState.Syncing)}isGuest(){return this.isGuestAccount}setGuest(e){this.isGuestAccount=e}getScheduler(){return this.scheduler}retryImmediately(){return this.syncApi.retryImmediately()}getNotifTimelineSet(){return this.notifTimelineSet}setNotifTimelineSet(e){this.notifTimelineSet=e}getCapabilities(e=!1){const t=(new Date).getTime();return this.cachedCapabilities&&!e&&t<this.cachedCapabilities.expiration?(S.logger.log("Returning cached capabilities"),Promise.resolve(this.cachedCapabilities.capabilities)):this.http.authedRequest(void 0,"GET","/capabilities").catch((e=>(S.logger.error(e),null))).then((e=>{e||(e={});const i=e.capabilities||{},n=Object.keys(i).length?216e5:6e4+5e3*Math.random();return this.cachedCapabilities={capabilities:i,expiration:t+n},S.logger.log("Caching capabilities: ",i),i}))}async initCrypto(){if(!(0,E.isCryptoAvailable)())throw new Error("End-to-end encryption not supported in this js-sdk build: did you remember to load the olm library?");if(this.crypto)return void S.logger.warn("Attempt to re-initialise e2e encryption on MatrixClient");if(!this.sessionStore)throw new Error("Cannot enable encryption: no sessionStore provided");if(!this.cryptoStore)throw new Error("Cannot enable encryption: no cryptoStore provided");S.logger.log("Crypto: Starting up crypto store..."),await this.cryptoStore.startup(),S.logger.log("Crypto: initialising roomlist..."),await this.roomList.init();const e=this.getUserId();if(null===e)throw new Error("Cannot enable encryption on MatrixClient with unknown userId: ensure userId is passed in createClient().");if(null===this.deviceId)throw new Error("Cannot enable encryption on MatrixClient with unknown deviceId: ensure deviceId is passed in createClient().");const t=new E.Crypto(this,this.sessionStore,e,this.deviceId,this.store,this.cryptoStore,this.roomList,this.verificationMethods);this.reEmitter.reEmit(t,["crypto.keyBackupFailed","crypto.keyBackupSessionsRemaining","crypto.roomKeyRequest","crypto.roomKeyRequestCancellation","crypto.warning","crypto.devicesUpdated","crypto.willUpdateDevices","deviceVerificationChanged","userTrustStatusChanged","crossSigning.keysChanged"]),S.logger.log("Crypto: initialising crypto object..."),await t.init({exportedOlmDevice:this.exportedOlmDeviceToImport,pickleKey:this.pickleKey}),delete this.exportedOlmDeviceToImport,this.olmVersion=E.Crypto.getOlmVersion(),t.registerEventHandlers(this),this.crypto=t}isCryptoEnabled(){return!!this.crypto}getDeviceEd25519Key(){return this.crypto?this.crypto.getDeviceEd25519Key():null}getDeviceCurve25519Key(){return this.crypto?this.crypto.getDeviceCurve25519Key():null}async uploadKeys(){if(!this.crypto)throw new Error("End-to-end encryption disabled");await this.crypto.uploadDeviceKeys()}downloadKeys(e,t){return this.crypto?this.crypto.downloadKeys(e,t):Promise.reject(new Error("End-to-end encryption disabled"))}getStoredDevicesForUser(e){if(!this.crypto)throw new Error("End-to-end encryption disabled");return this.crypto.getStoredDevicesForUser(e)||[]}getStoredDevice(e,t){if(!this.crypto)throw new Error("End-to-end encryption disabled");return this.crypto.getStoredDevice(e,t)||null}setDeviceVerified(e,t,i=!0){const n=this.setDeviceVerification(e,t,i,null,null);return e==this.credentials.userId&&this.checkKeyBackup(),n}setDeviceBlocked(e,t,i=!0){return this.setDeviceVerification(e,t,null,i,null)}setDeviceKnown(e,t,i=!0){return this.setDeviceVerification(e,t,null,null,i)}async setDeviceVerification(e,t,i,n,r){if(!this.crypto)throw new Error("End-to-end encryption disabled");await this.crypto.setDeviceVerification(e,t,i,n,r)}requestVerificationDM(e,t){if(!this.crypto)throw new Error("End-to-end encryption disabled");return this.crypto.requestVerificationDM(e,t)}findVerificationRequestDMInProgress(e){if(!this.crypto)throw new Error("End-to-end encryption disabled");return this.crypto.findVerificationRequestDMInProgress(e)}getVerificationRequestsToDeviceInProgress(e){if(!this.crypto)throw new Error("End-to-end encryption disabled");return this.crypto.getVerificationRequestsToDeviceInProgress(e)}requestVerification(e,t){if(!this.crypto)throw new Error("End-to-end encryption disabled");return this.crypto.requestVerification(e,t)}beginKeyVerification(e,t,i){if(!this.crypto)throw new Error("End-to-end encryption disabled");return this.crypto.beginKeyVerification(e,t,i)}checkSecretStorageKey(e,t){if(!this.crypto)throw new Error("End-to-end encryption disabled");return this.crypto.checkSecretStorageKey(e,t)}setGlobalBlacklistUnverifiedDevices(e){if(!this.crypto)throw new Error("End-to-end encryption disabled");return this.crypto.setGlobalBlacklistUnverifiedDevices(e)}getGlobalBlacklistUnverifiedDevices(){if(!this.crypto)throw new Error("End-to-end encryption disabled");return this.crypto.getGlobalBlacklistUnverifiedDevices()}setGlobalErrorOnUnknownDevices(e){if(!this.crypto)throw new Error("End-to-end encryption disabled");return this.crypto.setGlobalErrorOnUnknownDevices(e)}getGlobalErrorOnUnknownDevices(){if(!this.crypto)throw new Error("End-to-end encryption disabled");return this.crypto.getGlobalErrorOnUnknownDevices()}getCrossSigningId(e=D.CrossSigningKey.Master){if(!this.crypto)throw new Error("End-to-end encryption disabled");return this.crypto.getCrossSigningId(e)}getStoredCrossSigningForUser(e){if(!this.crypto)throw new Error("End-to-end encryption disabled");return this.crypto.getStoredCrossSigningForUser(e)}checkUserTrust(e){if(!this.crypto)throw new Error("End-to-end encryption disabled");return this.crypto.checkUserTrust(e)}checkDeviceTrust(e,t){if(!this.crypto)throw new Error("End-to-end encryption disabled");return this.crypto.checkDeviceTrust(e,t)}checkOwnCrossSigningTrust(e){if(!this.crypto)throw new Error("End-to-end encryption disabled");return this.crypto.checkOwnCrossSigningTrust(e)}checkCrossSigningPrivateKey(e,t){if(!this.crypto)throw new Error("End-to-end encryption disabled");return this.crypto.checkCrossSigningPrivateKey(e,t)}legacyDeviceVerification(e,t,i){if(!this.crypto)throw new Error("End-to-end encryption disabled");return this.crypto.legacyDeviceVerification(e,t,i)}prepareToEncrypt(e){if(!this.crypto)throw new Error("End-to-end encryption disabled");return this.crypto.prepareToEncrypt(e)}isCrossSigningReady(){if(!this.crypto)throw new Error("End-to-end encryption disabled");return this.crypto.isCrossSigningReady()}bootstrapCrossSigning(e){if(!this.crypto)throw new Error("End-to-end encryption disabled");return this.crypto.bootstrapCrossSigning(e)}getCryptoTrustCrossSignedDevices(){if(!this.crypto)throw new Error("End-to-end encryption disabled");return this.crypto.getCryptoTrustCrossSignedDevices()}setCryptoTrustCrossSignedDevices(e){if(!this.crypto)throw new Error("End-to-end encryption disabled");return this.crypto.setCryptoTrustCrossSignedDevices(e)}countSessionsNeedingBackup(){if(!this.crypto)throw new Error("End-to-end encryption disabled");return this.crypto.countSessionsNeedingBackup()}getEventEncryptionInfo(e){if(!this.crypto)throw new Error("End-to-end encryption disabled");return this.crypto.getEventEncryptionInfo(e)}createRecoveryKeyFromPassphrase(e){if(!this.crypto)throw new Error("End-to-end encryption disabled");return this.crypto.createRecoveryKeyFromPassphrase(e)}isSecretStorageReady(){if(!this.crypto)throw new Error("End-to-end encryption disabled");return this.crypto.isSecretStorageReady()}bootstrapSecretStorage(e){if(!this.crypto)throw new Error("End-to-end encryption disabled");return this.crypto.bootstrapSecretStorage(e)}addSecretStorageKey(e,t,i){if(!this.crypto)throw new Error("End-to-end encryption disabled");return this.crypto.addSecretStorageKey(e,t,i)}hasSecretStorageKey(e){if(!this.crypto)throw new Error("End-to-end encryption disabled");return this.crypto.hasSecretStorageKey(e)}storeSecret(e,t,i){if(!this.crypto)throw new Error("End-to-end encryption disabled");return this.crypto.storeSecret(e,t,i)}getSecret(e){if(!this.crypto)throw new Error("End-to-end encryption disabled");return this.crypto.getSecret(e)}isSecretStored(e,t){if(!this.crypto)throw new Error("End-to-end encryption disabled");return this.crypto.isSecretStored(e,t)}requestSecret(e,t){if(!this.crypto)throw new Error("End-to-end encryption disabled");return this.crypto.requestSecret(e,t)}getDefaultSecretStorageKeyId(){if(!this.crypto)throw new Error("End-to-end encryption disabled");return this.crypto.getDefaultSecretStorageKeyId()}setDefaultSecretStorageKeyId(e){if(!this.crypto)throw new Error("End-to-end encryption disabled");return this.crypto.setDefaultSecretStorageKeyId(e)}checkSecretStoragePrivateKey(e,t){if(!this.crypto)throw new Error("End-to-end encryption disabled");return this.crypto.checkSecretStoragePrivateKey(e,t)}async getEventSenderDeviceInfo(e){return this.crypto?this.crypto.getEventSenderDeviceInfo(e):null}async isEventSenderVerified(e){const t=await this.getEventSenderDeviceInfo(e);return!!t&&t.isVerified()}cancelAndResendEventRoomKeyRequest(e){return e.cancelAndResendKeyRequest(this.crypto,this.getUserId())}setRoomEncryption(e,t){if(!this.crypto)throw new Error("End-to-End encryption disabled");return this.crypto.setRoomEncryption(e,t)}isRoomEncrypted(e){const t=this.getRoom(e);return!!t&&(!!t.currentState.getStateEvents("m.room.encryption","")||this.roomList.isRoomEncrypted(e))}forceDiscardSession(e){if(!this.crypto)throw new Error("End-to-End encryption disabled");this.crypto.forceDiscardSession(e)}exportRoomKeys(){return this.crypto?this.crypto.exportRoomKeys():Promise.reject(new Error("End-to-end encryption disabled"))}importRoomKeys(e,t){if(!this.crypto)throw new Error("End-to-end encryption disabled");return this.crypto.importRoomKeys(e,t)}checkKeyBackup(){return this.crypto.backupManager.checkKeyBackup()}async getKeyBackupVersion(){let e;try{e=await this.http.authedRequest(void 0,"GET","/room_keys/version",void 0,void 0,{prefix:w.PREFIX_UNSTABLE})}catch(e){if("M_NOT_FOUND"===e.errcode)return null;throw e}try{K.BackupManager.checkBackupVersion(e)}catch(e){throw e}return e}isKeyBackupTrusted(e){return this.crypto.backupManager.isKeyBackupTrusted(e)}getKeyBackupEnabled(){if(!this.crypto)throw new Error("End-to-end encryption disabled");return this.crypto.backupManager.getKeyBackupEnabled()}enableKeyBackup(e){if(!this.crypto)throw new Error("End-to-end encryption disabled");return this.crypto.backupManager.enableKeyBackup(e)}disableKeyBackup(){if(!this.crypto)throw new Error("End-to-end encryption disabled");this.crypto.backupManager.disableKeyBackup()}async prepareKeyBackupVersion(e,t={secureSecretStorage:!1}){if(!this.crypto)throw new Error("End-to-end encryption disabled");const{algorithm:i,auth_data:n,recovery_key:r,privateKey:s}=await this.crypto.backupManager.prepareKeyBackupVersion(e);return t.secureSecretStorage&&(await this.storeSecret("m.megolm_backup.v1",(0,v.encodeBase64)(s)),S.logger.info("Key backup private key stored in secret storage")),{algorithm:i,auth_data:n,recovery_key:r}}isKeyBackupKeyStored(){return Promise.resolve(this.isSecretStored("m.megolm_backup.v1",!1))}async createKeyBackupVersion(e){if(!this.crypto)throw new Error("End-to-end encryption disabled");await this.crypto.backupManager.createKeyBackupVersion(e);const t={algorithm:e.algorithm,auth_data:e.auth_data};await this.crypto.signObject(t.auth_data),this.cryptoCallbacks.getCrossSigningKey&&this.crypto.crossSigningInfo.getId()&&await this.crypto.crossSigningInfo.signObject(t.auth_data,"master");const i=await this.http.authedRequest(void 0,"POST","/room_keys/version",void 0,t,{prefix:w.PREFIX_UNSTABLE});return await this.checkKeyBackup(),this.getKeyBackupEnabled()||S.logger.error("Key backup not usable even though we just created it"),i}deleteKeyBackupVersion(e){if(!this.crypto)throw new Error("End-to-end encryption disabled");this.crypto.backupManager.version&&this.crypto.backupManager.disableKeyBackup();const t=p.encodeUri("/room_keys/version/$version",{$version:e});return this.http.authedRequest(void 0,"DELETE",t,void 0,void 0,{prefix:w.PREFIX_UNSTABLE})}makeKeyBackupPath(e,t,i){let n;return n=void 0!==t?p.encodeUri("/room_keys/keys/$roomId/$sessionId",{$roomId:e,$sessionId:t}):void 0!==e?p.encodeUri("/room_keys/keys/$roomId",{$roomId:e}):"/room_keys/keys",{path:n,queryData:void 0===i?void 0:{version:i}}}sendKeyBackup(e,t,i,n){if(!this.crypto)throw new Error("End-to-end encryption disabled");const r=this.makeKeyBackupPath(e,t,i);return this.http.authedRequest(void 0,"PUT",r.path,r.queryData,n,{prefix:w.PREFIX_UNSTABLE})}async scheduleAllGroupSessionsForBackup(){if(!this.crypto)throw new Error("End-to-end encryption disabled");await this.crypto.backupManager.scheduleAllGroupSessionsForBackup()}flagAllGroupSessionsForBackup(){if(!this.crypto)throw new Error("End-to-end encryption disabled");return this.crypto.backupManager.flagAllGroupSessionsForBackup()}isValidRecoveryKey(e){try{return(0,I.decodeRecoveryKey)(e),!0}catch(e){return!1}}keyBackupKeyFromPassword(e,t){return(0,k.keyFromAuthData)(t.auth_data,e)}keyBackupKeyFromRecoveryKey(e){return(0,I.decodeRecoveryKey)(e)}async restoreKeyBackupWithPassword(e,t,i,n,r){const s=await(0,k.keyFromAuthData)(n.auth_data,e);return this.restoreKeyBackup(s,t,i,n,r)}async restoreKeyBackupWithSecretStorage(e,t,i,n){const r=await this.getSecret("m.megolm_backup.v1"),s=(0,E.fixBackupKey)(r);if(s){const[e]=await this.crypto.getSecretStorageKey();await this.storeSecret("m.megolm_backup.v1",s,[e])}const o=(0,v.decodeBase64)(s||r);return this.restoreKeyBackup(o,t,i,e,n)}restoreKeyBackupWithRecoveryKey(e,t,i,n,r){const s=(0,I.decodeRecoveryKey)(e);return this.restoreKeyBackup(s,t,i,n,r)}async restoreKeyBackupWithCache(e,t,i,n){const r=await this.crypto.getSessionBackupPrivateKey();if(!r)throw new Error("Couldn't get key");return this.restoreKeyBackup(r,e,t,i,n)}async restoreKeyBackup(e,t,i,n,r){const s=null==r?void 0:r.cacheCompleteCallback,o=null==r?void 0:r.progressCallback;if(!this.crypto)throw new Error("End-to-end encryption disabled");let a=0,c=[];const l=this.makeKeyBackupPath(t,i,n.version),h=await K.BackupManager.makeAlgorithm(n,(async()=>e)),u=h.untrusted;try{if(!await h.keyMatches(e))return Promise.reject(new w.MatrixError({errcode:W.RESTORE_BACKUP_ERROR_BAD_KEY}));this.crypto.storeSessionBackupPrivateKey(e).catch((e=>{S.logger.warn("Error caching session backup key:",e)})).then(s),o&&o({stage:"fetch"});const n=await this.http.authedRequest(void 0,"GET",l.path,l.queryData,void 0,{prefix:w.PREFIX_UNSTABLE});if(n.rooms)for(const[e,t]of Object.entries(n.rooms)){if(!t.sessions)continue;a+=Object.keys(t.sessions).length;const i=await h.decryptSessions(t.sessions);for(const t of i)t.room_id=e,c.push(t)}else if(n.sessions){a=Object.keys(n.sessions).length,c=await h.decryptSessions(n.sessions);for(const e of c)e.room_id=t}else{a=1;try{const[e]=await h.decryptSessions({[i]:n});e.room_id=t,e.session_id=i,c.push(e)}catch(e){S.logger.log("Failed to decrypt megolm session from backup",e)}}}finally{h.free()}return await this.importRoomKeys(c,{progressCallback:o,untrusted:u,source:"backup"}),await this.checkKeyBackup(),{total:a,imported:c.length}}deleteKeysFromBackup(e,t,i){if(!this.crypto)throw new Error("End-to-end encryption disabled");const n=this.makeKeyBackupPath(e,t,i);return this.http.authedRequest(void 0,"DELETE",n.path,n.queryData,void 0,{prefix:w.PREFIX_UNSTABLE})}async sendSharedHistoryKeys(e,t){if(!this.crypto)throw new Error("End-to-end encryption disabled");const i=this.roomList.getRoomEncryption(e);if(!i)return void S.logger.error("Unknown room.  Not sharing decryption keys");const n=await this.crypto.downloadKeys(t),r={};for(const[e,t]of Object.entries(n))r[e]=Object.values(t);const s=this.crypto.getRoomDecryptor(e,i.algorithm);s.sendSharedHistoryInboundSessions?await s.sendSharedHistoryInboundSessions(r):S.logger.warn("Algorithm does not support sharing previous keys",i.algorithm)}getGroup(e){return this.store.getGroup(e)}getGroups(){return this.store.getGroups()}getMediaConfig(e){return this.http.authedRequest(e,"GET","/config",void 0,void 0,{prefix:w.PREFIX_MEDIA_R0})}getRoom(e){return this.store.getRoom(e)}getRooms(){return this.store.getRooms()}getVisibleRooms(){const e=this.store.getRooms(),t=new Set;for(const i of e){const e=i.currentState.getStateEvents("m.room.create","");if(e){const i=e.getContent().predecessor;i&&i.room_id&&t.add(i.room_id)}}return e.filter((e=>!e.currentState.getStateEvents("m.room.tombstone","")||!t.has(e.roomId)))}getUser(e){return this.store.getUser(e)}getUsers(){return this.store.getUsers()}setAccountData(e,t,i){const n=p.encodeUri("/user/$userId/account_data/$type",{$userId:this.credentials.userId,$type:e}),r=(0,w.retryNetworkOperation)(5,(()=>this.http.authedRequest(void 0,"PUT",n,void 0,t)));return i&&r.then((e=>i(null,e)),i),r}getAccountData(e){return this.store.getAccountData(e)}async getAccountDataFromServer(e){if(this.isInitialSyncComplete()){const t=this.store.getAccountData(e);return t?t.getContent():null}const t=p.encodeUri("/user/$userId/account_data/$type",{$userId:this.credentials.userId,$type:e});try{return await this.http.authedRequest(void 0,"GET",t,void 0)}catch(e){if(e.data&&"M_NOT_FOUND"===e.data.errcode)return null;throw e}}getIgnoredUsers(){const e=this.getAccountData("m.ignored_user_list");return e&&e.getContent()&&e.getContent().ignored_users?Object.keys(e.getContent().ignored_users):[]}setIgnoredUsers(e,t){const i={ignored_users:{}};return e.map((e=>i.ignored_users[e]={})),this.setAccountData("m.ignored_user_list",i,t)}isUserIgnored(e){return this.getIgnoredUsers().includes(e)}async joinRoom(e,t,i){if(p.isFunction(t))throw new Error("Expected 'opts' object, got function.");void 0===(t=t||{}).syncRoom&&(t.syncRoom=!0);const n=this.getRoom(e);if(n&&n.hasMembershipState(this.credentials.userId,"join"))return Promise.resolve(n);let r=Promise.resolve();t.inviteSignUrl&&(r=this.http.requestOtherUrl(void 0,"POST",t.inviteSignUrl,{mxid:this.credentials.userId}));const s={};t.viaServers&&(s.server_name=t.viaServers);const o={qsStringifyOptions:{arrayFormat:"repeat"}};try{const n={},c=await r;c&&(n.third_party_signed=c);const l=p.encodeUri("/join/$roomid",{$roomid:e}),h=(await this.http.authedRequest(void 0,"POST",l,s,n,o)).room_id,u=new a.SyncApi(this,this.clientOpts).createRoom(h);return t.syncRoom,null==i||i(null,u),u}catch(e){throw null==i||i(e),e}}resendEvent(e,t){return this.updatePendingEventStatus(t,e,c.EventStatus.SENDING),this.encryptAndSendEvent(t,e)}cancelPendingEvent(e){if([c.EventStatus.QUEUED,c.EventStatus.NOT_SENT].indexOf(e.status)<0)throw new Error("cannot cancel an event with status "+e.status);this.scheduler&&this.scheduler.removeEventFromQueue(e);const t=this.getRoom(e.getRoomId());this.updatePendingEventStatus(t,e,c.EventStatus.CANCELLED)}setRoomName(e,t,i){return this.sendStateEvent(e,"m.room.name",{name:t},void 0,i)}setRoomTopic(e,t,i){return this.sendStateEvent(e,"m.room.topic",{topic:t},void 0,i)}getRoomTags(e,t){const i=p.encodeUri("/user/$userId/rooms/$roomId/tags/",{$userId:this.credentials.userId,$roomId:e});return this.http.authedRequest(t,"GET",i,void 0)}setRoomTag(e,t,i,n){const r=p.encodeUri("/user/$userId/rooms/$roomId/tags/$tag",{$userId:this.credentials.userId,$roomId:e,$tag:t});return this.http.authedRequest(n,"PUT",r,void 0,i)}deleteRoomTag(e,t,i){const n=p.encodeUri("/user/$userId/rooms/$roomId/tags/$tag",{$userId:this.credentials.userId,$roomId:e,$tag:t});return this.http.authedRequest(i,"DELETE",n,void 0,void 0)}setRoomAccountData(e,t,i,n){const r=p.encodeUri("/user/$userId/rooms/$roomId/account_data/$type",{$userId:this.credentials.userId,$roomId:e,$type:t});return this.http.authedRequest(n,"PUT",r,void 0,i)}setPowerLevel(e,t,i,n,r){let s={users:{}};n&&"m.room.power_levels"===n.getType()&&(s=p.deepCopy(n.getContent())),s.users[t]=i;const o=p.encodeUri("/rooms/$roomId/state/m.room.power_levels",{$roomId:e});return this.http.authedRequest(r,"PUT",o,void 0,s)}sendEvent(e,t,i,n,r){return this.sendCompleteEvent(e,{type:t,content:i},n,r)}sendCompleteEvent(e,t,i,n){p.isFunction(i)&&(n=i,i=void 0),i||(i=this.makeTxnId());const r=new c.MatrixEvent(Object.assign(t,{event_id:"~"+e+":"+i,user_id:this.credentials.userId,sender:this.credentials.userId,room_id:e,origin_server_ts:(new Date).getTime()})),s=this.getRoom(e),o=r.getAssociatedId();if(o&&o.startsWith("~")){const e=s.getPendingEvents().find((e=>e.getId()===o));e.once("Event.localEventIdReplaced",(()=>{r.updateAssociatedId(e.getId())}))}const a=r.getType();return S.logger.log(`sendEvent of type ${a} in ${e} with txnId ${i}`),r.setTxnId(i),r.setStatus(c.EventStatus.SENDING),s&&s.addPendingEvent(r,i),r.status===c.EventStatus.NOT_SENT?Promise.reject(new Error("Event blocked by other events not yet sent")):this.encryptAndSendEvent(s,r,n)}encryptAndSendEvent(e,t,i){return Promise.resolve().then((()=>{const i=this.encryptEventIfNeeded(t,e);return i?(this.updatePendingEventStatus(e,t,c.EventStatus.ENCRYPTING),i.then((()=>this.updatePendingEventStatus(e,t,c.EventStatus.SENDING)))):null})).then((()=>{let i;return this.scheduler&&(i=this.scheduler.queueEvent(t),i&&this.scheduler.getQueueForEvent(t).length>1&&this.updatePendingEventStatus(e,t,c.EventStatus.QUEUED)),i||(i=this.sendEventHttpRequest(t),e&&(i=i.then((i=>(e.updatePendingEvent(t,c.EventStatus.SENT,i.event_id),i))))),i})).then((e=>(null==i||i(null,e),e))).catch((n=>{S.logger.error("Error sending event",n.stack||n);try{t.error=n,this.updatePendingEventStatus(e,t,c.EventStatus.NOT_SENT),n.event=t,null==i||i(n)}catch(e){S.logger.error("Exception in error handler!",e.stack||n)}throw n}))}encryptEventIfNeeded(e,t){if(e.isEncrypted())return null;if(!this.isRoomEncrypted(e.getRoomId()))return null;if(!this.crypto&&this.usingExternalCrypto)return null;if(e.getType()===M.EventType.Reaction)return null;if(!this.crypto)throw new Error("This room is configured to use encryption, but your client does not support encryption.");return this.crypto.encryptEvent(e,t)}getEncryptedIfNeededEventType(e,t){return t===M.EventType.Reaction?t:this.isRoomEncrypted(e)?M.EventType.RoomMessageEncrypted:t}updatePendingEventStatus(e,t,i){e?e.updatePendingEvent(t,i):t.setStatus(i)}sendEventHttpRequest(e){let t=e.getTxnId();t||(t=this.makeTxnId(),e.setTxnId(t));const i={$roomId:e.getRoomId(),$eventType:e.getWireType(),$stateKey:e.getStateKey(),$txnId:t};let n;if(e.isState()){let t="/rooms/$roomId/state/$eventType";e.getStateKey()&&e.getStateKey().length>0&&(t="/rooms/$roomId/state/$eventType/$stateKey"),n=p.encodeUri(t,i)}else if(e.isRedaction()){const t="/rooms/$roomId/redact/$redactsEventId/$txnId";n=p.encodeUri(t,Object.assign({$redactsEventId:e.event.redacts},i))}else n=p.encodeUri("/rooms/$roomId/send/$eventType/$txnId",i);return this.http.authedRequest(void 0,"PUT",n,void 0,e.getWireContent()).then((t=>(S.logger.log(`Event sent to ${e.getRoomId()} with event id ${t.event_id}`),t)))}redactEvent(e,t,i,n){const r=("object"==typeof n?n:{}).reason,s="function"==typeof n?n:void 0;return this.sendCompleteEvent(e,{type:M.EventType.RoomRedaction,content:{reason:r},redacts:t},i,s)}sendMessage(e,t,i,n){return p.isFunction(i)&&(n=i,i=void 0),this.sendEvent(e,"m.room.message",t,i,n)}sendTextMessage(e,t,i,n){const r=P.makeTextMessage(t);return this.sendMessage(e,r,i,n)}sendNotice(e,t,i,n){const r=P.makeNotice(t);return this.sendMessage(e,r,i,n)}sendEmoteMessage(e,t,i,n){const r=P.makeEmoteMessage(t);return this.sendMessage(e,r,i,n)}sendImageMessage(e,t,i,n="Image",r){p.isFunction(n)&&(r=n,n=void 0);const s={msgtype:"m.image",url:t,info:i,body:n};return this.sendMessage(e,s,void 0,r)}sendStickerMessage(e,t,i,n="Sticker",r){p.isFunction(n)&&(r=n,n=void 0);const s={url:t,info:i,body:n};return this.sendEvent(e,M.EventType.Sticker,s,void 0,r)}sendHtmlMessage(e,t,i,n){const r=P.makeHtmlMessage(t,i);return this.sendMessage(e,r,void 0,n)}sendHtmlNotice(e,t,i,n){const r=P.makeHtmlNotice(t,i);return this.sendMessage(e,r,void 0,n)}sendHtmlEmote(e,t,i,n){const r=P.makeHtmlEmote(t,i);return this.sendMessage(e,r,void 0,n)}sendReceipt(e,t,i,n){if("function"==typeof i&&(n=i,i={}),this.isGuest())return Promise.resolve({});const r=p.encodeUri("/rooms/$roomId/receipt/$receiptType/$eventId",{$roomId:e.getRoomId(),$receiptType:t,$eventId:e.getId()}),s=this.http.authedRequest(n,"POST",r,void 0,i||{}),o=this.getRoom(e.getRoomId());return o&&o.addLocalEchoReceipt(this.credentials.userId,e,t),s}async sendReadReceipt(e,t,i){"function"==typeof t&&(i=t,t={}),t||(t={});const n=e.getId(),r=this.getRoom(e.getRoomId());if(r&&r.hasPendingEvent(n))throw new Error(`Cannot set read receipt to a pending event (${n})`);const s={"m.hidden":Boolean(t.hidden)};return this.sendReceipt(e,"m.read",s,i)}async setRoomReadMarkers(e,t,i,n){const r=this.getRoom(e);if(r&&r.hasPendingEvent(t))throw new Error(`Cannot set read marker to a pending event (${t})`);let s;if(i){if(s=i.getId(),r&&r.hasPendingEvent(s))throw new Error(`Cannot set read receipt to a pending event (${s})`);r&&r.addLocalEchoReceipt(this.credentials.userId,i,"m.read")}return this.setRoomReadMarkersHttpRequest(e,t,s,n)}getUrlPreview(e,t,i){t=6e4*Math.floor(t/6e4);const n=new URL(e);n.hash="";const r=t+"_"+(e=n.toString()),s=this.urlPreviewCache[r];if(s)return i&&s.then(i).catch(i),s;const o=this.http.authedRequest(i,"GET","/preview_url",{url:e,ts:t},void 0,{prefix:w.PREFIX_MEDIA_R0});return this.urlPreviewCache[r]=o,o}sendTyping(e,t,i,n){if(this.isGuest())return Promise.resolve({});const r=p.encodeUri("/rooms/$roomId/typing/$userId",{$roomId:e,$userId:this.credentials.userId}),s={typing:t};return t&&(s.timeout=i||2e4),this.http.authedRequest(n,"PUT",r,void 0,s)}getRoomUpgradeHistory(e,t=!1){let i=this.getRoom(e);if(!i)return[];const n=[i];let r=i.currentState.getStateEvents("m.room.create","");for(;r;){S.logger.log(`Looking at ${r.getId()}`);const e=r.getContent().predecessor;if(!e||!e.room_id)break;{S.logger.log(`Looking at predecessor ${e.room_id}`);const i=this.getRoom(e.room_id);if(!i)break;if(t){const e=i.currentState.getStateEvents("m.room.tombstone","");if(!e||e.getContent().replacement_room!==i.roomId)break}n.splice(0,0,i),r=i.currentState.getStateEvents("m.room.create","")}}let s=i.currentState.getStateEvents("m.room.tombstone","");for(;s;){const e=this.getRoom(s.getContent().replacement_room);if(!e)break;if(e.roomId===i.roomId)break;if(t){if(r=e.currentState.getStateEvents("m.room.create",""),!r||!r.getContent().predecessor)break;if(r.getContent().predecessor.room_id!==i.roomId)break}if(n.push(e),new Set(n.map((e=>e.roomId))).size<n.length)return n.slice(0,n.length-1);i=e,s=i.currentState.getStateEvents("m.room.tombstone","")}return n}invite(e,t,i,n){return this.membershipChange(e,t,"invite",n,i)}inviteByEmail(e,t,i){return this.inviteByThreePid(e,"email",t,i)}async inviteByThreePid(e,t,i,n){const r=p.encodeUri("/rooms/$roomId/invite",{$roomId:e}),s=this.getIdentityServerUrl(!0);if(!s)return Promise.reject(new w.MatrixError({error:"No supplied identity server URL",errcode:"ORG.MATRIX.JSSDK_MISSING_PARAM"}));const o={id_server:s,medium:t,address:i};if(this.identityServer&&this.identityServer.getAccessToken&&await this.doesServerAcceptIdentityAccessToken()){const e=await this.identityServer.getAccessToken();e&&(o.id_access_token=e)}return this.http.authedRequest(n,"POST",r,void 0,o)}leave(e,t){return this.membershipChange(e,void 0,"leave",void 0,t)}leaveRoomChain(e,t=!0){const i=this.getRoomUpgradeHistory(e);let n=i;if(!t){n=[];for(const t of i)if(n.push(t),t.roomId===e)break}const r={},s=[],o=e=>this.leave(e).then((()=>{r[e]=null})).catch((t=>(r[e]=t,null)));for(const e of n)s.push(o(e.roomId));return Promise.all(s).then((()=>r))}ban(e,t,i,n){return this.membershipChange(e,t,"ban",i,n)}forget(e,t,i){void 0===t&&(t=!0);const n=this.membershipChange(e,void 0,"forget",void 0,i);return t?n.then((t=>(this.store.removeRoom(e),this.emit("deleteRoom",e),t))):n}unban(e,t,i){const n=p.encodeUri("/rooms/$roomId/unban",{$roomId:e}),r={user_id:t};return this.http.authedRequest(i,"POST",n,void 0,r)}kick(e,t,i,n){return this.setMembershipState(e,t,"leave",i,n)}setMembershipState(e,t,i,n,r){p.isFunction(n)&&(r=n,n=void 0);const s=p.encodeUri("/rooms/$roomId/state/m.room.member/$userId",{$roomId:e,$userId:t});return this.http.authedRequest(r,"PUT",s,void 0,{membership:i,reason:n})}membershipChange(e,t,i,n,r){p.isFunction(n)&&(r=n,n=void 0);const s=p.encodeUri("/rooms/$room_id/$membership",{$room_id:e,$membership:i});return this.http.authedRequest(r,"POST",s,void 0,{user_id:t,reason:n})}getPushActionsForEvent(e){return e.getPushActions()||e.setPushActions(this.pushProcessor.actionsForEvent(e)),e.getPushActions()}setProfileInfo(e,t,i){const n=p.encodeUri("/profile/$userId/$info",{$userId:this.credentials.userId,$info:e});return this.http.authedRequest(i,"PUT",n,void 0,t)}async setDisplayName(e,t){const i=await this.setProfileInfo("displayname",{displayname:e},t),n=this.getUser(this.getUserId());return n&&(n.displayName=e,n.emit("User.displayName",n.events.presence,n)),i}async setAvatarUrl(e,t){const i=await this.setProfileInfo("avatar_url",{avatar_url:e},t),n=this.getUser(this.getUserId());return n&&(n.avatarUrl=e,n.emit("User.avatarUrl",n.events.presence,n)),i}mxcUrlToHttp(e,t,i,n,r){return(0,C.getHttpUriForMxc)(this.baseUrl,e,t,i,n,r)}_unstable_setStatusMessage(e){const t="im.vector.user_status";return Promise.all(this.getRooms().map((i=>{const n="join"===i.getMyMembership(),r=2===i.getInvitedAndJoinedMemberCount();return n&&r&&i.currentState.mayClientSendStateEvent(t,this)?this.sendStateEvent(i.roomId,t,{status:e},this.getUserId()):Promise.resolve()}))).then()}setPresence(e,t){const i=p.encodeUri("/presence/$userId/status",{$userId:this.credentials.userId});if("string"==typeof e&&(e={presence:e}),-1===["offline","online","unavailable"].indexOf(e.presence))throw new Error("Bad presence value: "+e.presence);return this.http.authedRequest(t,"PUT",i,void 0,e)}getPresence(e,t){const i=p.encodeUri("/presence/$userId/status",{$userId:e});return this.http.authedRequest(t,"GET",i,void 0,void 0)}scrollback(e,t,i){p.isFunction(t)&&(i=t,t=void 0),t=t||30;let n=0,r=this.ongoingScrollbacks[e.roomId]||{};if(r.promise)return r.promise;if(r.errorTs){const e=Date.now()-r.errorTs;n=Math.max(3e3-e,0)}if(null===e.oldState.paginationToken)return Promise.resolve(e);const s=this.store.scrollback(e,t).length;if(s===t)return Promise.resolve(e);t-=s;const o=new Promise(((r,s)=>{(0,p.sleep)(n).then((()=>this.createMessagesRequest(e.roomId,e.oldState.paginationToken,t,"b"))).then((t=>{var n;const s=t.chunk.map(this.getEventMapper());if(t.state){const i=t.state.map(this.getEventMapper());e.currentState.setUnknownStateEvents(i)}e.addEventsToTimeline(s,!0,e.getLiveTimeline()),e.oldState.paginationToken=t.end,0===t.chunk.length&&(e.oldState.paginationToken=null),this.store.storeEvents(e,s,t.end,!0),this.ongoingScrollbacks[e.roomId]=null,null===(n=i)||void 0===n||n(null,e),r(e)})).catch((t=>{var n;this.ongoingScrollbacks[e.roomId]={errorTs:Date.now()},null===(n=i)||void 0===n||n(t),s(t)}))}));return r={promise:o,errorTs:null},this.ongoingScrollbacks[e.roomId]=r,o}getEventMapper(e){return(0,B.eventMapperFor)(this,e||{})}getEventTimeline(e,t){if(!this.timelineSupport)throw new Error("timeline support is disabled. Set the 'timelineSupport' parameter to true when creating MatrixClient to enable it.");if(e.getTimelineForEvent(t))return Promise.resolve(e.getTimelineForEvent(t));const i=p.encodeUri("/rooms/$roomId/context/$eventId",{$roomId:e.room.roomId,$eventId:t});let n;return this.clientOpts.lazyLoadMembers&&(n={filter:JSON.stringify(u.Filter.LAZY_LOADING_MESSAGES_FILTER)}),this.http.authedRequest(void 0,"GET",i,n).then((i=>{if(!i.event)throw new Error("'event' not in '/context' result - homeserver too old?");if(e.getTimelineForEvent(t))return e.getTimelineForEvent(t);i.events_after.reverse();const n=i.events_after.concat([i.event]).concat(i.events_before).map(this.getEventMapper());let r=e.getTimelineForEvent(n[0].getId());if(r){const e=i.state.map(this.getEventMapper());r.getState(g.EventTimeline.BACKWARDS).setUnknownStateEvents(e)}else r=e.addTimeline(),r.initialiseState(i.state.map(this.getEventMapper())),r.getState(g.EventTimeline.FORWARDS).paginationToken=i.end;return e.addEventsToTimeline(n,!0,r,i.start),e.getTimelineForEvent(t)||r}))}createMessagesRequest(e,t,i,n,r){const s=p.encodeUri("/rooms/$roomId/messages",{$roomId:e});void 0===i&&(i=30);const o={from:t,limit:i,dir:n};let a=null;var c;return this.clientOpts.lazyLoadMembers&&(a=Object.assign({},u.Filter.LAZY_LOADING_MESSAGES_FILTER)),r&&(a=a||{},Object.assign(a,null===(c=r.getRoomTimelineFilterComponent())||void 0===c?void 0:c.toJSON())),a&&(o.filter=JSON.stringify(a)),this.http.authedRequest(void 0,"GET",s,o)}paginateEventTimeline(e,t){const i=e.getTimelineSet()===this.notifTimelineSet,n=(t=t||{}).backwards||!1;if(i&&!n)throw new Error("paginateNotifTimeline can only paginate backwards");const r=n?g.EventTimeline.BACKWARDS:g.EventTimeline.FORWARDS,s=e.getPaginationToken(r);if(!s)return Promise.resolve(!1);const o=e.paginationRequests[r];if(o)return o;let a,c,l;if(i)a="/notifications",c={limit:"limit"in t?t.limit:30,only:"highlight"},s&&"end"!==s&&(c.from=s),l=this.http.authedRequest(void 0,"GET","/notifications",c,void 0).then((t=>{const i=t.next_token,s=[];for(let e=0;e<t.notifications.length;e++){const i=t.notifications[e],n=this.getEventMapper()(i.event);n.setPushActions(f.PushProcessor.actionListToActionsObject(i.actions)),n.event.room_id=i.room_id,s[e]=n}return e.getTimelineSet().addEventsToTimeline(s,n,e,i),n&&!t.next_token&&e.setPaginationToken(null,r),!!t.next_token})).finally((()=>{e.paginationRequests[r]=null})),e.paginationRequests[r]=l;else{if(!this.getRoom(e.getRoomId()))throw new Error("Unknown room "+e.getRoomId());l=this.createMessagesRequest(e.getRoomId(),s,t.limit,r,e.getFilter()),l.then((t=>{if(t.state){const i=e.getState(r),n=t.state.map(this.getEventMapper());i.setUnknownStateEvents(n)}const i=t.end,s=t.chunk.map(this.getEventMapper());return e.getTimelineSet().addEventsToTimeline(s,n,e,i),n&&t.end==t.start&&e.setPaginationToken(null,r),t.end!=t.start})).finally((()=>{e.paginationRequests[r]=null})),e.paginationRequests[r]=l}return l}resetNotifTimelineSet(){this.notifTimelineSet&&this.notifTimelineSet.resetLiveTimeline("end",null)}peekInRoom(e){return this.peekSync&&this.peekSync.stopPeeking(),this.peekSync=new a.SyncApi(this,this.clientOpts),this.peekSync.peek(e)}stopPeeking(){this.peekSync&&(this.peekSync.stopPeeking(),this.peekSync=null)}setGuestAccess(e,t){const i=this.sendStateEvent(e,"m.room.guest_access",{guest_access:t.allowJoin?"can_join":"forbidden"},"");let n=Promise.resolve();return t.allowRead&&(n=this.sendStateEvent(e,"m.room.history_visibility",{history_visibility:"world_readable"},"")),Promise.all([n,i]).then()}requestRegisterEmailToken(e,t,i,n){return this.requestTokenFromEndpoint("/register/email/requestToken",{email:e,client_secret:t,send_attempt:i,next_link:n})}requestRegisterMsisdnToken(e,t,i,n,r){return this.requestTokenFromEndpoint("/register/msisdn/requestToken",{country:e,phone_number:t,client_secret:i,send_attempt:n,next_link:r})}requestAdd3pidEmailToken(e,t,i,n){return this.requestTokenFromEndpoint("/account/3pid/email/requestToken",{email:e,client_secret:t,send_attempt:i,next_link:n})}requestAdd3pidMsisdnToken(e,t,i,n,r){return this.requestTokenFromEndpoint("/account/3pid/msisdn/requestToken",{country:e,phone_number:t,client_secret:i,send_attempt:n,next_link:r})}requestPasswordEmailToken(e,t,i,n){return this.requestTokenFromEndpoint("/account/password/email/requestToken",{email:e,client_secret:t,send_attempt:i,next_link:n})}requestPasswordMsisdnToken(e,t,i,n,r){return this.requestTokenFromEndpoint("/account/password/msisdn/requestToken",{country:e,phone_number:t,client_secret:i,send_attempt:n,next_link:r})}async requestTokenFromEndpoint(e,t){const i=Object.assign({},t);if(!await this.doesServerSupportSeparateAddAndBind()&&this.idBaseUrl){const e=U.default.parse(this.idBaseUrl);if(!e.host)throw new Error("Invalid ID server URL: "+this.idBaseUrl);if(i.id_server=e.host,this.identityServer&&this.identityServer.getAccessToken&&await this.doesServerAcceptIdentityAccessToken()){const e=await this.identityServer.getAccessToken();e&&(i.id_access_token=e)}}return this.http.request(void 0,"POST",e,void 0,i)}getRoomPushRule(e,t){if(!this.pushRules)throw new Error("SyncApi.sync() must be done before accessing to push rules.");for(let i=0;i<this.pushRules[e].room.length;i++){const n=this.pushRules[e].room[i];if(n.rule_id===t)return n}}setRoomMutePushRule(e,t,i){let n,r;const s=this.getRoomPushRule(e,t);if(s&&0<=s.actions.indexOf("dont_notify")&&(r=!0),i?s?r||(n=p.defer(),this.deletePushRule(e,"room",s.rule_id).then((()=>{this.addPushRule(e,"room",t,{actions:["dont_notify"]}).then((()=>{n.resolve()})).catch((e=>{n.reject(e)}))})).catch((e=>{n.reject(e)})),n=n.promise):n=this.addPushRule(e,"room",t,{actions:["dont_notify"]}):r&&(n=this.deletePushRule(e,"room",s.rule_id)),n)return new Promise(((e,t)=>{n.then((()=>{this.getPushRules().then((t=>{this.pushRules=t,e()})).catch((e=>{t(e)}))})).catch((e=>{this.getPushRules().then((i=>{this.pushRules=i,t(e)})).catch((i=>{t(e)}))}))}))}searchMessageText(e,t){const i={search_term:e.query};return"keys"in e&&(i.keys=e.keys),this.search({body:{search_categories:{room_events:i}}},t)}searchRoomEvents(e){const t={search_categories:{room_events:{search_term:e.term,filter:e.filter,order_by:"recent",event_context:{before_limit:1,after_limit:1,include_profile:!0}}}},i={_query:t,results:[],highlights:[]};return this.search({body:t}).then((e=>this.processRoomEventsSearch(i,e)))}backPaginateRoomEventsSearch(e){if(!e.next_batch)return Promise.reject(new Error("Cannot backpaginate event search any further"));if(e.pendingRequest)return e.pendingRequest;const t={body:e._query,next_batch:e.next_batch},i=this.search(t).then((t=>this.processRoomEventsSearch(e,t))).finally((()=>{e.pendingRequest=null}));return e.pendingRequest=i,i}processRoomEventsSearch(e,t){const i=t.search_categories.room_events;e.count=i.count,e.next_batch=i.next_batch;const n={};i.highlights.forEach((e=>{n[e]=1})),e.highlights.forEach((e=>{n[e]=1})),e.highlights=Object.keys(n);const r=i.results?i.results.length:0;for(let t=0;t<r;t++){const n=x.SearchResult.fromJson(i.results[t],this.getEventMapper());e.results.push(n)}return e}syncLeftRooms(){if(this.syncedLeftRooms)return Promise.resolve([]);if(this.syncLeftRoomsPromise)return this.syncLeftRoomsPromise;const e=new a.SyncApi(this,this.clientOpts);return this.syncLeftRoomsPromise=e.syncLeftRooms(),this.syncLeftRoomsPromise.then((e=>{S.logger.log("Marking success of sync left room request"),this.syncedLeftRooms=!0})).finally((()=>{this.syncLeftRoomsPromise=null})),this.syncLeftRoomsPromise}createFilter(e){const t=p.encodeUri("/user/$userId/filter",{$userId:this.credentials.userId});return this.http.authedRequest(void 0,"POST",t,void 0,e).then((t=>{const i=u.Filter.fromJson(this.credentials.userId,t.filter_id,e);return this.store.storeFilter(i),i}))}getFilter(e,t,i){if(i){const i=this.store.getFilter(e,t);if(i)return Promise.resolve(i)}const n=p.encodeUri("/user/$userId/filter/$filterId",{$userId:e,$filterId:t});return this.http.authedRequest(void 0,"GET",n,void 0,void 0).then((i=>{const n=u.Filter.fromJson(e,t,i);return this.store.storeFilter(n),n}))}async getOrCreateFilter(e,t){const i=this.store.getFilterIdByName(e);let n;if(i){try{const e=await this.getFilter(this.credentials.userId,i,!0);if(e){const r=e.getDefinition(),s=t.getDefinition();p.deepCompare(r,s)&&(n=i)}}catch(e){if("M_UNKNOWN"!==e.errcode&&"M_NOT_FOUND"!==e.errcode)throw e}n||this.store.setFilterIdByName(e,void 0)}if(n)return n;const r=await this.createFilter(t.getDefinition());return this.store.setFilterIdByName(e,r.filterId),r.filterId}getOpenIdToken(){const e=p.encodeUri("/user/$userId/openid/request_token",{$userId:this.credentials.userId});return this.http.authedRequest(void 0,"POST",e,void 0,{})}turnServer(e){return this.http.authedRequest(e,"GET","/voip/turnServer")}getTurnServers(){return this.turnServers||[]}getTurnServersExpiry(){return this.turnServersExpiry}async checkTurnServers(){if(!this.canSupportVoip)return;let e=!1;const t=this.turnServersExpiry-Date.now();if(t>$)S.logger.debug("TURN creds are valid for another "+t+" ms: not fetching new ones."),e=!0;else{S.logger.debug("Fetching new TURN credentials");try{const t=await this.turnServer();if(t.uris){S.logger.log("Got TURN URIs: "+t.uris+" refresh in "+t.ttl+" secs");const i={urls:t.uris,username:t.username,credential:t.password};this.turnServers=[i],this.turnServersExpiry=Date.now()+1e3*t.ttl,e=!0}}catch(e){S.logger.error("Failed to get TURN URIs",e),403===e.httpStatus&&(S.logger.info("TURN access unavailable for this account: stopping credentials checks"),null!==this.checkTurnServersIntervalID&&i.g.clearInterval(this.checkTurnServersIntervalID),this.checkTurnServersIntervalID=null)}}return e}setFallbackICEServerAllowed(e){this.fallbackICEServerAllowed=e}isFallbackICEServerAllowed(){return this.fallbackICEServerAllowed}isSynapseAdministrator(){const e=p.encodeUri("/_synapse/admin/v1/users/$userId/admin",{$userId:this.getUserId()});return this.http.authedRequest(void 0,"GET",e,void 0,void 0,{prefix:""}).then((e=>e.admin))}whoisSynapseUser(e){const t=p.encodeUri("/_synapse/admin/v1/whois/$userId",{$userId:e});return this.http.authedRequest(void 0,"GET",t,void 0,void 0,{prefix:""})}deactivateSynapseUser(e){const t=p.encodeUri("/_synapse/admin/v1/deactivate/$userId",{$userId:e});return this.http.authedRequest(void 0,"POST",t,void 0,void 0,{prefix:""})}async fetchClientWellKnown(){this.clientWellKnownPromise=m.AutoDiscovery.getRawClientConfig(this.getDomain()),this.clientWellKnown=await this.clientWellKnownPromise,this.emit("WellKnown.client",this.clientWellKnown)}getClientWellKnown(){return this.clientWellKnown}waitForClientWellKnown(){return this.clientWellKnownPromise}storeClientOptions(){const e=["boolean","string","number"],t=Object.entries(this.clientOpts).filter((([t,i])=>e.includes(typeof i))).reduce(((e,[t,i])=>(e[t]=i,e)),{});return this.store.storeClientOptions(t)}async _unstable_getSharedRooms(e){if(!await this.doesServerSupportUnstableFeature("uk.half-shot.msc2666"))throw Error("Server does not support shared_rooms API");const t=p.encodeUri("/uk.half-shot.msc2666/user/shared_rooms/$userId",{$userId:e});return(await this.http.authedRequest(void 0,"GET",t,void 0,void 0,{prefix:w.PREFIX_UNSTABLE})).joined}getVersions(){return this.serverVersionsPromise||(this.serverVersionsPromise=this.http.request(void 0,"GET","/_matrix/client/versions",void 0,void 0,{prefix:""}).catch((e=>{throw this.serverVersionsPromise=null,e}))),this.serverVersionsPromise}async isVersionSupported(e){const{versions:t}=await this.getVersions();return t&&t.includes(e)}async doesServerSupportLazyLoading(){const e=await this.getVersions();if(!e)return!1;const t=e.versions,i=e.unstable_features;return t&&t.includes("r0.5.0")||i&&i["m.lazy_load_members"]}async doesServerRequireIdServerParam(){const e=await this.getVersions();if(!e)return!0;const t=e.versions;if(t&&t.includes("r0.6.0"))return!1;const i=e.unstable_features;return!i||void 0===i["m.require_identity_server"]||i["m.require_identity_server"]}async doesServerAcceptIdentityAccessToken(){const e=await this.getVersions();if(!e)return!1;const t=e.versions,i=e.unstable_features;return t&&t.includes("r0.6.0")||i&&i["m.id_access_token"]}async doesServerSupportSeparateAddAndBind(){const e=await this.getVersions();if(!e)return!1;const t=e.versions,i=e.unstable_features;return t&&t.includes("r0.6.0")||i&&i["m.separate_add_and_bind"]}async doesServerSupportUnstableFeature(e){const t=await this.getVersions();if(!t)return!1;const i=t.unstable_features;return i&&!!i[e]}async doesServerForceEncryptionForPreset(e){const t=await this.getVersions();if(!t)return!1;const i=t.unstable_features,n=e.includes("_chat")?e.substring(0,e.indexOf("_chat")):e;return i&&!!i[`io.element.e2ee_forced.${n}`]}hasLazyLoadMembersEnabled(){return!!this.clientOpts.lazyLoadMembers}setCanResetTimelineCallback(e){this.canResetTimelineCallback=e}getCanResetTimelineCallback(){return this.canResetTimelineCallback}async relations(e,t,i,n,r){const s=this.getEncryptedIfNeededEventType(e,n),o=await this.fetchRelations(e,t,i,s,r),a=this.getEventMapper();let c;o.original_event&&(c=a(o.original_event));let l=o.chunk.map(a);if("m.room.encrypted"===s){const e=c?l.concat(c):l;await Promise.all(e.map((e=>new Promise((t=>e.once("Event.decrypted",t)))))),l=l.filter((e=>e.getType()===n))}return c&&"m.replace"===i&&(l=l.filter((e=>e.getSender()===c.getSender()))),{originalEvent:c,events:l,nextBatch:o.next_batch}}getCrossSigningCacheCallbacks(){var e;return null===(e=this.crypto)||void 0===e?void 0:e.crossSigningInfo.getCacheCallbacks()}generateClientSecret(){return(0,L.randomString)(32)}decryptEventIfNeeded(e,t){return e.shouldAttemptDecryption()&&e.attemptDecryption(this.crypto,t),e.isBeingDecrypted()?e.getDecryptionPromise():Promise.resolve()}termsUrlForService(e,t){switch(e){case b.SERVICE_TYPES.IS:return t+w.PREFIX_IDENTITY_V2+"/terms";case b.SERVICE_TYPES.IM:return t+"/_matrix/integrations/v1/terms";default:throw new Error("Unsupported service type")}}getHomeserverUrl(){return this.baseUrl}getIdentityServerUrl(e=!1){return e&&(this.idBaseUrl.startsWith("http://")||this.idBaseUrl.startsWith("https://"))?this.idBaseUrl.split("://")[1]:this.idBaseUrl}setIdentityServerUrl(e){this.idBaseUrl=p.ensureNoTrailingSlash(e),this.http.setIdBaseUrl(this.idBaseUrl)}getAccessToken(){return this.http.opts.accessToken||null}isLoggedIn(){return void 0!==this.http.opts.accessToken}makeTxnId(){return"m"+(new Date).getTime()+"."+this.txnCtr++}isUsernameAvailable(e){return this.http.authedRequest(void 0,"GET","/register/available",{username:e}).then((e=>e.available))}register(e,t,i,n,r,s,o,a){!0===r?r={email:!0}:null==r&&(r={}),"function"==typeof o&&(a=o,o=void 0),i&&(n.session=i);const c={auth:n};return null!=e&&(c.username=e),null!=t&&(c.password=t),r.email&&(c.bind_email=!0),r.msisdn&&(c.bind_msisdn=!0),null!=s&&(c.guest_access_token=s),null!=o&&(c.inhibit_login=o),null!=t&&(c.x_show_msisdn=!0),this.registerRequest(c,void 0,a)}registerGuest(e,t){return(e=e||{}).body=e.body||{},this.registerRequest(e.body,"guest",t)}registerRequest(e,t,i){const n={};return t&&(n.kind=t),this.http.request(i,"POST","/register",n,e)}loginFlows(e){return this.http.request(e,"GET","/login")}login(e,t,i){const n={type:e};return p.extend(n,t),this.http.authedRequest(((e,t)=>{t&&t.access_token&&t.user_id&&(this.http.opts.accessToken=t.access_token,this.credentials={userId:t.user_id}),i&&i(e,t)}),"POST","/login",void 0,n)}loginWithPassword(e,t,i){return this.login("m.login.password",{user:e,password:t},i)}loginWithSAML2(e,t){return this.login("m.login.saml2",{relay_state:e},t)}getCasLoginUrl(e){return this.getSsoLoginUrl(e,"cas")}getSsoLoginUrl(e,t="sso",i){let n="/login/"+t+"/redirect";return i&&(n+="/"+i),this.http.getUrl(n,{redirectUrl:e},w.PREFIX_R0)}loginWithToken(e,t){return this.login("m.login.token",{token:e},t)}logout(e){return this.http.authedRequest(e,"POST","/logout")}deactivateAccount(e,t){if("function"==typeof t)throw new Error("deactivateAccount no longer accepts a callback parameter");const i={};return e&&(i.auth=e),void 0!==t&&(i.erase=t),this.http.authedRequest(void 0,"POST","/account/deactivate",void 0,i)}getFallbackAuthUrl(e,t){const i=p.encodeUri("/auth/$loginType/fallback/web",{$loginType:e});return this.http.getUrl(i,{session:t},w.PREFIX_R0)}async createRoom(e,t){const i=(e.invite_3pid||[]).filter((e=>!e.id_access_token));if(i.length>0&&this.identityServer&&this.identityServer.getAccessToken&&await this.doesServerAcceptIdentityAccessToken()){const e=await this.identityServer.getAccessToken();if(e)for(const t of i)t.id_access_token=e}return this.http.authedRequest(t,"POST","/createRoom",void 0,e)}async fetchRelations(e,t,i,n,r){const s={};r.from&&(s.from=r.from);const o=p.encodeParams(s),a=p.encodeUri("/rooms/$roomId/relations/$eventId/$relationType/$eventType?"+o,{$roomId:e,$eventId:t,$relationType:i,$eventType:n});return await this.http.authedRequest(void 0,"GET",a,null,null,{prefix:w.PREFIX_UNSTABLE})}roomState(e,t){const i=p.encodeUri("/rooms/$roomId/state",{$roomId:e});return this.http.authedRequest(t,"GET",i)}fetchRoomEvent(e,t,i){const n=p.encodeUri("/rooms/$roomId/event/$eventId",{$roomId:e,$eventId:t});return this.http.authedRequest(i,"GET",n)}members(e,t,i,n,r){const s={};t&&(s.membership=t),i&&(s.not_membership=i),n&&(s.at=n);const o=p.encodeParams(s),a=p.encodeUri("/rooms/$roomId/members?"+o,{$roomId:e});return this.http.authedRequest(r,"GET",a)}upgradeRoom(e,t){const i=p.encodeUri("/rooms/$roomId/upgrade",{$roomId:e});return this.http.authedRequest(void 0,"POST",i,void 0,{new_version:t})}getStateEvent(e,t,i,n){const r={$roomId:e,$eventType:t,$stateKey:i};let s=p.encodeUri("/rooms/$roomId/state/$eventType",r);return void 0!==i&&(s=p.encodeUri(s+"/$stateKey",r)),this.http.authedRequest(n,"GET",s)}sendStateEvent(e,t,i,n="",r){const s={$roomId:e,$eventType:t,$stateKey:n};let o=p.encodeUri("/rooms/$roomId/state/$eventType",s);return void 0!==n&&(o=p.encodeUri(o+"/$stateKey",s)),this.http.authedRequest(r,"PUT",o,void 0,i)}roomInitialSync(e,t,i){p.isFunction(t)&&(i=t,t=void 0);const n=p.encodeUri("/rooms/$roomId/initialSync",{$roomId:e});return t||(t=30),this.http.authedRequest(i,"GET",n,{limit:t})}setRoomReadMarkersHttpRequest(e,t,i,n){const r=p.encodeUri("/rooms/$roomId/read_markers",{$roomId:e}),s={"m.fully_read":t,"m.read":i,"m.hidden":Boolean(!!n&&n.hidden)};return this.http.authedRequest(void 0,"POST",r,void 0,s)}getJoinedRooms(){const e=p.encodeUri("/joined_rooms",{});return this.http.authedRequest(void 0,"GET",e)}getJoinedRoomMembers(e){const t=p.encodeUri("/rooms/$roomId/joined_members",{$roomId:e});return this.http.authedRequest(void 0,"GET",t)}publicRooms(e,t){"function"==typeof e&&(t=e,e={}),void 0===e&&(e={});const i={};return e.server&&(i.server=e.server,delete e.server),0===Object.keys(e).length&&0===Object.keys(i).length?this.http.authedRequest(t,"GET","/publicRooms"):this.http.authedRequest(t,"POST","/publicRooms",i,e)}createAlias(e,t,i){const n=p.encodeUri("/directory/room/$alias",{$alias:e}),r={room_id:t};return this.http.authedRequest(i,"PUT",n,void 0,r)}deleteAlias(e,t){const i=p.encodeUri("/directory/room/$alias",{$alias:e});return this.http.authedRequest(t,"DELETE",i,void 0,void 0)}unstableGetLocalAliases(e,t){const i=p.encodeUri("/rooms/$roomId/aliases",{$roomId:e}),n=w.PREFIX_UNSTABLE+"/org.matrix.msc2432";return this.http.authedRequest(t,"GET",i,null,null,{prefix:n})}getRoomIdForAlias(e,t){const i=p.encodeUri("/directory/room/$alias",{$alias:e});return this.http.authedRequest(t,"GET",i)}resolveRoomAlias(e,t){const i=p.encodeUri("/directory/room/$alias",{$alias:e});return this.http.request(t,"GET",i)}getRoomDirectoryVisibility(e,t){const i=p.encodeUri("/directory/list/room/$roomId",{$roomId:e});return this.http.authedRequest(t,"GET",i)}setRoomDirectoryVisibility(e,t,i){const n=p.encodeUri("/directory/list/room/$roomId",{$roomId:e});return this.http.authedRequest(i,"PUT",n,void 0,{visibility:t})}setRoomDirectoryVisibilityAppService(e,t,i,n){const r=p.encodeUri("/directory/list/appservice/$networkId/$roomId",{$networkId:e,$roomId:t});return this.http.authedRequest(n,"PUT",r,void 0,{visibility:i})}searchUserDirectory(e){const t={search_term:e.term};return void 0!==e.limit&&(t.limit=e.limit),this.http.authedRequest(void 0,"POST","/user_directory/search",void 0,t)}uploadContent(e,t){return this.http.uploadContent(e,t)}cancelUpload(e){return this.http.cancelUpload(e)}getCurrentUploads(){return this.http.getCurrentUploads()}getProfileInfo(e,t,i){p.isFunction(t)&&(i=t,t=void 0);const n=t?p.encodeUri("/profile/$userId/$info",{$userId:e,$info:t}):p.encodeUri("/profile/$userId",{$userId:e});return this.http.authedRequest(i,"GET",n)}getThreePids(e){return this.http.authedRequest(e,"GET","/account/3pid",void 0,void 0)}addThreePid(e,t,i){const n={threePidCreds:e,bind:t};return this.http.authedRequest(i,"POST","/account/3pid",null,n)}async addThreePidOnly(e){const t=await this.isVersionSupported("r0.6.0")?w.PREFIX_R0:w.PREFIX_UNSTABLE;return this.http.authedRequest(void 0,"POST","/account/3pid/add",null,e,{prefix:t})}async bindThreePid(e){const t=await this.isVersionSupported("r0.6.0")?w.PREFIX_R0:w.PREFIX_UNSTABLE;return this.http.authedRequest(void 0,"POST","/account/3pid/bind",null,e,{prefix:t})}async unbindThreePid(e,t){const i={medium:e,address:t,id_server:this.getIdentityServerUrl(!0)},n=await this.isVersionSupported("r0.6.0")?w.PREFIX_R0:w.PREFIX_UNSTABLE;return this.http.authedRequest(void 0,"POST","/account/3pid/unbind",null,i,{prefix:n})}deleteThreePid(e,t){const i={medium:e,address:t};return this.http.authedRequest(void 0,"POST","/account/3pid/delete",null,i)}setPassword(e,t,i){const n={auth:e,new_password:t};return this.http.authedRequest(i,"POST","/account/password",null,n)}getDevices(){return this.http.authedRequest(void 0,"GET","/devices",void 0,void 0)}getDevice(e){const t=p.encodeUri("/devices/$device_id",{$device_id:e});return this.http.authedRequest(void 0,"GET",t,void 0,void 0)}setDeviceDetails(e,t){const i=p.encodeUri("/devices/$device_id",{$device_id:e});return this.http.authedRequest(void 0,"PUT",i,void 0,t)}deleteDevice(e,t){const i=p.encodeUri("/devices/$device_id",{$device_id:e}),n={};return t&&(n.auth=t),this.http.authedRequest(void 0,"DELETE",i,void 0,n)}deleteMultipleDevices(e,t){const i={devices:e};return t&&(i.auth=t),this.http.authedRequest(void 0,"POST","/delete_devices",void 0,i)}getPushers(e){return this.http.authedRequest(e,"GET","/pushers",void 0,void 0)}setPusher(e,t){return this.http.authedRequest(t,"POST","/pushers/set",null,e)}getPushRules(e){return this.http.authedRequest(e,"GET","/pushrules/").then((e=>f.PushProcessor.rewriteDefaultRules(e)))}addPushRule(e,t,i,n,r){const s=p.encodeUri("/pushrules/"+e+"/$kind/$ruleId",{$kind:t,$ruleId:i});return this.http.authedRequest(r,"PUT",s,void 0,n)}deletePushRule(e,t,i,n){const r=p.encodeUri("/pushrules/"+e+"/$kind/$ruleId",{$kind:t,$ruleId:i});return this.http.authedRequest(n,"DELETE",r)}setPushRuleEnabled(e,t,i,n,r){const s=p.encodeUri("/pushrules/"+e+"/$kind/$ruleId/enabled",{$kind:t,$ruleId:i});return this.http.authedRequest(r,"PUT",s,void 0,{enabled:n})}setPushRuleActions(e,t,i,n,r){const s=p.encodeUri("/pushrules/"+e+"/$kind/$ruleId/actions",{$kind:t,$ruleId:i});return this.http.authedRequest(r,"PUT",s,void 0,{actions:n})}search(e,t){const i={};return e.next_batch&&(i.next_batch=e.next_batch),this.http.authedRequest(t,"POST","/search",i,e.body)}uploadKeysRequest(e,t,i){return this.http.authedRequest(i,"POST","/keys/upload",void 0,e)}uploadKeySignatures(e){return this.http.authedRequest(void 0,"POST","/keys/signatures/upload",void 0,e,{prefix:w.PREFIX_UNSTABLE})}downloadKeysForUsers(e,t){if(p.isFunction(t))throw new Error("downloadKeysForUsers no longer accepts a callback parameter");const i={device_keys:{}};return"token"in(t=t||{})&&(i.token=t.token),e.forEach((e=>{i.device_keys[e]=[]})),this.http.authedRequest(void 0,"POST","/keys/query",void 0,i)}claimOneTimeKeys(e,t="signed_curve25519",i){const n={};void 0===t&&(t="signed_curve25519");for(let i=0;i<e.length;++i){const r=e[i][0],s=e[i][1],o=n[r]||{};n[r]=o,o[s]=t}const r={one_time_keys:n};return i&&(r.timeout=i),this.http.authedRequest(void 0,"POST","/keys/claim",void 0,r)}getKeyChanges(e,t){const i={from:e,to:t};return this.http.authedRequest(void 0,"GET","/keys/changes",i,void 0)}uploadDeviceSigningKeys(e,t){const i=Object.assign({},t);return e&&Object.assign(i,{auth:e}),this.http.authedRequest(void 0,"POST","/keys/device_signing/upload",void 0,i,{prefix:w.PREFIX_UNSTABLE})}registerWithIdentityServer(e){if(!this.idBaseUrl)throw new Error("No Identity Server base URL set");const t=this.idBaseUrl+w.PREFIX_IDENTITY_V2+"/account/register";return this.http.requestOtherUrl(void 0,"POST",t,null,e)}async requestEmailToken(e,t,i,n,r,s){const o={client_secret:t,email:e,send_attempt:i,next_link:n};return await this.http.idServerRequest(r,"POST","/validate/email/requestToken",o,w.PREFIX_IDENTITY_V2,s)}async requestMsisdnToken(e,t,i,n,r,s,o){const a={client_secret:i,country:e,phone_number:t,send_attempt:n,next_link:r};return await this.http.idServerRequest(s,"POST","/validate/msisdn/requestToken",a,w.PREFIX_IDENTITY_V2,o)}async submitMsisdnToken(e,t,i,n){const r={sid:e,client_secret:t,token:i};return await this.http.idServerRequest(void 0,"POST","/validate/msisdn/submitToken",r,w.PREFIX_IDENTITY_V2,n)}submitMsisdnTokenOtherUrl(e,t,i,n){const r={sid:t,client_secret:i,token:n};return this.http.requestOtherUrl(void 0,"POST",e,void 0,r)}getIdentityHashDetails(e){return this.http.idServerRequest(void 0,"GET","/hash_details",null,w.PREFIX_IDENTITY_V2,e)}async identityHashedLookup(e,t){const n={},r=await this.getIdentityHashDetails(t);if(!r||!r.lookup_pepper||!r.algorithms)throw new Error("Unsupported identity server: bad response");n.pepper=r.lookup_pepper;const s={};if(r.algorithms.includes("sha256")){const t=new i.g.Olm.Utility;n.addresses=e.map((e=>{const i=e[0].toLowerCase(),r=e[1].toLowerCase(),o=t.sha256(`${i} ${r} ${n.pepper}`).replace(/\+/g,"-").replace(/\//g,"_");return s[o]=e[0],o})),n.algorithm="sha256"}else{if(!r.algorithms.includes("none"))throw new Error("Unsupported identity server: unknown hash algorithm");n.addresses=e.map((e=>{const t=`${e[0].toLowerCase()} ${e[1].toLowerCase()}`;return s[t]=e[0],t})),n.algorithm="none"}const o=await this.http.idServerRequest(void 0,"POST","/lookup",n,w.PREFIX_IDENTITY_V2,t);if(!o||!o.mappings)return[];const a=[];for(const e of Object.keys(o.mappings)){const t=o.mappings[e],i=s[e];if(!i)throw new Error("Identity server returned more results than expected");a.push({address:i,mxid:t})}return a}async lookupThreePid(e,t,i,n){const r=(await this.identityHashedLookup([[t,e]],n)).find((e=>e.address===t));if(!r)return i&&i(null,{}),{};const s={address:t,medium:e,mxid:r.mxid};return i&&i(null,s),s}async bulkLookupThreePids(e,t){const i=await this.identityHashedLookup(e.map((e=>[e[1],e[0]])),t),n=[];for(const t of i){const i=e.find((e=>e[1]===t.address));if(!i)throw new Error("Identity sever returned unexpected results");n.push([i[0],t.address,t.mxid])}return{threepids:n}}getIdentityAccount(e){return this.http.idServerRequest(void 0,"GET","/account",void 0,w.PREFIX_IDENTITY_V2,e)}sendToDevice(e,t,i){const n=p.encodeUri("/sendToDevice/$eventType/$txnId",{$eventType:e,$txnId:i||this.makeTxnId()}),r={messages:t},s=Object.keys(t).reduce(((e,i)=>(e[i]=Object.keys(t[i]),e)),{});return S.logger.log(`PUT ${n}`,s),this.http.authedRequest(void 0,"PUT",n,void 0,r)}getThirdpartyProtocols(){return this.http.authedRequest(void 0,"GET","/thirdparty/protocols",void 0,void 0).then((e=>{if(!e||"object"!=typeof e)throw new Error(`/thirdparty/protocols did not return an object: ${e}`);return e}))}getThirdpartyLocation(e,t){const i=p.encodeUri("/thirdparty/location/$protocol",{$protocol:e});return this.http.authedRequest(void 0,"GET",i,t,void 0)}getThirdpartyUser(e,t){const i=p.encodeUri("/thirdparty/user/$protocol",{$protocol:e});return this.http.authedRequest(void 0,"GET",i,t,void 0)}getTerms(e,t){const i=this.termsUrlForService(e,t);return this.http.requestOtherUrl(void 0,"GET",i)}agreeToTerms(e,t,i,n){const r=this.termsUrlForService(e,t),s={Authorization:"Bearer "+i};return this.http.requestOtherUrl(void 0,"POST",r,null,{user_accepts:n},{headers:s})}reportEvent(e,t,i,n){const r=p.encodeUri("/rooms/$roomId/report/$eventId",{$roomId:e,$eventId:t});return this.http.authedRequest(void 0,"POST",r,null,{score:i,reason:n})}getSpaceSummary(e,t,i,n,r,s){const o=p.encodeUri("/rooms/$roomId/spaces",{$roomId:e});return this.http.authedRequest(void 0,"POST",o,null,{max_rooms_per_space:t,suggested_only:i,auto_join_only:n,limit:r,batch:s},{prefix:"/_matrix/client/unstable/org.matrix.msc2946"})}async unstableCreateFileTree(e){const{room_id:t}=await this.createRoom({name:e,preset:N.Preset.PrivateChat,power_level_content_override:q(q({},j.DEFAULT_TREE_POWER_LEVELS_TEMPLATE),{},{users:{[this.getUserId()]:100}}),creation_content:{[M.RoomCreateTypeField]:M.RoomType.Space},initial_state:[{type:M.UNSTABLE_MSC3088_PURPOSE.name,state_key:M.UNSTABLE_MSC3089_TREE_SUBTYPE.name,content:{[M.UNSTABLE_MSC3088_ENABLED.name]:!0}},{type:M.EventType.RoomEncryption,state_key:"",content:{algorithm:v.MEGOLM_ALGORITHM}}]});return new j.MSC3089TreeSpace(this,t)}unstableGetFileTreeSpace(e){var t,i;const n=this.getRoom(e);if(!n)return null;const r=n.currentState.getStateEvents(M.EventType.RoomCreate,""),s=n.currentState.getStateEvents(M.UNSTABLE_MSC3088_PURPOSE.name,M.UNSTABLE_MSC3089_TREE_SUBTYPE.name);if(!r)throw new Error("Expected single room create event");return null!=s&&null!==(t=s.getContent())&&void 0!==t&&t[M.UNSTABLE_MSC3088_ENABLED.name]?(null===(i=r.getContent())||void 0===i?void 0:i[M.RoomCreateTypeField])!==M.RoomType.Space?null:new j.MSC3089TreeSpace(this,e):null}getGroupSummary(e){const t=p.encodeUri("/groups/$groupId/summary",{$groupId:e});return this.http.authedRequest(void 0,"GET",t)}getGroupProfile(e){const t=p.encodeUri("/groups/$groupId/profile",{$groupId:e});return this.http.authedRequest(void 0,"GET",t)}setGroupProfile(e,t){const i=p.encodeUri("/groups/$groupId/profile",{$groupId:e});return this.http.authedRequest(void 0,"POST",i,void 0,t)}setGroupJoinPolicy(e,t){const i=p.encodeUri("/groups/$groupId/settings/m.join_policy",{$groupId:e});return this.http.authedRequest(void 0,"PUT",i,void 0,{"m.join_policy":t})}getGroupUsers(e){const t=p.encodeUri("/groups/$groupId/users",{$groupId:e});return this.http.authedRequest(void 0,"GET",t)}getGroupInvitedUsers(e){const t=p.encodeUri("/groups/$groupId/invited_users",{$groupId:e});return this.http.authedRequest(void 0,"GET",t)}getGroupRooms(e){const t=p.encodeUri("/groups/$groupId/rooms",{$groupId:e});return this.http.authedRequest(void 0,"GET",t)}inviteUserToGroup(e,t){const i=p.encodeUri("/groups/$groupId/admin/users/invite/$userId",{$groupId:e,$userId:t});return this.http.authedRequest(void 0,"PUT",i,void 0,{})}removeUserFromGroup(e,t){const i=p.encodeUri("/groups/$groupId/admin/users/remove/$userId",{$groupId:e,$userId:t});return this.http.authedRequest(void 0,"PUT",i,void 0,{})}addUserToGroupSummary(e,t,i){const n=p.encodeUri(i?"/groups/$groupId/summary/$roleId/users/$userId":"/groups/$groupId/summary/users/$userId",{$groupId:e,$roleId:i,$userId:t});return this.http.authedRequest(void 0,"PUT",n,void 0,{})}removeUserFromGroupSummary(e,t){const i=p.encodeUri("/groups/$groupId/summary/users/$userId",{$groupId:e,$userId:t});return this.http.authedRequest(void 0,"DELETE",i,void 0,{})}addRoomToGroupSummary(e,t,i){const n=p.encodeUri(i?"/groups/$groupId/summary/$categoryId/rooms/$roomId":"/groups/$groupId/summary/rooms/$roomId",{$groupId:e,$categoryId:i,$roomId:t});return this.http.authedRequest(void 0,"PUT",n,void 0,{})}removeRoomFromGroupSummary(e,t){const i=p.encodeUri("/groups/$groupId/summary/rooms/$roomId",{$groupId:e,$roomId:t});return this.http.authedRequest(void 0,"DELETE",i,void 0,{})}addRoomToGroup(e,t,i){void 0===i&&(i=!0);const n=p.encodeUri("/groups/$groupId/admin/rooms/$roomId",{$groupId:e,$roomId:t});return this.http.authedRequest(void 0,"PUT",n,void 0,{"m.visibility":{type:i?"public":"private"}})}updateGroupRoomVisibility(e,t,i){const n=p.encodeUri("/groups/$groupId/admin/rooms/$roomId/config/m.visibility",{$groupId:e,$roomId:t});return this.http.authedRequest(void 0,"PUT",n,void 0,{type:i?"public":"private"})}removeRoomFromGroup(e,t){const i=p.encodeUri("/groups/$groupId/admin/rooms/$roomId",{$groupId:e,$roomId:t});return this.http.authedRequest(void 0,"DELETE",i,void 0,{})}acceptGroupInvite(e,t=null){const i=p.encodeUri("/groups/$groupId/self/accept_invite",{$groupId:e});return this.http.authedRequest(void 0,"PUT",i,void 0,t||{})}joinGroup(e){const t=p.encodeUri("/groups/$groupId/self/join",{$groupId:e});return this.http.authedRequest(void 0,"PUT",t,void 0,{})}leaveGroup(e){const t=p.encodeUri("/groups/$groupId/self/leave",{$groupId:e});return this.http.authedRequest(void 0,"PUT",t,void 0,{})}getJoinedGroups(){const e=p.encodeUri("/joined_groups",{});return this.http.authedRequest(void 0,"GET",e)}createGroup(e){const t=p.encodeUri("/create_group",{});return this.http.authedRequest(void 0,"POST",t,void 0,e)}getPublicisedGroups(e){const t=p.encodeUri("/publicised_groups",{});return this.http.authedRequest(void 0,"POST",t,void 0,{user_ids:e})}setGroupPublicity(e,t){const i=p.encodeUri("/groups/$groupId/self/update_publicity",{$groupId:e});return this.http.authedRequest(void 0,"PUT",i,void 0,{publicise:t})}}t.MatrixClient=W,(0,s.default)(W,"RESTORE_BACKUP_ERROR_BAD_KEY","RESTORE_BACKUP_ERROR_BAD_KEY")},4656:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.makeHtmlMessage=function(e,t){return{msgtype:"m.text",format:"org.matrix.custom.html",body:e,formatted_body:t}},t.makeHtmlNotice=function(e,t){return{msgtype:"m.notice",format:"org.matrix.custom.html",body:e,formatted_body:t}},t.makeHtmlEmote=function(e,t){return{msgtype:"m.emote",format:"org.matrix.custom.html",body:e,formatted_body:t}},t.makeTextMessage=function(e){return{msgtype:"m.text",body:e}},t.makeNotice=function(e){return{msgtype:"m.notice",body:e}},t.makeEmoteMessage=function(e){return{msgtype:"m.emote",body:e}}},3667:(e,t,i)=>{"use strict";var n=i(862);Object.defineProperty(t,"__esModule",{value:!0}),t.getHttpUriForMxc=function(e,t,i,n,s,o=!1){if("string"!=typeof t||!t)return"";if(0!==t.indexOf("mxc://"))return o?t:"";let a=t.slice(6),c="/_matrix/media/r0/download/";const l={};i&&(l.width=Math.round(i)),n&&(l.height=Math.round(n)),s&&(l.method=s),Object.keys(l).length>0&&(c="/_matrix/media/r0/thumbnail/");const h=a.indexOf("#");let u="";h>=0&&(u=a.substr(h),a=a.substr(0,h));return e+c+a+(0===Object.keys(l).length?"":"?"+r.encodeParams(l))+u};var r=n(i(3102))},3075:(e,t,i)=>{"use strict";var n=i(5318);Object.defineProperty(t,"__esModule",{value:!0}),t.createCryptoStoreCacheCallbacks=function(e,t){return{getCrossSigningKeyCache:async function(i,n){const r=await new Promise((t=>e.doTxn("readonly",[c.IndexedDBCryptoStore.STORE_ACCOUNT],(n=>{e.getSecretStorePrivateKey(n,t,i)}))));if(r&&r.ciphertext){const e=Buffer.from(t._pickleKey),n=await(0,l.decryptAES)(r,e,i);return(0,o.decodeBase64)(n)}return r},storeCrossSigningKeyCache:async function(i,n){if(!(n instanceof Uint8Array))throw new Error(`storeCrossSigningKeyCache expects Uint8Array, got ${n}`);const r=Buffer.from(t._pickleKey),s=await(0,l.encryptAES)((0,o.encodeBase64)(n),r,i);return e.doTxn("readwrite",[c.IndexedDBCryptoStore.STORE_ACCOUNT],(t=>{e.storeSecretStorePrivateKey(t,i,s)}))}}},t.requestKeysDuringVerification=async function(e,t,i){if(e.getUserId()===t)return a.logger.log("Cross-signing: Self-verification done; requesting keys"),new Promise(((t,n)=>{const r=e,s=r.crypto.crossSigningInfo,c=new u(s.userId,{getCrossSigningKey:async e=>{a.logger.debug("Cross-signing: requesting secret",e,i);const{promise:t}=r.requestSecret(`m.cross_signing.${e}`,[i]),n=await t,s=(0,o.decodeBase64)(n);return Uint8Array.from(s)}},s.getCacheCallbacks());c.keys=s.keys;const l=new Promise(((e,t)=>{setTimeout(e,6e4,new Error("Timeout"))})),h=(async()=>{if(!await r.crypto.getSessionBackupPrivateKey()){a.logger.info("No cached backup key found. Requesting...");const e=r.requestSecret("m.megolm_backup.v1",[i]),t=await e.promise;a.logger.info("Got key backup key, decoding...");const n=(0,o.decodeBase64)(t);a.logger.info("Decoded backup key, storing..."),r.crypto.storeSessionBackupPrivateKey(Uint8Array.from(n)),a.logger.info("Backup key stored. Starting backup restore...");const s=await r.getKeyBackupVersion();r.restoreKeyBackupWithCache(void 0,void 0,s).then((()=>{a.logger.info("Backup restored.")}))}})();return Promise.race([Promise.all([c.getCrossSigningKey("master"),c.getCrossSigningKey("self_signing"),c.getCrossSigningKey("user_signing"),h]),l]).then(t,n)})).catch((e=>{a.logger.warn("Cross-signing: failure while requesting keys:",e)}))},t.DeviceTrustLevel=t.UserTrustLevel=t.CrossSigningLevel=t.CrossSigningInfo=void 0;var r=n(i(9713)),s=i(7187),o=i(2772),a=i(7434),c=i(7585),l=i(2611);function h(e){return Object.values(e.keys)[0]}class u extends s.EventEmitter{constructor(e,t={},i={}){super(),this.userId=e,this.callbacks=t,this.cacheCallbacks=i,(0,r.default)(this,"keys",{}),(0,r.default)(this,"firstUse",!0),(0,r.default)(this,"crossSigningVerifiedBefore",!1)}static fromStorage(e,t){const i=new u(t);for(const t in e)e.hasOwnProperty(t)&&(i[t]=e[t]);return i}toStorage(){return{keys:this.keys,firstUse:this.firstUse,crossSigningVerifiedBefore:this.crossSigningVerifiedBefore}}async getCrossSigningKey(e,t){const n=["master","self_signing","user_signing"].indexOf(e)>=0;if(!this.callbacks.getCrossSigningKey)throw new Error("No getCrossSigningKey callback supplied");function r(e){if(!e)return;const n=new i.g.Olm.PkSigning,r=n.init_with_seed(e);if(r===t)return[r,n];n.free()}let s;void 0===t&&(t=this.getId(e)),this.cacheCallbacks.getCrossSigningKeyCache&&n&&(s=await this.cacheCallbacks.getCrossSigningKeyCache(e,t));const o=r(s);if(o)return o;s=await this.callbacks.getCrossSigningKey(e,t);const a=r(s);if(a)return this.cacheCallbacks.storeCrossSigningKeyCache&&n&&await this.cacheCallbacks.storeCrossSigningKeyCache(e,s),a;if(!s)throw new Error("getCrossSigningKey callback for "+e+" returned falsey");throw new Error("Key type "+e+" from getCrossSigningKey callback did not match")}async isStoredInSecretStorage(e){const t=await e.isStored("m.cross_signing.master",!1)||{};function i(e){for(const i of Object.keys(t))e[i]||delete t[i]}for(const t of["self_signing","user_signing"])i(await e.isStored(`m.cross_signing.${t}`,!1)||{});return Object.keys(t).length?t:null}static async storeInSecretStorage(e,t){for(const[i,n]of e){const e=(0,o.encodeBase64)(n);await t.store(`m.cross_signing.${i}`,e)}}static async getFromSecretStorage(e,t){const i=await t.get(`m.cross_signing.${e}`);return i?(0,o.decodeBase64)(i):null}async isStoredInKeyCache(e){const t=this.cacheCallbacks;if(!t)return!1;const i=e?[e]:["master","self_signing","user_signing"];for(const e of i)if(!await t.getCrossSigningKeyCache(e))return!1;return!0}async getCrossSigningKeysFromCache(){const e=new Map,t=this.cacheCallbacks;if(!t)return e;for(const i of["master","self_signing","user_signing"]){const n=await t.getCrossSigningKeyCache(i);n&&e.set(i,n)}return e}getId(e="master"){return this.keys[e]?h(this.keys[e]):null}async resetKeys(e){if(!this.callbacks.saveCrossSigningKeys)throw new Error("No saveCrossSigningKeys callback supplied");if(void 0===e||e&d.MASTER||!this.keys.master)e=d.MASTER|d.USER_SIGNING|d.SELF_SIGNING;else if(0===e)return;const t={},n={};let r,s;try{if(e&d.MASTER?(r=new i.g.Olm.PkSigning,t.master=r.generate_seed(),s=r.init_with_seed(t.master),n.master={user_id:this.userId,usage:["master"],keys:{["ed25519:"+s]:s}}):[s,r]=await this.getCrossSigningKey("master"),e&d.SELF_SIGNING){const e=new i.g.Olm.PkSigning;try{t.self_signing=e.generate_seed();const i=e.init_with_seed(t.self_signing);n.self_signing={user_id:this.userId,usage:["self_signing"],keys:{["ed25519:"+i]:i}},(0,o.pkSign)(n.self_signing,r,this.userId,s)}finally{e.free()}}if(e&d.USER_SIGNING){const e=new i.g.Olm.PkSigning;try{t.user_signing=e.generate_seed();const i=e.init_with_seed(t.user_signing);n.user_signing={user_id:this.userId,usage:["user_signing"],keys:{["ed25519:"+i]:i}},(0,o.pkSign)(n.user_signing,r,this.userId,s)}finally{e.free()}}Object.assign(this.keys,n),this.callbacks.saveCrossSigningKeys(t)}finally{r&&r.free()}}clearKeys(){this.keys={}}setKeys(e){const t={};if(e.master){if(e.master.user_id!==this.userId){const t="Mismatched user ID "+e.master.user_id+" in master key from "+this.userId;throw a.logger.error(t),new Error(t)}this.keys.master?h(e.master)!==this.getId()&&(this.firstUse=!1):this.firstUse=!0,t.master=e.master}else{if(!this.keys.master)throw new Error("Tried to set cross-signing keys without a master key");t.master=this.keys.master}const i=h(t.master);if(e.user_signing){if(e.user_signing.user_id!==this.userId){const t="Mismatched user ID "+e.master.user_id+" in user_signing key from "+this.userId;throw a.logger.error(t),new Error(t)}try{(0,o.pkVerify)(e.user_signing,i,this.userId)}catch(e){throw a.logger.error("invalid signature on user-signing key"),e}}if(e.self_signing){if(e.self_signing.user_id!==this.userId){const t="Mismatched user ID "+e.master.user_id+" in self_signing key from "+this.userId;throw a.logger.error(t),new Error(t)}try{(0,o.pkVerify)(e.self_signing,i,this.userId)}catch(e){throw a.logger.error("invalid signature on self-signing key"),e}}e.master&&(this.keys.master=e.master,this.keys.self_signing=null,this.keys.user_signing=null),e.self_signing&&(this.keys.self_signing=e.self_signing),e.user_signing&&(this.keys.user_signing=e.user_signing)}updateCrossSigningVerifiedBefore(e){!this.crossSigningVerifiedBefore&&e&&(this.crossSigningVerifiedBefore=!0)}async signObject(e,t){if(!this.keys[t])throw new Error("Attempted to sign with "+t+" key but no such key present");const[i,n]=await this.getCrossSigningKey(t);try{return(0,o.pkSign)(e,n,this.userId,i),e}finally{n.free()}}async signUser(e){if(this.keys.user_signing)return this.signObject(e.keys.master,"user_signing");a.logger.info("No user signing key: not signing user")}async signDevice(e,t){if(e!==this.userId)throw new Error(`Trying to sign ${e}'s device; can only sign our own device`);if(this.keys.self_signing)return this.signObject({algorithms:t.algorithms,keys:t.keys,device_id:t.deviceId,user_id:e},"self_signing");a.logger.info("No self signing key: not signing device")}checkUserTrust(e){if(this.userId===e.userId&&this.getId()&&this.getId()===e.getId()&&this.getId("self_signing")&&this.getId("self_signing")===e.getId("self_signing"))return new p(!0,!0,this.firstUse);if(!this.keys.user_signing)return new p(!1,!1,e.firstUse);let t;const i=e.keys.master,n=this.getId("user_signing");try{(0,o.pkVerify)(i,n,this.userId),t=!0}catch(e){t=!1}return new p(t,e.crossSigningVerifiedBefore,e.firstUse)}checkDeviceTrust(e,t,i,n){const r=this.checkUserTrust(e),s=e.keys.self_signing;if(!s)return new g(!1,!1,i,n);const a=function(e,t){return{algorithms:e.algorithms,keys:e.keys,device_id:e.deviceId,user_id:t,signatures:e.signatures}}(t,e.userId);try{return(0,o.pkVerify)(s,e.getId(),e.userId),(0,o.pkVerify)(a,h(s),e.userId),g.fromUserTrustLevel(r,i,n)}catch(e){return new g(!1,!1,i,n)}}getCacheCallbacks(){return this.cacheCallbacks}}let d;t.CrossSigningInfo=u,t.CrossSigningLevel=d,function(e){e[e.MASTER=4]="MASTER",e[e.USER_SIGNING=2]="USER_SIGNING",e[e.SELF_SIGNING=1]="SELF_SIGNING"}(d||(t.CrossSigningLevel=d={}));class p{constructor(e,t,i){this.crossSigningVerified=e,this.crossSigningVerifiedBefore=t,this.tofu=i}isVerified(){return this.isCrossSigningVerified()}isCrossSigningVerified(){return this.crossSigningVerified}wasCrossSigningVerified(){return this.crossSigningVerifiedBefore}isTofu(){return this.tofu}}t.UserTrustLevel=p;class g{constructor(e,t,i,n){this.crossSigningVerified=e,this.tofu=t,this.localVerified=i,this.trustCrossSignedDevices=n}static fromUserTrustLevel(e,t,i){return new g(e.isCrossSigningVerified(),e.isTofu(),t,i)}isVerified(){return Boolean(this.isLocallyVerified()||this.trustCrossSignedDevices&&this.isCrossSigningVerified())}isCrossSigningVerified(){return this.crossSigningVerified}isLocallyVerified(){return this.localVerified}isTofu(){return this.tofu}}t.DeviceTrustLevel=g},6670:(e,t,i)=>{"use strict";var n=i(862),r=i(5318);Object.defineProperty(t,"__esModule",{value:!0}),t.DeviceList=void 0;var s,o=r(i(9713)),a=i(7187),c=i(7434),l=i(3272),h=i(3075),u=n(i(2772)),d=i(7585),p=i(3102);!function(e){e[e.NotTracked=0]="NotTracked",e[e.PendingDownload=1]="PendingDownload",e[e.DownloadInProgress=2]="DownloadInProgress",e[e.UpToDate=3]="UpToDate"}(s||(s={}));class g extends a.EventEmitter{constructor(e,t,i,n=250){super(),this.cryptoStore=t,this.keyDownloadChunkSize=n,(0,o.default)(this,"devices",{}),(0,o.default)(this,"crossSigningInfo",{}),(0,o.default)(this,"userByIdentityKey",{}),(0,o.default)(this,"deviceTrackingStatus",{}),(0,o.default)(this,"syncToken",null),(0,o.default)(this,"keyDownloadsInProgressByUser",{}),(0,o.default)(this,"dirty",!1),(0,o.default)(this,"savePromise",null),(0,o.default)(this,"resolveSavePromise",null),(0,o.default)(this,"savePromiseTime",null),(0,o.default)(this,"saveTimer",null),(0,o.default)(this,"hasFetched",null),(0,o.default)(this,"serialiser",void 0),this.serialiser=new f(e,i,this)}async load(){await this.cryptoStore.doTxn("readonly",[d.IndexedDBCryptoStore.STORE_DEVICE_DATA],(e=>{this.cryptoStore.getEndToEndDeviceData(e,(e=>{this.hasFetched=Boolean(e&&e.devices),this.devices=e?e.devices:{},this.crossSigningInfo=e&&e.crossSigningInfo||{},this.deviceTrackingStatus=e?e.trackingStatus:{},this.syncToken=e?e.syncToken:null,this.userByIdentityKey={};for(const e of Object.keys(this.devices)){const t=this.devices[e];for(const i of Object.keys(t)){const n=t[i].keys["curve25519:"+i];void 0!==n&&(this.userByIdentityKey[n]=e)}}}))}));for(const e of Object.keys(this.deviceTrackingStatus))this.deviceTrackingStatus[e]==s.DownloadInProgress&&(this.deviceTrackingStatus[e]=s.PendingDownload)}stop(){null!==this.saveTimer&&clearTimeout(this.saveTimer)}async saveIfDirty(e=500){if(!this.dirty)return Promise.resolve(!1);const t=Date.now()+e;this.savePromiseTime&&t<this.savePromiseTime&&(clearTimeout(this.saveTimer),this.saveTimer=null,this.savePromiseTime=null);let i=this.savePromise;if(null===i&&(i=new Promise(((e,t)=>{this.resolveSavePromise=e})),this.savePromise=i),null===this.saveTimer){const i=this.resolveSavePromise;this.savePromiseTime=t,this.saveTimer=setTimeout((()=>{c.logger.log("Saving device tracking data",this.syncToken),this.savePromiseTime=null,this.saveTimer=null,this.savePromise=null,this.resolveSavePromise=null,this.cryptoStore.doTxn("readwrite",[d.IndexedDBCryptoStore.STORE_DEVICE_DATA],(e=>{this.cryptoStore.storeEndToEndDeviceData({devices:this.devices,crossSigningInfo:this.crossSigningInfo,trackingStatus:this.deviceTrackingStatus,syncToken:this.syncToken},e)})).then((()=>{this.dirty=!1,i(!0)}),(e=>{c.logger.error("Failed to save device tracking data",this.syncToken),c.logger.error(e)}))}),e)}return i}getSyncToken(){return this.syncToken}setSyncToken(e){this.syncToken=e}downloadKeys(e,t){const i=[],n=[];if(e.forEach((e=>{const r=this.deviceTrackingStatus[e];this.keyDownloadsInProgressByUser[e]?(c.logger.log(`downloadKeys: already have a download in progress for ${e}: awaiting its result`),n.push(this.keyDownloadsInProgressByUser[e])):(t||r!=s.UpToDate)&&i.push(e)})),0!=i.length){c.logger.log("downloadKeys: downloading for",i);const e=this.doKeyDownload(i);n.push(e)}return 0===n.length&&c.logger.log("downloadKeys: already have all necessary keys"),Promise.all(n).then((()=>this.getDevicesFromStore(e)))}getDevicesFromStore(e){const t={};return e.map((e=>{t[e]={},(this.getStoredDevicesForUser(e)||[]).map((function(i){t[e][i.deviceId]=i}))})),t}getKnownUserIds(){return Object.keys(this.devices)}getStoredDevicesForUser(e){const t=this.devices[e];if(!t)return null;const i=[];for(const e in t)t.hasOwnProperty(e)&&i.push(l.DeviceInfo.fromStorage(t[e],e));return i}getRawStoredDevicesForUser(e){return this.devices[e]}getStoredCrossSigningForUser(e){return this.crossSigningInfo[e]?h.CrossSigningInfo.fromStorage(this.crossSigningInfo[e],e):null}storeCrossSigningForUser(e,t){this.crossSigningInfo[e]=t,this.dirty=!0}getStoredDevice(e,t){const i=this.devices[e];if(i&&i[t])return l.DeviceInfo.fromStorage(i[t],t)}getUserByIdentityKey(e,t){return e!==u.OLM_ALGORITHM&&e!==u.MEGOLM_ALGORITHM?null:this.userByIdentityKey[t]}getDeviceByIdentityKey(e,t){const i=this.getUserByIdentityKey(e,t);if(!i)return null;const n=this.devices[i];if(!n)return null;for(const e in n){if(!n.hasOwnProperty(e))continue;const i=n[e];for(const n in i.keys)if(i.keys.hasOwnProperty(n)&&0===n.indexOf("curve25519:")&&i.keys[n]==t)return l.DeviceInfo.fromStorage(i,e)}return null}storeDevicesForUser(e,t){this.setRawStoredDevicesForUser(e,t),this.dirty=!0}startTrackingDeviceList(e){if("string"!=typeof e)throw new Error("userId must be a string; was "+e);this.deviceTrackingStatus[e]||(c.logger.log("Now tracking device list for "+e),this.deviceTrackingStatus[e]=s.PendingDownload,this.dirty=!0)}stopTrackingDeviceList(e){this.deviceTrackingStatus[e]&&(c.logger.log("No longer tracking device list for "+e),this.deviceTrackingStatus[e]=s.NotTracked,this.dirty=!0)}stopTrackingAllDeviceLists(){for(const e of Object.keys(this.deviceTrackingStatus))this.deviceTrackingStatus[e]=s.NotTracked;this.dirty=!0}invalidateUserDeviceList(e){this.deviceTrackingStatus[e]&&(c.logger.log("Marking device list outdated for",e),this.deviceTrackingStatus[e]=s.PendingDownload,this.dirty=!0)}refreshOutdatedDeviceLists(){this.saveIfDirty();const e=[];for(const t of Object.keys(this.deviceTrackingStatus))this.deviceTrackingStatus[t]==s.PendingDownload&&e.push(t);return this.doKeyDownload(e)}setRawStoredDevicesForUser(e,t){if(void 0!==this.devices[e])for(const[t,i]of Object.entries(this.devices[e])){const e=i.keys["curve25519:"+t];delete this.userByIdentityKey[e]}this.devices[e]=t;for(const[i,n]of Object.entries(t)){const t=n.keys["curve25519:"+i];this.userByIdentityKey[t]=e}}setRawStoredCrossSigningForUser(e,t){this.crossSigningInfo[e]=t}doKeyDownload(e){if(0===e.length)return Promise.resolve();const t=this.serialiser.updateDevicesForUsers(e,this.syncToken).then((()=>{i(!0)}),(t=>{throw c.logger.error("Error downloading keys for "+e+":",t),i(!1),t}));e.forEach((e=>{this.keyDownloadsInProgressByUser[e]=t,this.deviceTrackingStatus[e]==s.PendingDownload&&(this.deviceTrackingStatus[e]=s.DownloadInProgress)}));const i=i=>{this.emit("crypto.willUpdateDevices",e,!this.hasFetched),e.forEach((e=>{this.dirty=!0,this.keyDownloadsInProgressByUser[e]===t?(delete this.keyDownloadsInProgressByUser[e],this.deviceTrackingStatus[e]==s.DownloadInProgress&&(i?(this.deviceTrackingStatus[e]=s.UpToDate,c.logger.log("Device list for",e,"now up to date")):this.deviceTrackingStatus[e]=s.PendingDownload)):c.logger.log("Another update in the queue for",e,"- not marking up-to-date")})),this.saveIfDirty(),this.emit("crypto.devicesUpdated",e,!this.hasFetched),this.hasFetched=!0};return t}}t.DeviceList=g;class f{constructor(e,t,i){this.baseApis=e,this.olmDevice=t,this.deviceList=i,(0,o.default)(this,"downloadInProgress",!1),(0,o.default)(this,"keyDownloadsQueuedByUser",{}),(0,o.default)(this,"queuedQueryDeferred",null),(0,o.default)(this,"syncToken",null)}updateDevicesForUsers(e,t){return e.forEach((e=>{this.keyDownloadsQueuedByUser[e]=!0})),this.queuedQueryDeferred||(this.queuedQueryDeferred=(0,p.defer)()),this.syncToken=t,this.downloadInProgress?(c.logger.log("Queued key download for",e),this.queuedQueryDeferred.promise):this.doQueuedQueries()}doQueuedQueries(){if(this.downloadInProgress)throw new Error("DeviceListUpdateSerialiser.doQueuedQueries called with request active");const e=Object.keys(this.keyDownloadsQueuedByUser);this.keyDownloadsQueuedByUser={};const t=this.queuedQueryDeferred;this.queuedQueryDeferred=null,c.logger.log("Starting key download for",e),this.downloadInProgress=!0;const i={};this.syncToken&&(i.token=this.syncToken);const n=[];for(let t=0;t<e.length;t+=this.deviceList.keyDownloadChunkSize){const r=e.slice(t,t+this.deviceList.keyDownloadChunkSize);n.push((()=>this.baseApis.downloadKeysForUsers(r,i)))}return(0,p.chunkPromises)(n,3).then((async t=>{const i=Object.assign({},...t.map((e=>e.device_keys||{}))),n=Object.assign({},...t.map((e=>e.master_keys||{}))),r=Object.assign({},...t.map((e=>e.self_signing_keys||{}))),s=Object.assign({},...t.map((e=>e.user_signing_keys||{})));for(const t of e){await(0,p.sleep)(5);try{await this.processQueryResponseForUser(t,i[t],{master:n[t],self_signing:r[t],user_signing:s[t]})}catch(e){c.logger.error(`Error processing keys for ${t}:`,e)}}})).then((()=>{c.logger.log("Completed key download for "+e),this.downloadInProgress=!1,t.resolve(),this.queuedQueryDeferred&&this.doQueuedQueries()}),(i=>{c.logger.warn("Error downloading keys for "+e+":",i),this.downloadInProgress=!1,t.reject(i)})),t.promise}async processQueryResponseForUser(e,t,i){c.logger.log("got device keys for "+e+":",t),c.logger.log("got cross-signing keys for "+e+":",i);{const i={},n=this.deviceList.getRawStoredDevicesForUser(e);n&&Object.keys(n).forEach((e=>{const t=l.DeviceInfo.fromStorage(n[e],e);i[e]=t})),await async function(e,t,i,n,r,s){let o=!1;for(const e in i)if(i.hasOwnProperty(e)&&!(e in n)){if(t===r&&e===s){c.logger.warn(`Local device ${e} missing from sync, skipping removal`);continue}c.logger.log("Device "+t+":"+e+" has been removed"),delete i[e],o=!0}for(const r in n){if(!n.hasOwnProperty(r))continue;const s=n[r];s.user_id===t?s.device_id===r?await m(e,i,s)&&(o=!0):c.logger.warn("Mismatched device_id "+s.device_id+" in keys from "+t+":"+r):c.logger.warn("Mismatched user_id "+s.user_id+" in keys from "+t+":"+r)}return o}(this.olmDevice,e,i,t||{},this.baseApis.getUserId(),this.baseApis.deviceId);const r={};Object.keys(i).forEach((e=>{r[e]=i[e].toStorage()})),this.deviceList.setRawStoredDevicesForUser(e,r)}if(i&&(i.master||i.self_signing||i.user_signing)){const t=this.deviceList.getStoredCrossSigningForUser(e)||new h.CrossSigningInfo(e);t.setKeys(i),this.deviceList.setRawStoredCrossSigningForUser(e,t.toStorage()),this.deviceList.emit("userCrossSigningUpdated",e)}}}async function m(e,t,i){if(!i.keys)return!1;const n=i.device_id,r=i.user_id,s="ed25519:"+n,o=i.keys[s];if(!o)return c.logger.warn("Device "+r+":"+n+" has no ed25519 key"),!1;const a=i.unsigned||{},h=i.signatures||{};try{await u.verifySignature(e,i,r,n,o)}catch(e){return c.logger.warn("Unable to verify signature on device "+r+":"+n+":"+e),!1}let d;if(n in t){if(d=t[n],d.getFingerprint()!=o)return c.logger.warn("Ed25519 key for device "+r+":"+n+" has changed"),!1}else t[n]=d=new l.DeviceInfo(n);return d.keys=i.keys||{},d.algorithms=i.algorithms||[],d.unsigned=a,d.signatures=h,!0}},636:(e,t,i)=>{"use strict";var n=i(5318);Object.defineProperty(t,"__esModule",{value:!0}),t.EncryptionSetupOperation=t.EncryptionSetupBuilder=void 0;var r=n(i(9713)),s=i(7434),o=i(4369),a=i(7187),c=i(3075),l=i(7585),h=i(7715);t.EncryptionSetupBuilder=class{constructor(e,t){(0,r.default)(this,"accountDataClientAdapter",void 0),(0,r.default)(this,"crossSigningCallbacks",void 0),(0,r.default)(this,"ssssCryptoCallbacks",void 0),(0,r.default)(this,"crossSigningKeys",null),(0,r.default)(this,"keySignatures",null),(0,r.default)(this,"keyBackupInfo",null),(0,r.default)(this,"sessionBackupPrivateKey",void 0),this.accountDataClientAdapter=new d(e),this.crossSigningCallbacks=new p,this.ssssCryptoCallbacks=new g(t)}addCrossSigningKeys(e,t){this.crossSigningKeys={authUpload:e,keys:t}}addSessionBackup(e){this.keyBackupInfo=e}addSessionBackupPrivateKeyToCache(e){this.sessionBackupPrivateKey=e}addKeySignature(e,t,i){this.keySignatures||(this.keySignatures={});const n=this.keySignatures[e]||{};this.keySignatures[e]=n,n[t]=i}setAccountData(e,t){return this.accountDataClientAdapter.setAccountData(e,t)}buildOperation(){const e=this.accountDataClientAdapter.values;return new u(e,this.crossSigningKeys,this.keyBackupInfo,this.keySignatures)}async persist(e){if(this.crossSigningKeys){const t=(0,c.createCryptoStoreCacheCallbacks)(e.cryptoStore,e.olmDevice);for(const e of["master","self_signing","user_signing"]){s.logger.log(`Cache ${e} cross-signing private key locally`);const i=this.crossSigningCallbacks.privateKeys.get(e);await t.storeCrossSigningKeyCache(e,i)}await e.cryptoStore.doTxn("readwrite",[l.IndexedDBCryptoStore.STORE_ACCOUNT],(t=>{e.cryptoStore.storeCrossSigningKeys(t,this.crossSigningKeys.keys)}))}this.sessionBackupPrivateKey&&await e.storeSessionBackupPrivateKey(this.sessionBackupPrivateKey)}};class u{constructor(e,t,i,n){this.accountData=e,this.crossSigningKeys=t,this.keyBackupInfo=i,this.keySignatures=n}async apply(e){const t=e.baseApis;if(this.crossSigningKeys){const i={};for(const[e,t]of Object.entries(this.crossSigningKeys.keys))i[e+"_key"]=t;await this.crossSigningKeys.authUpload((e=>t.uploadDeviceSigningKeys(e,i))),e.crossSigningInfo.setKeys(this.crossSigningKeys.keys)}if(this.accountData)for(const[e,i]of this.accountData)await t.setAccountData(e,i);this.keySignatures&&await t.uploadKeySignatures(this.keySignatures),this.keyBackupInfo&&(this.keyBackupInfo.version?await t.http.authedRequest(void 0,"PUT","/room_keys/version/"+this.keyBackupInfo.version,void 0,{algorithm:this.keyBackupInfo.algorithm,auth_data:this.keyBackupInfo.auth_data},{prefix:h.PREFIX_UNSTABLE}):await t.http.authedRequest(void 0,"POST","/room_keys/version",void 0,this.keyBackupInfo,{prefix:h.PREFIX_UNSTABLE}))}}t.EncryptionSetupOperation=u;class d extends a.EventEmitter{constructor(e){super(),this.existingValues=e,(0,r.default)(this,"values",new Map)}getAccountDataFromServer(e){return Promise.resolve(this.getAccountData(e))}getAccountData(e){const t=this.values.get(e);if(t)return t;const i=this.existingValues[e];return i?i.getContent():null}setAccountData(e,t){const i=this.values.get(e);return this.values.set(e,t),Promise.resolve().then((()=>{const n=new o.MatrixEvent({type:e,content:t});this.emit("accountData",n,i)}))}}class p{constructor(){(0,r.default)(this,"privateKeys",new Map)}getCrossSigningKeyCache(e,t){return this.getCrossSigningKey(e,t)}storeCrossSigningKeyCache(e,t){return this.privateKeys.set(e,t),Promise.resolve()}getCrossSigningKey(e,t){return Promise.resolve(this.privateKeys.get(e))}saveCrossSigningKeys(e){for(const[t,i]of Object.entries(e))this.privateKeys.set(t,i)}}class g{constructor(e){this.delegateCryptoCallbacks=e,(0,r.default)(this,"privateKeys",new Map)}async getSecretStorageKey({keys:e},t){for(const t of Object.keys(e)){const e=this.privateKeys.get(t);if(e)return[t,e]}if(this.delegateCryptoCallbacks){const i=await this.delegateCryptoCallbacks.getSecretStorageKey({keys:e},t);if(i){const[e,t]=i;this.privateKeys.set(e,t)}return i}}addPrivateKey(e,t,i){var n,r;this.privateKeys.set(e,i),null===(n=this.delegateCryptoCallbacks)||void 0===n||null===(r=n.cacheSecretStorageKey)||void 0===r||r.call(n,e,t,i)}}},2573:(e,t,i)=>{"use strict";var n=i(862);Object.defineProperty(t,"__esModule",{value:!0}),t.OlmDevice=c,t.WITHHELD_MESSAGES=void 0;var r=i(7434),s=i(7585),o=n(i(1994));function a(e){if(void 0===e)throw new Error("payloadString undefined");if(e.length>49152){const t=new Error("Message too long ("+e.length+" bytes). The maximum for an encrypted message is 49152 bytes.");throw t.data={errcode:"M_TOO_LARGE",error:"Payload too large for encrypted message"},t}}function c(e){this._cryptoStore=e,this._pickleKey="DEFAULT_KEY",this.deviceCurve25519Key=null,this.deviceEd25519Key=null,this._maxOneTimeKeys=null,this._outboundGroupSessionStore={},this._inboundGroupSessionMessageIndexes={},this._sessionsInProgress={},this._olmPrekeyPromise=Promise.resolve()}c.prototype.init=async function(e={}){let t;const n=new i.g.Olm.Account,{pickleKey:o,fromExportedDevice:a}=e;try{a?(o&&r.logger.warn("ignoring opts.pickleKey because opts.fromExportedDevice is present."),this._pickleKey=a.pickleKey,await async function(e,t,i,n){await t.doTxn("readwrite",[s.IndexedDBCryptoStore.STORE_ACCOUNT,s.IndexedDBCryptoStore.STORE_SESSIONS],(i=>{t.storeAccount(i,e.pickledAccount),e.sessions.forEach((e=>{const{deviceKey:n,sessionId:r}=e,s={session:e.session,lastReceivedMessageTs:e.lastReceivedMessageTs};t.storeEndToEndSession(n,r,s,i)}))})),n.unpickle(i,e.pickledAccount)}(a,this._cryptoStore,this._pickleKey,n)):(o&&(this._pickleKey=o),await async function(e,t,i){await e.doTxn("readwrite",[s.IndexedDBCryptoStore.STORE_ACCOUNT],(n=>{e.getAccount(n,(r=>{null!==r?i.unpickle(t,r):(i.create(),r=i.pickle(t),e.storeAccount(n,r))}))}))}(this._cryptoStore,this._pickleKey,n)),t=JSON.parse(n.identity_keys()),this._maxOneTimeKeys=n.max_number_of_one_time_keys()}finally{n.free()}this.deviceCurve25519Key=t.curve25519,this.deviceEd25519Key=t.ed25519},c.getOlmVersion=function(){return i.g.Olm.get_library_version()},c.prototype._getAccount=function(e,t){this._cryptoStore.getAccount(e,(e=>{const n=new i.g.Olm.Account;try{n.unpickle(this._pickleKey,e),t(n)}finally{n.free()}}))},c.prototype._storeAccount=function(e,t){this._cryptoStore.storeAccount(e,t.pickle(this._pickleKey))},c.prototype.export=async function(){const e={pickleKey:this._pickleKey};return await this._cryptoStore.doTxn("readonly",[s.IndexedDBCryptoStore.STORE_ACCOUNT,s.IndexedDBCryptoStore.STORE_SESSIONS],(t=>{this._cryptoStore.getAccount(t,(t=>{e.pickledAccount=t})),e.sessions=[],this._cryptoStore.getAllEndToEndSessions(t,(t=>{e.sessions.push(t)}))})),e},c.prototype._getSession=function(e,t,i,n){this._cryptoStore.getEndToEndSession(e,t,i,(e=>{this._unpickleSession(e,n)}))},c.prototype._unpickleSession=function(e,t){const n=new i.g.Olm.Session;try{n.unpickle(this._pickleKey,e.session),t(Object.assign({},e,{session:n}))}finally{n.free()}},c.prototype._saveSession=function(e,t,i){const n=t.session.session_id(),r=Object.assign(t,{session:t.session.pickle(this._pickleKey)});this._cryptoStore.storeEndToEndSession(e,n,r,i)},c.prototype._getUtility=function(e){const t=new i.g.Olm.Utility;try{return e(t)}finally{t.free()}},c.prototype.sign=async function(e){let t;return await this._cryptoStore.doTxn("readonly",[s.IndexedDBCryptoStore.STORE_ACCOUNT],(i=>{this._getAccount(i,(i=>{t=i.sign(e)}))})),t},c.prototype.getOneTimeKeys=async function(){let e;return await this._cryptoStore.doTxn("readonly",[s.IndexedDBCryptoStore.STORE_ACCOUNT],(t=>{this._getAccount(t,(t=>{e=JSON.parse(t.one_time_keys())}))})),e},c.prototype.maxNumberOfOneTimeKeys=function(){return this._maxOneTimeKeys},c.prototype.markKeysAsPublished=async function(){await this._cryptoStore.doTxn("readwrite",[s.IndexedDBCryptoStore.STORE_ACCOUNT],(e=>{this._getAccount(e,(t=>{t.mark_keys_as_published(),this._storeAccount(e,t)}))}))},c.prototype.generateOneTimeKeys=function(e){return this._cryptoStore.doTxn("readwrite",[s.IndexedDBCryptoStore.STORE_ACCOUNT],(t=>{this._getAccount(t,(i=>{i.generate_one_time_keys(e),this._storeAccount(t,i)}))}))},c.prototype.generateFallbackKey=async function(){await this._cryptoStore.doTxn("readwrite",[s.IndexedDBCryptoStore.STORE_ACCOUNT],(e=>{this._getAccount(e,(t=>{t.generate_fallback_key(),this._storeAccount(e,t)}))}))},c.prototype.getFallbackKey=async function(){let e;return await this._cryptoStore.doTxn("readonly",[s.IndexedDBCryptoStore.STORE_ACCOUNT],(t=>{this._getAccount(t,(t=>{e=JSON.parse(t.fallback_key())}))})),e},c.prototype.createOutboundSession=async function(e,t){let n;return await this._cryptoStore.doTxn("readwrite",[s.IndexedDBCryptoStore.STORE_ACCOUNT,s.IndexedDBCryptoStore.STORE_SESSIONS],(r=>{this._getAccount(r,(s=>{const o=new i.g.Olm.Session;try{o.create_outbound(s,e,t),n=o.session_id(),this._storeAccount(r,s);const i={session:o,lastReceivedMessageTs:Date.now()};this._saveSession(e,i,r)}finally{o.free()}}))}),r.logger.withPrefix("[createOutboundSession]")),n},c.prototype.createInboundSession=async function(e,t,n){if(0!==t)throw new Error("Need messageType == 0 to create inbound session");let o;return await this._cryptoStore.doTxn("readwrite",[s.IndexedDBCryptoStore.STORE_ACCOUNT,s.IndexedDBCryptoStore.STORE_SESSIONS],(r=>{this._getAccount(r,(s=>{const a=new i.g.Olm.Session;try{a.create_inbound_from(s,e,n),s.remove_one_time_keys(a),this._storeAccount(r,s);const i=a.decrypt(t,n),c={session:a,lastReceivedMessageTs:Date.now()};this._saveSession(e,c,r),o={payload:i,session_id:a.session_id()}}finally{a.free()}}))}),r.logger.withPrefix("[createInboundSession]")),o},c.prototype.getSessionIdsForDevice=async function(e){const t=r.logger.withPrefix("[getSessionIdsForDevice]");if(this._sessionsInProgress[e]){t.debug(`Waiting for Olm session for ${e} to be created`);try{await this._sessionsInProgress[e]}catch(e){}}let i;return await this._cryptoStore.doTxn("readonly",[s.IndexedDBCryptoStore.STORE_SESSIONS],(t=>{this._cryptoStore.getEndToEndSessions(e,t,(e=>{i=Object.keys(e)}))}),t),i},c.prototype.getSessionIdForDevice=async function(e,t,i){const n=await this.getSessionInfoForDevice(e,t,i);if(0===n.length)return null;let r=0;for(let e=1;e<n.length;e++){const t=n[e],i=void 0===t.lastReceivedMessageTs?0:t.lastReceivedMessageTs,s=n[r],o=void 0===s.lastReceivedMessageTs?0:s.lastReceivedMessageTs;(i>o||i===o&&t.sessionId<s.sessionId)&&(r=e)}return n[r].sessionId},c.prototype.getSessionInfoForDevice=async function(e,t,i=r.logger){if(i=i.withPrefix("[getSessionInfoForDevice]"),this._sessionsInProgress[e]&&!t){i.debug(`Waiting for Olm session for ${e} to be created`);try{await this._sessionsInProgress[e]}catch(e){}}const n=[];return await this._cryptoStore.doTxn("readonly",[s.IndexedDBCryptoStore.STORE_SESSIONS],(t=>{this._cryptoStore.getEndToEndSessions(e,t,(e=>{const t=Object.keys(e).sort();for(const i of t)this._unpickleSession(e[i],(e=>{n.push({lastReceivedMessageTs:e.lastReceivedMessageTs,hasReceivedMessage:e.session.has_received_message(),sessionId:i})}))}))}),i),n},c.prototype.encryptMessage=async function(e,t,i){let n;return a(i),await this._cryptoStore.doTxn("readwrite",[s.IndexedDBCryptoStore.STORE_SESSIONS],(s=>{this._getSession(e,t,s,(o=>{const a=o.session.describe();r.logger.log("encryptMessage: Olm Session ID "+t+" to "+e+": "+a),n=o.session.encrypt(i),this._saveSession(e,o,s)}))}),r.logger.withPrefix("[encryptMessage]")),n},c.prototype.decryptMessage=async function(e,t,i,n){let o;return await this._cryptoStore.doTxn("readwrite",[s.IndexedDBCryptoStore.STORE_SESSIONS],(s=>{this._getSession(e,t,s,(a=>{const c=a.session.describe();r.logger.log("decryptMessage: Olm Session ID "+t+" from "+e+": "+c),o=a.session.decrypt(i,n),a.lastReceivedMessageTs=Date.now(),this._saveSession(e,a,s)}))}),r.logger.withPrefix("[decryptMessage]")),o},c.prototype.matchesSession=async function(e,t,i,n){if(0!==i)return!1;let o;return await this._cryptoStore.doTxn("readonly",[s.IndexedDBCryptoStore.STORE_SESSIONS],(i=>{this._getSession(e,t,i,(e=>{o=e.session.matches_inbound(n)}))}),r.logger.withPrefix("[matchesSession]")),o},c.prototype.recordSessionProblem=async function(e,t,i){await this._cryptoStore.storeEndToEndSessionProblem(e,t,i)},c.prototype.sessionMayHaveProblems=async function(e,t){return await this._cryptoStore.getEndToEndSessionProblem(e,t)},c.prototype.filterOutNotifiedErrorDevices=async function(e){return await this._cryptoStore.filterOutNotifiedErrorDevices(e)},c.prototype._saveOutboundGroupSession=function(e){const t=e.pickle(this._pickleKey);this._outboundGroupSessionStore[e.session_id()]=t},c.prototype._getOutboundGroupSession=function(e,t){const n=this._outboundGroupSessionStore[e];if(void 0===n)throw new Error("Unknown outbound group session "+e);const r=new i.g.Olm.OutboundGroupSession;try{return r.unpickle(this._pickleKey,n),t(r)}finally{r.free()}},c.prototype.createOutboundGroupSession=function(){const e=new i.g.Olm.OutboundGroupSession;try{return e.create(),this._saveOutboundGroupSession(e),e.session_id()}finally{e.free()}},c.prototype.encryptGroupMessage=function(e,t){const i=this;return r.logger.log(`encrypting msg with megolm session ${e}`),a(t),this._getOutboundGroupSession(e,(function(e){const n=e.encrypt(t);return i._saveOutboundGroupSession(e),n}))},c.prototype.getOutboundGroupSessionKey=function(e){return this._getOutboundGroupSession(e,(function(e){return{chain_index:e.message_index(),key:e.session_key()}}))},c.prototype._unpickleInboundGroupSession=function(e,t){const n=new i.g.Olm.InboundGroupSession;try{return n.unpickle(this._pickleKey,e.session),t(n)}finally{n.free()}},c.prototype._getInboundGroupSession=function(e,t,i,n,r){this._cryptoStore.getEndToEndInboundGroupSession(t,i,n,((t,i)=>{if(null!==t){if(null!==e&&e!==t.room_id)throw new Error("Mismatched room_id for inbound group session (expected "+t.room_id+", was "+e+")");this._unpickleInboundGroupSession(t,(e=>{r(e,t,i)}))}else r(null,null,i)}))},c.prototype.addInboundGroupSession=async function(e,t,n,o,a,c,l,h={}){await this._cryptoStore.doTxn("readwrite",[s.IndexedDBCryptoStore.STORE_INBOUND_GROUP_SESSIONS,s.IndexedDBCryptoStore.STORE_INBOUND_GROUP_SESSIONS_WITHHELD,s.IndexedDBCryptoStore.STORE_SHARED_HISTORY_INBOUND_GROUP_SESSIONS],(s=>{this._getInboundGroupSession(e,t,o,s,((u,d)=>{const p=new i.g.Olm.InboundGroupSession;try{if(l?p.import_session(a):p.create(a),o!=p.session_id())throw new Error("Mismatched group session ID from senderKey: "+t);if(u&&(r.logger.log("Update for megolm session "+t+"/"+o),u.first_known_index()<=p.first_known_index()&&(u.first_known_index()!=p.first_known_index()||h.untrusted||!d.untrusted)))return void r.logger.log(`Keeping existing megolm session ${o}`);r.logger.info("Storing megolm session "+t+"/"+o+" with first index "+p.first_known_index());const i=Object.assign({},h,{room_id:e,session:p.pickle(this._pickleKey),keysClaimed:c,forwardingCurve25519KeyChain:n});this._cryptoStore.storeEndToEndInboundGroupSession(t,o,i,s),!u&&h.sharedHistory&&this._cryptoStore.addSharedHistoryInboundGroupSession(e,t,o,s)}finally{p.free()}}))}),r.logger.withPrefix("[addInboundGroupSession]"))},c.prototype.addInboundGroupSessionWithheld=async function(e,t,i,n,r){await this._cryptoStore.doTxn("readwrite",[s.IndexedDBCryptoStore.STORE_INBOUND_GROUP_SESSIONS_WITHHELD],(s=>{this._cryptoStore.storeEndToEndInboundGroupSessionWithheld(t,i,{room_id:e,code:n,reason:r},s)}))};const l={"m.unverified":"The sender has disabled encrypting to unverified devices.","m.blacklisted":"The sender has blocked you.","m.unauthorised":"You are not authorised to read the message.","m.no_olm":"Unable to establish a secure channel."};function h(e){return e.code&&e.code in l?l[e.code]:e.reason?e.reason:"decryption key withheld"}t.WITHHELD_MESSAGES=l,c.prototype.decryptGroupMessage=async function(e,t,i,n,a,c){let l,u;if(await this._cryptoStore.doTxn("readwrite",[s.IndexedDBCryptoStore.STORE_INBOUND_GROUP_SESSIONS,s.IndexedDBCryptoStore.STORE_INBOUND_GROUP_SESSIONS_WITHHELD],(r=>{this._getInboundGroupSession(e,t,i,r,((e,s,d)=>{if(null===e)return d&&(u=new o.DecryptionError("MEGOLM_UNKNOWN_INBOUND_SESSION_ID",h(d),{session:t+"|"+i})),void(l=null);let p;try{p=e.decrypt(n)}catch(e){return void(u=e&&"OLM.UNKNOWN_MESSAGE_INDEX"===e.message&&d?new o.DecryptionError("MEGOLM_UNKNOWN_INBOUND_SESSION_ID",h(d),{session:t+"|"+i}):e)}let g=p.plaintext;if(void 0===g)g=p;else{const e=t+"|"+i+"|"+p.message_index;if(e in this._inboundGroupSessionMessageIndexes){const t=this._inboundGroupSessionMessageIndexes[e];if(t.id!==a||t.timestamp!==c)return void(u=new Error("Duplicate message index, possible replay attack: "+e))}this._inboundGroupSessionMessageIndexes[e]={id:a,timestamp:c}}s.session=e.pickle(this._pickleKey),this._cryptoStore.storeEndToEndInboundGroupSession(t,i,s,r),l={result:g,keysClaimed:s.keysClaimed||{},senderKey:t,forwardingCurve25519KeyChain:s.forwardingCurve25519KeyChain||[],untrusted:s.untrusted}}))}),r.logger.withPrefix("[decryptGroupMessage]")),u)throw u;return l},c.prototype.hasInboundSessionKeys=async function(e,t,i){let n;return await this._cryptoStore.doTxn("readonly",[s.IndexedDBCryptoStore.STORE_INBOUND_GROUP_SESSIONS,s.IndexedDBCryptoStore.STORE_INBOUND_GROUP_SESSIONS_WITHHELD],(s=>{this._cryptoStore.getEndToEndInboundGroupSession(t,i,s,(s=>{null!==s?e!==s.room_id?(r.logger.warn(`requested keys for inbound group session ${t}|${i}, with incorrect room_id (expected ${s.room_id}, was ${e})`),n=!1):n=!0:n=!1}))}),r.logger.withPrefix("[hasInboundSessionKeys]")),n},c.prototype.getInboundGroupSessionKey=async function(e,t,i,n){let o;return await this._cryptoStore.doTxn("readonly",[s.IndexedDBCryptoStore.STORE_INBOUND_GROUP_SESSIONS,s.IndexedDBCryptoStore.STORE_INBOUND_GROUP_SESSIONS_WITHHELD],(r=>{this._getInboundGroupSession(e,t,i,r,((e,t)=>{if(null===e)return void(o=null);void 0===n&&(n=e.first_known_index());const i=e.export_session(n),r=(t.keysClaimed||{}).ed25519||null;o={chain_index:n,key:i,forwarding_curve25519_key_chain:t.forwardingCurve25519KeyChain||[],sender_claimed_ed25519_key:r,shared_history:t.sharedHistory||!1}}))}),r.logger.withPrefix("[getInboundGroupSessionKey]")),o},c.prototype.exportInboundGroupSession=function(e,t,i){return this._unpickleInboundGroupSession(i,(n=>{const r=n.first_known_index();return{sender_key:e,sender_claimed_keys:i.keysClaimed,room_id:i.room_id,session_id:t,session_key:n.export_session(r),forwarding_curve25519_key_chain:n.forwardingCurve25519KeyChain||[],first_known_index:n.first_known_index(),"org.matrix.msc3061.shared_history":i.sharedHistory||!1}}))},c.prototype.getSharedHistoryInboundGroupSessions=async function(e){let t;return await this._cryptoStore.doTxn("readonly",[s.IndexedDBCryptoStore.STORE_SHARED_HISTORY_INBOUND_GROUP_SESSIONS],(i=>{t=this._cryptoStore.getSharedHistoryInboundGroupSessions(e,i)}),r.logger.withPrefix("[getSharedHistoryInboundGroupSessionsForRoom]")),t},c.prototype.verifySignature=function(e,t,i){this._getUtility((function(n){n.ed25519_verify(e,t,i)}))}},6617:(e,t,i)=>{"use strict";var n=i(5318);Object.defineProperty(t,"__esModule",{value:!0}),t.OutgoingRoomKeyRequestManager=t.RoomKeyRequestState=void 0;var r=n(i(9713)),s=i(7434),o=i(2481);let a;function c(e){return e.room_id+" / "+e.session_id}function l(e){return"["+e.map((e=>`${e.userId}:${e.deviceId}`)).join(",")+"]"}t.RoomKeyRequestState=a,function(e){e[e.Unsent=0]="Unsent",e[e.Sent=1]="Sent",e[e.CancellationPending=2]="CancellationPending",e[e.CancellationPendingAndWillResend=3]="CancellationPendingAndWillResend"}(a||(t.RoomKeyRequestState=a={})),t.OutgoingRoomKeyRequestManager=class{constructor(e,t,i){this.baseApis=e,this.deviceId=t,this.cryptoStore=i,(0,r.default)(this,"sendOutgoingRoomKeyRequestsTimer",null),(0,r.default)(this,"sendOutgoingRoomKeyRequestsRunning",!1),(0,r.default)(this,"clientRunning",!1)}start(){this.clientRunning=!0}stop(){s.logger.log("stopping OutgoingRoomKeyRequestManager"),this.clientRunning=!1}sendQueuedRequests(){this.startTimer()}async queueRoomKeyRequest(e,t,i=!1){const n=await this.cryptoStore.getOutgoingRoomKeyRequest(e);if(n)switch(n.state){case a.CancellationPendingAndWillResend:case a.Unsent:return;case a.CancellationPending:{const e=i?a.CancellationPendingAndWillResend:a.Sent;await this.cryptoStore.updateOutgoingRoomKeyRequest(n.requestId,a.CancellationPending,{state:e,cancellationTxnId:this.baseApis.makeTxnId()});break}case a.Sent:if(i){const r=a.CancellationPendingAndWillResend,o=await this.cryptoStore.updateOutgoingRoomKeyRequest(n.requestId,a.Sent,{state:r,cancellationTxnId:this.baseApis.makeTxnId(),requestTxnId:this.baseApis.makeTxnId()});if(!o)return await this.queueRoomKeyRequest(e,t,i);try{await this.sendOutgoingRoomKeyRequestCancellation(o,!0)}catch(e){s.logger.error("Error sending room key request cancellation; will retry later.",e)}}break;default:throw new Error("unhandled state: "+n.state)}else await this.cryptoStore.getOrAddOutgoingRoomKeyRequest({requestBody:e,recipients:t,requestId:this.baseApis.makeTxnId(),state:a.Unsent})}cancelRoomKeyRequest(e){return this.cryptoStore.getOutgoingRoomKeyRequest(e).then((t=>{if(t)switch(t.state){case a.CancellationPending:case a.CancellationPendingAndWillResend:return;case a.Unsent:return s.logger.log("deleting unnecessary room key request for "+c(e)),this.cryptoStore.deleteOutgoingRoomKeyRequest(t.requestId,a.Unsent);case a.Sent:return this.cryptoStore.updateOutgoingRoomKeyRequest(t.requestId,a.Sent,{state:a.CancellationPending,cancellationTxnId:this.baseApis.makeTxnId()}).then((t=>{t?this.sendOutgoingRoomKeyRequestCancellation(t).catch((e=>{s.logger.error("Error sending room key request cancellation; will retry later.",e),this.startTimer()})):s.logger.log("Tried to cancel room key request for "+c(e)+" but it was already cancelled in another tab")}));default:throw new Error("unhandled state: "+t.state)}}))}getOutgoingSentRoomKeyRequest(e,t){return this.cryptoStore.getOutgoingRoomKeyRequestsByTarget(e,t,[a.Sent])}async cancelAndResendAllOutgoingRequests(){const e=await this.cryptoStore.getAllOutgoingRoomKeyRequestsByState(a.Sent);return Promise.all(e.map((({requestBody:e,recipients:t})=>this.queueRoomKeyRequest(e,t,!0))))}startTimer(){this.sendOutgoingRoomKeyRequestsTimer||(this.sendOutgoingRoomKeyRequestsTimer=i.g.setTimeout((()=>{if(this.sendOutgoingRoomKeyRequestsRunning)throw new Error("RoomKeyRequestSend already in progress!");this.sendOutgoingRoomKeyRequestsRunning=!0,this.sendOutgoingRoomKeyRequests().finally((()=>{this.sendOutgoingRoomKeyRequestsRunning=!1})).catch((e=>{s.logger.warn(`error in OutgoingRoomKeyRequestManager: ${e}`)}))}),500))}sendOutgoingRoomKeyRequests(){return this.clientRunning?this.cryptoStore.getOutgoingRoomKeyRequestByState([a.CancellationPending,a.CancellationPendingAndWillResend,a.Unsent]).then((e=>{if(!e)return void(this.sendOutgoingRoomKeyRequestsTimer=null);let t;switch(e.state){case a.Unsent:t=this.sendOutgoingRoomKeyRequest(e);break;case a.CancellationPending:t=this.sendOutgoingRoomKeyRequestCancellation(e);break;case a.CancellationPendingAndWillResend:t=this.sendOutgoingRoomKeyRequestCancellation(e,!0)}return t.then((()=>this.sendOutgoingRoomKeyRequests())).catch((e=>{s.logger.error("Error sending room key request; will retry later.",e),this.sendOutgoingRoomKeyRequestsTimer=null}))})):(this.sendOutgoingRoomKeyRequestsTimer=null,Promise.resolve())}sendOutgoingRoomKeyRequest(e){s.logger.log(`Requesting keys for ${c(e.requestBody)} from ${l(e.recipients)}(id ${e.requestId})`);const t={action:"request",requesting_device_id:this.deviceId,request_id:e.requestId,body:e.requestBody};return this.sendMessageToDevices(t,e.recipients,e.requestTxnId||e.requestId).then((()=>this.cryptoStore.updateOutgoingRoomKeyRequest(e.requestId,a.Unsent,{state:a.Sent})))}sendOutgoingRoomKeyRequestCancellation(e,t=!1){s.logger.log(`Sending cancellation for key request for ${c(e.requestBody)} to ${l(e.recipients)} (cancellation id ${e.cancellationTxnId})`);const i={action:"request_cancellation",requesting_device_id:this.deviceId,request_id:e.requestId};return this.sendMessageToDevices(i,e.recipients,e.cancellationTxnId).then((()=>t?this.cryptoStore.updateOutgoingRoomKeyRequest(e.requestId,a.CancellationPendingAndWillResend,{state:a.Unsent}):this.cryptoStore.deleteOutgoingRoomKeyRequest(e.requestId,a.CancellationPending)))}sendMessageToDevices(e,t,i){const n={};for(const i of t)n[i.userId]||(n[i.userId]={}),n[i.userId][i.deviceId]=e;return this.baseApis.sendToDevice(o.EventType.RoomKeyRequest,n,i)}}},635:(e,t,i)=>{"use strict";var n=i(5318);Object.defineProperty(t,"__esModule",{value:!0}),t.RoomList=void 0;var r=n(i(9713)),s=i(7585);t.RoomList=class{constructor(e){this.cryptoStore=e,(0,r.default)(this,"roomEncryption",{})}async init(){await this.cryptoStore.doTxn("readwrite",[s.IndexedDBCryptoStore.STORE_ROOMS],(e=>{this.cryptoStore.getEndToEndRooms(e,(e=>{this.roomEncryption=e}))}))}getRoomEncryption(e){return this.roomEncryption[e]||null}isRoomEncrypted(e){return Boolean(this.getRoomEncryption(e))}async setRoomEncryption(e,t){this.roomEncryption[e]=t,await this.cryptoStore.doTxn("readwrite",[s.IndexedDBCryptoStore.STORE_ROOMS],(i=>{this.cryptoStore.storeEndToEndRoom(e,t,i)}))}}},4823:(e,t,i)=>{"use strict";var n=i(862),r=i(5318);Object.defineProperty(t,"__esModule",{value:!0}),t.SecretStorage=t.SECRET_STORAGE_ALGORITHM_V1_AES=void 0;var s=r(i(9713)),o=i(7434),a=n(i(2772)),c=i(8401),l=i(2611);const h="m.secret_storage.v1.aes-hmac-sha2";t.SECRET_STORAGE_ALGORITHM_V1_AES=h,t.SecretStorage=class{constructor(e,t,i){this.accountDataAdapter=e,this.cryptoCallbacks=t,this.baseApis=i,(0,s.default)(this,"requests",new Map)}async getDefaultKeyId(){const e=await this.accountDataAdapter.getAccountDataFromServer("m.secret_storage.default_key");return e?e.key:null}setDefaultKeyId(e){return new Promise(((t,i)=>{const n=i=>{"m.secret_storage.default_key"===i.getType()&&i.getContent().key===e&&(this.accountDataAdapter.removeListener("accountData",n),t())};this.accountDataAdapter.on("accountData",n),this.accountDataAdapter.setAccountData("m.secret_storage.default_key",{key:e}).catch((e=>{this.accountDataAdapter.removeListener("accountData",n),i(e)}))}))}async addKey(e,t,i){const n={algorithm:e};if(t||(t={}),t.name&&(n.name=t.name),e!==h)throw new Error(`Unknown key algorithm ${e}`);if(t.passphrase&&(n.passphrase=t.passphrase),t.key){const{iv:e,mac:i}=await(0,l.calculateKeyCheck)(t.key);n.iv=e,n.mac=i}if(!i)do{i=(0,c.randomString)(32)}while(await this.accountDataAdapter.getAccountDataFromServer(`m.secret_storage.key.${i}`));return await this.accountDataAdapter.setAccountData(`m.secret_storage.key.${i}`,n),{keyId:i,keyInfo:n}}async getKey(e){if(e||(e=await this.getDefaultKeyId()),!e)return null;const t=await this.accountDataAdapter.getAccountDataFromServer("m.secret_storage.key."+e);return t?[e,t]:null}async hasKey(e){return Boolean(await this.getKey(e))}async checkKey(e,t){if(t.algorithm===h){if(t.mac){const{mac:i}=await(0,l.calculateKeyCheck)(e,t.iv);return t.mac.replace(/=+$/g,"")===i.replace(/=+$/g,"")}return!0}throw new Error("Unknown algorithm")}async store(e,t,i){const n={};if(!i){const e=await this.getDefaultKeyId();if(!e)throw new Error("No keys specified and no default key present");i=[e]}if(0===i.length)throw new Error("Zero keys given to encrypt with!");for(const r of i){const i=await this.accountDataAdapter.getAccountDataFromServer("m.secret_storage.key."+r);if(!i)throw new Error("Unknown key: "+r);if(i.algorithm===h){const s={[r]:i},[,o]=await this.getSecretStorageKey(s,e);n[r]=await o.encrypt(t)}else o.logger.warn("unknown algorithm for secret storage key "+r+": "+i.algorithm)}await this.accountDataAdapter.setAccountData(e,{encrypted:n})}async get(e){const t=await this.accountDataAdapter.getAccountDataFromServer(e);if(!t)return;if(!t.encrypted)throw new Error("Content is not encrypted!");const i={};for(const e of Object.keys(t.encrypted)){const n=await this.accountDataAdapter.getAccountDataFromServer("m.secret_storage.key."+e),r=t.encrypted[e];n.algorithm===h&&r.iv&&r.ciphertext&&r.mac&&(i[e]=n)}if(0===Object.keys(i).length)throw new Error(`Could not decrypt ${e} because none of the keys it is encrypted with are for a supported algorithm`);let n,r;try{[n,r]=await this.getSecretStorageKey(i,e);const s=t.encrypted[n];return s.passthrough?(0,a.encodeBase64)(r.get_private_key()):await r.decrypt(s)}finally{r&&r.free&&r.free()}}async isStored(e,t){const i=await this.accountDataAdapter.getAccountDataFromServer(e);if(!i)return null;if(!i.encrypted)return null;void 0===t&&(t=!0);const n={};for(const e of Object.keys(i.encrypted)){const t=await this.accountDataAdapter.getAccountDataFromServer("m.secret_storage.key."+e);if(!t)continue;const r=i.encrypted[e];t.algorithm===h&&r.iv&&r.ciphertext&&r.mac&&(n[e]=t)}return Object.keys(n).length?n:null}request(e,t){const i=this.baseApis.makeTxnId();let n,r;const s=new Promise(((e,t)=>{n=e,r=t}));this.requests.set(i,{name:e,devices:t,resolve:n,reject:r});const a={name:e,action:"request",requesting_device_id:this.baseApis.deviceId,request_id:i},c={};for(const e of t)c[e]=a;return o.logger.info(`Request secret ${e} from ${t}, id ${i}`),this.baseApis.sendToDevice("m.secret.request",{[this.baseApis.getUserId()]:c}),{requestId:i,promise:s,cancel:e=>{const n={action:"request_cancellation",requesting_device_id:this.baseApis.deviceId,request_id:i},s={};for(const e of t)s[e]=n;this.baseApis.sendToDevice("m.secret.request",{[this.baseApis.getUserId()]:s}),r(new Error(e||"Cancelled"))}}}async onRequestReceived(e){const t=e.getSender(),i=e.getContent();if(t!==this.baseApis.getUserId()||!(i.name&&i.action&&i.requesting_device_id&&i.request_id))return;const n=i.requesting_device_id;if("request_cancellation"===i.action);else if("request"===i.action){if(n===this.baseApis.deviceId)return;if(o.logger.info("received request for secret ("+t+", "+n+", "+i.request_id+")"),!this.cryptoCallbacks.onSecretRequested)return;const e=await this.cryptoCallbacks.onSecretRequested(t,n,i.request_id,i.name,this.baseApis.checkDeviceTrust(t,n));if(e){o.logger.info(`Preparing ${i.name} secret for ${n}`);const r={type:"m.secret.send",content:{request_id:i.request_id,secret:e}},s={algorithm:a.OLM_ALGORITHM,sender_key:this.baseApis.crypto.olmDevice.deviceCurve25519Key,ciphertext:{}};await a.ensureOlmSessionsForDevices(this.baseApis.crypto.olmDevice,this.baseApis,{[t]:[this.baseApis.getStoredDevice(t,n)]}),await a.encryptMessageForDevice(s.ciphertext,this.baseApis.getUserId(),this.baseApis.deviceId,this.baseApis.crypto.olmDevice,t,this.baseApis.getStoredDevice(t,n),r);const c={[t]:{[n]:s}};o.logger.info(`Sending ${i.name} secret for ${n}`),this.baseApis.sendToDevice("m.room.encrypted",c)}else o.logger.info(`Request denied for ${i.name} secret for ${n}`)}}onSecretReceived(e){if(e.getSender()!==this.baseApis.getUserId())return;const t=e.getContent();o.logger.log("got secret share for request",t.request_id);const i=this.requests.get(t.request_id);if(i){const n=this.baseApis.crypto.deviceList.getDeviceByIdentityKey(a.OLM_ALGORITHM,e.getSenderKey());if(!n)return void o.logger.log("secret share from unknown device with key",e.getSenderKey());if(!i.devices.includes(n.deviceId))return void o.logger.log("unsolicited secret share from device",n.deviceId);o.logger.log(`Successfully received secret ${i.name} from ${n.deviceId}`),i.resolve(t.secret)}}async getSecretStorageKey(e,t){if(!this.cryptoCallbacks.getSecretStorageKey)throw new Error("No getSecretStorageKey callback supplied");const i=await this.cryptoCallbacks.getSecretStorageKey({keys:e},t);if(!i)throw new Error("getSecretStorageKey callback returned falsey");if(i.length<2)throw new Error("getSecretStorageKey callback returned invalid data");const[n,r]=i;if(!e[n])throw new Error("App returned unknown key from getSecretStorageKey!");if(e[n].algorithm===h)return[n,{encrypt:async function(e){return await(0,l.encryptAES)(e,r,t)},decrypt:async function(e){return await(0,l.decryptAES)(e,r,t)}}];throw new Error("Unknown key type: "+e[n].algorithm)}}},2611:(e,t,i)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.encryptAES=l,t.decryptAES=function(e,t,i){return s?async function(e,t,i){const[n,o]=await c(t,i),a=(0,r.decodeBase64)(e.ciphertext);if(!await s.verify({name:"HMAC"},o,(0,r.decodeBase64)(e.mac),a))throw new Error(`Error decrypting secret ${i}: bad MAC`);const l=await s.decrypt({name:"AES-CTR",counter:(0,r.decodeBase64)(e.iv),length:64},n,a);return(new TextDecoder).decode(new Uint8Array(l))}(e,t,i):async function(e,t,i){const s=(0,n.getCrypto)();if(!s)throw new Error("No usable crypto implementation");const[o,c]=a(t,i);if(s.createHmac("sha256",c).update(Buffer.from(e.ciphertext,"base64")).digest("base64").replace(/=+$/g,"")!==e.mac.replace(/=+$/g,""))throw new Error(`Error decrypting secret ${i}: bad MAC`);const l=s.createDecipheriv("aes-256-ctr",o,(0,r.decodeBase64)(e.iv));return l.update(e.ciphertext,"base64","utf8")+l.final("utf8")}(e,t,i)},t.calculateKeyCheck=function(e,t){return l("\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0",e,"",t)};var n=i(3102),r=i(2772);const s="undefined"!=typeof window&&window.crypto?window.crypto.subtle||window.crypto.webkitSubtle:null,o=new Uint8Array(8);function a(e,t){const i=(0,n.getCrypto)(),r=i.createHmac("sha256",o).update(e).digest(),s=Buffer.alloc(1,1),a=i.createHmac("sha256",r).update(t,"utf8").update(s).digest();return s[0]=2,[a,i.createHmac("sha256",r).update(a).update(t,"utf8").update(s).digest()]}async function c(e,t){const i=await s.importKey("raw",e,{name:"HKDF"},!1,["deriveBits"]),n=await s.deriveBits({name:"HKDF",salt:o,info:(new TextEncoder).encode(t),hash:"SHA-256"},i,512),r=n.slice(0,32),a=n.slice(32),c=s.importKey("raw",r,{name:"AES-CTR"},!1,["encrypt","decrypt"]),l=s.importKey("raw",a,{name:"HMAC",hash:{name:"SHA-256"}},!1,["sign","verify"]);return await Promise.all([c,l])}function l(e,t,i,o){return s?async function(e,t,i,n){let o;n?o=(0,r.decodeBase64)(n):(o=new Uint8Array(16),window.crypto.getRandomValues(o)),o[8]&=127;const[a,l]=await c(t,i),h=(new TextEncoder).encode(e),u=await s.encrypt({name:"AES-CTR",counter:o,length:64},a,h),d=await s.sign({name:"HMAC"},l,u);return{iv:(0,r.encodeBase64)(o),ciphertext:(0,r.encodeBase64)(u),mac:(0,r.encodeBase64)(d)}}(e,t,i,o):async function(e,t,i,s){const o=(0,n.getCrypto)();if(!o)throw new Error("No usable crypto implementation");let c;c=s?(0,r.decodeBase64)(s):o.randomBytes(16),c[8]&=127;const[l,h]=a(t,i),u=o.createCipheriv("aes-256-ctr",l,c),d=Buffer.concat([u.update(e,"utf8"),u.final()]),p=o.createHmac("sha256",h).update(d).digest("base64");return{iv:(0,r.encodeBase64)(c),ciphertext:d.toString("base64"),mac:p}}(e,t,i,o)}},1897:(e,t,i)=>{"use strict";var n=i(5318);Object.defineProperty(t,"__esModule",{value:!0}),t.registerAlgorithm=function(e,t,i){s[e]=t,o[e]=i},t.UnknownDeviceError=t.DecryptionError=t.DecryptionAlgorithm=t.EncryptionAlgorithm=t.DECRYPTION_CLASSES=t.ENCRYPTION_CLASSES=void 0;var r=n(i(9713));const s={};t.ENCRYPTION_CLASSES=s;const o={};t.DECRYPTION_CLASSES=o,t.EncryptionAlgorithm=class{constructor(e){(0,r.default)(this,"userId",void 0),(0,r.default)(this,"deviceId",void 0),(0,r.default)(this,"crypto",void 0),(0,r.default)(this,"olmDevice",void 0),(0,r.default)(this,"baseApis",void 0),(0,r.default)(this,"roomId",void 0),this.userId=e.userId,this.deviceId=e.deviceId,this.crypto=e.crypto,this.olmDevice=e.olmDevice,this.baseApis=e.baseApis,this.roomId=e.roomId}prepareToEncrypt(e){}onRoomMembership(e,t,i){}},t.DecryptionAlgorithm=class{constructor(e){(0,r.default)(this,"userId",void 0),(0,r.default)(this,"crypto",void 0),(0,r.default)(this,"olmDevice",void 0),(0,r.default)(this,"baseApis",void 0),(0,r.default)(this,"roomId",void 0),this.userId=e.userId,this.crypto=e.crypto,this.olmDevice=e.olmDevice,this.baseApis=e.baseApis,this.roomId=e.roomId}onRoomKeyEvent(e){}async importRoomKey(e,t){}hasKeysForKeyRequest(e){return Promise.resolve(!1)}shareKeysWithDevice(e){throw new Error("shareKeysWithDevice not supported for this DecryptionAlgorithm")}async retryDecryptionFromSender(e){return!1}};class a extends Error{constructor(e,t,i){super(t),this.code=e,(0,r.default)(this,"detailedString",void 0),this.code=e,this.name="DecryptionError",this.detailedString=function(e,t){let i=e.name+"[msg: "+e.message;return t&&(i+=", "+Object.keys(t).map((e=>e+": "+t[e])).join(", ")),i+="]",i}(this,i)}}t.DecryptionError=a;class c extends Error{constructor(e,t){super(e),this.devices=t,this.name="UnknownDeviceError",this.devices=t}}t.UnknownDeviceError=c},1994:(e,t,i)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),i(3072),i(7125);var n=i(1897);Object.keys(n).forEach((function(e){"default"!==e&&"__esModule"!==e&&(e in t&&t[e]===n[e]||Object.defineProperty(t,e,{enumerable:!0,get:function(){return n[e]}}))}))},7125:(e,t,i)=>{"use strict";var n=i(862),r=i(5318);Object.defineProperty(t,"__esModule",{value:!0}),t.isRoomSharedHistory=h;var s=r(i(9713)),o=i(7434),a=n(i(2772)),c=i(1897),l=i(2573);function h(e){var t,i;const n=null==e||null===(t=e.currentState)||void 0===t?void 0:t.getStateEvents("m.room.history_visibility",""),r=null==n||null===(i=n.getContent())||void 0===i?void 0:i.history_visibility;return["world_readable","shared"].includes(r)}class u{constructor(e,t=!1){this.sessionId=e,this.sharedHistory=t,(0,s.default)(this,"useCount",0),(0,s.default)(this,"creationTime",void 0),(0,s.default)(this,"sharedWithDevices",{}),(0,s.default)(this,"blockedDevicesNotified",{}),this.creationTime=(new Date).getTime()}needsRotation(e,t){const i=(new Date).getTime()-this.creationTime;return(this.useCount>=e||i>=t)&&(o.logger.log("Rotating megolm session after "+this.useCount+" messages, "+i+"ms"),!0)}markSharedWithDevice(e,t,i){this.sharedWithDevices[e]||(this.sharedWithDevices[e]={}),this.sharedWithDevices[e][t]=i}markNotifiedBlockedDevice(e,t){this.blockedDevicesNotified[e]||(this.blockedDevicesNotified[e]={}),this.blockedDevicesNotified[e][t]=!0}sharedWithTooManyDevices(e){for(const t in this.sharedWithDevices)if(this.sharedWithDevices.hasOwnProperty(t)){if(!e.hasOwnProperty(t))return o.logger.log("Starting new megolm session because we shared with "+t),!0;for(const i in this.sharedWithDevices[t])if(this.sharedWithDevices[t].hasOwnProperty(i)&&!e[t].hasOwnProperty(i))return o.logger.log("Starting new megolm session because we shared with "+t+":"+i),!0}}}class d extends c.EncryptionAlgorithm{constructor(e){var t,i,n,r;super(e),(0,s.default)(this,"setupPromise",Promise.resolve(void 0)),(0,s.default)(this,"outboundSessions",{}),(0,s.default)(this,"sessionRotationPeriodMsgs",void 0),(0,s.default)(this,"sessionRotationPeriodMs",void 0),(0,s.default)(this,"encryptionPreparation",void 0),(0,s.default)(this,"encryptionPreparationMetadata",void 0),this.sessionRotationPeriodMsgs=null!==(t=null===(i=e.config)||void 0===i?void 0:i.rotation_period_msgs)&&void 0!==t?t:100,this.sessionRotationPeriodMs=null!==(n=null===(r=e.config)||void 0===r?void 0:r.rotation_period_ms)&&void 0!==n?n:6048e5}async ensureOutboundSession(e,t,i,n=!1){let r;function s(){return r}const c=this.setupPromise.then((async s=>{r=s;const c=h(e);r&&c!==r.sharedHistory&&(r=null),r&&r.needsRotation(this.sessionRotationPeriodMsgs,this.sessionRotationPeriodMs)&&(o.logger.log("Starting new megolm session because we need to rotate."),r=null),r&&r.sharedWithTooManyDevices(t)&&(r=null),r||(o.logger.log(`Starting new megolm session for room ${this.roomId}`),r=await this.prepareNewSession(c),o.logger.log(`Started new megolm session ${r.sessionId} for room ${this.roomId}`),this.outboundSessions[r.sessionId]=r);const l={};for(const[e,i]of Object.entries(t))for(const[t,n]of Object.entries(i))n.getIdentityKey()!=this.olmDevice.deviceCurve25519Key&&(r.sharedWithDevices[e]&&void 0!==r.sharedWithDevices[e][t]||(l[e]=l[e]||[],l[e].push(n)));const u=this.olmDevice.getOutboundGroupSessionKey(r.sessionId),d={type:"m.room_key",content:{algorithm:a.MEGOLM_ALGORITHM,room_id:this.roomId,session_id:r.sessionId,session_key:u.key,chain_index:u.chain_index,"org.matrix.msc3061.shared_history":c}},[p,g]=await a.getExistingOlmSessions(this.olmDevice,this.baseApis,l);await Promise.all([(async()=>{o.logger.debug(`Sharing keys with existing Olm sessions in ${this.roomId}`),await this.shareKeyWithOlmSessions(r,u,d,g),o.logger.debug(`Shared keys with existing Olm sessions in ${this.roomId}`)})(),(async()=>{o.logger.debug(`Sharing keys (start phase 1) with new Olm sessions in ${this.roomId}`);const e=[],t=Date.now(),i=[];await this.shareKeyWithDevices(r,u,d,p,e,n?1e4:2e3,i),o.logger.debug(`Shared keys (end phase 1) with new Olm sessions in ${this.roomId}`),!n&&Date.now()-t<1e4?(async()=>{const t={},n=new Set;for(const e of i)n.add(e);const s=[];for(const{userId:i,deviceInfo:r}of e){const e=i.slice(i.indexOf(":")+1);n.has(e)?(t[i]=t[i]||[],t[i].push(r)):s.push({userId:i,deviceInfo:r})}o.logger.debug(`Sharing keys (start phase 2) with new Olm sessions in ${this.roomId}`),await this.shareKeyWithDevices(r,u,d,t,s,3e4),o.logger.debug(`Shared keys (end phase 2) with new Olm sessions in ${this.roomId}`),await this.notifyFailedOlmDevices(r,u,s)})():await this.notifyFailedOlmDevices(r,u,e),o.logger.debug(`Shared keys (all phases done) with new Olm sessions in ${this.roomId}`)})(),(async()=>{o.logger.debug(`Notifying blocked devices in ${this.roomId}`);const e={};let t=0;for(const[n,s]of Object.entries(i))for(const[i,o]of Object.entries(s))r.blockedDevicesNotified[n]&&void 0!==r.blockedDevicesNotified[n][i]||(e[n]=e[n]||{},e[n][i]={device:o},t++);await this.notifyBlockedDevices(r,e),o.logger.debug(`Notified ${t} blocked devices in ${this.roomId}`)})()])}));return c.catch((e=>{o.logger.error(`Failed to ensure outbound session in ${this.roomId}`,e)})),this.setupPromise=c.then(s,s),c.then(s)}async prepareNewSession(e){const t=this.olmDevice.createOutboundGroupSession(),i=this.olmDevice.getOutboundGroupSessionKey(t);return await this.olmDevice.addInboundGroupSession(this.roomId,this.olmDevice.deviceCurve25519Key,[],t,i.key,{ed25519:this.olmDevice.deviceEd25519Key},!1,{sharedHistory:e}),this.crypto.backupManager.backupGroupSession(this.olmDevice.deviceCurve25519Key,t),new u(t,e)}getDevicesWithoutSessions(e,t,i=[]){for(const[n,r]of Object.entries(t)){const t=e[n];for(const e of r){const r=e.deviceId;t[r].sessionId||(i.push({userId:n,deviceInfo:e}),delete t[r])}}return i}splitDevices(e){let t=[];const i=[t];for(const[n,r]of Object.entries(e)){for(const e of Object.values(r))t.push({userId:n,deviceInfo:e.device});t.length>20&&(t=[],i.push(t))}return 0===t.length&&i.pop(),i}encryptAndSendKeysToDevices(e,t,i,n){const r={},s=[];for(let e=0;e<i.length;e++){const t={algorithm:a.OLM_ALGORITHM,sender_key:this.olmDevice.deviceCurve25519Key,ciphertext:{}},o=i[e],c=o.userId,l=o.deviceInfo,h=l.deviceId;r[c]||(r[c]={}),r[c][h]=t,s.push(a.encryptMessageForDevice(t.ciphertext,this.userId,this.deviceId,this.olmDevice,c,l,n))}return Promise.all(s).then((()=>{for(const e of Object.keys(r)){for(const t of Object.keys(r[e]))0===Object.keys(r[e][t].ciphertext).length&&(o.logger.log("No ciphertext for device "+e+":"+t+": pruning"),delete r[e][t]);0===Object.keys(r[e]).length&&(o.logger.log("Pruned all devices for user "+e),delete r[e])}if(0!==Object.keys(r).length)return this.baseApis.sendToDevice("m.room.encrypted",r).then((()=>{for(const i of Object.keys(r))for(const n of Object.keys(r[i]))e.markSharedWithDevice(i,n,t)}));o.logger.log("No users left to send to: aborting")}))}async sendBlockedNotificationsToDevices(e,t,i){const n={};for(const e of t){const t=e.userId,r=e.deviceInfo,s=r.deviceInfo.deviceId,o=Object.assign({},i);o.code=r.code,o.reason=r.reason,"m.no_olm"===o.code&&(delete o.room_id,delete o.session_id),n[t]||(n[t]={}),n[t][s]=o}await this.baseApis.sendToDevice("org.matrix.room_key.withheld",n);for(const t of Object.keys(n))for(const i of Object.keys(n[t]))e.markNotifiedBlockedDevice(t,i)}async reshareKeyWithDevice(e,t,i,n){const r=this.outboundSessions[t];if(!r)return void o.logger.debug(`megolm session ${t} not found: not re-sharing keys`);if(void 0===r.sharedWithDevices[i])return void o.logger.debug(`megolm session ${t} never shared with user ${i}`);const s=r.sharedWithDevices[i][n.deviceId];if(void 0===s)return void o.logger.debug("megolm session ID "+t+" never shared with device "+i+":"+n.deviceId);const c=await this.olmDevice.getInboundGroupSessionKey(this.roomId,e,t,s);if(!c)return void o.logger.warn(`No inbound session key found for megolm ${t}: not re-sharing keys`);await a.ensureOlmSessionsForDevices(this.olmDevice,this.baseApis,{[i]:[n]});const l={type:"m.forwarded_room_key",content:{algorithm:a.MEGOLM_ALGORITHM,room_id:this.roomId,session_id:t,session_key:c.key,chain_index:c.chain_index,sender_key:e,sender_claimed_ed25519_key:c.sender_claimed_ed25519_key,forwarding_curve25519_key_chain:c.forwarding_curve25519_key_chain,"org.matrix.msc3061.shared_history":c.shared_history||!1}},h={algorithm:a.OLM_ALGORITHM,sender_key:this.olmDevice.deviceCurve25519Key,ciphertext:{}};await a.encryptMessageForDevice(h.ciphertext,this.userId,this.deviceId,this.olmDevice,i,n,l),await this.baseApis.sendToDevice("m.room.encrypted",{[i]:{[n.deviceId]:h}}),o.logger.debug(`Re-shared key for megolm session ${t} with ${i}:${n.deviceId}`)}async shareKeyWithDevices(e,t,i,n,r,s,c){o.logger.debug(`Ensuring Olm sessions for devices in ${this.roomId}`);const l=await a.ensureOlmSessionsForDevices(this.olmDevice,this.baseApis,n,!1,s,c,o.logger.withPrefix(`[${this.roomId}]`));o.logger.debug(`Ensured Olm sessions for devices in ${this.roomId}`),this.getDevicesWithoutSessions(l,n,r),o.logger.debug(`Sharing keys with Olm sessions in ${this.roomId}`),await this.shareKeyWithOlmSessions(e,t,i,l),o.logger.debug(`Shared keys with Olm sessions in ${this.roomId}`)}async shareKeyWithOlmSessions(e,t,i,n){const r=this.splitDevices(n);for(let n=0;n<r.length;n++){const s=`megolm keys for ${e.sessionId} in ${this.roomId} (slice ${n+1}/${r.length})`;try{o.logger.debug(`Sharing ${s}`),await this.encryptAndSendKeysToDevices(e,t.chain_index,r[n],i),o.logger.debug(`Shared ${s}`)}catch(e){throw o.logger.error(`Failed to share ${s}`),e}}}async notifyFailedOlmDevices(e,t,i){o.logger.debug(`Notifying ${i.length} devices we failed to create Olm sessions in ${this.roomId}`);for(const{userId:n,deviceInfo:r}of i){const i=r.deviceId;e.markSharedWithDevice(n,i,t.chain_index)}const n=await this.olmDevice.filterOutNotifiedErrorDevices(i);o.logger.debug(`Filtered down to ${n.length} error devices in ${this.roomId}`);const r={};for(const{userId:e,deviceInfo:t}of n)r[e]=r[e]||{},r[e][t.deviceId]={device:{code:"m.no_olm",reason:l.WITHHELD_MESSAGES["m.no_olm"],deviceInfo:t}};await this.notifyBlockedDevices(e,r),o.logger.debug(`Notified ${n.length} devices we failed to create Olm sessions in ${this.roomId}`)}async notifyBlockedDevices(e,t){const i={room_id:this.roomId,session_id:e.sessionId,algorithm:a.MEGOLM_ALGORITHM,sender_key:this.olmDevice.deviceCurve25519Key},n=this.splitDevices(t);for(let t=0;t<n.length;t++)try{await this.sendBlockedNotificationsToDevices(e,n[t],i),o.logger.log(`Completed blacklist notification for ${e.sessionId} in ${this.roomId} (slice ${t+1}/${n.length})`)}catch(i){throw o.logger.log(`blacklist notification for ${e.sessionId} in ${this.roomId} (slice ${t+1}/${n.length}) failed`),i}}prepareToEncrypt(e){if(this.encryptionPreparation){const e=Date.now()-this.encryptionPreparationMetadata.startTime;o.logger.debug(`Already started preparing to encrypt for ${this.roomId} ${e} ms ago, skipping`)}else o.logger.debug(`Preparing to encrypt events for ${this.roomId}`),this.encryptionPreparationMetadata={startTime:Date.now()},this.encryptionPreparation=(async()=>{try{o.logger.debug(`Getting devices in ${this.roomId}`);const[t,i]=await this.getDevicesInRoom(e);this.crypto.getGlobalErrorOnUnknownDevices()&&this.removeUnknownDevices(t),o.logger.debug(`Ensuring outbound session in ${this.roomId}`),await this.ensureOutboundSession(e,t,i,!0),o.logger.debug(`Ready to encrypt events for ${this.roomId}`)}catch(e){o.logger.error(`Failed to prepare to encrypt events for ${this.roomId}`,e)}finally{delete this.encryptionPreparationMetadata,delete this.encryptionPreparation}})()}async encryptMessage(e,t,i){if(o.logger.log(`Starting to encrypt event for ${this.roomId}`),this.encryptionPreparation)try{await this.encryptionPreparation}catch(e){}const[n,r]=await this.getDevicesInRoom(e);this.crypto.getGlobalErrorOnUnknownDevices()&&this.checkForUnknownDevices(n);const s=await this.ensureOutboundSession(e,n,r),c={room_id:this.roomId,type:t,content:i},l=this.olmDevice.encryptGroupMessage(s.sessionId,JSON.stringify(c)),h={algorithm:a.MEGOLM_ALGORITHM,sender_key:this.olmDevice.deviceCurve25519Key,ciphertext:l,session_id:s.sessionId,device_id:this.deviceId};return s.useCount++,h}forceDiscardSession(){this.setupPromise=this.setupPromise.then((()=>null))}checkForUnknownDevices(e){const t={};if(Object.keys(e).forEach((i=>{Object.keys(e[i]).forEach((n=>{const r=e[i][n];r.isUnverified()&&!r.isKnown()&&(t[i]||(t[i]={}),t[i][n]=r)}))})),Object.keys(t).length)throw new c.UnknownDeviceError("This room contains unknown devices which have not been verified. We strongly recommend you verify them before continuing.",t)}removeUnknownDevices(e){for(const[t,i]of Object.entries(e)){for(const[e,t]of Object.entries(i))t.isUnverified()&&!t.isKnown()&&delete i[e];0===Object.keys(i).length&&delete e[t]}}async getDevicesInRoom(e){const t=(await e.getEncryptionTargetMembers()).map((function(e){return e.userId}));let i=this.crypto.getGlobalBlacklistUnverifiedDevices();"boolean"==typeof e.getBlacklistUnverifiedDevices()&&(i=e.getBlacklistUnverifiedDevices());const n=await this.crypto.downloadKeys(t,!1),r={};for(const e in n){if(!n.hasOwnProperty(e))continue;const t=n[e];for(const n in t){if(!t.hasOwnProperty(n))continue;const s=this.crypto.checkDeviceTrust(e,n);if(t[n].isBlocked()||!s.isVerified()&&i){r[e]||(r[e]={});const i=t[n].isBlocked();r[e][n]={code:i?"m.blacklisted":"m.unverified",reason:l.WITHHELD_MESSAGES[i?"m.blacklisted":"m.unverified"],deviceInfo:t[n]},delete t[n]}}}return[n,r]}}class p extends c.DecryptionAlgorithm{constructor(...e){super(...e),(0,s.default)(this,"pendingEvents",{}),(0,s.default)(this,"olmlib",a)}async decryptEvent(e){const t=e.getWireContent();if(!t.sender_key||!t.session_id||!t.ciphertext)throw new c.DecryptionError("MEGOLM_MISSING_FIELDS","Missing fields in input");let i;this.addEventToPendingList(e);try{i=await this.olmDevice.decryptGroupMessage(e.getRoomId(),t.sender_key,t.session_id,t.ciphertext,e.getId(),e.getTs())}catch(i){if("DecryptionError"===i.name)throw i;let n="OLM_DECRYPT_GROUP_MESSAGE_ERROR";throw i&&"OLM.UNKNOWN_MESSAGE_INDEX"===i.message&&(this.requestKeysForEvent(e),n="OLM_UNKNOWN_MESSAGE_INDEX"),new c.DecryptionError(n,i?i.toString():"Unknown Error: Error is undefined",{session:t.sender_key+"|"+t.session_id})}if(null===i){this.requestKeysForEvent(e);const i=await this.olmDevice.sessionMayHaveProblems(t.sender_key,e.getTs()-12e4);if(i){let e=g[i.type]||g.unknown;throw i.fixed&&(e+=" Trying to create a new secure channel and re-requesting the keys."),new c.DecryptionError("MEGOLM_UNKNOWN_INBOUND_SESSION_ID",e,{session:t.sender_key+"|"+t.session_id})}throw new c.DecryptionError("MEGOLM_UNKNOWN_INBOUND_SESSION_ID","The sender's device has not sent us the keys for this message.",{session:t.sender_key+"|"+t.session_id})}this.removeEventFromPendingList(e);const n=JSON.parse(i.result);if(n.room_id!==e.getRoomId())throw new c.DecryptionError("MEGOLM_BAD_ROOM","Message intended for room "+n.room_id);return{clearEvent:n,senderCurve25519Key:i.senderKey,claimedEd25519Key:i.keysClaimed.ed25519,forwardingCurve25519KeyChain:i.forwardingCurve25519KeyChain,untrusted:i.untrusted}}requestKeysForEvent(e){const t=e.getWireContent(),i=e.getKeyRequestRecipients(this.userId);this.crypto.requestRoomKey({room_id:e.getRoomId(),algorithm:t.algorithm,sender_key:t.sender_key,session_id:t.session_id},i)}addEventToPendingList(e){const t=e.getWireContent(),i=t.sender_key,n=t.session_id;this.pendingEvents[i]||(this.pendingEvents[i]=new Map);const r=this.pendingEvents[i];r.has(n)||r.set(n,new Set),r.get(n).add(e)}removeEventFromPendingList(e){const t=e.getWireContent(),i=t.sender_key,n=t.session_id,r=this.pendingEvents[i],s=r&&r.get(n);s&&(s.delete(e),0===s.size&&r.delete(i),0===r.size&&delete this.pendingEvents[i])}onRoomKeyEvent(e){const t=e.getContent(),i=t.session_id;let n,r=e.getSenderKey(),s=[],a=!1;if(!t.room_id||!i||!t.session_key)return void o.logger.error("key event is missing fields");if(!r)return void o.logger.error("key event has no sender key (not encrypted?)");if("m.forwarded_room_key"==e.getType()){if(a=!0,s=t.forwarding_curve25519_key_chain,Array.isArray(s)||(s=[]),s=s.slice(),s.push(r),r=t.sender_key,!r)return void o.logger.error("forwarded_room_key event is missing sender_key field");const e=t.sender_claimed_ed25519_key;if(!e)return void o.logger.error("forwarded_room_key_event is missing sender_claimed_ed25519_key field");n={ed25519:e}}else n=e.getKeysClaimed();const c={};return t["org.matrix.msc3061.shared_history"]&&(c.sharedHistory=!0),this.olmDevice.addInboundGroupSession(t.room_id,r,s,i,t.session_key,n,a,c).then((()=>{this.retryDecryption(r,i).then((e=>{e&&this.crypto.cancelRoomKeyRequest({algorithm:t.algorithm,room_id:t.room_id,session_id:t.session_id,sender_key:r})}))})).then((()=>{this.crypto.backupManager.backupGroupSession(r,t.session_id)})).catch((e=>{o.logger.error(`Error handling m.room_key_event: ${e}`)}))}async onRoomKeyWithheldEvent(e){const t=e.getContent(),i=t.sender_key;if("m.no_olm"===t.code){const n=e.getSender();if(o.logger.warn(`${n}:${i} was unable to establish an olm session with us`),await this.olmDevice.getSessionIdForDevice(i))return o.logger.debug("New session already created.  Not creating a new one."),await this.olmDevice.recordSessionProblem(i,"no_olm",!0),void this.retryDecryptionFromSender(i);let r=this.crypto.deviceList.getDeviceByIdentityKey(t.algorithm,i);if(!r&&(await this.crypto.downloadKeys([n],!1),r=this.crypto.deviceList.getDeviceByIdentityKey(t.algorithm,i),!r))return o.logger.info("Couldn't find device for identity key "+i+": not establishing session"),await this.olmDevice.recordSessionProblem(i,"no_olm",!1),void this.retryDecryptionFromSender(i);await a.ensureOlmSessionsForDevices(this.olmDevice,this.baseApis,{[n]:[r]},!1);const s={algorithm:a.OLM_ALGORITHM,sender_key:this.olmDevice.deviceCurve25519Key,ciphertext:{}};await a.encryptMessageForDevice(s.ciphertext,this.userId,void 0,this.olmDevice,n,r,{type:"m.dummy"}),await this.olmDevice.recordSessionProblem(i,"no_olm",!0),this.retryDecryptionFromSender(i),await this.baseApis.sendToDevice("m.room.encrypted",{[n]:{[r.deviceId]:s}})}else await this.olmDevice.addInboundGroupSessionWithheld(t.room_id,i,t.session_id,t.code,t.reason)}hasKeysForKeyRequest(e){const t=e.requestBody;return this.olmDevice.hasInboundSessionKeys(t.room_id,t.sender_key,t.session_id)}shareKeysWithDevice(e){const t=e.userId,i=e.deviceId,n=this.crypto.getStoredDevice(t,i),r=e.requestBody;this.olmlib.ensureOlmSessionsForDevices(this.olmDevice,this.baseApis,{[t]:[n]}).then((e=>e[t][i].sessionId?(o.logger.log("sharing keys for session "+r.sender_key+"|"+r.session_id+" with device "+t+":"+i),this.buildKeyForwardingMessage(r.room_id,r.sender_key,r.session_id)):null)).then((e=>{const r={algorithm:a.OLM_ALGORITHM,sender_key:this.olmDevice.deviceCurve25519Key,ciphertext:{}};return this.olmlib.encryptMessageForDevice(r.ciphertext,this.userId,void 0,this.olmDevice,t,n,e).then((()=>{const e={[t]:{[i]:r}};return this.baseApis.sendToDevice("m.room.encrypted",e)}))}))}async buildKeyForwardingMessage(e,t,i){const n=await this.olmDevice.getInboundGroupSessionKey(e,t,i);return{type:"m.forwarded_room_key",content:{algorithm:a.MEGOLM_ALGORITHM,room_id:e,sender_key:t,sender_claimed_ed25519_key:n.sender_claimed_ed25519_key,session_id:i,session_key:n.key,chain_index:n.chain_index,forwarding_curve25519_key_chain:n.forwarding_curve25519_key_chain,"org.matrix.msc3061.shared_history":n.shared_history||!1}}}importRoomKey(e,t={}){const i={};return(t.untrusted||e.untrusted)&&(i.untrusted=!0),e["org.matrix.msc3061.shared_history"]&&(i.sharedHistory=!0),this.olmDevice.addInboundGroupSession(e.room_id,e.sender_key,e.forwarding_curve25519_key_chain,e.session_id,e.session_key,e.sender_claimed_keys,!0,i).then((()=>{"backup"!==t.source&&this.crypto.backupManager.backupGroupSession(e.sender_key,e.session_id).catch((e=>{o.logger.log("Failed to back up megolm session",e)})),this.retryDecryption(e.sender_key,e.session_id)}))}async retryDecryption(e,t){const i=this.pendingEvents[e];if(!i)return!0;const n=i.get(t);return!n||(o.logger.debug("Retrying decryption on events",[...n]),await Promise.all([...n].map((async e=>{try{await e.attemptDecryption(this.crypto,{isRetry:!0})}catch(e){}}))),!(this.pendingEvents[e]||{})[t])}async retryDecryptionFromSender(e){const t=this.pendingEvents[e];return!t||(delete this.pendingEvents[e],await Promise.all([...t].map((async([e,t])=>{await Promise.all([...t].map((async e=>{try{await e.attemptDecryption(this.crypto)}catch(e){}})))}))),!this.pendingEvents[e])}async sendSharedHistoryInboundSessions(e){await a.ensureOlmSessionsForDevices(this.olmDevice,this.baseApis,e),o.logger.log("sendSharedHistoryInboundSessions to users",Object.keys(e));const t=await this.olmDevice.getSharedHistoryInboundGroupSessions(this.roomId);o.logger.log("shared-history sessions",t);for(const[i,n]of t){const t=await this.buildKeyForwardingMessage(this.roomId,i,n),r=[],s={};for(const[i,n]of Object.entries(e)){s[i]={};for(const e of n){const n={algorithm:a.OLM_ALGORITHM,sender_key:this.olmDevice.deviceCurve25519Key,ciphertext:{}};s[i][e.deviceId]=n,r.push(a.encryptMessageForDevice(n.ciphertext,this.userId,void 0,this.olmDevice,i,e,t))}}await Promise.all(r);for(const e of Object.keys(s)){for(const t of Object.keys(s[e]))0===Object.keys(s[e][t].ciphertext).length&&(o.logger.log("No ciphertext for device "+e+":"+t+": pruning"),delete s[e][t]);0===Object.keys(s[e]).length&&(o.logger.log("Pruned all devices for user "+e),delete s[e])}if(0===Object.keys(s).length)return void o.logger.log("No users left to send to: aborting");await this.baseApis.sendToDevice("m.room.encrypted",s)}}}const g={no_olm:"The sender was unable to establish a secure channel.",unknown:"The secure channel with the sender was corrupted."};(0,c.registerAlgorithm)(a.MEGOLM_ALGORITHM,d,p)},3072:(e,t,i)=>{"use strict";var n=i(862),r=i(5318)(i(9713)),s=i(7434),o=n(i(2772)),a=i(3272),c=i(1897);const l=a.DeviceInfo.DeviceVerification;class h extends c.EncryptionAlgorithm{constructor(...e){super(...e),(0,r.default)(this,"sessionPrepared",!1),(0,r.default)(this,"prepPromise",null)}ensureSession(e){return this.prepPromise?this.prepPromise:this.sessionPrepared?Promise.resolve():(this.prepPromise=this.crypto.downloadKeys(e).then((t=>this.crypto.ensureOlmSessionsForUsers(e))).then((()=>{this.sessionPrepared=!0})).finally((()=>{this.prepPromise=null})),this.prepPromise)}async encryptMessage(e,t,i){const n=(await e.getEncryptionTargetMembers()).map((function(e){return e.userId}));await this.ensureSession(n);const r={room_id:e.roomId,type:t,content:i},s={algorithm:o.OLM_ALGORITHM,sender_key:this.olmDevice.deviceCurve25519Key,ciphertext:{}},a=[];for(let e=0;e<n.length;++e){const t=n[e],i=this.crypto.getStoredDevicesForUser(t);for(let e=0;e<i.length;++e){const n=i[e];n.getIdentityKey()!=this.olmDevice.deviceCurve25519Key&&n.verified!=l.BLOCKED&&a.push(o.encryptMessageForDevice(s.ciphertext,this.userId,this.deviceId,this.olmDevice,t,n,r))}}return await Promise.all(a).then((()=>s))}}class u extends c.DecryptionAlgorithm{async decryptEvent(e){const t=e.getWireContent(),i=t.sender_key,n=t.ciphertext;if(!n)throw new c.DecryptionError("OLM_MISSING_CIPHERTEXT","Missing ciphertext");if(!(this.olmDevice.deviceCurve25519Key in n))throw new c.DecryptionError("OLM_NOT_INCLUDED_IN_RECIPIENTS","Not included in recipients");const r=n[this.olmDevice.deviceCurve25519Key];let s;try{s=await this.decryptMessage(i,r)}catch(e){throw new c.DecryptionError("OLM_BAD_ENCRYPTED_MESSAGE","Bad Encrypted Message",{sender:i,err:e})}const o=JSON.parse(s);if(o.recipient!=this.userId)throw new c.DecryptionError("OLM_BAD_RECIPIENT","Message was intented for "+o.recipient);if(o.recipient_keys.ed25519!=this.olmDevice.deviceEd25519Key)throw new c.DecryptionError("OLM_BAD_RECIPIENT_KEY","Message not intended for this device",{intended:o.recipient_keys.ed25519,our_key:this.olmDevice.deviceEd25519Key});if(o.sender!=e.getSender())throw new c.DecryptionError("OLM_FORWARDED_MESSAGE","Message forwarded from "+o.sender,{reported_sender:e.getSender()});if(o.room_id!==e.getRoomId())throw new c.DecryptionError("OLM_BAD_ROOM","Message intended for room "+o.room_id,{reported_room:e.getRoomId()});return{clearEvent:o,senderCurve25519Key:i,claimedEd25519Key:(o.keys||{}).ed25519||null}}async decryptMessage(e,t){if(0!==t.type)return this.reallyDecryptMessage(e,t);{const i=this.olmDevice._olmPrekeyPromise.then((()=>this.reallyDecryptMessage(e,t)));return this.olmDevice._olmPrekeyPromise=i.catch((()=>{})),await i}}async reallyDecryptMessage(e,t){const i=await this.olmDevice.getSessionIdsForDevice(e),n={};for(let r=0;r<i.length;r++){const o=i[r];try{const i=await this.olmDevice.decryptMessage(e,o,t.type,t.body);return s.logger.log("Decrypted Olm message from "+e+" with session "+o),i}catch(i){if(await this.olmDevice.matchesSession(e,o,t.type,t.body))throw new Error("Error decrypting prekey message with existing session id "+o+": "+i.message);n[o]=i.message}}if(0!==t.type){if(0===i.length)throw new Error("No existing sessions");throw new Error("Error decrypting non-prekey message with existing sessions: "+JSON.stringify(n))}let r;try{r=await this.olmDevice.createInboundSession(e,t.type,t.body)}catch(e){throw n["(new)"]=e.message,new Error("Error decrypting prekey message: "+JSON.stringify(n))}return s.logger.log("created new inbound Olm session ID "+r.session_id+" with "+e),r.payload}}(0,c.registerAlgorithm)(o.OLM_ALGORITHM,h,u)},764:(e,t)=>{"use strict";let i;Object.defineProperty(t,"__esModule",{value:!0}),t.CrossSigningKey=void 0,t.CrossSigningKey=i,function(e){e.Master="master",e.SelfSigning="self_signing",e.UserSigning="user_signing"}(i||(t.CrossSigningKey=i={}))},5537:(e,t,i)=>{"use strict";var n=i(5318);Object.defineProperty(t,"__esModule",{value:!0}),t.DefaultAlgorithm=t.algorithmsByName=t.Aes256=t.Curve25519=t.BackupManager=void 0;var r=n(i(9713)),s=i(2168),o=i(7434),a=i(2772),c=i(1597),l=i(3102),h=i(7585),u=i(4077),d=i(2611),p=i(7048);class g{constructor(e,t){this.baseApis=e,this.getKey=t,(0,r.default)(this,"algorithm",void 0),(0,r.default)(this,"backupInfo",void 0),(0,r.default)(this,"checkedForBackup",void 0),(0,r.default)(this,"sendingBackups",void 0),this.checkedForBackup=!1,this.sendingBackups=!1}get version(){return this.backupInfo&&this.backupInfo.version}static checkBackupVersion(e){const t=y[e.algorithm];if(!t)throw new Error("Unknown backup algorithm: "+e.algorithm);if("object"!=typeof e.auth_data)throw new Error("Invalid backup data returned");return t.checkBackupVersion(e)}static async makeAlgorithm(e,t){const i=y[e.algorithm];if(!i)throw new Error("Unknown backup algorithm");return await i.init(e.auth_data,t)}async enableKeyBackup(e){this.backupInfo=e,this.algorithm&&this.algorithm.free(),this.algorithm=await g.makeAlgorithm(e,this.getKey),this.baseApis.emit("crypto.keyBackupStatus",!0),this.scheduleKeyBackupSend()}disableKeyBackup(){this.algorithm&&this.algorithm.free(),this.algorithm=void 0,this.backupInfo=void 0,this.baseApis.emit("crypto.keyBackupStatus",!1)}getKeyBackupEnabled(){return this.checkedForBackup?Boolean(this.algorithm):null}async prepareKeyBackupVersion(e,t){const i=t?y[t]:_;if(!i)throw new Error("Unknown backup algorithm");const[n,r]=await i.prepare(e),s=(0,u.encodeRecoveryKey)(n);return{algorithm:i.algorithmName,auth_data:r,recovery_key:s,privateKey:n}}async createKeyBackupVersion(e){this.algorithm=await g.makeAlgorithm(e,this.getKey)}async checkAndStart(){if(o.logger.log("Checking key backup status..."),this.baseApis.isGuest())return o.logger.log("Skipping key backup check since user is guest"),this.checkedForBackup=!0,null;let e;try{e=await this.baseApis.getKeyBackupVersion()}catch(e){return o.logger.log("Error checking for active key backup",e),404===e.httpStatus&&(this.checkedForBackup=!0),null}this.checkedForBackup=!0;const t=await this.isKeyBackupTrusted(e);return t.usable&&!this.backupInfo?(o.logger.log("Found usable key backup v"+e.version+": enabling key backups"),await this.enableKeyBackup(e)):!t.usable&&this.backupInfo?(o.logger.log("No usable key backup: disabling key backup"),this.disableKeyBackup()):t.usable||this.backupInfo?t.usable&&this.backupInfo&&(e.version!==this.backupInfo.version?(o.logger.log("On backup version "+this.backupInfo.version+" but found version "+e.version+": switching."),this.disableKeyBackup(),await this.enableKeyBackup(e),await this.scheduleAllGroupSessionsForBackup()):o.logger.log("Backup version "+e.version+" still current")):o.logger.log("No usable key backup: not enabling key backup"),{backupInfo:e,trustInfo:t}}async checkKeyBackup(){return this.checkedForBackup=!1,this.checkAndStart()}async isKeyBackupTrusted(e){const t={usable:!1,trusted_locally:!1,sigs:[]};if(!(e&&e.algorithm&&e.auth_data&&e.auth_data.signatures))return o.logger.info("Key backup is absent or missing required data"),t;const i=this.baseApis.crypto.sessionStore.getLocalTrustedBackupPubKey();"public_key"in e.auth_data&&e.auth_data.public_key===i&&(o.logger.info("Backup public key "+i+" is trusted locally"),t.trusted_locally=!0);const n=e.auth_data.signatures[this.baseApis.getUserId()]||[];for(const i of Object.keys(n)){const n=i.split(":");if("ed25519"!==n[0]){o.logger.log("Ignoring unknown signature type: "+n[0]);continue}const r={deviceId:n[1]},s=this.baseApis.crypto.crossSigningInfo.getId();if(s===r.deviceId){r.crossSigningId=!0;try{await(0,a.verifySignature)(this.baseApis.crypto.olmDevice,e.auth_data,this.baseApis.getUserId(),r.deviceId,s),r.valid=!0}catch(e){o.logger.warn("Bad signature from cross signing key "+s,e),r.valid=!1}t.sigs.push(r);continue}const c=this.baseApis.crypto.deviceList.getStoredDevice(this.baseApis.getUserId(),r.deviceId);if(c){r.device=c,r.deviceTrust=await this.baseApis.checkDeviceTrust(this.baseApis.getUserId(),r.deviceId);try{await(0,a.verifySignature)(this.baseApis.crypto.olmDevice,e.auth_data,this.baseApis.getUserId(),c.deviceId,c.getFingerprint()),r.valid=!0}catch(t){o.logger.info("Bad signature from key ID "+i+" userID "+this.baseApis.getUserId()+" device ID "+c.deviceId+" fingerprint: "+c.getFingerprint(),e.auth_data,t),r.valid=!1}}else r.valid=null,o.logger.info("Ignoring signature from unknown key "+i);t.sigs.push(r)}return t.usable=t.sigs.some((e=>e.valid&&(e.device&&e.deviceTrust.isVerified()||e.crossSigningId))),t.usable=t.usable||t.trusted_locally,t}async scheduleKeyBackupSend(e=1e4){if(!this.sendingBackups){this.sendingBackups=!0;try{const t=Math.random()*e;await(0,l.sleep)(t,void 0);let i=0;for(;;){if(!this.algorithm)return;try{if(0===await this.backupPendingKeys(200))return;i=0}catch(e){if(i++,o.logger.log("Key backup request failed",e),e.data&&("M_NOT_FOUND"==e.data.errcode||"M_WRONG_ROOM_KEYS_VERSION"==e.data.errcode))throw await this.checkKeyBackup(),this.baseApis.crypto.emit("crypto.keyBackupFailed",e.data.errcode),e}i&&await(0,l.sleep)(1e3*Math.pow(2,Math.min(i-1,4)),void 0)}}finally{this.sendingBackups=!1}}}async backupPendingKeys(e){const t=await this.baseApis.crypto.cryptoStore.getSessionsNeedingBackup(e);if(!t.length)return 0;let i=await this.baseApis.crypto.cryptoStore.countSessionsNeedingBackup();this.baseApis.crypto.emit("crypto.keyBackupSessionsRemaining",i);const n={};for(const e of t){const t=e.sessionData.room_id;void 0===n[t]&&(n[t]={sessions:{}});const i=await this.baseApis.crypto.olmDevice.exportInboundGroupSession(e.senderKey,e.sessionId,e.sessionData);i.algorithm=a.MEGOLM_ALGORITHM;const r=(i.forwarding_curve25519_key_chain||[]).length,s=this.baseApis.crypto.deviceList.getUserByIdentityKey(a.MEGOLM_ALGORITHM,e.senderKey),o=this.baseApis.crypto.deviceList.getDeviceByIdentityKey(a.MEGOLM_ALGORITHM,e.senderKey),c=this.baseApis.crypto.checkDeviceInfoTrust(s,o).isVerified();n[t].sessions[e.sessionId]={first_message_index:i.first_known_index,forwarded_count:r,is_verified:c,session_data:await this.algorithm.encryptSession(i)}}return await this.baseApis.sendKeyBackup(void 0,void 0,this.backupInfo.version,{rooms:n}),await this.baseApis.crypto.cryptoStore.unmarkSessionsNeedingBackup(t),i=await this.baseApis.crypto.cryptoStore.countSessionsNeedingBackup(),this.baseApis.crypto.emit("crypto.keyBackupSessionsRemaining",i),t.length}async backupGroupSession(e,t){await this.baseApis.crypto.cryptoStore.markSessionsNeedingBackup([{senderKey:e,sessionId:t}]),this.backupInfo&&this.scheduleKeyBackupSend()}async scheduleAllGroupSessionsForBackup(){await this.flagAllGroupSessionsForBackup(),this.scheduleKeyBackupSend(0)}async flagAllGroupSessionsForBackup(){await this.baseApis.crypto.cryptoStore.doTxn("readwrite",[h.IndexedDBCryptoStore.STORE_INBOUND_GROUP_SESSIONS,h.IndexedDBCryptoStore.STORE_BACKUP],(e=>{this.baseApis.crypto.cryptoStore.getAllEndToEndInboundGroupSessions(e,(t=>{null!==t&&this.baseApis.crypto.cryptoStore.markSessionsNeedingBackup([t],e)}))}));const e=await this.baseApis.crypto.cryptoStore.countSessionsNeedingBackup();return this.baseApis.emit("crypto.keyBackupSessionsRemaining",e),e}countSessionsNeedingBackup(){return this.baseApis.crypto.cryptoStore.countSessionsNeedingBackup()}}t.BackupManager=g;class f{constructor(e,t,i){this.authData=e,this.publicKey=t,this.getKey=i}static async init(e,t){if(!e||!("public_key"in e))throw new Error("auth_data missing required information");const n=new i.g.Olm.PkEncryption;return n.set_recipient_key(e.public_key),new f(e,n,t)}static async prepare(e){const t=new i.g.Olm.PkDecryption;try{const n={};if(e)if(e instanceof Uint8Array)n.public_key=t.init_with_private_key(e);else{const i=await(0,c.keyFromPassphrase)(e);n.private_key_salt=i.salt,n.private_key_iterations=i.iterations,n.public_key=t.init_with_private_key(i.key)}else n.public_key=t.generate_key();return(new i.g.Olm.PkEncryption).set_recipient_key(n.public_key),[t.get_private_key(),n]}finally{t.free()}}static checkBackupVersion(e){if(!("public_key"in e.auth_data))throw new Error("Invalid backup data returned")}get untrusted(){return!0}async encryptSession(e){const t=Object.assign({},e);return delete t.session_id,delete t.room_id,delete t.first_known_index,this.publicKey.encrypt(JSON.stringify(t))}async decryptSessions(e){const t=await this.getKey(),n=new i.g.Olm.PkDecryption;try{if(n.init_with_private_key(t)!==this.authData.public_key)throw{errcode:s.MatrixClient.RESTORE_BACKUP_ERROR_BAD_KEY};const i=[];for(const[t,r]of Object.entries(e))try{const e=JSON.parse(n.decrypt(r.session_data.ephemeral,r.session_data.mac,r.session_data.ciphertext));e.session_id=t,i.push(e)}catch(e){o.logger.log("Failed to decrypt megolm session from backup",e,r)}return i}finally{n.free()}}async keyMatches(e){const t=new i.g.Olm.PkDecryption;let n;try{n=t.init_with_private_key(e)}finally{t.free()}return n===this.authData.public_key}free(){this.publicKey.free()}}t.Curve25519=f,(0,r.default)(f,"algorithmName","m.megolm_backup.v1.curve25519-aes-sha2");const m=new p.UnstableValue(null,"org.matrix.msc3270.v1.aes-hmac-sha2");class v{constructor(e,t){this.authData=e,this.key=t}static async init(e,t){if(!e)throw new Error("auth_data missing");const i=await t();if(e.mac){const{mac:t}=await(0,d.calculateKeyCheck)(i,e.iv);if(e.mac.replace(/=+$/g,"")!==t.replace(/=+/g,""))throw new Error("Key does not match")}return new v(e,i)}static async prepare(e){let t;const i={};if(e)if(e instanceof Uint8Array)t=new Uint8Array(e);else{const n=await(0,c.keyFromPassphrase)(e);i.private_key_salt=n.salt,i.private_key_iterations=n.iterations,t=n.key}else t=function(e){var t;const i=(0,l.getCrypto)();if(i)return i.randomBytes(32);if(null!==(t=window)&&void 0!==t&&t.crypto){const e=new Uint8Array(32);return window.crypto.getRandomValues(e),e}throw new Error("No usable crypto implementation")}();const{iv:n,mac:r}=await(0,d.calculateKeyCheck)(t);return i.iv=n,i.mac=r,[t,i]}static checkBackupVersion(e){if(!("iv"in e.auth_data)||!("mac"in e.auth_data))throw new Error("Invalid backup data returned")}get untrusted(){return!1}async encryptSession(e){const t=Object.assign({},e);return delete t.session_id,delete t.room_id,delete t.first_known_index,await(0,d.encryptAES)(JSON.stringify(t),this.key,e.session_id)}async decryptSessions(e){const t=[];for(const[i,n]of Object.entries(e))try{const e=JSON.parse(await(0,d.decryptAES)(n.session_data,this.key,i));e.session_id=i,t.push(e)}catch(e){o.logger.log("Failed to decrypt megolm session from backup",e,n)}return t}async keyMatches(e){if(this.authData.mac){const{mac:t}=await(0,d.calculateKeyCheck)(e,this.authData.iv);return this.authData.mac.replace(/=+$/g,"")===t.replace(/=+/g,"")}return!0}free(){this.key.fill(0)}}t.Aes256=v,(0,r.default)(v,"algorithmName",m.name);const y={[f.algorithmName]:f,[v.algorithmName]:v};t.algorithmsByName=y;const _=f;t.DefaultAlgorithm=_},4830:(e,t,i)=>{"use strict";var n=i(5318);Object.defineProperty(t,"__esModule",{value:!0}),t.DehydrationManager=t.DEHYDRATION_ALGORITHM=void 0;var r=n(i(9713)),s=i(2772),o=i(7585),a=i(2611),c=n(i(9141)),l=i(7434);const h="org.matrix.msc2697.v1.olm.libolm_pickle";t.DEHYDRATION_ALGORITHM=h;const u=6048e5;t.DehydrationManager=class{constructor(e){this.crypto=e,(0,r.default)(this,"inProgress",!1),(0,r.default)(this,"timeoutId",void 0),(0,r.default)(this,"key",void 0),(0,r.default)(this,"keyInfo",void 0),(0,r.default)(this,"deviceDisplayName",void 0),this.getDehydrationKeyFromCache()}async getDehydrationKeyFromCache(){return await this.crypto.cryptoStore.doTxn("readonly",[o.IndexedDBCryptoStore.STORE_ACCOUNT],(e=>{this.crypto.cryptoStore.getSecretStorePrivateKey(e,(async e=>{if(e){const{key:t,keyInfo:n,deviceDisplayName:r,time:o}=e,c=Buffer.from(this.crypto.olmDevice._pickleKey),l=await(0,a.decryptAES)(t,c,h);this.key=(0,s.decodeBase64)(l),this.keyInfo=n,this.deviceDisplayName=r;const d=Date.now(),p=Math.max(1,o+u-d);this.timeoutId=i.g.setTimeout(this.dehydrateDevice.bind(this),p)}}),"dehydration")}))}async setKeyAndQueueDehydration(e,t={},i){await this.setKey(e,t,i)||this.dehydrateDevice()}async setKey(e,t={},n){if(!e)return this.timeoutId&&(i.g.clearTimeout(this.timeoutId),this.timeoutId=void 0),await this.crypto.cryptoStore.doTxn("readwrite",[o.IndexedDBCryptoStore.STORE_ACCOUNT],(e=>{this.crypto.cryptoStore.storeSecretStorePrivateKey(e,"dehydration",null)})),this.key=void 0,void(this.keyInfo=void 0);let r=this.key&&e.length==this.key.length;for(let t=0;r&&t<e.length;t++)e[t]!=this.key[t]&&(r=!1);return r||(this.key=e,this.keyInfo=t,this.deviceDisplayName=n),r}async dehydrateDevice(){if(this.inProgress)l.logger.log("Dehydration already in progress -- not starting new dehydration");else{this.inProgress=!0,this.timeoutId&&(i.g.clearTimeout(this.timeoutId),this.timeoutId=void 0);try{const e=Buffer.from(this.crypto.olmDevice._pickleKey),t=await(0,a.encryptAES)((0,s.encodeBase64)(this.key),e,h);await this.crypto.cryptoStore.doTxn("readwrite",[o.IndexedDBCryptoStore.STORE_ACCOUNT],(e=>{this.crypto.cryptoStore.storeSecretStorePrivateKey(e,"dehydration",{keyInfo:this.keyInfo,key:t,deviceDisplayName:this.deviceDisplayName,time:Date.now()})})),l.logger.log("Attempting to dehydrate device"),l.logger.log("Creating account");const n=new i.g.Olm.Account;n.create();const r=JSON.parse(n.identity_keys()),d=n.max_number_of_one_time_keys();n.generate_one_time_keys(d/2),n.generate_fallback_key();const p=JSON.parse(n.one_time_keys()),g=JSON.parse(n.fallback_key());n.mark_keys_as_published();const f=n.pickle(new Uint8Array(this.key)),m={algorithm:h,account:f};this.keyInfo.passphrase&&(m.passphrase=this.keyInfo.passphrase),l.logger.log("Uploading account to server");const v=(await this.crypto.baseApis.http.authedRequest(void 0,"PUT","/dehydrated_device",void 0,{device_data:m,initial_device_display_name:this.deviceDisplayName},{prefix:"/_matrix/client/unstable/org.matrix.msc2697.v2"})).device_id;l.logger.log("Preparing device keys",v);const y={algorithms:this.crypto.supportedAlgorithms,device_id:v,user_id:this.crypto.userId,keys:{[`ed25519:${v}`]:r.ed25519,[`curve25519:${v}`]:r.curve25519}},_=n.sign(c.default.stringify(y));y.signatures={[this.crypto.userId]:{[`ed25519:${v}`]:_}},this.crypto.crossSigningInfo.getId("self_signing")&&await this.crypto.crossSigningInfo.signObject(y,"self_signing"),l.logger.log("Preparing one-time keys");const S={};for(const[e,t]of Object.entries(p.curve25519)){const i={key:t},r=n.sign(c.default.stringify(i));i.signatures={[this.crypto.userId]:{[`ed25519:${v}`]:r}},S[`signed_curve25519:${e}`]=i}l.logger.log("Preparing fallback keys");const b={};for(const[e,t]of Object.entries(g.curve25519)){const i={key:t,fallback:!0},r=n.sign(c.default.stringify(i));i.signatures={[this.crypto.userId]:{[`ed25519:${v}`]:r}},b[`signed_curve25519:${e}`]=i}return l.logger.log("Uploading keys to server"),await this.crypto.baseApis.http.authedRequest(void 0,"POST","/keys/upload/"+encodeURI(v),void 0,{device_keys:y,one_time_keys:S,"org.matrix.msc2732.fallback_keys":b}),l.logger.log("Done dehydrating"),this.timeoutId=i.g.setTimeout(this.dehydrateDevice.bind(this),u),v}finally{this.inProgress=!1}}}stop(){this.timeoutId&&(i.g.clearTimeout(this.timeoutId),this.timeoutId=void 0)}}},3272:(e,t,i)=>{"use strict";var n=i(5318);Object.defineProperty(t,"__esModule",{value:!0}),t.DeviceInfo=void 0;var r,s=n(i(9713));!function(e){e[e.Blocked=-1]="Blocked",e[e.Unverified=0]="Unverified",e[e.Verified=1]="Verified"}(r||(r={}));class o{static fromStorage(e,t){const i=new o(t);for(const t in e)e.hasOwnProperty(t)&&(i[t]=e[t]);return i}constructor(e){this.deviceId=e,(0,s.default)(this,"algorithms",void 0),(0,s.default)(this,"keys",{}),(0,s.default)(this,"verified",r.Unverified),(0,s.default)(this,"known",!1),(0,s.default)(this,"unsigned",{}),(0,s.default)(this,"signatures",{})}toStorage(){return{algorithms:this.algorithms,keys:this.keys,verified:this.verified,known:this.known,unsigned:this.unsigned,signatures:this.signatures}}getFingerprint(){return this.keys["ed25519:"+this.deviceId]}getIdentityKey(){return this.keys["curve25519:"+this.deviceId]}getDisplayName(){return this.unsigned.device_display_name||null}isBlocked(){return this.verified==r.Blocked}isVerified(){return this.verified==r.Verified}isUnverified(){return this.verified==r.Unverified}isKnown(){return!0===this.known}}t.DeviceInfo=o,(0,s.default)(o,"DeviceVerification",{VERIFIED:r.Verified,UNVERIFIED:r.Unverified,BLOCKED:r.Blocked})},2600:(e,t,i)=>{"use strict";var n=i(862),r=i(5318);Object.defineProperty(t,"__esModule",{value:!0}),t.isCryptoAvailable=function(){return Boolean(i.g.Olm)},t.fixBackupKey=U,t.IncomingRoomKeyRequest=t.Crypto=t.verificationMethods=void 0;var s=r(i(9713)),o=r(i(9141)),a=i(7187),c=i(771),l=i(7434),h=i(2573),u=n(i(2772)),d=i(6670),p=i(3272),g=n(i(1994)),f=i(3075),m=i(636),v=i(4823),y=i(6617),_=i(7585),S=i(1696),b=i(6381),w=i(1597),E=i(4077),I=i(5279),k=i(2842),T=i(9588),C=i(4028),x=i(9489),R=i(2611),O=i(4830),A=i(5537),P=i(4369);const D=p.DeviceInfo.DeviceVerification,M={[S.ReciprocateQRCode.NAME]:S.ReciprocateQRCode,[b.SAS.NAME]:b.SAS,[S.SHOW_QR_CODE_METHOD]:C.IllegalMethod,[S.SCAN_QR_CODE_METHOD]:C.IllegalMethod},N={RECIPROCATE_QR_CODE:S.ReciprocateQRCode.NAME,SAS:b.SAS.NAME};t.verificationMethods=N;class B extends a.EventEmitter{static getOlmVersion(){return h.OlmDevice.getOlmVersion()}constructor(e,t,i,n,r,o,a,p){if(super(),this.baseApis=e,this.sessionStore=t,this.userId=i,this.deviceId=n,this.clientStore=r,this.cryptoStore=o,this.roomList=a,(0,s.default)(this,"backupManager",void 0),(0,s.default)(this,"crossSigningInfo",void 0),(0,s.default)(this,"olmDevice",void 0),(0,s.default)(this,"deviceList",void 0),(0,s.default)(this,"dehydrationManager",void 0),(0,s.default)(this,"secretStorage",void 0),(0,s.default)(this,"reEmitter",void 0),(0,s.default)(this,"verificationMethods",void 0),(0,s.default)(this,"supportedAlgorithms",void 0),(0,s.default)(this,"outgoingRoomKeyRequestManager",void 0),(0,s.default)(this,"toDeviceVerificationRequests",void 0),(0,s.default)(this,"inRoomVerificationRequests",void 0),(0,s.default)(this,"trustCrossSignedDevices",!0),(0,s.default)(this,"lastOneTimeKeyCheck",null),(0,s.default)(this,"oneTimeKeyCheckInProgress",!1),(0,s.default)(this,"roomEncryptors",{}),(0,s.default)(this,"roomDecryptors",{}),(0,s.default)(this,"deviceKeys",{}),(0,s.default)(this,"globalBlacklistUnverifiedDevices",!1),(0,s.default)(this,"globalErrorOnUnknownDevices",!0),(0,s.default)(this,"receivedRoomKeyRequests",[]),(0,s.default)(this,"receivedRoomKeyRequestCancellations",[]),(0,s.default)(this,"processingRoomKeyRequests",!1),(0,s.default)(this,"lazyLoadMembers",!1),(0,s.default)(this,"roomDeviceTrackingState",{}),(0,s.default)(this,"lastNewSessionForced",{}),(0,s.default)(this,"sendKeyRequestsImmediately",!1),(0,s.default)(this,"oneTimeKeyCount",void 0),(0,s.default)(this,"needsNewFallback",void 0),(0,s.default)(this,"onDeviceListUserCrossSigningUpdated",(async e=>{if(e===this.userId){const t=this.deviceList.getStoredCrossSigningForUser(e),i=t?t.getId():null,n=this.crossSigningInfo.getId(),r=n!==i;n&&i&&!r?await this.checkOwnCrossSigningTrust():(this.storeTrustedSelfKeys(null),this.emit("crossSigning.keysChanged",{}),this.emit("userTrustStatusChanged",this.userId,this.checkUserTrust(e)))}else{await this.checkDeviceVerifications(e);const t=this.deviceList.getStoredCrossSigningForUser(e);t&&(t.updateCrossSigningVerifiedBefore(this.checkUserTrust(e).isCrossSigningVerified()),this.deviceList.setRawStoredCrossSigningForUser(e,t.toStorage())),this.emit("userTrustStatusChanged",e,this.checkUserTrust(e))}})),(0,s.default)(this,"onToDeviceEvent",(e=>{try{l.logger.log(`received to_device ${e.getType()} from: ${e.getSender()} id: ${e.getId()}`),"m.room_key"==e.getType()||"m.forwarded_room_key"==e.getType()?this.onRoomKeyEvent(e):"m.room_key_request"==e.getType()?this.onRoomKeyRequestEvent(e):"m.secret.request"===e.getType()?this.secretStorage.onRequestReceived(e):"m.secret.send"===e.getType()?this.secretStorage.onSecretReceived(e):"org.matrix.room_key.withheld"===e.getType()?this.onRoomKeyWithheldEvent(e):e.getContent().transaction_id?this.onKeyVerificationMessage(e):"m.bad.encrypted"===e.getContent().msgtype?this.onToDeviceBadEncrypted(e):(e.isBeingDecrypted()||e.shouldAttemptDecryption())&&(e.isBeingDecrypted()||e.attemptDecryption(this),e.once("Event.decrypted",(e=>{this.onToDeviceEvent(e)})))}catch(e){l.logger.error("Error handling toDeviceEvent:",e)}})),(0,s.default)(this,"onTimelineEvent",((e,t,i,n,{liveEvent:r=!0}={})=>{k.InRoomChannel.validateEvent(e,this.baseApis)&&this.handleVerificationEvent(e,this.inRoomVerificationRequests,(e=>{const t=new k.InRoomChannel(this.baseApis,e.getRoomId());return new I.VerificationRequest(t,this.verificationMethods,this.baseApis)}),r)})),this.reEmitter=new c.ReEmitter(this),p){this.verificationMethods=new Map;for(const e of p)"string"==typeof e?M[e]&&this.verificationMethods.set(e,M[e]):e.NAME?this.verificationMethods.set(e.NAME,e):l.logger.warn(`Excluding unknown verification method ${e}`)}else this.verificationMethods=M;this.backupManager=new A.BackupManager(e,(async()=>{const e=await this.getSessionBackupPrivateKey();if(e)return e;const t=await this.getSecret("m.megolm_backup.v1");if(t){const e=U(t);if(e){const[t]=await this.getSecretStorageKey();await this.storeSecret("m.megolm_backup.v1",e,[t])}return u.decodeBase64(e||t)}if(this.baseApis.cryptoCallbacks&&this.baseApis.cryptoCallbacks.getBackupKey)return await this.baseApis.cryptoCallbacks.getBackupKey();throw new Error("Unable to get private key")})),this.olmDevice=new h.OlmDevice(o),this.deviceList=new d.DeviceList(e,o,this.olmDevice),this.deviceList.on("userCrossSigningUpdated",this.onDeviceListUserCrossSigningUpdated),this.reEmitter.reEmit(this.deviceList,["crypto.devicesUpdated","crypto.willUpdateDevices"]),this.supportedAlgorithms=Object.keys(g.DECRYPTION_CLASSES),this.outgoingRoomKeyRequestManager=new y.OutgoingRoomKeyRequestManager(e,this.deviceId,this.cryptoStore),this.toDeviceVerificationRequests=new T.ToDeviceRequests,this.inRoomVerificationRequests=new k.InRoomRequests;const m=this.baseApis.cryptoCallbacks||{},_=(0,f.createCryptoStoreCacheCallbacks)(o,this.olmDevice);this.crossSigningInfo=new f.CrossSigningInfo(i,m,_),this.secretStorage=new v.SecretStorage(e,m,e),this.dehydrationManager=new O.DehydrationManager(this),!m.getCrossSigningKey&&m.getSecretStorageKey&&(m.getCrossSigningKey=async e=>f.CrossSigningInfo.getFromSecretStorage(e,this.secretStorage))}async init({exportedOlmDevice:e,pickleKey:t}={}){l.logger.log("Crypto: initialising Olm..."),await i.g.Olm.init(),l.logger.log(e?"Crypto: initialising Olm device from exported device...":"Crypto: initialising Olm device..."),await this.olmDevice.init({fromExportedDevice:e,pickleKey:t}),l.logger.log("Crypto: loading device list..."),await this.deviceList.load(),this.deviceKeys["ed25519:"+this.deviceId]=this.olmDevice.deviceEd25519Key,this.deviceKeys["curve25519:"+this.deviceId]=this.olmDevice.deviceCurve25519Key,l.logger.log("Crypto: fetching own devices...");let n=this.deviceList.getRawStoredDevicesForUser(this.userId);if(n||(n={}),!n[this.deviceId]){l.logger.log("Crypto: adding this device to the store...");const e={keys:this.deviceKeys,algorithms:this.supportedAlgorithms,verified:D.VERIFIED,known:!0};n[this.deviceId]=e,this.deviceList.storeDevicesForUser(this.userId,n),this.deviceList.saveIfDirty()}await this.cryptoStore.doTxn("readonly",[_.IndexedDBCryptoStore.STORE_ACCOUNT],(e=>{this.cryptoStore.getCrossSigningKeys(e,(e=>{e&&0!==Object.keys(e).length&&(l.logger.log("Loaded cross-signing public keys from crypto store"),this.crossSigningInfo.setKeys(e))}))})),this.deviceList.startTrackingDeviceList(this.userId),l.logger.log("Crypto: checking for key backup..."),this.backupManager.checkAndStart()}getCryptoTrustCrossSignedDevices(){return this.trustCrossSignedDevices}setCryptoTrustCrossSignedDevices(e){this.trustCrossSignedDevices=e;for(const e of this.deviceList.getKnownUserIds()){const t=this.deviceList.getRawStoredDevicesForUser(e);for(const i of Object.keys(t)){const t=this.checkDeviceTrust(e,i);if(!t.isLocallyVerified()&&t.isCrossSigningVerified()){const t=this.deviceList.getStoredDevice(e,i);this.emit("deviceVerificationChanged",e,i,t)}}}}async createRecoveryKeyFromPassphrase(e){const t=new i.g.Olm.PkDecryption;try{const i={};if(e){const n=await(0,w.keyFromPassphrase)(e);i.passphrase={algorithm:"m.pbkdf2",iterations:n.iterations,salt:n.salt},i.pubkey=t.init_with_private_key(n.key)}else i.pubkey=t.generate_key();const n=t.get_private_key();return{keyInfo:i,encodedPrivateKey:(0,E.encodeRecoveryKey)(n),privateKey:n}}finally{t&&t.free()}}async isCrossSigningReady(){const e=this.crossSigningInfo.getId(),t=await this.crossSigningInfo.isStoredInKeyCache()||await this.crossSigningInfo.isStoredInSecretStorage(this.secretStorage);return!(!e||!t)}async isSecretStorageReady(){const e=await this.secretStorage.hasKey(),t=await this.crossSigningInfo.isStoredInSecretStorage(this.secretStorage),i=!this.backupManager.getKeyBackupEnabled()||await this.baseApis.isKeyBackupKeyStored();return!!(e&&t&&i)}async bootstrapCrossSigning({authUploadDeviceSigningKeys:e,setupNewCrossSigning:t}={}){l.logger.log("Bootstrapping cross-signing");const i=this.baseApis.cryptoCallbacks,n=new m.EncryptionSetupBuilder(this.baseApis.store.accountData,i),r=new f.CrossSigningInfo(this.userId,n.crossSigningCallbacks,n.crossSigningCallbacks),s=this.crossSigningInfo.getId(),o=await this.crossSigningInfo.isStoredInKeyCache(),a=await this.crossSigningInfo.isStoredInSecretStorage(this.secretStorage),c=o||a;l.logger.log({setupNewCrossSigning:t,publicKeysOnDevice:s,privateKeysInCache:o,privateKeysInStorage:a,privateKeysExistSomewhere:c}),!c||t?(l.logger.log("Cross-signing private keys not found locally or in secret storage, creating new keys"),await(async()=>{r.resetKeys(),await this.signObject(r.keys.master),n.addCrossSigningKeys(e,r.keys);const t=this.deviceList.getStoredDevice(this.userId,this.deviceId),i=await r.signDevice(this.userId,t);n.addKeySignature(this.userId,this.deviceId,i),this.backupManager.backupInfo&&(await r.signObject(this.backupManager.backupInfo.auth_data,"master"),n.addSessionBackup(this.backupManager.backupInfo))})()):s&&o?l.logger.log("Cross-signing public keys trusted and private keys found locally"):a&&(l.logger.log("Cross-signing private keys not found locally, but they are available in secret storage, reading storage and caching locally"),await this.checkOwnCrossSigningTrust({allowPrivateKeyRequests:!0}));const h=n.crossSigningCallbacks.privateKeys;if(h.size&&!this.baseApis.cryptoCallbacks.saveCrossSigningKeys){const e=new v.SecretStorage(n.accountDataClientAdapter,n.ssssCryptoCallbacks);await e.hasKey()&&(l.logger.log("Storing new cross-signing private keys in secret storage"),await f.CrossSigningInfo.storeInSecretStorage(h,e))}const u=n.buildOperation();await u.apply(this),await n.persist(this),l.logger.log("Cross-signing ready")}async bootstrapSecretStorage({createSecretStorageKey:e=(async()=>({})),keyBackupInfo:t,setupNewKeyBackup:i,setupNewSecretStorage:n,getKeyBackupPassphrase:r}={}){l.logger.log("Bootstrapping Secure Secret Storage");const s=this.baseApis.cryptoCallbacks,o=new m.EncryptionSetupBuilder(this.baseApis.store.accountData,s),a=new v.SecretStorage(o.accountDataClientAdapter,o.ssssCryptoCallbacks);let c=null;const h=async(e,t)=>{e=e||{},t&&(e.key=t);const{keyId:i,keyInfo:n}=await a.addKey(v.SECRET_STORAGE_ALGORITHM_V1_AES,e);return t&&o.ssssCryptoCallbacks.addPrivateKey(i,n,t),await a.setDefaultKeyId(i),i},d=async e=>{if(this.crossSigningInfo.getId()&&await this.crossSigningInfo.isStoredInKeyCache("master"))try{l.logger.log("Adding cross-signing signature to key backup"),await this.crossSigningInfo.signObject(e,"master")}catch(e){l.logger.error("Signing key backup with cross-signing keys failed",e)}else l.logger.warn("Cross-signing keys not available, skipping signature on key backup")},p=await this.getSecretStorageKey(),[g,y]=p||[null,null],_=!n&&y&&y.algorithm===v.SECRET_STORAGE_ALGORITHM_V1_AES;if(l.logger.log({keyBackupInfo:t,setupNewKeyBackup:i,setupNewSecretStorage:n,storageExists:_,oldKeyInfo:y}),_||t)if(!_&&t){l.logger.log("Secret storage does not exist, using key backup key");const e=await this.getSessionBackupPrivateKey()||await r(),i={};t.auth_data.private_key_salt&&t.auth_data.private_key_iterations&&(i.passphrase={algorithm:"m.pbkdf2",iterations:t.auth_data.private_key_iterations,salt:t.auth_data.private_key_salt,bits:256}),c=await h(i,e),await a.store("m.megolm_backup.v1",u.encodeBase64(e),[c]),await d(t.auth_data),o.addSessionBackup(t)}else l.logger.log("Secret storage exists"),y&&y.algorithm===v.SECRET_STORAGE_ALGORITHM_V1_AES&&await(async(e,t)=>{if(!t.mac){const i=await this.baseApis.cryptoCallbacks.getSecretStorageKey({keys:{[e]:t}},"");if(i){const n=i[1];o.ssssCryptoCallbacks.addPrivateKey(e,t,n);const{iv:r,mac:s}=await(0,R.calculateKeyCheck)(n);t.iv=r,t.mac=s,await o.setAccountData(`m.secret_storage.key.${e}`,t)}}})(g,y);else{l.logger.log("Secret storage does not exist, creating new storage key");const{keyInfo:t,privateKey:i}=await e();c=await h(t,i)}if(!this.baseApis.cryptoCallbacks.saveCrossSigningKeys&&await this.isCrossSigningReady()&&(c||!await this.crossSigningInfo.isStoredInSecretStorage(a))){l.logger.log("Copying cross-signing private keys from cache to secret storage");const e=await this.crossSigningInfo.getCrossSigningKeysFromCache();await f.CrossSigningInfo.storeInSecretStorage(e,a)}if(i&&!t){l.logger.log("Creating new message key backup version");const e=await this.baseApis.prepareKeyBackupVersion(null,{secureSecretStorage:!1}),t=(0,E.decodeRecoveryKey)(e.recovery_key);await a.store("m.megolm_backup.v1",u.encodeBase64(t));const i={algorithm:e.algorithm,auth_data:e.auth_data};await d(i.auth_data),await this.signObject(i.auth_data),o.addSessionBackup(i)}const S=await a.get("m.megolm_backup.v1");if(S){l.logger.info("Got session backup key from secret storage: caching");const e=U(S);e&&await a.store("m.megolm_backup.v1",e,[c||g]);const t=new Uint8Array(u.decodeBase64(e||S));await o.addSessionBackupPrivateKeyToCache(t)}else if(this.backupManager.getKeyBackupEnabled()){const e=await this.getSessionBackupPrivateKey()||await r();if(!e)return void l.logger.error("Key backup is enabled but couldn't get key backup key!");l.logger.info("Got session backup key from cache/user that wasn't in SSSS: saving to SSSS"),await a.store("m.megolm_backup.v1",u.encodeBase64(e))}const b=o.buildOperation();await b.apply(this),await o.persist(this),l.logger.log("Secure Secret Storage ready")}addSecretStorageKey(e,t,i){return this.secretStorage.addKey(e,t,i)}hasSecretStorageKey(e){return this.secretStorage.hasKey(e)}getSecretStorageKey(e){return this.secretStorage.getKey(e)}storeSecret(e,t,i){return this.secretStorage.store(e,t,i)}getSecret(e){return this.secretStorage.get(e)}isSecretStored(e,t){return this.secretStorage.isStored(e,t)}requestSecret(e,t){return t||(t=Object.keys(this.deviceList.getRawStoredDevicesForUser(this.userId))),this.secretStorage.request(e,t)}getDefaultSecretStorageKeyId(){return this.secretStorage.getDefaultKeyId()}setDefaultSecretStorageKeyId(e){return this.secretStorage.setDefaultKeyId(e)}checkSecretStorageKey(e,t){return this.secretStorage.checkKey(e,t)}checkSecretStoragePrivateKey(e,t){let n=null;try{return n=new i.g.Olm.PkDecryption,n.init_with_private_key(e)===t}finally{n&&n.free()}}async getSessionBackupPrivateKey(){let e=await new Promise((e=>{this.cryptoStore.doTxn("readonly",[_.IndexedDBCryptoStore.STORE_ACCOUNT],(t=>{this.cryptoStore.getSecretStorePrivateKey(t,e,"m.megolm_backup.v1")}))}));if(e&&"string"==typeof e&&(e=new Uint8Array(u.decodeBase64(U(e)||e)),await this.storeSessionBackupPrivateKey(e)),e&&e.ciphertext){const t=Buffer.from(this.olmDevice._pickleKey),i=await(0,R.decryptAES)(e,t,"m.megolm_backup.v1");e=u.decodeBase64(i)}return e}async storeSessionBackupPrivateKey(e){if(!(e instanceof Uint8Array))throw new Error(`storeSessionBackupPrivateKey expects Uint8Array, got ${e}`);const t=Buffer.from(this.olmDevice._pickleKey),i=await(0,R.encryptAES)(u.encodeBase64(e),t,"m.megolm_backup.v1");return this.cryptoStore.doTxn("readwrite",[_.IndexedDBCryptoStore.STORE_ACCOUNT],(e=>{this.cryptoStore.storeSecretStorePrivateKey(e,"m.megolm_backup.v1",i)}))}checkCrossSigningPrivateKey(e,t){let n=null;try{return n=new i.g.Olm.PkSigning,n.init_with_seed(e)===t}finally{n&&n.free()}}async afterCrossSigningLocalKeyChange(){l.logger.info("Starting cross-signing key change post-processing");const e=this.deviceList.getStoredDevice(this.userId,this.deviceId),t=await this.crossSigningInfo.signDevice(this.userId,e);l.logger.info(`Starting background key sig upload for ${this.deviceId}`);const i=({shouldEmit:e})=>this.baseApis.uploadKeySignatures({[this.userId]:{[this.deviceId]:t}}).then((t=>{const{failures:n}=t||{};if(Object.keys(n||[]).length>0)throw e&&this.baseApis.emit("crypto.keySignatureUploadFailure",n,"afterCrossSigningLocalKeyChange",i),new x.KeySignatureUploadError("Key upload failed",{failures:n});l.logger.info(`Finished background key sig upload for ${this.deviceId}`)})).catch((e=>{l.logger.error(`Error during background key sig upload for ${this.deviceId}`,e)}));i({shouldEmit:!0});const n=this.baseApis.cryptoCallbacks.shouldUpgradeDeviceVerifications;if(n){l.logger.info("Starting device verification upgrade");const e={};for(const[t,i]of Object.entries(this.deviceList.crossSigningInfo)){const n=await this.checkForDeviceVerificationUpgrade(t,f.CrossSigningInfo.fromStorage(i,t));n&&(e[t]=n)}if(Object.keys(e).length>0){l.logger.info(`Found ${Object.keys(e).length} verif users to upgrade`);try{const t=await n({users:e});if(t)for(const i of t)i in e&&await this.baseApis.setDeviceVerified(i,e[i].crossSigningInfo.getId())}catch(e){l.logger.log("shouldUpgradeDeviceVerifications threw an error: not upgrading",e)}}l.logger.info("Finished device verification upgrade")}l.logger.info("Finished cross-signing key change post-processing")}async checkForDeviceVerificationUpgrade(e,t){const i=this.crossSigningInfo.checkUserTrust(t);if(t.firstUse&&!i.isVerified()){const i=this.deviceList.getRawStoredDevicesForUser(e),n=await this.checkForValidDeviceSignature(e,t.keys.master,i);if(n.length)return{devices:n.map((e=>p.DeviceInfo.fromStorage(i[e],e))),crossSigningInfo:t}}}async checkForValidDeviceSignature(e,t,i){const n=[];if(i&&t.signatures&&t.signatures[e])for(const r of Object.keys(t.signatures[e])){const[,s]=r.split(":",2);if(s in i&&i[s].verified===D.VERIFIED)try{await u.verifySignature(this.olmDevice,t,e,s,i[s].keys[r]),n.push(s)}catch(e){}}return n}getCrossSigningId(e){return this.crossSigningInfo.getId(e)}getStoredCrossSigningForUser(e){return this.deviceList.getStoredCrossSigningForUser(e)}checkUserTrust(e){const t=this.deviceList.getStoredCrossSigningForUser(e);return t?this.crossSigningInfo.checkUserTrust(t):new f.UserTrustLevel(!1,!1,!1)}checkDeviceTrust(e,t){const i=this.deviceList.getStoredDevice(e,t);return this.checkDeviceInfoTrust(e,i)}checkDeviceInfoTrust(e,t){const i=!(!t||!t.isVerified()),n=this.deviceList.getStoredCrossSigningForUser(e);if(t&&n){const r=this.trustCrossSignedDevices||e===this.userId;return this.crossSigningInfo.checkDeviceTrust(n,t,i,r)}return new f.DeviceTrustLevel(!1,!1,i,!1)}async checkOwnCrossSigningTrust({allowPrivateKeyRequests:e=!1}={}){const t=this.userId;await this.downloadKeys([this.userId]);const i=await this.crossSigningInfo.getCrossSigningKeysFromCache(),n=this.deviceList.getStoredCrossSigningForUser(t);if(!n)return void l.logger.error("Got cross-signing update event for user "+t+" but no new cross-signing information found!");const r=n.getId(),s=this.crossSigningInfo.getId()!==r,o=n.getId()&&!i.has("master");if(s&&l.logger.info("Got new master public key",r),e&&(s||o)){l.logger.info("Attempting to retrieve cross-signing master private key");let e=null;try{e=(await this.crossSigningInfo.getCrossSigningKey("master",r))[1],l.logger.info("Got cross-signing master private key")}finally{e&&e.free()}}const a=this.crossSigningInfo.getId("self_signing"),c=this.crossSigningInfo.getId("user_signing");this.storeTrustedSelfKeys(n.keys);const h=a!==n.getId("self_signing"),u=c!==n.getId("user_signing"),d=n.getId("self_signing")&&!i.has("self_signing"),p=n.getId("user_signing")&&!i.has("user_signing"),g={};if(h&&l.logger.info("Got new self-signing key",n.getId("self_signing")),e&&(h||d)){l.logger.info("Attempting to retrieve cross-signing self-signing private key");let e=null;try{e=(await this.crossSigningInfo.getCrossSigningKey("self_signing",n.getId("self_signing")))[1],l.logger.info("Got cross-signing self-signing private key")}finally{e&&e.free()}const t=this.deviceList.getStoredDevice(this.userId,this.deviceId),i=await this.crossSigningInfo.signDevice(this.userId,t);g[this.deviceId]=i}if(u&&l.logger.info("Got new user-signing key",n.getId("user_signing")),e&&(u||p)){l.logger.info("Attempting to retrieve cross-signing user-signing private key");let e=null;try{e=(await this.crossSigningInfo.getCrossSigningKey("user_signing",n.getId("user_signing")))[1],l.logger.info("Got cross-signing user-signing private key")}finally{e&&e.free()}}if(s){const e=this.crossSigningInfo.keys.master;await this.signObject(e);const t=e.signatures[this.userId]["ed25519:"+this.deviceId];g[this.crossSigningInfo.getId()]=Object.assign({},e,{signatures:{[this.userId]:{["ed25519:"+this.deviceId]:t}}})}const f=Object.keys(g);if(f.length){const e=({shouldEmit:t})=>(l.logger.info(`Starting background key sig upload for ${f}`),this.baseApis.uploadKeySignatures({[this.userId]:g}).then((i=>{const{failures:n}=i||{};if(l.logger.info(`Finished background key sig upload for ${f}`),Object.keys(n||[]).length>0)throw t&&this.baseApis.emit("crypto.keySignatureUploadFailure",n,"checkOwnCrossSigningTrust",e),new x.KeySignatureUploadError("Key upload failed",{failures:n})})).catch((e=>{l.logger.error(`Error during background key sig upload for ${f}`,e)})));e({shouldEmit:!0})}this.emit("userTrustStatusChanged",t,this.checkUserTrust(t)),s&&(this.baseApis.emit("crossSigning.keysChanged",{}),await this.afterCrossSigningLocalKeyChange()),await this.backupManager.checkKeyBackup()}async storeTrustedSelfKeys(e){e?this.crossSigningInfo.setKeys(e):this.crossSigningInfo.clearKeys(),await this.cryptoStore.doTxn("readwrite",[_.IndexedDBCryptoStore.STORE_ACCOUNT],(e=>{this.cryptoStore.storeCrossSigningKeys(e,this.crossSigningInfo.keys)}))}async checkDeviceVerifications(e){const t=this.baseApis.cryptoCallbacks.shouldUpgradeDeviceVerifications;if(t){if(l.logger.info(`Starting device verification upgrade for ${e}`),this.crossSigningInfo.keys.user_signing){const i=this.deviceList.getStoredCrossSigningForUser(e);if(i){const n=await this.checkForDeviceVerificationUpgrade(e,i);n&&(await t({users:{[e]:n}})).includes(e)&&await this.baseApis.setDeviceVerified(e,i.getId())}}l.logger.info(`Finished device verification upgrade for ${e}`)}}async setTrustedBackupPubKey(e){this.sessionStore.setLocalTrustedBackupPubKey(e),await this.backupManager.checkKeyBackup()}enableLazyLoading(){this.lazyLoadMembers=!0}registerEventHandlers(e){e.on("RoomMember.membership",((e,t,i)=>{try{this.onRoomMembership(e,t,i)}catch(e){l.logger.error("Error handling membership change:",e)}})),e.on("toDeviceEvent",this.onToDeviceEvent),e.on("Room.timeline",this.onTimelineEvent),e.on("Event.decrypted",this.onTimelineEvent)}start(){this.outgoingRoomKeyRequestManager.start()}stop(){this.outgoingRoomKeyRequestManager.stop(),this.deviceList.stop(),this.dehydrationManager.stop()}getDeviceEd25519Key(){return this.olmDevice.deviceEd25519Key}getDeviceCurve25519Key(){return this.olmDevice.deviceCurve25519Key}setGlobalBlacklistUnverifiedDevices(e){this.globalBlacklistUnverifiedDevices=e}getGlobalBlacklistUnverifiedDevices(){return this.globalBlacklistUnverifiedDevices}setGlobalErrorOnUnknownDevices(e){this.globalErrorOnUnknownDevices=e}getGlobalErrorOnUnknownDevices(){return this.globalErrorOnUnknownDevices}uploadDeviceKeys(){const e={algorithms:this.supportedAlgorithms,device_id:this.deviceId,keys:this.deviceKeys,user_id:this.userId};return this.signObject(e).then((()=>this.baseApis.uploadKeysRequest({device_keys:e})))}updateOneTimeKeyCount(e){if(!isFinite(e))throw new TypeError("Parameter for updateOneTimeKeyCount has to be a number");this.oneTimeKeyCount=e}setNeedsNewFallback(e){this.needsNewFallback=!!e}getNeedsNewFallback(){return this.needsNewFallback}maybeUploadOneTimeKeys(){if(this.oneTimeKeyCheckInProgress)return;const e=Date.now();if(null!==this.lastOneTimeKeyCheck&&e-this.lastOneTimeKeyCheck<6e4)return;this.lastOneTimeKeyCheck=e;const t=this.olmDevice.maxNumberOfOneTimeKeys(),i=Math.floor(t/2),n=async e=>{for(;i>e||this.getNeedsNewFallback();){if(i>e){l.logger.info("generating oneTimeKeys");const t=Math.min(i-e,5);await this.olmDevice.generateOneTimeKeys(t)}this.getNeedsNewFallback()&&(l.logger.info("generating fallback key"),await this.olmDevice.generateFallbackKey()),l.logger.info("calling uploadOneTimeKeys");const t=await this.uploadOneTimeKeys();if(!t.one_time_key_counts||!t.one_time_key_counts.signed_curve25519)throw new Error("response for uploading keys does not contain one_time_key_counts.signed_curve25519");e=t.one_time_key_counts.signed_curve25519}};this.oneTimeKeyCheckInProgress=!0,Promise.resolve().then((()=>void 0!==this.oneTimeKeyCount?Promise.resolve(this.oneTimeKeyCount):this.baseApis.uploadKeysRequest({}).then((e=>e.one_time_key_counts.signed_curve25519||0)))).then((e=>n(e))).catch((e=>{l.logger.error("Error uploading one-time keys",e.stack||e)})).finally((()=>{this.oneTimeKeyCount=void 0,this.oneTimeKeyCheckInProgress=!1}))}async uploadOneTimeKeys(){const e=[],t={};if(this.getNeedsNewFallback()){const i=await this.olmDevice.getFallbackKey();for(const[n,r]of Object.entries(i.curve25519)){const i={key:r,fallback:!0};t["signed_curve25519:"+n]=i,e.push(this.signObject(i))}this.setNeedsNewFallback(!1)}const i=await this.olmDevice.getOneTimeKeys(),n={};for(const t in i.curve25519)if(i.curve25519.hasOwnProperty(t)){const r={key:i.curve25519[t]};n["signed_curve25519:"+t]=r,e.push(this.signObject(r))}await Promise.all(e);const r=await this.baseApis.uploadKeysRequest({one_time_keys:n,"org.matrix.msc2732.fallback_keys":t});return await this.olmDevice.markKeysAsPublished(),r}downloadKeys(e,t){return this.deviceList.downloadKeys(e,t)}getStoredDevicesForUser(e){return this.deviceList.getStoredDevicesForUser(e)}getStoredDevice(e,t){return this.deviceList.getStoredDevice(e,t)}saveDeviceList(e){return this.deviceList.saveIfDirty(e)}async setDeviceVerification(e,t,i,n,r){void 0===i&&(i=null),void 0===n&&(n=null),void 0===r&&(r=null);const s=this.deviceList.getStoredCrossSigningForUser(e);if(s&&s.getId()===t){if(null!==n||null!==r)throw new Error("Cannot set blocked or known for a cross-signing key");if(!i)throw new Error("Cannot set a cross-signing key as unverified");if(this.crossSigningInfo.getId()||e!==this.crossSigningInfo.userId||(this.storeTrustedSelfKeys(s.keys),this.emit("userTrustStatusChanged",this.userId,this.checkUserTrust(e))),e!==this.userId){l.logger.info("Master key "+s.getId()+" for "+e+" marked verified. Signing...");const i=await this.crossSigningInfo.signUser(s);if(i){const n=async({shouldEmit:r})=>{l.logger.info("Uploading signature for "+e+"...");const s=await this.baseApis.uploadKeySignatures({[e]:{[t]:i}}),{failures:o}=s||{};if(Object.keys(o||[]).length>0)throw r&&this.baseApis.emit("crypto.keySignatureUploadFailure",o,"setDeviceVerification",n),new x.KeySignatureUploadError("Key upload failed",{failures:o})};await n({shouldEmit:!0})}return i}return s}const o=this.deviceList.getRawStoredDevicesForUser(e);if(!o||!o[t])throw new Error("Unknown device "+e+":"+t);const a=o[t];let c=a.verified;i?c=D.VERIFIED:null!==i&&c==D.VERIFIED&&(c=D.UNVERIFIED),n?c=D.BLOCKED:null!==n&&c==D.BLOCKED&&(c=D.UNVERIFIED);let h=a.known;if(null!==r&&(h=r),a.verified===c&&a.known===h||(a.verified=c,a.known=h,this.deviceList.storeDevicesForUser(e,o),this.deviceList.saveIfDirty()),i&&e===this.userId){let i;if(l.logger.info("Own device "+t+" marked verified: signing"),this.checkDeviceTrust(e,t).isCrossSigningVerified()?l.logger.log(`Own device ${t} already cross-signing verified`):i=await this.crossSigningInfo.signDevice(e,p.DeviceInfo.fromStorage(a,t)),i){const n=async({shouldEmit:r})=>{l.logger.info("Uploading signature for "+t);const s=await this.baseApis.uploadKeySignatures({[e]:{[t]:i}}),{failures:o}=s||{};if(Object.keys(o||[]).length>0)throw r&&this.baseApis.emit("crypto.keySignatureUploadFailure",o,"setDeviceVerification",n),new x.KeySignatureUploadError("Key upload failed",{failures:o})};await n({shouldEmit:!0})}}const u=p.DeviceInfo.fromStorage(a,t);return this.emit("deviceVerificationChanged",e,t,u),u}findVerificationRequestDMInProgress(e){return this.inRoomVerificationRequests.findRequestInProgress(e)}getVerificationRequestsToDeviceInProgress(e){return this.toDeviceVerificationRequests.getRequestsInProgress(e)}requestVerificationDM(e,t){const i=this.inRoomVerificationRequests.findRequestInProgress(t);if(i)return Promise.resolve(i);const n=new k.InRoomChannel(this.baseApis,t,e);return this.requestVerificationWithChannel(e,n,this.inRoomVerificationRequests)}requestVerification(e,t){t||(t=Object.keys(this.deviceList.getRawStoredDevicesForUser(e)));const i=this.toDeviceVerificationRequests.findRequestInProgress(e,t);if(i)return Promise.resolve(i);const n=new T.ToDeviceChannel(this.baseApis,e,t,T.ToDeviceChannel.makeTransactionId());return this.requestVerificationWithChannel(e,n,this.toDeviceVerificationRequests)}async requestVerificationWithChannel(e,t,i){let n=new I.VerificationRequest(t,this.verificationMethods,this.baseApis);t.transactionId&&i.setRequestByChannel(t,n),await n.sendRequest();const r=i.getRequestByChannel(t);return r?n=r:(l.logger.log(`Crypto: adding new request to requestsByTxnId with id ${t.transactionId} ${t.roomId}`),i.setRequestByChannel(t,n)),n}beginKeyVerification(e,t,i,n=null){let r;if(n){if(r=this.toDeviceVerificationRequests.getRequestBySenderAndTxnId(t,n),!r)throw new Error(`No request found for user ${t} with transactionId ${n}`)}else{n=T.ToDeviceChannel.makeTransactionId();const e=new T.ToDeviceChannel(this.baseApis,t,[i],n,i);r=new I.VerificationRequest(e,this.verificationMethods,this.baseApis),this.toDeviceVerificationRequests.setRequestBySenderAndTxnId(t,n,r)}return r.beginKeyVerification(e,{userId:t,deviceId:i})}async legacyDeviceVerification(e,t,i){const n=T.ToDeviceChannel.makeTransactionId(),r=new T.ToDeviceChannel(this.baseApis,e,[t],n,t),s=new I.VerificationRequest(r,this.verificationMethods,this.baseApis);this.toDeviceVerificationRequests.setRequestBySenderAndTxnId(e,n,s);const o=s.beginKeyVerification(i,{userId:e,deviceId:t});return await Promise.race([o.verify(),s.waitFor((e=>e.started))]),s}async getOlmSessionsForUser(e){const t=this.getStoredDevicesForUser(e)||[],i={};for(let e=0;e<t.length;++e){const n=t[e],r=n.getIdentityKey(),s=await this.olmDevice.getSessionInfoForDevice(r);i[n.deviceId]={deviceIdKey:r,sessions:s}}return i}getEventSenderDeviceInfo(e){const t=e.getSenderKey(),i=e.getWireContent().algorithm;if(!t||!i)return null;if(e.getForwardingCurve25519KeyChain().length>0)return null;if(e.isKeySourceUntrusted())return null;const n=this.deviceList.getDeviceByIdentityKey(i,t);if(null===n)return null;const r=e.getClaimedEd25519Key();return r?r!==n.getFingerprint()?(l.logger.warn("Event "+e.getId()+" claims ed25519 key "+r+" but sender device has key "+n.getFingerprint()),null):n:(l.logger.warn("Event "+e.getId()+" claims no ed25519 key: cannot verify sending device"),null)}getEventEncryptionInfo(e){const t={};if(t.senderKey=e.getSenderKey(),t.algorithm=e.getWireContent().algorithm,!t.senderKey||!t.algorithm)return t.encrypted=!1,t;t.encrypted=!0,e.getForwardingCurve25519KeyChain().length>0||e.isKeySourceUntrusted()?t.authenticated=!1:t.authenticated=!0,t.sender=this.deviceList.getDeviceByIdentityKey(t.algorithm,t.senderKey);const i=e.getClaimedEd25519Key();return i||(l.logger.warn("Event "+e.getId()+" claims no ed25519 key: cannot verify sending device"),t.mismatchedSender=!0),t.sender&&i!==t.sender.getFingerprint()&&(l.logger.warn("Event "+e.getId()+" claims ed25519 key "+i+"but sender device has key "+t.sender.getFingerprint()),t.mismatchedSender=!0),t}forceDiscardSession(e){const t=this.roomEncryptors[e];if(void 0===t)throw new Error("Room not encrypted");if(void 0===t.forceDiscardSession)throw new Error("Room encryption algorithm doesn't support session discarding");t.forceDiscardSession()}async setRoomEncryption(e,t,i){if(!t.algorithm)return void l.logger.log("Ignoring setRoomEncryption with no algorithm");const n=this.roomList.getRoomEncryption(e);if(n&&JSON.stringify(n)!=JSON.stringify(t))return void l.logger.error("Ignoring m.room.encryption event which requests a change of config in "+e);if(this.roomEncryptors[e])return;let r=null;n||(r=this.roomList.setRoomEncryption(e,t));const s=g.ENCRYPTION_CLASSES[t.algorithm];if(!s)throw new Error("Unable to encrypt with "+t.algorithm);const o=new s({userId:this.userId,deviceId:this.deviceId,crypto:this,olmDevice:this.olmDevice,baseApis:this.baseApis,roomId:e,config:t});this.roomEncryptors[e]=o,r&&await r,this.lazyLoadMembers?l.logger.log("Enabling encryption in "+e):(l.logger.log("Enabling encryption in "+e+"; starting to track device lists for all users therein"),await this.trackRoomDevices(e),i||this.deviceList.refreshOutdatedDeviceLists())}trackRoomDevices(e){let t=this.roomDeviceTrackingState[e];return t||(t=(async()=>{if(!this.roomEncryptors[e])return;const t=this.clientStore.getRoom(e);if(!t)throw new Error(`Unable to start tracking devices in unknown room ${e}`);l.logger.log(`Starting to track devices for room ${e} ...`),(await t.getEncryptionTargetMembers()).forEach((e=>{this.deviceList.startTrackingDeviceList(e.userId)}))})(),this.roomDeviceTrackingState[e]=t.catch((t=>{throw this.roomDeviceTrackingState[e]=null,t}))),t}ensureOlmSessionsForUsers(e){const t={};for(let i=0;i<e.length;++i){const n=e[i];t[n]=[];const r=this.getStoredDevicesForUser(n)||[];for(let e=0;e<r.length;++e){const i=r[e];i.getIdentityKey()!=this.olmDevice.deviceCurve25519Key&&i.verified!=D.BLOCKED&&t[n].push(i)}}return u.ensureOlmSessionsForDevices(this.olmDevice,this.baseApis,t)}async exportRoomKeys(){const e=[];return await this.cryptoStore.doTxn("readonly",[_.IndexedDBCryptoStore.STORE_INBOUND_GROUP_SESSIONS],(t=>{this.cryptoStore.getAllEndToEndInboundGroupSessions(t,(t=>{if(null===t)return;const i=this.olmDevice.exportInboundGroupSession(t.senderKey,t.sessionId,t.sessionData);delete i.first_known_index,i.algorithm=u.MEGOLM_ALGORITHM,e.push(i)}))})),e}importRoomKeys(e,t={}){let i=0,n=0;const r=e.length;function s(){t.progressCallback({stage:"load_keys",successes:i,failures:n,total:r})}return Promise.all(e.map((e=>e.room_id&&e.algorithm?this.getRoomDecryptor(e.room_id,e.algorithm).importRoomKey(e,t).finally((()=>{i++,t.progressCallback&&s()})):(l.logger.warn("ignoring room key entry with missing fields",e),n++,t.progressCallback&&s(),null))))}countSessionsNeedingBackup(){return this.backupManager.countSessionsNeedingBackup()}prepareToEncrypt(e){const t=this.roomEncryptors[e.roomId];t&&t.prepareToEncrypt(e)}async encryptEvent(e,t){if(!t)throw new Error("Cannot send encrypted messages in unknown rooms");const i=e.getRoomId(),n=this.roomEncryptors[i];if(!n)throw new Error("Room was previously configured to use encryption, but is no longer. Perhaps the homeserver is hiding the configuration event.");this.roomDeviceTrackingState[i]||this.trackRoomDevices(i),await this.roomDeviceTrackingState[i];let r=e.getContent();const s=r["m.relates_to"];s&&(r=Object.assign({},r),delete r["m.relates_to"]);const o=await n.encryptMessage(t,e.getType(),r);s&&(o["m.relates_to"]=s),e.makeEncrypted("m.room.encrypted",o,this.olmDevice.deviceCurve25519Key,this.olmDevice.deviceEd25519Key)}async decryptEvent(e){if(e.isRedacted()){const t=new P.MatrixEvent(e.getUnsigned().redacted_because),i=await this.decryptEvent(t);return{clearEvent:{room_id:e.getRoomId(),type:"m.room.message",content:{},unsigned:{redacted_because:i.clearEvent}}}}{const t=e.getWireContent(),i=this.getRoomDecryptor(e.getRoomId(),t.algorithm);return await i.decryptEvent(e)}}async handleDeviceListChanges(e,t){e.oldSyncToken&&await this.evalDeviceListChanges(t)}requestRoomKey(e,t,i=!1){return this.outgoingRoomKeyRequestManager.queueRoomKeyRequest(e,t,i).then((()=>{this.sendKeyRequestsImmediately&&this.outgoingRoomKeyRequestManager.sendQueuedRequests()})).catch((e=>{l.logger.error("Error requesting key for event",e)}))}cancelRoomKeyRequest(e){this.outgoingRoomKeyRequestManager.cancelRoomKeyRequest(e).catch((e=>{l.logger.warn("Error clearing pending room key requests",e)}))}async cancelAndResendAllOutgoingKeyRequests(){await this.outgoingRoomKeyRequestManager.cancelAndResendAllOutgoingRequests()}async onCryptoEvent(e){const t=e.getRoomId(),i=e.getContent();try{await this.setRoomEncryption(t,i,!0)}catch(e){l.logger.error("Error configuring encryption in room "+t+":",e)}}async onSyncWillProcess(e){e.oldSyncToken||(l.logger.log("Initial sync performed - resetting device tracking state"),this.deviceList.stopTrackingAllDeviceLists(),this.deviceList.startTrackingDeviceList(this.userId),this.roomDeviceTrackingState={}),this.sendKeyRequestsImmediately=!1}async onSyncCompleted(e){this.deviceList.setSyncToken(e.nextSyncToken),this.deviceList.saveIfDirty(),this.deviceList.startTrackingDeviceList(this.userId),this.deviceList.refreshOutdatedDeviceLists(),e.catchingUp||(this.maybeUploadOneTimeKeys(),this.processReceivedRoomKeyRequests(),this.outgoingRoomKeyRequestManager.sendQueuedRequests(),this.sendKeyRequestsImmediately=!0)}async evalDeviceListChanges(e){if(e.changed&&Array.isArray(e.changed)&&e.changed.forEach((e=>{this.deviceList.invalidateUserDeviceList(e)})),e.left&&Array.isArray(e.left)&&e.left.length){const t=new Set(await this.getTrackedE2eUsers());e.left.forEach((e=>{t.has(e)||this.deviceList.stopTrackingDeviceList(e)}))}}async getTrackedE2eUsers(){const e=[];for(const t of this.getTrackedE2eRooms()){const i=await t.getEncryptionTargetMembers();for(const t of i)e.push(t.userId)}return e}getTrackedE2eRooms(){return this.clientStore.getRooms().filter((e=>{if(!this.roomEncryptors[e.roomId])return!1;if(!this.roomDeviceTrackingState[e.roomId])return!1;const t=e.getMyMembership();return"join"===t||"invite"===t}))}onRoomKeyEvent(e){const t=e.getContent();t.room_id&&t.algorithm?(this.backupManager.checkedForBackup||this.backupManager.checkAndStart(),this.getRoomDecryptor(t.room_id,t.algorithm).onRoomKeyEvent(e)):l.logger.error("key event is missing fields")}onRoomKeyWithheldEvent(e){const t=e.getContent();if(!(("m.no_olm"===t.code||t.room_id&&t.session_id)&&t.algorithm&&t.sender_key))return void l.logger.error("key withheld event is missing fields");l.logger.info(`Got room key withheld event from ${e.getSender()} (${t.sender_key}) for ${t.algorithm}/${t.room_id}/${t.session_id} with reason ${t.code} (${t.reason})`);const i=this.getRoomDecryptor(t.room_id,t.algorithm);if(i.onRoomKeyWithheldEvent&&i.onRoomKeyWithheldEvent(e),!t.room_id){const e=this.getRoomDecryptors(t.algorithm);for(const i of e)i.retryDecryptionFromSender(t.sender_key)}}onKeyVerificationMessage(e){T.ToDeviceChannel.validateEvent(e,this.baseApis)&&this.handleVerificationEvent(e,this.toDeviceVerificationRequests,(e=>{if(!T.ToDeviceChannel.canCreateRequest(T.ToDeviceChannel.getEventType(e)))return;const t=e.getContent(),i=t&&t.from_device;if(!i)return;const n=e.getSender(),r=new T.ToDeviceChannel(this.baseApis,n,[i]);return new I.VerificationRequest(r,this.verificationMethods,this.baseApis)}))}async handleVerificationEvent(e,t,i,n=!0){let r=t.getRequest(e),s=!1;if(!r){if(r=i(e),!r)return void l.logger.log(`Crypto: could not find VerificationRequest for ${e.getType()}, and could not create one, so ignoring.`);s=!0,t.setRequest(e,r)}e.setVerificationRequest(r);try{await r.channel.handleEvent(e,r,n)}catch(e){l.logger.error("error while handling verification event: "+e.message)}s&&!r.initiatedByMe&&!r.invalid&&!r.observeOnly&&this.baseApis.emit("crypto.verification.request",r)}async onToDeviceBadEncrypted(e){const t=e.getWireContent(),i=e.getSender(),n=t.algorithm,r=t.sender_key,s=()=>{const e=this.getRoomDecryptors(u.MEGOLM_ALGORITHM);for(const t of e)t.retryDecryptionFromSender(r)};if(void 0===i||void 0===r||void 0===r)return;this.lastNewSessionForced[i]=this.lastNewSessionForced[i]||{};const o=this.lastNewSessionForced[i][r]||0;if(o+36e5>Date.now())return l.logger.debug("New session already forced with device "+i+":"+r+" at "+o+": not forcing another"),await this.olmDevice.recordSessionProblem(r,"wedged",!0),void s();let a=this.deviceList.getDeviceByIdentityKey(n,r);if(!a&&(await this.downloadKeys([i],!1),a=this.deviceList.getDeviceByIdentityKey(n,r),!a))return l.logger.info("Couldn't find device for identity key "+r+": not re-establishing session"),await this.olmDevice.recordSessionProblem(r,"wedged",!1),void s();const c={};c[i]=[a],await u.ensureOlmSessionsForDevices(this.olmDevice,this.baseApis,c,!0),this.lastNewSessionForced[i][r]=Date.now();const h={algorithm:u.OLM_ALGORITHM,sender_key:this.olmDevice.deviceCurve25519Key,ciphertext:{}};await u.encryptMessageForDevice(h.ciphertext,this.userId,this.deviceId,this.olmDevice,i,a,{type:"m.dummy"}),await this.olmDevice.recordSessionProblem(r,"wedged",!0),s(),await this.baseApis.sendToDevice("m.room.encrypted",{[i]:{[a.deviceId]:h}});const d=await this.outgoingRoomKeyRequestManager.getOutgoingSentRoomKeyRequest(i,a.deviceId);for(const e of d)this.requestRoomKey(e.requestBody,e.recipients,!0)}onRoomMembership(e,t,i){const n=t.roomId,r=this.roomEncryptors[n];r&&(this.roomDeviceTrackingState[n]&&("join"==t.membership?(l.logger.log("Join event for "+t.userId+" in "+n),this.deviceList.startTrackingDeviceList(t.userId)):"invite"==t.membership&&this.clientStore.getRoom(n).shouldEncryptForInvitedMembers()&&(l.logger.log("Invite event for "+t.userId+" in "+n),this.deviceList.startTrackingDeviceList(t.userId))),r.onRoomMembership(e,t,i))}onRoomKeyRequestEvent(e){const t=e.getContent();if("request"===t.action){const t=new L(e);this.receivedRoomKeyRequests.push(t)}else if("request_cancellation"===t.action){const t=new K(e);this.receivedRoomKeyRequestCancellations.push(t)}}async processReceivedRoomKeyRequests(){if(!this.processingRoomKeyRequests){this.processingRoomKeyRequests=!0;try{const e=this.receivedRoomKeyRequests;this.receivedRoomKeyRequests=[];const t=this.receivedRoomKeyRequestCancellations;this.receivedRoomKeyRequestCancellations=[],await Promise.all(e.map((e=>this.processReceivedRoomKeyRequest(e)))),await Promise.all(t.map((e=>this.processReceivedRoomKeyRequestCancellation(e))))}catch(e){l.logger.error(`Error processing room key requsts: ${e}`)}finally{this.processingRoomKeyRequests=!1}}}async processReceivedRoomKeyRequest(e){const t=e.userId,i=e.deviceId,n=e.requestBody,r=n.room_id,s=n.algorithm;if(l.logger.log(`m.room_key_request from ${t}:${i} for ${r} / ${n.session_id} (id ${e.requestId})`),t!==this.userId){if(!this.roomEncryptors[r])return void l.logger.debug(`room key request for unencrypted room ${r}`);const e=this.roomEncryptors[r],s=this.deviceList.getStoredDevice(t,i);if(!s)return void l.logger.debug(`Ignoring keyshare for unknown device ${t}:${i}`);try{await e.reshareKeyWithDevice(n.sender_key,n.session_id,t,s)}catch(e){l.logger.warn("Failed to re-share keys for session "+n.session_id+" with device "+t+":"+s.deviceId,e)}return}if(i===this.deviceId)return void l.logger.log("Ignoring room key request from ourselves");if(!this.roomDecryptors[r])return void l.logger.log(`room key request for unencrypted room ${r}`);const o=this.roomDecryptors[r][s];if(o)if(await o.hasKeysForKeyRequest(e)){if(e.share=()=>{o.shareKeysWithDevice(e)},this.checkDeviceTrust(t,i).isVerified())return l.logger.log("device is already verified: sharing keys"),void e.share();this.emit("crypto.roomKeyRequest",e)}else l.logger.log(`room key request for unknown session ${r} / `+n.session_id);else l.logger.log(`room key request for unknown alg ${s} in room ${r}`)}async processReceivedRoomKeyRequestCancellation(e){l.logger.log(`m.room_key_request cancellation for ${e.userId}:${e.deviceId} (id ${e.requestId})`),this.emit("crypto.roomKeyRequestCancellation",e)}getRoomDecryptor(e,t){let i,n;if((e=e||null)&&(i=this.roomDecryptors[e],i||(this.roomDecryptors[e]=i={}),n=i[t],n))return n;const r=g.DECRYPTION_CLASSES[t];if(!r)throw new g.DecryptionError("UNKNOWN_ENCRYPTION_ALGORITHM",'Unknown encryption algorithm "'+t+'".');return n=new r({userId:this.userId,crypto:this,olmDevice:this.olmDevice,baseApis:this.baseApis,roomId:e}),i&&(i[t]=n),n}getRoomDecryptors(e){const t=[];for(const i of Object.values(this.roomDecryptors))e in i&&t.push(i[e]);return t}async signObject(e){const t=e.signatures||{},i=e.unsigned;delete e.signatures,delete e.unsigned,t[this.userId]=t[this.userId]||{},t[this.userId]["ed25519:"+this.deviceId]=await this.olmDevice.sign(o.default.stringify(e)),e.signatures=t,void 0!==i&&(e.unsigned=i)}}function U(e){if("string"!=typeof e||e.indexOf(",")<0)return null;const t=Uint8Array.from(e.split(","),(e=>parseInt(e)));return u.encodeBase64(t)}t.Crypto=B;class L{constructor(e){(0,s.default)(this,"userId",void 0),(0,s.default)(this,"deviceId",void 0),(0,s.default)(this,"requestId",void 0),(0,s.default)(this,"requestBody",void 0),(0,s.default)(this,"share",void 0);const t=e.getContent();this.userId=e.getSender(),this.deviceId=t.requesting_device_id,this.requestId=t.request_id,this.requestBody=t.body||{},this.share=()=>{throw new Error("don't know how to share keys for this request yet")}}}t.IncomingRoomKeyRequest=L;class K{constructor(e){(0,s.default)(this,"userId",void 0),(0,s.default)(this,"deviceId",void 0),(0,s.default)(this,"requestId",void 0);const t=e.getContent();this.userId=e.getSender(),this.deviceId=t.requesting_device_id,this.requestId=t.request_id}}},1597:(e,t,i)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.keyFromAuthData=async function(e,t){if(!i.g.Olm)throw new Error("Olm is not available");if(!e.private_key_salt||!e.private_key_iterations)throw new Error("Salt and/or iterations not found: this backup cannot be restored with a passphrase");return await s(t,e.private_key_salt,e.private_key_iterations,e.private_key_bits||256)},t.keyFromPassphrase=async function(e){if(!i.g.Olm)throw new Error("Olm is not available");const t=(0,n.randomString)(32);return{key:await s(e,t,r,256),salt:t,iterations:r}},t.deriveKey=s;var n=i(8401);const r=5e5;async function s(e,t,n,r=256){const s=i.g.crypto.subtle,o=i.g.TextEncoder;if(!s||!o)throw new Error("Password-based backup is not avaiable on this platform");const a=await s.importKey("raw",(new o).encode(e),{name:"PBKDF2"},!1,["deriveBits"]),c=await s.deriveBits({name:"PBKDF2",salt:(new o).encode(t),iterations:n,hash:"SHA-512"},a,r);return new Uint8Array(c)}},2772:(e,t,i)=>{"use strict";var n=i(862),r=i(5318);Object.defineProperty(t,"__esModule",{value:!0}),t.encryptMessageForDevice=async function(e,t,i,n,r,s,o){const l=s.getIdentityKey(),h=await n.getSessionIdForDevice(l);if(null===h)return;a.logger.log("Using sessionid "+h+" for device "+r+":"+s.deviceId);const u={sender:t,sender_device:i,keys:{ed25519:n.deviceEd25519Key},recipient:r,recipient_keys:{ed25519:s.getFingerprint()}};c.extend(u,o),e[l]=await n.encryptMessage(l,h,JSON.stringify(u))},t.getExistingOlmSessions=async function(e,t,i){const n={},r={},s=[];for(const[t,o]of Object.entries(i))for(const i of o){const o=i.deviceId,a=i.getIdentityKey();s.push((async()=>{const s=await e.getSessionIdForDevice(a,!0);null===s?(n[t]=n[t]||[],n[t].push(i)):(r[t]=r[t]||{},r[t][o]={device:i,sessionId:s})})())}return await Promise.all(s),[n,r]},t.ensureOlmSessionsForDevices=async function(e,t,i,n=!1,r,s,o=a.logger){"number"==typeof n&&(o=s,s=r,r=n,n=!1);const c=[],l={},h={};for(const[,t]of Object.entries(i))for(const i of t){const t=i.getIdentityKey();t!==e.deviceCurve25519Key&&(e._sessionsInProgress[t]||(e._sessionsInProgress[t]=new Promise((i=>{h[t]=n=>{delete e._sessionsInProgress[t],i(n)}}))))}for(const[t,r]of Object.entries(i)){l[t]={};for(const i of r){const r=i.deviceId,s=i.getIdentityKey();if(s===e.deviceCurve25519Key){o.info("Attempted to start session with ourself! Ignoring"),l[t][r]={device:i,sessionId:null};continue}const a=`for ${s} (${t}:${r})`,u=await e.getSessionIdForDevice(s,h[s],o);null!==u&&h[s]&&h[s](),(null===u||n)&&(n?o.info(`Forcing new Olm session ${a}`):o.info(`Making new Olm session ${a}`),c.push([t,r])),l[t][r]={device:i,sessionId:u}}}if(0===c.length)return l;let u,p=`one-time keys for ${c.length} devices`;try{o.debug(`Claiming ${p}`),u=await t.claimOneTimeKeys(c,"signed_curve25519",r),o.debug(`Claimed ${p}`)}catch(e){for(const e of Object.values(h))e();throw o.log(`Failed to claim ${p}`,e,c),e}s&&"failures"in u&&s.push(...Object.keys(u.failures));const g=u.one_time_keys||{},f=[];for(const[t,r]of Object.entries(i)){const i=g[t]||{};for(let s=0;s<r.length;s++){const a=r[s],c=a.deviceId,u=a.getIdentityKey();if(u===e.deviceCurve25519Key)continue;if(l[t][c].sessionId&&!n)continue;const p=i[c]||{};let g=null;for(const e in p)0===e.indexOf("signed_curve25519:")&&(g=p[e]);g?f.push(d(e,g,t,a).then((e=>{h[u]&&h[u](e),l[t][c].sessionId=e}),(e=>{throw h[u]&&h[u](),e}))):(o.warn(`No one-time keys (alg=signed_curve25519) for device ${t}:${c}`),h[u]&&h[u]())}}return p=`Olm sessions for ${f.length} devices`,o.debug(`Starting ${p}`),await Promise.all(f),o.debug(`Started ${p}`),l},t.verifySignature=p,t.pkSign=function(e,t,n,r){let s=!1;if(t instanceof Uint8Array){const e=new i.g.Olm.PkSigning;r=e.init_with_seed(t),t=e,s=!0}const a=e.signatures||{};delete e.signatures;const c=e.unsigned;e.unsigned&&delete e.unsigned;try{const i=a[n]||{};return a[n]=i,i["ed25519:"+r]=t.sign(o.default.stringify(e))}finally{e.signatures=a,c&&(e.unsigned=c),s&&t.free()}},t.pkVerify=function(e,t,n){const r="ed25519:"+t;if(!(e.signatures&&e.signatures[n]&&e.signatures[n][r]))throw new Error("No signature");const s=e.signatures[n][r],a=new i.g.Olm.Utility,c=e.signatures;delete e.signatures;const l=e.unsigned;e.unsigned&&delete e.unsigned;try{a.ed25519_verify(t,o.default.stringify(e),s)}finally{e.signatures=c,l&&(e.unsigned=l),a.free()}},t.encodeBase64=g,t.encodeUnpaddedBase64=function(e){return g(e).replace(/=+$/g,"")},t.decodeBase64=function(e){return Buffer.from(e,"base64")},t.MEGOLM_BACKUP_ALGORITHM=t.MEGOLM_ALGORITHM=t.OLM_ALGORITHM=void 0;var s,o=r(i(9141)),a=i(7434),c=n(i(3102));!function(e){e.Olm="m.olm.v1.curve25519-aes-sha2",e.Megolm="m.megolm.v1.aes-sha2",e.MegolmBackup="m.megolm_backup.v1.curve25519-aes-sha2"}(s||(s={}));const l=s.Olm;t.OLM_ALGORITHM=l;const h=s.Megolm;t.MEGOLM_ALGORITHM=h;const u=s.MegolmBackup;async function d(e,t,i,n){const r=n.deviceId;try{await p(e,t,i,r,n.getFingerprint())}catch(e){return a.logger.error("Unable to verify signature on one-time key for device "+i+":"+r+":",e),null}let s;try{s=await e.createOutboundSession(n.getIdentityKey(),t.key)}catch(e){return a.logger.error("Error starting olm session with device "+i+":"+r+": "+e),null}return a.logger.log("Started new olm sessionid "+s+" for device "+i+":"+r),s}async function p(e,t,i,n,r){const s="ed25519:"+n,a=((t.signatures||{})[i]||{})[s];if(!a)throw Error("No signature");const c=Object.assign({},t);"unsigned"in c&&delete c.unsigned,delete c.signatures;const l=o.default.stringify(c);e.verifySignature(r,l,a)}function g(e){return Buffer.from(e).toString("base64")}t.MEGOLM_BACKUP_ALGORITHM=u},4077:(e,t,i)=>{"use strict";var n=i(5318);Object.defineProperty(t,"__esModule",{value:!0}),t.encodeRecoveryKey=function(e){const t=new Buffer(s.length+e.length+1);t.set(s,0),t.set(e,s.length);let i=0;for(let e=0;e<t.length-1;++e)i^=t[e];return t[t.length-1]=i,r.default.encode(t).match(/.{1,4}/g).join(" ")},t.decodeRecoveryKey=function(e){const t=r.default.decode(e.replace(/ /g,""));let n=0;for(const e of t)n^=e;if(0!==n)throw new Error("Incorrect parity");for(let e=0;e<s.length;++e)if(t[e]!==s[e])throw new Error("Incorrect prefix");if(t.length!==s.length+i.g.Olm.PRIVATE_KEY_LENGTH+1)throw new Error("Incorrect length");return Uint8Array.from(t.slice(s.length,s.length+i.g.Olm.PRIVATE_KEY_LENGTH))};var r=n(i(7191));const s=[139,1]},5251:(e,t,i)=>{"use strict";var n=i(862);Object.defineProperty(t,"__esModule",{value:!0}),t.upgradeDatabase=function(e,t){r.logger.log(`Upgrading IndexedDBCryptoStore from version ${t} to 10`),t<1&&function(e){const t=e.createObjectStore("outgoingRoomKeyRequests",{keyPath:"requestId"});t.createIndex("session",["requestBody.room_id","requestBody.session_id"]),t.createIndex("state","state")}(e),t<2&&e.createObjectStore("account"),t<3&&e.createObjectStore("sessions",{keyPath:["deviceKey","sessionId"]}).createIndex("deviceKey","deviceKey"),t<4&&e.createObjectStore("inbound_group_sessions",{keyPath:["senderCurve25519Key","sessionId"]}),t<5&&e.createObjectStore("device_data"),t<6&&e.createObjectStore("rooms"),t<7&&e.createObjectStore("sessions_needing_backup",{keyPath:["senderCurve25519Key","sessionId"]}),t<8&&e.createObjectStore("inbound_group_sessions_withheld",{keyPath:["senderCurve25519Key","sessionId"]}),t<9&&(e.createObjectStore("session_problems",{keyPath:["deviceKey","time"]}).createIndex("deviceKey","deviceKey"),e.createObjectStore("notified_error_devices",{keyPath:["userId","deviceId"]})),t<10&&e.createObjectStore("shared_history_inbound_group_sessions",{keyPath:["roomId"]})},t.Backend=t.VERSION=void 0;var r=i(7434),s=n(i(3102));function o(e,t){e._mx_abortexception=t;try{e.abort()}catch(t){}}function a(e){return new Promise(((t,i)=>{e.oncomplete=()=>{void 0!==e._mx_abortexception&&i(e._mx_abortexception),t()},e.onerror=t=>{void 0!==e._mx_abortexception?i(e._mx_abortexception):(r.logger.log("Error performing indexeddb txn",t),i(t.target.error))},e.onabort=t=>{void 0!==e._mx_abortexception?i(e._mx_abortexception):(r.logger.log("Error performing indexeddb txn",t),i(t.target.error))}}))}t.VERSION=10,t.Backend=class{constructor(e){this._db=e,this._nextTxnId=0,e.onversionchange=t=>{r.logger.log(`versionchange for indexeddb ${this._dbName}: closing`),e.close()}}getOrAddOutgoingRoomKeyRequest(e){const t=e.requestBody;return new Promise(((i,n)=>{const s=this._db.transaction("outgoingRoomKeyRequests","readwrite");s.onerror=n,this._getOutgoingRoomKeyRequest(s,t,(n=>{if(n)return r.logger.log(`already have key request outstanding for ${t.room_id} / ${t.session_id}: not sending another`),void i(n);r.logger.log(`enqueueing key request for ${t.room_id} / `+t.session_id),s.oncomplete=()=>{i(e)},s.objectStore("outgoingRoomKeyRequests").add(e)}))}))}getOutgoingRoomKeyRequest(e){return new Promise(((t,i)=>{const n=this._db.transaction("outgoingRoomKeyRequests","readonly");n.onerror=i,this._getOutgoingRoomKeyRequest(n,e,(e=>{t(e)}))}))}_getOutgoingRoomKeyRequest(e,t,i){e.objectStore("outgoingRoomKeyRequests").index("session").openCursor([t.room_id,t.session_id]).onsuccess=e=>{const n=e.target.result;if(!n)return void i(null);const r=n.value;s.deepCompare(r.requestBody,t)?i(r):n.continue()}}getOutgoingRoomKeyRequestByState(e){if(0===e.length)return Promise.resolve(null);let t,i=0;const n=this._db.transaction("outgoingRoomKeyRequests","readonly"),r=n.objectStore("outgoingRoomKeyRequests"),s=e[i];return r.index("state").openCursor(s).onsuccess=function n(r){const s=r.target.result;if(s)return void(t=s.value);if(i++,i>=e.length)return;const o=e[i];r.target.source.openCursor(o).onsuccess=n},a(n).then((()=>t))}getAllOutgoingRoomKeyRequestsByState(e){return new Promise(((t,i)=>{const n=this._db.transaction("outgoingRoomKeyRequests","readonly").objectStore("outgoingRoomKeyRequests").index("state").getAll(e);n.onsuccess=e=>t(e.target.result),n.onerror=e=>i(e.target.error)}))}getOutgoingRoomKeyRequestsByTarget(e,t,i){let n=0;const r=[],s=this._db.transaction("outgoingRoomKeyRequests","readonly"),o=s.objectStore("outgoingRoomKeyRequests"),c=i[n];return o.index("state").openCursor(c).onsuccess=function s(o){const a=o.target.result;if(a){const i=a.value;i.recipients.includes({userId:e,deviceId:t})&&r.push(i),a.continue()}else{if(n++,n>=i.length)return;const e=i[n];o.target.source.openCursor(e).onsuccess=s}},a(s).then((()=>r))}updateOutgoingRoomKeyRequest(e,t,i){let n=null;const s=this._db.transaction("outgoingRoomKeyRequests","readwrite");return s.objectStore("outgoingRoomKeyRequests").openCursor(e).onsuccess=function(e){const s=e.target.result;if(!s)return;const o=s.value;o.state==t?(Object.assign(o,i),s.update(o),n=o):r.logger.warn(`Cannot update room key request from ${t} as it was already updated to ${o.state}`)},a(s).then((()=>n))}deleteOutgoingRoomKeyRequest(e,t){const i=this._db.transaction("outgoingRoomKeyRequests","readwrite");return i.objectStore("outgoingRoomKeyRequests").openCursor(e).onsuccess=e=>{const i=e.target.result;if(!i)return;const n=i.value;n.state==t?i.delete():r.logger.warn(`Cannot delete room key request in state ${n.state} (expected ${t})`)},a(i)}getAccount(e,t){const i=e.objectStore("account").get("-");i.onsuccess=function(){try{t(i.result||null)}catch(t){o(e,t)}}}storeAccount(e,t){e.objectStore("account").put(t,"-")}getCrossSigningKeys(e,t){const i=e.objectStore("account").get("crossSigningKeys");i.onsuccess=function(){try{t(i.result||null)}catch(t){o(e,t)}}}getSecretStorePrivateKey(e,t,i){const n=e.objectStore("account").get(`ssss_cache:${i}`);n.onsuccess=function(){try{t(n.result||null)}catch(t){o(e,t)}}}storeCrossSigningKeys(e,t){e.objectStore("account").put(t,"crossSigningKeys")}storeSecretStorePrivateKey(e,t,i){e.objectStore("account").put(i,`ssss_cache:${t}`)}countEndToEndSessions(e,t){const i=e.objectStore("sessions").count();i.onsuccess=function(){try{t(i.result)}catch(t){o(e,t)}}}getEndToEndSessions(e,t,i){const n=t.objectStore("sessions").index("deviceKey").openCursor(e),r={};n.onsuccess=function(){const e=n.result;if(e)r[e.value.sessionId]={session:e.value.session,lastReceivedMessageTs:e.value.lastReceivedMessageTs},e.continue();else try{i(r)}catch(e){o(t,e)}}}getEndToEndSession(e,t,i,n){const r=i.objectStore("sessions").get([e,t]);r.onsuccess=function(){try{r.result?n({session:r.result.session,lastReceivedMessageTs:r.result.lastReceivedMessageTs}):n(null)}catch(e){o(i,e)}}}getAllEndToEndSessions(e,t){const i=e.objectStore("sessions").openCursor();i.onsuccess=function(){try{const e=i.result;e?(t(e.value),e.continue()):t(null)}catch(t){o(e,t)}}}storeEndToEndSession(e,t,i,n){n.objectStore("sessions").put({deviceKey:e,sessionId:t,session:i.session,lastReceivedMessageTs:i.lastReceivedMessageTs})}async storeEndToEndSessionProblem(e,t,i){const n=this._db.transaction("session_problems","readwrite");return n.objectStore("session_problems").put({deviceKey:e,type:t,fixed:i,time:Date.now()}),a(n)}async getEndToEndSessionProblem(e,t){let i;const n=this._db.transaction("session_problems","readwrite"),r=n.objectStore("session_problems").index("deviceKey").getAll(e);return r.onsuccess=e=>{const n=r.result;if(!n.length)return void(i=null);n.sort(((e,t)=>e.time-t.time));const s=n[n.length-1];for(const e of n)if(e.time>t)return void(i=Object.assign({},e,{fixed:s.fixed}));i=s.fixed?null:s},await a(n),i}async filterOutNotifiedErrorDevices(e){const t=this._db.transaction("notified_error_devices","readwrite").objectStore("notified_error_devices"),i=[];return await Promise.all(e.map((e=>new Promise((n=>{const{userId:r,deviceInfo:s}=e,o=t.get([r,s.deviceId]);o.onsuccess=function(){o.result||(t.put({userId:r,deviceId:s.deviceId}),i.push(e)),n()}}))))),i}getEndToEndInboundGroupSession(e,t,i,n){let r=!1,s=!1;const a=i.objectStore("inbound_group_sessions").get([e,t]);a.onsuccess=function(){try{r=a.result?a.result.session:null,!1!==s&&n(r,s)}catch(e){o(i,e)}};const c=i.objectStore("inbound_group_sessions_withheld").get([e,t]);c.onsuccess=function(){try{s=c.result?c.result.session:null,!1!==r&&n(r,s)}catch(e){o(i,e)}}}getAllEndToEndInboundGroupSessions(e,t){const i=e.objectStore("inbound_group_sessions").openCursor();i.onsuccess=function(){const n=i.result;if(n){try{t({senderKey:n.value.senderCurve25519Key,sessionId:n.value.sessionId,sessionData:n.value.session})}catch(t){o(e,t)}n.continue()}else try{t(null)}catch(t){o(e,t)}}}addEndToEndInboundGroupSession(e,t,i,n){const s=n.objectStore("inbound_group_sessions").add({senderCurve25519Key:e,sessionId:t,session:i});s.onerror=i=>{"ConstraintError"===s.error.name?(i.stopPropagation(),i.preventDefault(),r.logger.log("Ignoring duplicate inbound group session: "+e+" / "+t)):o(n,new Error("Failed to add inbound group session: "+s.error))}}storeEndToEndInboundGroupSession(e,t,i,n){n.objectStore("inbound_group_sessions").put({senderCurve25519Key:e,sessionId:t,session:i})}storeEndToEndInboundGroupSessionWithheld(e,t,i,n){n.objectStore("inbound_group_sessions_withheld").put({senderCurve25519Key:e,sessionId:t,session:i})}getEndToEndDeviceData(e,t){const i=e.objectStore("device_data").get("-");i.onsuccess=function(){try{t(i.result||null)}catch(t){o(e,t)}}}storeEndToEndDeviceData(e,t){t.objectStore("device_data").put(e,"-")}storeEndToEndRoom(e,t,i){i.objectStore("rooms").put(t,e)}getEndToEndRooms(e,t){const i={},n=e.objectStore("rooms").openCursor();n.onsuccess=function(){const r=n.result;if(r)i[r.key]=r.value,r.continue();else try{t(i)}catch(t){o(e,t)}}}getSessionsNeedingBackup(e){return new Promise(((t,i)=>{const n=[],r=this._db.transaction(["sessions_needing_backup","inbound_group_sessions"],"readonly");r.onerror=i,r.oncomplete=function(){t(n)};const s=r.objectStore("sessions_needing_backup"),o=r.objectStore("inbound_group_sessions"),a=s.openCursor();a.onsuccess=function(){const t=a.result;if(t){const i=o.get(t.key);i.onsuccess=function(){n.push({senderKey:i.result.senderCurve25519Key,sessionId:i.result.sessionId,sessionData:i.result.session})},(!e||n.length<e)&&t.continue()}}}))}countSessionsNeedingBackup(e){e||(e=this._db.transaction("sessions_needing_backup","readonly"));const t=e.objectStore("sessions_needing_backup");return new Promise(((e,i)=>{const n=t.count();n.onerror=i,n.onsuccess=()=>e(n.result)}))}unmarkSessionsNeedingBackup(e,t){t||(t=this._db.transaction("sessions_needing_backup","readwrite"));const i=t.objectStore("sessions_needing_backup");return Promise.all(e.map((e=>new Promise(((t,n)=>{const r=i.delete([e.senderKey,e.sessionId]);r.onsuccess=t,r.onerror=n})))))}markSessionsNeedingBackup(e,t){t||(t=this._db.transaction("sessions_needing_backup","readwrite"));const i=t.objectStore("sessions_needing_backup");return Promise.all(e.map((e=>new Promise(((t,n)=>{const r=i.put({senderCurve25519Key:e.senderKey,sessionId:e.sessionId});r.onsuccess=t,r.onerror=n})))))}addSharedHistoryInboundGroupSession(e,t,i,n){n||(n=this._db.transaction("shared_history_inbound_group_sessions","readwrite"));const r=n.objectStore("shared_history_inbound_group_sessions"),s=r.get([e]);s.onsuccess=()=>{const{sessions:n}=s.result||{sessions:[]};n.push([t,i]),r.put({roomId:e,sessions:n})}}getSharedHistoryInboundGroupSessions(e,t){t||(t=this._db.transaction("shared_history_inbound_group_sessions","readonly"));const i=t.objectStore("shared_history_inbound_group_sessions").get([e]);return new Promise(((e,t)=>{i.onsuccess=()=>{const{sessions:t}=i.result||{sessions:[]};e(t)},i.onerror=t}))}doTxn(e,t,i,n=r.logger){const s=this._db.transaction(t,e),o=a(s),c=i(s);return o.then((()=>c))}}},7585:(e,t,i)=>{"use strict";var n=i(862);Object.defineProperty(t,"__esModule",{value:!0}),t.IndexedDBCryptoStore=void 0;var r=i(7434),s=i(4250),o=i(1045),a=n(i(5251)),c=i(9489),l=n(i(3415));class h{constructor(e,t){this._indexedDB=e,this._dbName=t,this._backendPromise=null,this._backend=null}static exists(e,t){return l.exists(e,t)}startup(){return this._backendPromise||(this._backendPromise=new Promise(((e,t)=>{if(!this._indexedDB)return void t(new Error("no indexeddb support available"));r.logger.log(`connecting to indexeddb ${this._dbName}`);const i=this._indexedDB.open(this._dbName,a.VERSION);i.onupgradeneeded=e=>{const t=e.target.result,i=e.oldVersion;a.upgradeDatabase(t,i)},i.onblocked=()=>{r.logger.log("can't yet open IndexedDBCryptoStore because it is open elsewhere")},i.onerror=e=>{r.logger.log("Error connecting to indexeddb",e),t(e.target.error)},i.onsuccess=t=>{const i=t.target.result;r.logger.log(`connected to indexeddb ${this._dbName}`),e(new a.Backend(i))}})).then((e=>e.doTxn("readonly",[h.STORE_INBOUND_GROUP_SESSIONS,h.STORE_INBOUND_GROUP_SESSIONS_WITHHELD],(t=>{e.getEndToEndInboundGroupSession("","",t,(()=>{}))})).then((()=>e)))).catch((e=>{if("VersionError"===e.name)throw r.logger.warn("Crypto DB is too new for us to use!",e),new c.InvalidCryptoStoreError(c.InvalidCryptoStoreError.TOO_NEW);r.logger.warn(`unable to connect to indexeddb ${this._dbName}: falling back to localStorage store: ${e}`);try{return new s.LocalStorageCryptoStore(i.g.localStorage)}catch(e){return r.logger.warn(`unable to open localStorage: falling back to in-memory store: ${e}`),new o.MemoryCryptoStore}})).then((e=>{this._backend=e}))),this._backendPromise}deleteAllData(){return new Promise(((e,t)=>{if(!this._indexedDB)return void t(new Error("no indexeddb support available"));r.logger.log(`Removing indexeddb instance: ${this._dbName}`);const i=this._indexedDB.deleteDatabase(this._dbName);i.onblocked=()=>{r.logger.log("can't yet delete IndexedDBCryptoStore because it is open elsewhere")},i.onerror=e=>{r.logger.log("Error deleting data from indexeddb",e),t(e.target.error)},i.onsuccess=()=>{r.logger.log(`Removed indexeddb instance: ${this._dbName}`),e()}})).catch((e=>{r.logger.warn(`unable to delete IndexedDBCryptoStore: ${e}`)}))}getOrAddOutgoingRoomKeyRequest(e){return this._backend.getOrAddOutgoingRoomKeyRequest(e)}getOutgoingRoomKeyRequest(e){return this._backend.getOutgoingRoomKeyRequest(e)}getOutgoingRoomKeyRequestByState(e){return this._backend.getOutgoingRoomKeyRequestByState(e)}getAllOutgoingRoomKeyRequestsByState(e){return this._backend.getAllOutgoingRoomKeyRequestsByState(e)}getOutgoingRoomKeyRequestsByTarget(e,t,i){return this._backend.getOutgoingRoomKeyRequestsByTarget(e,t,i)}updateOutgoingRoomKeyRequest(e,t,i){return this._backend.updateOutgoingRoomKeyRequest(e,t,i)}deleteOutgoingRoomKeyRequest(e,t){return this._backend.deleteOutgoingRoomKeyRequest(e,t)}getAccount(e,t){this._backend.getAccount(e,t)}storeAccount(e,t){this._backend.storeAccount(e,t)}getCrossSigningKeys(e,t){this._backend.getCrossSigningKeys(e,t)}getSecretStorePrivateKey(e,t,i){this._backend.getSecretStorePrivateKey(e,t,i)}storeCrossSigningKeys(e,t){this._backend.storeCrossSigningKeys(e,t)}storeSecretStorePrivateKey(e,t,i){this._backend.storeSecretStorePrivateKey(e,t,i)}countEndToEndSessions(e,t){this._backend.countEndToEndSessions(e,t)}getEndToEndSession(e,t,i,n){this._backend.getEndToEndSession(e,t,i,n)}getEndToEndSessions(e,t,i){this._backend.getEndToEndSessions(e,t,i)}getAllEndToEndSessions(e,t){this._backend.getAllEndToEndSessions(e,t)}storeEndToEndSession(e,t,i,n){this._backend.storeEndToEndSession(e,t,i,n)}storeEndToEndSessionProblem(e,t,i){return this._backend.storeEndToEndSessionProblem(e,t,i)}getEndToEndSessionProblem(e,t){return this._backend.getEndToEndSessionProblem(e,t)}filterOutNotifiedErrorDevices(e){return this._backend.filterOutNotifiedErrorDevices(e)}getEndToEndInboundGroupSession(e,t,i,n){this._backend.getEndToEndInboundGroupSession(e,t,i,n)}getAllEndToEndInboundGroupSessions(e,t){this._backend.getAllEndToEndInboundGroupSessions(e,t)}addEndToEndInboundGroupSession(e,t,i,n){this._backend.addEndToEndInboundGroupSession(e,t,i,n)}storeEndToEndInboundGroupSession(e,t,i,n){this._backend.storeEndToEndInboundGroupSession(e,t,i,n)}storeEndToEndInboundGroupSessionWithheld(e,t,i,n){this._backend.storeEndToEndInboundGroupSessionWithheld(e,t,i,n)}storeEndToEndDeviceData(e,t){this._backend.storeEndToEndDeviceData(e,t)}getEndToEndDeviceData(e,t){this._backend.getEndToEndDeviceData(e,t)}storeEndToEndRoom(e,t,i){this._backend.storeEndToEndRoom(e,t,i)}getEndToEndRooms(e,t){this._backend.getEndToEndRooms(e,t)}getSessionsNeedingBackup(e){return this._backend.getSessionsNeedingBackup(e)}countSessionsNeedingBackup(e){return this._backend.countSessionsNeedingBackup(e)}unmarkSessionsNeedingBackup(e,t){return this._backend.unmarkSessionsNeedingBackup(e,t)}markSessionsNeedingBackup(e,t){return this._backend.markSessionsNeedingBackup(e,t)}addSharedHistoryInboundGroupSession(e,t,i,n){this._backend.addSharedHistoryInboundGroupSession(e,t,i,n)}getSharedHistoryInboundGroupSessions(e,t){return this._backend.getSharedHistoryInboundGroupSessions(e,t)}doTxn(e,t,i,n){return this._backend.doTxn(e,t,i,n)}}t.IndexedDBCryptoStore=h,h.STORE_ACCOUNT="account",h.STORE_SESSIONS="sessions",h.STORE_INBOUND_GROUP_SESSIONS="inbound_group_sessions",h.STORE_INBOUND_GROUP_SESSIONS_WITHHELD="inbound_group_sessions_withheld",h.STORE_SHARED_HISTORY_INBOUND_GROUP_SESSIONS="shared_history_inbound_group_sessions",h.STORE_DEVICE_DATA="device_data",h.STORE_ROOMS="rooms",h.STORE_BACKUP="sessions_needing_backup"},4250:(e,t,i)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.LocalStorageCryptoStore=void 0;var n=i(7434),r=i(1045);const s="crypto.account",o="crypto.cross_signing_keys",a="crypto.notified_error_devices",c="crypto.device_data",l="crypto.inboundgroupsessions/",h="crypto.sessionsneedingbackup";function u(e){return"crypto.sessions/"+e}function d(e){return"crypto.session.problems/"+e}function p(e,t){return l+e+"/"+t}function g(e,t){return"crypto.inboundgroupsessions.withheld/"+e+"/"+t}function f(e){return"crypto.rooms/"+e}class m extends r.MemoryCryptoStore{constructor(e){super(),this.store=e}static exists(e){const t=e.length;for(let i=0;i<t;i++)if(e.key(i).startsWith("crypto."))return!0;return!1}countEndToEndSessions(e,t){let i=0;for(let e=0;e<this.store.length;++e)this.store.key(e).startsWith(u(""))&&++i;t(i)}_getEndToEndSessions(e,t,i){const n=v(this.store,u(e)),r={};for(const[e,t]of Object.entries(n||{}))r[e]="string"==typeof t?{session:t}:t;return r}getEndToEndSession(e,t,i,n){n(this._getEndToEndSessions(e)[t]||{})}getEndToEndSessions(e,t,i){i(this._getEndToEndSessions(e)||{})}getAllEndToEndSessions(e,t){for(let e=0;e<this.store.length;++e)if(this.store.key(e).startsWith(u(""))){const i=this.store.key(e).split("/")[1];for(const e of Object.values(this._getEndToEndSessions(i)))t(e)}}storeEndToEndSession(e,t,i,n){const r=this._getEndToEndSessions(e)||{};r[t]=i,y(this.store,u(e),r)}async storeEndToEndSessionProblem(e,t,i){const n=d(e),r=v(this.store,n)||[];r.push({type:t,fixed:i,time:Date.now()}),r.sort(((e,t)=>e.time-t.time)),y(this.store,n,r)}async getEndToEndSessionProblem(e,t){const i=d(e),n=v(this.store,i)||[];if(!n.length)return null;const r=n[n.length-1];for(const e of n)if(e.time>t)return Object.assign({},e,{fixed:r.fixed});return r.fixed?null:r}async filterOutNotifiedErrorDevices(e){const t=v(this.store,a)||{},i=[];for(const n of e){const{userId:e,deviceInfo:r}=n;e in t?r.deviceId in t[e]||(i.push(n),t[e][r.deviceId]=!0):(i.push(n),t[e]={[r.deviceId]:!0})}return y(this.store,a,t),i}getEndToEndInboundGroupSession(e,t,i,n){n(v(this.store,p(e,t)),v(this.store,g(e,t)))}getAllEndToEndInboundGroupSessions(e,t){for(let e=0;e<this.store.length;++e){const i=this.store.key(e);i.startsWith(l)&&t({senderKey:i.substr(l.length,43),sessionId:i.substr(l.length+44),sessionData:v(this.store,i)})}t(null)}addEndToEndInboundGroupSession(e,t,i,n){v(this.store,p(e,t))||this.storeEndToEndInboundGroupSession(e,t,i,n)}storeEndToEndInboundGroupSession(e,t,i,n){y(this.store,p(e,t),i)}storeEndToEndInboundGroupSessionWithheld(e,t,i,n){y(this.store,g(e,t),i)}getEndToEndDeviceData(e,t){t(v(this.store,c))}storeEndToEndDeviceData(e,t){y(this.store,c,e)}storeEndToEndRoom(e,t,i){y(this.store,f(e),t)}getEndToEndRooms(e,t){const i={},n=f("");for(let e=0;e<this.store.length;++e){const t=this.store.key(e);t.startsWith(n)&&(i[t.substr(n.length)]=v(this.store,t))}t(i)}getSessionsNeedingBackup(e){const t=v(this.store,h)||{},i=[];for(const n in t)if(Object.prototype.hasOwnProperty.call(t,n)){const t=n.substr(0,43),r=n.substr(44);if(this.getEndToEndInboundGroupSession(t,r,null,(e=>{i.push({senderKey:t,sessionId:r,sessionData:e})})),e&&n.length>=e)break}return Promise.resolve(i)}countSessionsNeedingBackup(){const e=v(this.store,h)||{};return Promise.resolve(Object.keys(e).length)}unmarkSessionsNeedingBackup(e){const t=v(this.store,h)||{};for(const i of e)delete t[i.senderKey+"/"+i.sessionId];return y(this.store,h,t),Promise.resolve()}markSessionsNeedingBackup(e){const t=v(this.store,h)||{};for(const i of e)t[i.senderKey+"/"+i.sessionId]=!0;return y(this.store,h,t),Promise.resolve()}deleteAllData(){return this.store.removeItem(s),Promise.resolve()}getAccount(e,t){t(v(this.store,s))}storeAccount(e,t){y(this.store,s,t)}getCrossSigningKeys(e,t){t(v(this.store,o))}getSecretStorePrivateKey(e,t,i){t(v(this.store,`crypto.ssss_cache.${i}`))}storeCrossSigningKeys(e,t){y(this.store,o,t)}storeSecretStorePrivateKey(e,t,i){y(this.store,`crypto.ssss_cache.${t}`,i)}doTxn(e,t,i){return Promise.resolve(i(null))}}function v(e,t){try{return JSON.parse(e.getItem(t))}catch(e){n.logger.log("Error: Failed to get key %s: %s",t,e.stack||e),n.logger.log(e.stack)}return null}function y(e,t,i){e.setItem(t,JSON.stringify(i))}t.LocalStorageCryptoStore=m},1045:(e,t,i)=>{"use strict";var n=i(862),r=i(5318);Object.defineProperty(t,"__esModule",{value:!0}),t.MemoryCryptoStore=void 0;var s=r(i(9713)),o=i(7434),a=n(i(3102));function c(e,t){var i=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),i.push.apply(i,n)}return i}function l(e){for(var t=1;t<arguments.length;t++){var i=null!=arguments[t]?arguments[t]:{};t%2?c(Object(i),!0).forEach((function(t){(0,s.default)(e,t,i[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(i)):c(Object(i)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(i,t))}))}return e}t.MemoryCryptoStore=class{constructor(){this._outgoingRoomKeyRequests=[],this._account=null,this._crossSigningKeys=null,this._privateKeys={},this._backupKeys={},this._sessions={},this._sessionProblems={},this._notifiedErrorDevices={},this._inboundGroupSessions={},this._inboundGroupSessionsWithheld={},this._deviceData=null,this._rooms={},this._sessionsNeedingBackup={},this._sharedHistoryInboundGroupSessions={}}async startup(){return this}deleteAllData(){return Promise.resolve()}getOrAddOutgoingRoomKeyRequest(e){const t=e.requestBody;return a.promiseTry((()=>{const i=this._getOutgoingRoomKeyRequest(t);return i?(o.logger.log(`already have key request outstanding for ${t.room_id} / ${t.session_id}: not sending another`),i):(o.logger.log(`enqueueing key request for ${t.room_id} / `+t.session_id),this._outgoingRoomKeyRequests.push(e),e)}))}getOutgoingRoomKeyRequest(e){return Promise.resolve(this._getOutgoingRoomKeyRequest(e))}_getOutgoingRoomKeyRequest(e){for(const t of this._outgoingRoomKeyRequests)if(a.deepCompare(t.requestBody,e))return t;return null}getOutgoingRoomKeyRequestByState(e){for(const t of this._outgoingRoomKeyRequests)for(const i of e)if(t.state===i)return Promise.resolve(t);return Promise.resolve(null)}getAllOutgoingRoomKeyRequestsByState(e){return Promise.resolve(this._outgoingRoomKeyRequests.filter((t=>t.state==e)))}getOutgoingRoomKeyRequestsByTarget(e,t,i){const n=[];for(const r of this._outgoingRoomKeyRequests)for(const s of i)r.state===s&&r.recipients.includes({userId:e,deviceId:t})&&n.push(r);return Promise.resolve(n)}updateOutgoingRoomKeyRequest(e,t,i){for(const n of this._outgoingRoomKeyRequests)if(n.requestId===e)return n.state!=t?(o.logger.warn(`Cannot update room key request from ${t} as it was already updated to ${n.state}`),Promise.resolve(null)):(Object.assign(n,i),Promise.resolve(n));return Promise.resolve(null)}deleteOutgoingRoomKeyRequest(e,t){for(let i=0;i<this._outgoingRoomKeyRequests.length;i++){const n=this._outgoingRoomKeyRequests[i];if(n.requestId===e)return n.state!=t?(o.logger.warn(`Cannot delete room key request in state ${n.state} (expected ${t})`),Promise.resolve(null)):(this._outgoingRoomKeyRequests.splice(i,1),Promise.resolve(n))}return Promise.resolve(null)}getAccount(e,t){t(this._account)}storeAccount(e,t){this._account=t}getCrossSigningKeys(e,t){t(this._crossSigningKeys)}getSecretStorePrivateKey(e,t,i){return t(this._privateKeys[i]||null)}storeCrossSigningKeys(e,t){this._crossSigningKeys=t}storeSecretStorePrivateKey(e,t,i){this._privateKeys[t]=i}countEndToEndSessions(e,t){return Object.keys(this._sessions).length}getEndToEndSession(e,t,i,n){n((this._sessions[e]||{})[t]||null)}getEndToEndSessions(e,t,i){i(this._sessions[e]||{})}getAllEndToEndSessions(e,t){Object.entries(this._sessions).forEach((([e,i])=>{Object.entries(i).forEach((([i,n])=>{t(l(l({},n),{},{deviceKey:e,sessionId:i}))}))}))}storeEndToEndSession(e,t,i,n){let r=this._sessions[e];void 0===r&&(r={},this._sessions[e]=r),r[t]=i}async storeEndToEndSessionProblem(e,t,i){const n=this._sessionProblems[e]=this._sessionProblems[e]||[];n.push({type:t,fixed:i,time:Date.now()}),n.sort(((e,t)=>e.time-t.time))}async getEndToEndSessionProblem(e,t){const i=this._sessionProblems[e]||[];if(!i.length)return null;const n=i[i.length-1];for(const e of i)if(e.time>t)return Object.assign({},e,{fixed:n.fixed});return n.fixed?null:n}async filterOutNotifiedErrorDevices(e){const t=this._notifiedErrorDevices,i=[];for(const n of e){const{userId:e,deviceInfo:r}=n;e in t?r.deviceId in t[e]||(i.push(n),t[e][r.deviceId]=!0):(i.push(n),t[e]={[r.deviceId]:!0})}return i}getEndToEndInboundGroupSession(e,t,i,n){const r=e+"/"+t;n(this._inboundGroupSessions[r]||null,this._inboundGroupSessionsWithheld[r]||null)}getAllEndToEndInboundGroupSessions(e,t){for(const e of Object.keys(this._inboundGroupSessions))t({senderKey:e.substr(0,43),sessionId:e.substr(44),sessionData:this._inboundGroupSessions[e]});t(null)}addEndToEndInboundGroupSession(e,t,i,n){const r=e+"/"+t;void 0===this._inboundGroupSessions[r]&&(this._inboundGroupSessions[r]=i)}storeEndToEndInboundGroupSession(e,t,i,n){this._inboundGroupSessions[e+"/"+t]=i}storeEndToEndInboundGroupSessionWithheld(e,t,i,n){const r=e+"/"+t;this._inboundGroupSessionsWithheld[r]=i}getEndToEndDeviceData(e,t){t(this._deviceData)}storeEndToEndDeviceData(e,t){this._deviceData=e}storeEndToEndRoom(e,t,i){this._rooms[e]=t}getEndToEndRooms(e,t){t(this._rooms)}getSessionsNeedingBackup(e){const t=[];for(const i in this._sessionsNeedingBackup)if(this._inboundGroupSessions[i]&&(t.push({senderKey:i.substr(0,43),sessionId:i.substr(44),sessionData:this._inboundGroupSessions[i]}),e&&i.length>=e))break;return Promise.resolve(t)}countSessionsNeedingBackup(){return Promise.resolve(Object.keys(this._sessionsNeedingBackup).length)}unmarkSessionsNeedingBackup(e){for(const t of e){const e=t.senderKey+"/"+t.sessionId;delete this._sessionsNeedingBackup[e]}return Promise.resolve()}markSessionsNeedingBackup(e){for(const t of e){const e=t.senderKey+"/"+t.sessionId;this._sessionsNeedingBackup[e]=!0}return Promise.resolve()}addSharedHistoryInboundGroupSession(e,t,i){const n=this._sharedHistoryInboundGroupSessions[e]||[];n.push([t,i]),this._sharedHistoryInboundGroupSessions[e]=n}getSharedHistoryInboundGroupSessions(e){return Promise.resolve(this._sharedHistoryInboundGroupSessions[e]||[])}doTxn(e,t,i){return Promise.resolve(i(null))}}},1631:(e,t,i)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.VerificationBase=t.SwitchStartEventError=void 0;var n=i(4369),r=i(7187),s=i(7434),o=i(3272),a=i(6702),c=i(3075);const l=new Error("Verification timed out");class h extends Error{constructor(e){super(),this.startEvent=e}}t.SwitchStartEventError=h;class u extends r.EventEmitter{constructor(e,t,i,n,r,s){super(),this._channel=e,this._baseApis=t,this.userId=i,this.deviceId=n,this.startEvent=r,this.request=s,this.cancelled=!1,this._done=!1,this._promise=null,this._transactionTimeoutTimer=null}get initiatedByMe(){if(!this.startEvent)return!0;const e=this.startEvent.getSender(),t=this.startEvent.getContent();return e===this._baseApis.getUserId()&&t.from_device===this._baseApis.getDeviceId()}_resetTimer(){s.logger.info("Refreshing/starting the verification transaction timeout timer"),null!==this._transactionTimeoutTimer&&clearTimeout(this._transactionTimeoutTimer),this._transactionTimeoutTimer=setTimeout((()=>{this._done||this.cancelled||(s.logger.info("Triggering verification timeout"),this.cancel(l))}),6e5)}_endTimer(){null!==this._transactionTimeoutTimer&&(clearTimeout(this._transactionTimeoutTimer),this._transactionTimeoutTimer=null)}_send(e,t){return this._channel.send(e,t)}_waitForEvent(e){if(this._done)return Promise.reject(new Error("Verification is already done"));const t=this.request.getEventFromOtherParty(e);return t?Promise.resolve(t):(this._expectedEvent=e,new Promise(((e,t)=>{this._resolveEvent=e,this._rejectEvent=t})))}canSwitchStartEvent(){return!1}switchStartEvent(e){if(this.canSwitchStartEvent(e))if(s.logger.log("Verification Base: switching verification start event",{restartingFlow:!!this._rejectEvent}),this._rejectEvent){const t=this._rejectEvent;this._rejectEvent=void 0,t(new h(e))}else this.startEvent=e}handleEvent(e){if(!this._done)if(e.getType()===this._expectedEvent)"m.key.verification.done"!==this._expectedEvent&&(this._expectedEvent=void 0,this._rejectEvent=void 0,this._resetTimer(),this._resolveEvent(e));else if("m.key.verification.cancel"===e.getType()){const t=this._reject;if(this._reject=void 0,t){const i=e.getContent(),{reason:n,code:r}=i;t(new Error(`Other side cancelled verification because ${n} (${r})`))}}else if(this._expectedEvent){const t=new Error("Unexpected message: expecting "+this._expectedEvent+" but got "+e.getType());if(this._expectedEvent=void 0,this._rejectEvent){const e=this._rejectEvent;this._rejectEvent=void 0,e(t)}this.cancel(t)}}done(){if(this._endTimer(),!this._done)return this.request.onVerifierFinished(),this._resolve(),(0,c.requestKeysDuringVerification)(this._baseApis,this.userId,this.deviceId)}cancel(e){if(this._endTimer(),!this._done){if(this.cancelled=!0,this.request.onVerifierCancelled(),this.userId&&this.deviceId)if(e===l){const e=(0,a.newTimeoutError)();this._send(e.getType(),e.getContent())}else if(e instanceof n.MatrixEvent){if(e.getSender()!==this.userId){const t=e.getContent();"m.key.verification.cancel"===e.getType()?(t.code=t.code||"m.unknown",t.reason=t.reason||t.body||"Unknown reason",this._send("m.key.verification.cancel",t)):this._send("m.key.verification.cancel",{code:"m.unknown",reason:t.body||"Unknown reason"})}}else this._send("m.key.verification.cancel",{code:"m.unknown",reason:e.toString()});null!==this._promise?this._reject&&this._reject(e):this._promise=Promise.reject(e),this.emit("cancel",e)}}verify(){return this._promise||(this._promise=new Promise(((e,t)=>{this._resolve=(...t)=>{this._done=!0,this._endTimer(),e(...t)},this._reject=(...e)=>{this._done=!0,this._endTimer(),t(...e)}})),this._doVerification&&!this._started&&(this._started=!0,this._resetTimer(),Promise.resolve(this._doVerification()).then(this.done.bind(this),this.cancel.bind(this)))),this._promise}async _verifyKeys(e,t,i){const n=[];for(const[r,a]of Object.entries(t)){const t=r.split(":",2)[1],c=this._baseApis.getStoredDevice(e,t);if(c)await i(r,c,a),n.push(t);else{const c=this._baseApis.crypto.deviceList.getStoredCrossSigningForUser(e);c&&c.getId()===t?(await i(r,o.DeviceInfo.fromStorage({keys:{[r]:t}},t),a),n.push(t)):s.logger.warn(`verification: Could not find device ${t} to verify`)}}if(!n.length)throw new Error("No devices could be verified");s.logger.info("Verification completed! Marking devices verified: ",n);for(const t of n)await this._baseApis.setDeviceVerified(e,t)}}t.VerificationBase=u},6702:(e,t,i)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.newVerificationError=r,t.errorFactory=s,t.errorFromEvent=function(e){const t=e.getContent();if(t){const{code:e,reason:i}=t;return{code:e,reason:i}}return{code:"Unknown error",reason:"m.unknown"}},t.newInvalidMessageError=t.newUserMismatchError=t.newKeyMismatchError=t.newUnexpectedMessageError=t.newUnknownMethodError=t.newUnknownTransactionError=t.newTimeoutError=t.newUserCancelledError=void 0;var n=i(4369);function r(e,t,i){const r=Object.assign({},{code:e,reason:t},i);return new n.MatrixEvent({type:"m.key.verification.cancel",content:r})}function s(e,t){return function(i){return r(e,t,i)}}const o=s("m.user","Cancelled by user");t.newUserCancelledError=o;const a=s("m.timeout","Timed out");t.newTimeoutError=a;const c=s("m.unknown_transaction","Unknown transaction");t.newUnknownTransactionError=c;const l=s("m.unknown_method","Unknown method");t.newUnknownMethodError=l;const h=s("m.unexpected_message","Unexpected message");t.newUnexpectedMessageError=h;const u=s("m.key_mismatch","Key mismatch");t.newKeyMismatchError=u;const d=s("m.user_error","User mismatch");t.newUserMismatchError=d;const p=s("m.invalid_message","Invalid message");t.newInvalidMessageError=p},4028:(e,t,i)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.IllegalMethod=void 0;var n=i(1631);class r extends n.VerificationBase{static factory(...e){return new r(...e)}static get NAME(){return"org.matrix.illegal_method"}async _doVerification(){throw new Error("Verification is not possible with this method")}}t.IllegalMethod=r},1696:(e,t,i)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.QRCodeData=t.ReciprocateQRCode=t.SCAN_QR_CODE_METHOD=t.SHOW_QR_CODE_METHOD=void 0;var n=i(1631),r=i(6702),s=i(2772),o=i(7434);t.SHOW_QR_CODE_METHOD="m.qr_code.show.v1",t.SCAN_QR_CODE_METHOD="m.qr_code.scan.v1";class a extends n.VerificationBase{static factory(...e){return new a(...e)}static get NAME(){return"m.reciprocate.v1"}async _doVerification(){if(!this.startEvent)throw new Error("It is not currently possible to start verificationwith this method yet.");const{qrCodeData:e}=this.request;if(this.startEvent.getContent().secret!==e.encodedSharedSecret)throw(0,r.newKeyMismatchError)();await new Promise(((e,t)=>{this.reciprocateQREvent={confirm:e,cancel:()=>t((0,r.newUserCancelledError)())},this.emit("show_reciprocate_qr",this.reciprocateQREvent)}));const t={};switch(e.mode){case c:{const i=e.otherUserMasterKey;t[`ed25519:${i}`]=i;break}case l:{const i=this.request.targetDevice.deviceId;t[`ed25519:${i}`]=e.otherDeviceKey;break}case h:{const i=e.myMasterKey;t[`ed25519:${i}`]=i;break}}await this._verifyKeys(this.userId,t,((e,i,n)=>{const s=t[e];if(!s)throw(0,r.newKeyMismatchError)();if(n!==s)throw o.logger.error("key ID from key info does not match"),(0,r.newKeyMismatchError)();for(const e in i.keys){if(!e.startsWith("ed25519"))continue;const n=t[e];if(!n)throw(0,r.newKeyMismatchError)();if(i.keys[e]!==n)throw o.logger.error("master key does not match"),(0,r.newKeyMismatchError)()}}))}}t.ReciprocateQRCode=a;const c=0,l=1,h=2;class u{constructor(e,t,i,n,r,s){this._sharedSecret=t,this._mode=e,this._otherUserMasterKey=i,this._otherDeviceKey=n,this._myMasterKey=r,this._buffer=s}static async create(e,t){const i=u._generateSharedSecret(),n=u._determineMode(e,t);let r=null,s=null,o=null;if(n===c)r=t.getStoredCrossSigningForUser(e.otherUserId).getId("master");else if(n===l)s=await u._getOtherDeviceKey(e,t);else if(n===h){const e=t.getUserId();o=t.getStoredCrossSigningForUser(e).getId("master")}const a=u._generateQrData(e,t,n,i,r,s,o),d=u._generateBuffer(a);return new u(n,i,r,s,o,d)}get buffer(){return this._buffer}get mode(){return this._mode}get otherDeviceKey(){return this._otherDeviceKey}get otherUserMasterKey(){return this._otherUserMasterKey}get myMasterKey(){return this._myMasterKey}get encodedSharedSecret(){return this._sharedSecret}static _generateSharedSecret(){const e=new Uint8Array(11);return i.g.crypto.getRandomValues(e),(0,s.encodeUnpaddedBase64)(e)}static async _getOtherDeviceKey(e,t){const i=t.getUserId(),n=e.targetDevice,r=n?n.deviceId:null,s=t.getStoredDevice(i,r);if(!s)throw new Error("could not find device "+r);return s.getFingerprint()}static _determineMode(e,t){const i=t.getUserId(),n=e.otherUserId;let r=c;return i===n&&(r=t.checkUserTrust(i).isCrossSigningVerified()?l:h),r}static _generateQrData(e,t,i,n,r,s,o){const a=t.getUserId(),u={prefix:"MATRIX",version:2,mode:i,transactionId:e.channel.transactionId,firstKeyB64:"",secondKeyB64:"",secretB64:n},d=t.getStoredCrossSigningForUser(a);return i===c?(u.firstKeyB64=d.getId("master"),u.secondKeyB64=r):i===l?(u.firstKeyB64=d.getId("master"),u.secondKeyB64=s):i===h&&(u.firstKeyB64=t.getDeviceEd25519Key(),u.secondKeyB64=o),u}static _generateBuffer(e){let t=Buffer.alloc(0);const i=e=>{const i=Buffer.from([e]);t=Buffer.concat([t,i])},n=(e,i,n=!0)=>{const r=Buffer.from(e,i);n&&(e=>{const i=Buffer.alloc(2);i.writeInt16BE(e,0),t=Buffer.concat([t,i])})(r.byteLength),t=Buffer.concat([t,r])},r=e=>{const i=(0,s.decodeBase64)(e),n=Buffer.from(i);t=Buffer.concat([t,n])};return n(e.prefix,"ascii",!1),i(e.version),i(e.mode),n(e.transactionId,"utf-8"),r(e.firstKeyB64),r(e.secondKeyB64),r(e.secretB64),t}}t.QRCodeData=u},6381:(e,t,i)=>{"use strict";var n=i(5318);Object.defineProperty(t,"__esModule",{value:!0}),t.SAS=void 0;var r=i(1631),s=n(i(9141)),o=i(6702),a=i(7434);const c="m.key.verification.start",l=["m.key.verification.accept","m.key.verification.key","m.key.verification.mac"];let h;const u=(0,o.errorFactory)("m.mismatched_sas","Mismatched short authentication string"),d=(0,o.errorFactory)("m.mismatched_commitment","Mismatched commitment"),p=[["🐶","dog"],["🐱","cat"],["🦁","lion"],["🐎","horse"],["🦄","unicorn"],["🐷","pig"],["🐘","elephant"],["🐰","rabbit"],["🐼","panda"],["🐓","rooster"],["🐧","penguin"],["🐢","turtle"],["🐟","fish"],["🐙","octopus"],["🦋","butterfly"],["🌷","flower"],["🌳","tree"],["🌵","cactus"],["🍄","mushroom"],["🌏","globe"],["🌙","moon"],["☁️","cloud"],["🔥","fire"],["🍌","banana"],["🍎","apple"],["🍓","strawberry"],["🌽","corn"],["🍕","pizza"],["🎂","cake"],["❤️","heart"],["🙂","smiley"],["🤖","robot"],["🎩","hat"],["👓","glasses"],["🔧","spanner"],["🎅","santa"],["👍","thumbs up"],["☂️","umbrella"],["⌛","hourglass"],["⏰","clock"],["🎁","gift"],["💡","light bulb"],["📕","book"],["✏️","pencil"],["📎","paperclip"],["✂️","scissors"],["🔒","lock"],["🔑","key"],["🔨","hammer"],["☎️","telephone"],["🏁","flag"],["🚂","train"],["🚲","bicycle"],["✈️","aeroplane"],["🚀","rocket"],["🏆","trophy"],["⚽","ball"],["🎸","guitar"],["🎺","trumpet"],["🔔","bell"],["⚓️","anchor"],["🎧","headphones"],["📁","folder"],["📌","pin"]],g={decimal:function(e){return[1e3+(e[0]<<5|e[1]>>3),1e3+((7&e[1])<<10|e[2]<<2|e[3]>>6),1e3+((63&e[3])<<7|e[4]>>1)]},emoji:function(e){return[e[0]>>2,(3&e[0])<<4|e[1]>>4,(15&e[1])<<2|e[2]>>6,63&e[2],e[3]>>2,(3&e[3])<<4|e[4]>>4,(15&e[4])<<2|e[5]>>6].map((e=>p[e]))}};function f(e,t){const i={};for(const n of t)n in g&&(i[n]=g[n](e));return i}const m={"hkdf-hmac-sha256":"calculate_mac","hmac-sha256":"calculate_mac_long_kdf"};function v(e,t){return function(...i){const n=e[m[t]].apply(e,i);return a.logger.log("SAS calculateMAC:",t,i,n),n}}const y={"curve25519-hkdf-sha256":function(e,t,i){const n=`${e._baseApis.getUserId()}|${e._baseApis.deviceId}|${e.ourSASPubKey}|`,r=`${e.userId}|${e.deviceId}|${e.theirSASPubKey}|`,s="MATRIX_KEY_VERIFICATION_SAS|"+(e.initiatedByMe?n+r:r+n)+e._channel.transactionId;return t.generate_bytes(s,i)},curve25519:function(e,t,i){const n=`${e._baseApis.getUserId()}${e._baseApis.deviceId}`,r=`${e.userId}${e.deviceId}`,s="MATRIX_KEY_VERIFICATION_SAS"+(e.initiatedByMe?n+r:r+n)+e._channel.transactionId;return t.generate_bytes(s,i)}},_=["curve25519-hkdf-sha256","curve25519"],S=["sha256"],b=["hkdf-hmac-sha256","hmac-sha256"],w=Object.keys(g),E=new Set(_),I=new Set(S),k=new Set(b),T=new Set(w);function C(e,t){return e instanceof Array?e.filter((e=>t.has(e))):[]}class x extends r.VerificationBase{static get NAME(){return"m.sas.v1"}get events(){return l}async _doVerification(){await i.g.Olm.init(),h=h||new i.g.Olm.Utility,await this._baseApis.downloadKeys([this.userId]);let e=!1;do{try{return this.initiatedByMe?await this._doSendVerification():await this._doRespondVerification()}catch(t){if(!(t instanceof r.SwitchStartEventError))throw t;this.startEvent=t.startEvent,e=!0}}while(e)}canSwitchStartEvent(e){if(e.getType()!==c)return!1;const t=e.getContent();return t&&t.method===x.NAME&&this._waitingForAccept}async _sendStart(){const e=this._channel.completeContent(c,{method:x.NAME,from_device:this._baseApis.deviceId,key_agreement_protocols:_,hashes:S,message_authentication_codes:b,short_authentication_string:w});return await this._channel.sendCompleted(c,e),e}async _doSendVerification(){let e,t;if(this._waitingForAccept=!0,e=this.startEvent?this._channel.completedContentFromEvent(this.startEvent):await this._sendStart(),!this.initiatedByMe)throw new r.SwitchStartEventError(this.startEvent);try{t=await this._waitForEvent("m.key.verification.accept")}finally{this._waitingForAccept=!1}let n=t.getContent();const a=C(n.short_authentication_string,T);if(!(E.has(n.key_agreement_protocol)&&I.has(n.hash)&&k.has(n.message_authentication_code)&&a.length))throw(0,o.newUnknownMethodError)();if("string"!=typeof n.commitment)throw(0,o.newInvalidMessageError)();const c=n.key_agreement_protocol,l=n.message_authentication_code,p=n.commitment,g=new i.g.Olm.SAS;try{this.ourSASPubKey=g.get_pubkey(),await this._send("m.key.verification.key",{key:this.ourSASPubKey}),t=await this._waitForEvent("m.key.verification.key"),n=t.getContent();const i=n.key+s.default.stringify(e);if(h.sha256(i)!==p)throw d();this.theirSASPubKey=n.key,g.set_their_key(n.key);const r=y[c](this,g,6),m=new Promise(((e,t)=>{this.sasEvent={sas:f(r,a),confirm:async()=>{try{await this._sendMAC(g,l),e()}catch(e){t(e)}},cancel:()=>t((0,o.newUserCancelledError)()),mismatch:()=>t(u())},this.emit("show_sas",this.sasEvent)}));[t]=await Promise.all([this._waitForEvent("m.key.verification.mac").then((e=>(this._expectedEvent="m.key.verification.done",e))),m]),n=t.getContent(),await this._checkMAC(g,n,l)}finally{g.free()}}async _doRespondVerification(){let e=this._channel.completedContentFromEvent(this.startEvent);const t=C(_,new Set(e.key_agreement_protocols))[0],n=C(S,new Set(e.hashes))[0],r=C(b,new Set(e.message_authentication_codes))[0],a=C(e.short_authentication_string,T);if(void 0===t||void 0===n||void 0===r||!a.length)throw(0,o.newUnknownMethodError)();const c=new i.g.Olm.SAS;try{const i=c.get_pubkey()+s.default.stringify(e);await this._send("m.key.verification.accept",{key_agreement_protocol:t,hash:n,message_authentication_code:r,short_authentication_string:a,commitment:h.sha256(i)});let l=await this._waitForEvent("m.key.verification.key");e=l.getContent(),this.theirSASPubKey=e.key,c.set_their_key(e.key),this.ourSASPubKey=c.get_pubkey(),await this._send("m.key.verification.key",{key:this.ourSASPubKey});const d=y[t](this,c,6),p=new Promise(((e,t)=>{this.sasEvent={sas:f(d,a),confirm:async()=>{try{await this._sendMAC(c,r),e()}catch(e){t(e)}},cancel:()=>t((0,o.newUserCancelledError)()),mismatch:()=>t(u())},this.emit("show_sas",this.sasEvent)}));[l]=await Promise.all([this._waitForEvent("m.key.verification.mac").then((e=>(this._expectedEvent="m.key.verification.done",e))),p]),e=l.getContent(),await this._checkMAC(c,e,r)}finally{c.free()}}_sendMAC(e,t){const i={},n=[],r="MATRIX_KEY_VERIFICATION_MAC"+this._baseApis.getUserId()+this._baseApis.deviceId+this.userId+this.deviceId+this._channel.transactionId,s=`ed25519:${this._baseApis.deviceId}`;i[s]=v(e,t)(this._baseApis.getDeviceEd25519Key(),r+s),n.push(s);const o=this._baseApis.getCrossSigningId();if(o){const s=`ed25519:${o}`;i[s]=v(e,t)(o,r+s),n.push(s)}const a=v(e,t)(n.sort().join(","),r+"KEY_IDS");return this._send("m.key.verification.mac",{mac:i,keys:a})}async _checkMAC(e,t,i){const n="MATRIX_KEY_VERIFICATION_MAC"+this.userId+this.deviceId+this._baseApis.getUserId()+this._baseApis.deviceId+this._channel.transactionId;if(t.keys!==v(e,i)(Object.keys(t.mac).sort().join(","),n+"KEY_IDS"))throw(0,o.newKeyMismatchError)();await this._verifyKeys(this.userId,t.mac,((t,r,s)=>{if(s!==v(e,i)(r.keys[t],n+t))throw(0,o.newKeyMismatchError)()}))}}t.SAS=x},2842:(e,t,i)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.InRoomRequests=t.InRoomChannel=void 0;var n=i(5279),r=i(7434);const s="m.room.message",o="m.reference",a="m.relates_to";class c{constructor(e,t,i=null){this._client=e,this._roomId=t,this.userId=i,this._requestEventId=null}get receiveStartFromOtherDevices(){return!0}get roomId(){return this._roomId}get transactionId(){return this._requestEventId}static getOtherPartyUserId(e,t){if(c.getEventType(e)!==n.REQUEST_TYPE)return;const i=t.getUserId(),r=e.getSender(),s=e.getContent().to;return r===i?s:s===i?r:void 0}getTimestamp(e){return e.getTs()}static canCreateRequest(e){return e===n.REQUEST_TYPE}static getTransactionId(e){if(c.getEventType(e)===n.REQUEST_TYPE)return e.getId();{const t=e.getRelation();if(t&&t.rel_type===o)return t.event_id}}static validateEvent(e,t){const i=c.getTransactionId(e);if("string"!=typeof i||0===i.length)return!1;const s=c.getEventType(e),o=e.getContent();if(s===n.REQUEST_TYPE){if(!o||"string"!=typeof o.to||!o.to.length)return r.logger.log("InRoomChannel: validateEvent: no valid to "+(o&&o.to)),!1;if(!c.getOtherPartyUserId(e,t))return r.logger.log(`InRoomChannel: validateEvent: not directed to or sent by me: ${e.getSender()}, ${o&&o.to}`),!1}return n.VerificationRequest.validateEvent(s,e,t)}static getEventType(e){const t=e.getType();if(t===s){const t=e.getContent();if(t){const{msgtype:e}=t;if(e===n.REQUEST_TYPE)return n.REQUEST_TYPE}}return t&&t!==n.REQUEST_TYPE?t:""}async handleEvent(e,t,i){if(t.hasEventId(e.getId()))return;const n=c.getEventType(e);if(e.getRoomId()!==this._roomId)return;if(null===this.userId){const t=c.getOtherPartyUserId(e,this._client);t&&(this.userId=t)}const s=this._client.getUserId(),o=e.getSender();if(null!==this.userId&&o!==s&&o!==this.userId)return void r.logger.log(`InRoomChannel: ignoring verification event from non-participating sender ${o}`);null===this._requestEventId&&(this._requestEventId=c.getTransactionId(e));const a=!!e.getUnsigned().transaction_id,l=e.getSender()===this._client.getUserId();return await t.handleEvent(n,e,i,a,l)}completedContentFromEvent(e){const t=Object.assign({},e.getContent());return t[a]=e.getRelation(),t}completeContent(e,t){return t=Object.assign({},t),e!==n.REQUEST_TYPE&&e!==n.READY_TYPE&&e!==n.START_TYPE||(t.from_device=this._client.getDeviceId()),e===n.REQUEST_TYPE?t={body:this._client.getUserId()+" is requesting to verify your key, but your client does not support in-chat key verification.  You will need to use legacy key verification to verify keys.",msgtype:n.REQUEST_TYPE,to:this.userId,from_device:t.from_device,methods:t.methods}:t[a]={rel_type:o,event_id:this.transactionId},t}send(e,t){const i=this.completeContent(e,t);return this.sendCompleted(e,i)}async sendCompleted(e,t){let i=e;e===n.REQUEST_TYPE&&(i=s);const r=await this._client.sendEvent(this._roomId,i,t);e===n.REQUEST_TYPE&&(this._requestEventId=r.event_id)}}t.InRoomChannel=c,t.InRoomRequests=class{constructor(){this._requestsByRoomId=new Map}getRequest(e){const t=e.getRoomId(),i=c.getTransactionId(e);return this._getRequestByTxnId(t,i)}getRequestByChannel(e){return this._getRequestByTxnId(e.roomId,e.transactionId)}_getRequestByTxnId(e,t){const i=this._requestsByRoomId.get(e);if(i)return i.get(t)}setRequest(e,t){this._setRequest(e.getRoomId(),c.getTransactionId(e),t)}setRequestByChannel(e,t){this._setRequest(e.roomId,e.transactionId,t)}_setRequest(e,t,i){let n=this._requestsByRoomId.get(e);n||(n=new Map,this._requestsByRoomId.set(e,n)),n.set(t,i)}removeRequest(e){const t=e.getRoomId(),i=this._requestsByRoomId.get(t);i&&(i.delete(c.getTransactionId(e)),0===i.size&&this._requestsByRoomId.delete(t))}findRequestInProgress(e){const t=this._requestsByRoomId.get(e);if(t)for(const e of t.values())if(e.pending)return e}}},9588:(e,t,i)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.ToDeviceRequests=t.ToDeviceChannel=void 0;var n=i(8401),r=i(7434),s=i(5279),o=i(6702),a=i(4369);class c{constructor(e,t,i,n=null,r=null){this._client=e,this.userId=t,this._devices=i,this.transactionId=n,this._deviceId=r}isToDevices(e){if(e.length===this._devices.length){for(const t of e)if(!this._devices.find((e=>e.deviceId===t.deviceId)))return!1;return!0}return!1}get deviceId(){return this._deviceId}static getEventType(e){return e.getType()}static getTransactionId(e){const t=e.getContent();return t&&t.transaction_id}static canCreateRequest(e){return e===s.REQUEST_TYPE||e===s.START_TYPE}static validateEvent(e,t){if(e.isCancelled())return r.logger.warn("Ignoring flagged verification request from "+e.getSender()),!1;const i=e.getContent();if(!i)return r.logger.warn("ToDeviceChannel.validateEvent: invalid: no content"),!1;if(!i.transaction_id)return r.logger.warn("ToDeviceChannel.validateEvent: invalid: no transaction_id"),!1;const n=e.getType();if(n===s.REQUEST_TYPE){if(!Number.isFinite(i.timestamp))return r.logger.warn("ToDeviceChannel.validateEvent: invalid: no timestamp"),!1;if(e.getSender()===t.getUserId()&&i.from_device==t.getDeviceId())return r.logger.warn("ToDeviceChannel.validateEvent: invalid: from own device"),!1}return s.VerificationRequest.validateEvent(n,e,t)}getTimestamp(e){const t=e.getContent();return t&&t.timestamp}async handleEvent(e,t,i){const n=e.getType(),r=e.getContent();if(n===s.REQUEST_TYPE||n===s.READY_TYPE||n===s.START_TYPE){this.transactionId||(this.transactionId=r.transaction_id);const e=r.from_device;if(!this._deviceId&&this._devices.includes(e)&&(this._deviceId=e),!this._deviceId||this._deviceId!==e){const t=this.completeContent((0,o.errorFromEvent)((0,o.newUnexpectedMessageError)()));return this._sendToDevices(s.CANCEL_TYPE,t,[e])}}const a=t.phase===s.PHASE_STARTED||t.phase===s.PHASE_READY;await t.handleEvent(e.getType(),e,i,!1,!1);const c=t.phase===s.PHASE_STARTED||t.phase===s.PHASE_READY;if((n===s.START_TYPE||n===s.READY_TYPE)&&!a&&c&&this._deviceId){const e=this._devices.filter((e=>e!==this._deviceId&&e!==this._client.getDeviceId()));if(e.length){const t=this.completeContent({code:"m.accepted",reason:"Verification request accepted by another device"});await this._sendToDevices(s.CANCEL_TYPE,t,e)}}}completedContentFromEvent(e){return e.getContent()}completeContent(e,t){return t=Object.assign({},t),this.transactionId&&(t.transaction_id=this.transactionId),e!==s.REQUEST_TYPE&&e!==s.READY_TYPE&&e!==s.START_TYPE||(t.from_device=this._client.getDeviceId()),e===s.REQUEST_TYPE&&(t.timestamp=Date.now()),t}send(e,t={}){e!==s.REQUEST_TYPE&&e!==s.START_TYPE||this.transactionId||(this.transactionId=c.makeTransactionId());const i=this.completeContent(e,t);return this.sendCompleted(e,i)}async sendCompleted(e,t){let i;i=e===s.REQUEST_TYPE?await this._sendToDevices(e,t,this._devices):await this._sendToDevices(e,t,[this._deviceId]);const n=new a.MatrixEvent({sender:this._client.getUserId(),content:t,type:e});return await this._request.handleEvent(e,n,!0,!0,!0),i}_sendToDevices(e,t,i){if(i.length){const n={};for(const e of i)n[e]=t;return this._client.sendToDevice(e,{[this.userId]:n})}return Promise.resolve()}static makeTransactionId(){return(0,n.randomString)(32)}}t.ToDeviceChannel=c,t.ToDeviceRequests=class{constructor(){this._requestsByUserId=new Map}getRequest(e){return this.getRequestBySenderAndTxnId(e.getSender(),c.getTransactionId(e))}getRequestByChannel(e){return this.getRequestBySenderAndTxnId(e.userId,e.transactionId)}getRequestBySenderAndTxnId(e,t){const i=this._requestsByUserId.get(e);if(i)return i.get(t)}setRequest(e,t){this.setRequestBySenderAndTxnId(e.getSender(),c.getTransactionId(e),t)}setRequestByChannel(e,t){this.setRequestBySenderAndTxnId(e.userId,e.transactionId,t)}setRequestBySenderAndTxnId(e,t,i){let n=this._requestsByUserId.get(e);n||(n=new Map,this._requestsByUserId.set(e,n)),n.set(t,i)}removeRequest(e){const t=e.getSender(),i=this._requestsByUserId.get(t);i&&(i.delete(c.getTransactionId(e)),0===i.size&&this._requestsByUserId.delete(t))}findRequestInProgress(e,t){const i=this._requestsByUserId.get(e);if(i)for(const e of i.values())if(e.pending&&e.channel.isToDevices(t))return e}getRequestsInProgress(e){const t=this._requestsByUserId.get(e);return t?Array.from(t.values()).filter((e=>e.pending)):[]}}},5279:(e,t,i)=>{"use strict";var n=i(5318);Object.defineProperty(t,"__esModule",{value:!0}),t.VerificationRequest=t.PHASE_DONE=t.PHASE_CANCELLED=t.PHASE_STARTED=t.PHASE_READY=t.PHASE_REQUESTED=t.PHASE_UNSENT=t.READY_TYPE=t.DONE_TYPE=t.CANCEL_TYPE=t.START_TYPE=t.REQUEST_TYPE=t.EVENT_PREFIX=void 0;var r=n(i(9713)),s=i(7434),o=i(7187),a=i(6702),c=i(1696);const l="m.key.verification.";t.EVENT_PREFIX=l;const h=l+"request";t.REQUEST_TYPE=h;const u=l+"start";t.START_TYPE=u;const d=l+"cancel";t.CANCEL_TYPE=d;const p=l+"done";t.DONE_TYPE=p;const g=l+"ready";t.READY_TYPE=g,t.PHASE_UNSENT=1,t.PHASE_REQUESTED=2,t.PHASE_READY=3,t.PHASE_STARTED=4,t.PHASE_CANCELLED=5,t.PHASE_DONE=6;class f extends o.EventEmitter{constructor(e,t,i){super(),(0,r.default)(this,"_cancelOnTimeout",(()=>{try{this.initiatedByMe?this.cancel({reason:"Other party didn't accept in time",code:"m.timeout"}):this.cancel({reason:"User didn't accept in time",code:"m.timeout"})}catch(e){s.logger.error("Error while cancelling verification request",e)}})),this.channel=e,this.channel._request=this,this._verificationMethods=t,this._client=i,this._commonMethods=[],this._setPhase(1,!1),this._eventsByUs=new Map,this._eventsByThem=new Map,this._observeOnly=!1,this._timeoutTimer=null,this._accepting=!1,this._declining=!1,this._verifierHasFinished=!1,this._cancelled=!1,this._chosenMethod=null,this._qrCodeData=null,this._requestReceivedAt=null}static validateEvent(e,t,i){const n=t.getContent();return!(!e||!e.startsWith(l))&&(n?e!==h&&e!==g||Array.isArray(n.methods)?e!==h&&e!==g&&e!==u||"string"==typeof n.from_device&&0!==n.from_device.length||(s.logger.log("VerificationRequest: validateEvent: fail because from_device"),!1):(s.logger.log("VerificationRequest: validateEvent: fail because methods"),!1):(s.logger.log("VerificationRequest: validateEvent: no content"),!1))}get invalid(){return 1===this.phase}get requested(){return 2===this.phase}get cancelled(){return 5===this.phase}get ready(){return 3===this.phase}get started(){return 4===this.phase}get done(){return 6===this.phase}get methods(){return this._commonMethods}get chosenMethod(){return this._chosenMethod}calculateEventTimeout(e){let t=this.channel.getTimestamp(e)+6e5;if(this._requestReceivedAt&&!this.initiatedByMe&&this.phase<=2){const e=this._requestReceivedAt+12e4;t=Math.min(t,e)}return Math.max(0,t-Date.now())}get timeout(){const e=this._getEventByEither(h);return e?this.calculateEventTimeout(e):0}get requestEvent(){return this._getEventByEither(h)}get phase(){return this._phase}get verifier(){return this._verifier}get canAccept(){return this.phase<3&&!this._accepting&&!this._declining}get accepting(){return this._accepting}get declining(){return this._declining}get pending(){return!this.observeOnly&&6!==this._phase&&5!==this._phase}get qrCodeData(){return this._qrCodeData}otherPartySupportsMethod(e,t=!1){if(!t&&!this.ready&&!this.started)return!1;const i=this._eventsByThem.get(h)||this._eventsByThem.get(g);if(!i){if(this.started&&this.initiatedByMe){const t=this._eventsByUs.get(u),i=t&&t.getContent();return e==(i&&i.method)}return!1}const n=i.getContent();if(!n)return!1;const{methods:r}=n;return!!Array.isArray(r)&&r.includes(e)}get initiatedByMe(){const e=this._eventsByUs.size+this._eventsByThem.size===0;if(1===this._phase&&e)return!0;const t=this._eventsByUs.has(h),i=this._eventsByThem.has(h);if(t&&!i)return!0;if(!t&&i)return!1;const n=this._eventsByUs.has(u),r=this._eventsByThem.has(u);return!(!n||r)}get requestingUserId(){return this.initiatedByMe?this._client.getUserId():this.otherUserId}get receivingUserId(){return this.initiatedByMe?this.otherUserId:this._client.getUserId()}get otherUserId(){return this.channel.userId}get isSelfVerification(){return this._client.getUserId()===this.otherUserId}get cancellingUserId(){const e=this._eventsByUs.get(d),t=this._eventsByThem.get(d);return e&&(!t||e.getId()<t.getId())?e.getSender():t?t.getSender():void 0}get cancellationCode(){const e=this._getEventByEither(d);return e?e.getContent().code:null}get observeOnly(){return this._observeOnly}get targetDevice(){const e=(this._eventsByThem.get(h)||this._eventsByThem.get(g)||this._eventsByThem.get(u)).getContent().from_device;return{userId:this.otherUserId,deviceId:e}}beginKeyVerification(e,t=null){if(!this.observeOnly&&!this._verifier&&(2===this.phase||3===this.phase||1===this.phase&&this.channel.constructor.canCreateRequest(u))){if(this._commonMethods.length&&!this._commonMethods.includes(e))throw(0,a.newUnknownMethodError)();if(this._verifier=this._createVerifier(e,null,t),!this._verifier)throw(0,a.newUnknownMethodError)();this._chosenMethod=e}return this._verifier}async sendRequest(){if(!this.observeOnly&&1===this._phase){const e=[...this._verificationMethods.keys()];await this.channel.send(h,{methods:e})}}async cancel({reason:e="User declined",code:t="m.user"}={}){if(!this.observeOnly&&5!==this._phase){if(this._declining=!0,this.emit("change"),this._verifier)return this._verifier.cancel((0,a.errorFactory)(t,e)());this._cancellingUserId=this._client.getUserId(),await this.channel.send(d,{code:t,reason:e})}}async accept(){if(!this.observeOnly&&2===this.phase&&!this.initiatedByMe){const e=[...this._verificationMethods.keys()];this._accepting=!0,this.emit("change"),await this.channel.send(g,{methods:e})}}waitFor(e){return new Promise(((t,i)=>{const n=()=>{let r=!1;return e(this)?(t(this),r=!0):this.cancelled&&(i(new Error("cancelled")),r=!0),r&&this.off("change",n),r};n()||this.on("change",n)}))}_setPhase(e,t=!0){this._phase=e,t&&this.emit("change")}_getEventByEither(e){return this._eventsByThem.get(e)||this._eventsByUs.get(e)}_getEventBy(e,t){return t?this._eventsByThem.get(e):this._eventsByUs.get(e)}_calculatePhaseTransitions(){const e=[{phase:1}],t=()=>e[e.length-1].phase,i=this._eventsByThem.has(h),n=this._getEventBy(h,i);n&&e.push({phase:2,event:n});const r=n&&this._getEventBy(g,!i);let s;if(r&&2===t()&&e.push({phase:3,event:r}),r||!n){const e=this._eventsByThem.get(u),t=this._eventsByUs.get(u);s=e&&t?e.getSender()<t.getSender()?e:t:e||t}else s=this._getEventBy(u,!i);if(s){const i=2===t()&&n.getSender()!==s.getSender(),r=1===t()&&this.channel.constructor.canCreateRequest(u);(i||3===t()||r)&&e.push({phase:4,event:s})}const o=this._eventsByUs.get(p);(this._verifierHasFinished||o&&4===t())&&e.push({phase:6});const a=this._getEventByEither(d);return(this._cancelled||a)&&6!==t()?(e.push({phase:5,event:a}),e):e}_transitionToPhase(e){const{phase:t,event:i}=e;if((2===t||3===t)&&!this._wasSentByOwnDevice(i)){const e=i.getContent();this._commonMethods=e.methods.filter((e=>this._verificationMethods.has(e)))}if(this.observeOnly||2!==t&&4!==t&&3!==t||this.channel.receiveStartFromOtherDevices&&this._wasSentByOwnUser(i)&&!this._wasSentByOwnDevice(i)&&(this._observeOnly=!0),4===t){const{method:e}=i.getContent();this._verifier||this.observeOnly||(this._verifier=this._createVerifier(e,i),this._verifier?this._chosenMethod=e:this.cancel({code:"m.unknown_method",reason:`Unknown method: ${e}`}))}}_applyPhaseTransitions(){const e=this._calculatePhaseTransitions(),t=e.findIndex((e=>e.phase===this.phase)),i=e.slice(t+1);for(const e of i)this._transitionToPhase(e);return i}_isWinningStartRace(e){if(e.getType()!==u)return!1;const t=this._verifier.startEvent;let i,n;if(this.isSelfVerification)if(t){const e=t.getContent();i=e&&e.from_device}else i=this._client.getDeviceId();else i=t?t.getSender():this._client.getUserId();if(this.isSelfVerification){const t=e.getContent();n=t&&t.from_device}else n=e.getSender();return n<i}hasEventId(e){for(const t of this._eventsByUs.values())if(t.getId()===e)return!0;for(const t of this._eventsByThem.values())if(t.getId()===e)return!0;return!1}async handleEvent(e,t,i,n,r){if(this.done||this.cancelled)return;const o=this._observeOnly;if(this._adjustObserveOnly(t,i),!this.observeOnly&&!n&&await this._cancelOnError(e,t))return;if(r?this._eventsByUs.has(e):this._eventsByThem.has(e))return;const a=this.phase;this._addEvent(e,t,r);const l=this._applyPhaseTransitions();try{if(this._verifier&&!this.observeOnly){const i=this._isWinningStartRace(t);this._verifier.canSwitchStartEvent(t)&&i?this._verifier.switchStartEvent(t):n||(e===d||this._verifier.events&&this._verifier.events.includes(e))&&this._verifier.handleEvent(t)}if(l.length){i&&l.some((e=>3===e.phase))&&this.otherPartySupportsMethod(c.SCAN_QR_CODE_METHOD,!0)&&(this._qrCodeData=await c.QRCodeData.create(this,this._client));const e=l[l.length-1],{phase:t}=e;this._setupTimeout(t),this._setPhase(t)}else this._observeOnly!==o&&this.emit("change")}finally{s.logger.log(`Verification request ${this.channel.transactionId}: ${e} event with id:${t.getId()}, content:${JSON.stringify(t.getContent())} deviceId:${this.channel.deviceId}, sender:${t.getSender()}, isSentByUs:${r}, isLiveEvent:${i}, isRemoteEcho:${n}, phase:${a}=>${this.phase}, observeOnly:${o}=>${this._observeOnly}`)}}_setupTimeout(e){!this._timeoutTimer&&!this.observeOnly&&2===e&&(this._timeoutTimer=setTimeout(this._cancelOnTimeout,this.timeout)),this._timeoutTimer&&(4===e||3===e||6===e||5===e)&&(clearTimeout(this._timeoutTimer),this._timeoutTimer=null)}async _cancelOnError(e,t){if(e===u){const e=t.getContent().method;if(!this._verificationMethods.has(e))return await this.cancel((0,a.errorFromEvent)((0,a.newUnknownMethodError)())),!0}const i=e===h&&1!==this.phase,n=e===g&&2!==this.phase;if(1!==this.phase&&(i||n)){s.logger.warn(`Cancelling, unexpected ${e} verification event from ${t.getSender()}`);const i=`Unexpected ${e} event in phase ${this.phase}`;return await this.cancel((0,a.errorFromEvent)((0,a.newUnexpectedMessageError)({reason:i}))),!0}return!1}_adjustObserveOnly(e,t){t||(this._observeOnly=!0),this.calculateEventTimeout(e)<3e3&&(this._observeOnly=!0)}_addEvent(e,t,i){if(i?this._eventsByUs.set(e,t):this._eventsByThem.set(e,t),e===h){for(const[e,t]of this._eventsByThem.entries())t.getSender()!==this.otherUserId&&this._eventsByThem.delete(e);this._requestReceivedAt=Date.now()}}_createVerifier(e,t=null,i=null){i||(i=this.targetDevice);const{userId:n,deviceId:r}=i,o=this._verificationMethods.get(e);if(o)return new o(this.channel,this._client,n,r,t,this);s.logger.warn("could not find verifier constructor for method",e)}_wasSentByOwnUser(e){return e.getSender()===this._client.getUserId()}_wasSentByOwnDevice(e){if(!this._wasSentByOwnUser(e))return!1;const t=e.getContent();return!(!t||t.from_device!==this._client.getDeviceId())}onVerifierCancelled(){this._cancelled=!0;const e=this._applyPhaseTransitions();e.length&&this._setPhase(e[e.length-1].phase)}onVerifierFinished(){this.channel.send("m.key.verification.done",{}),this._verifierHasFinished=!0;const e=this._applyPhaseTransitions();e.length&&this._setPhase(e[e.length-1].phase)}getEventFromOtherParty(e){return this._eventsByThem.get(e)}}t.VerificationRequest=f},9489:(e,t)=>{"use strict";function i(e,t){const i=`Store is invalid because ${e}, please stop the client, delete all data and start the client again`,n=Reflect.construct(Error,[i]);return Reflect.setPrototypeOf(n,Reflect.getPrototypeOf(this)),n.reason=e,n.value=t,n}function n(e){const t=`Crypto store is invalid because ${e}, please stop the client, delete all data and start the client again`,i=Reflect.construct(Error,[t]);return Reflect.setPrototypeOf(i,Reflect.getPrototypeOf(this)),i.reason=e,i.name="InvalidCryptoStoreError",i}Object.defineProperty(t,"__esModule",{value:!0}),t.InvalidStoreError=i,t.InvalidCryptoStoreError=n,t.KeySignatureUploadError=void 0,i.TOGGLED_LAZY_LOADING="TOGGLED_LAZY_LOADING",i.prototype=Object.create(Error.prototype,{constructor:{value:Error,enumerable:!1,writable:!0,configurable:!0}}),Reflect.setPrototypeOf(i,Error),n.TOO_NEW="TOO_NEW",n.prototype=Object.create(Error.prototype,{constructor:{value:Error,enumerable:!1,writable:!0,configurable:!0}}),Reflect.setPrototypeOf(n,Error);class r extends Error{constructor(e,t){super(e),this.value=t}}t.KeySignatureUploadError=r},1166:(e,t,i)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.eventMapperFor=function(e,t){const i=Boolean(t.preventReEmit),r=!1!==t.decrypt;return function(t){const s=new n.MatrixEvent(t);return s.isEncrypted()&&(i||e.reEmitter.reEmit(s,["Event.decrypted"]),r&&e.decryptEventIfNeeded(s)),i||e.reEmitter.reEmit(s,["Event.replaced"]),s}};var n=i(4369)},3564:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.FilterComponent=void 0,t.FilterComponent=class{constructor(e){this.filterJson=e}check(e){return this.checkFields(e.getRoomId(),e.getSender(),e.getType(),!!e.getContent()&&void 0!==e.getContent().url)}toJSON(){return{types:this.filterJson.types||null,not_types:this.filterJson.not_types||[],rooms:this.filterJson.rooms||null,not_rooms:this.filterJson.not_rooms||[],senders:this.filterJson.senders||null,not_senders:this.filterJson.not_senders||[],contains_url:this.filterJson.contains_url||null}}checkFields(e,t,i,n){const r={rooms:function(t){return e===t},senders:function(e){return t===e},types:function(e){return function(e,t){if(t.endsWith("*")){const i=t.slice(0,-1);return e.substr(0,i.length)===i}return e===t}(i,e)}};for(let e=0;e<Object.keys(r).length;e++){const t=Object.keys(r)[e],i=r[t],n="not_"+t,s=this.filterJson[n];if(null!=s&&s.some(i))return!1;const o=this.filterJson[t];if(o&&!o.some(i))return!1}const s=this.filterJson.contains_url;return void 0===s||s===n}filter(e){return e.filter(this.check,this)}limit(){return void 0!==this.filterJson.limit?this.filterJson.limit:10}}},7906:(e,t,i)=>{"use strict";var n=i(5318);Object.defineProperty(t,"__esModule",{value:!0}),t.Filter=void 0;var r=n(i(9713)),s=i(3564);function o(e,t,i){const n=t.split(".");let r=e;for(let e=0;e<n.length-1;e++)r[n[e]]||(r[n[e]]={}),r=r[n[e]];r[n[n.length-1]]=i}class a{static fromJson(e,t,i){const n=new a(e,t);return n.setDefinition(i),n}constructor(e,t){this.userId=e,this.filterId=t,(0,r.default)(this,"definition",{}),(0,r.default)(this,"roomFilter",void 0),(0,r.default)(this,"roomTimelineFilter",void 0)}getFilterId(){return this.filterId}getDefinition(){return this.definition}setDefinition(e){this.definition=e;const t=e.room,i={};t&&(t.rooms&&(i.rooms=t.rooms),t.rooms&&(i.not_rooms=t.not_rooms)),this.roomFilter=new s.FilterComponent(i),this.roomTimelineFilter=new s.FilterComponent((null==t?void 0:t.timeline)||{})}getRoomTimelineFilterComponent(){return this.roomTimelineFilter}filterRoomTimeline(e){return this.roomTimelineFilter.filter(this.roomFilter.filter(e))}setTimelineLimit(e){o(this.definition,"room.timeline.limit",e)}setLazyLoadMembers(e){o(this.definition,"room.state.lazy_load_members",!!e)}setIncludeLeaveRooms(e){o(this.definition,"room.include_leave",e)}}t.Filter=a,(0,r.default)(a,"LAZY_LOADING_MESSAGES_FILTER",{lazy_load_members:!0})},7715:(e,t,i)=>{"use strict";var n=i(862),r=i(5318);Object.defineProperty(t,"__esModule",{value:!0}),t.MatrixHttpApi=d,t.retryNetworkOperation=async function(e,t){let i=0,n=null;for(;i<e;)try{if(i>0){const e=1e3*Math.pow(2,i);c.logger.log(`network operation failed ${i} times, retrying in ${e}ms...`),await new Promise((t=>setTimeout(t,e)))}return await t()}catch(e){if(!(e instanceof f))throw e;i+=1,n=e}throw n},t.AbortError=t.ConnectionError=t.MatrixError=t.PREFIX_MEDIA_R0=t.PREFIX_IDENTITY_V2=t.PREFIX_IDENTITY_V1=t.PREFIX_UNSTABLE=t.PREFIX_R0=void 0;var s=r(i(9713)),o=i(7811),a=n(i(3102)),c=i(7434),l=n(i(2731));function h(e,t){var i=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),i.push.apply(i,n)}return i}function u(e){for(var t=1;t<arguments.length;t++){var i=null!=arguments[t]?arguments[t]:{};t%2?h(Object(i),!0).forEach((function(t){(0,s.default)(e,t,i[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(i)):h(Object(i)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(i,t))}))}return e}function d(e,t){a.checkObjectHasKeys(t,["baseUrl","request","prefix"]),t.onlyData=t.onlyData||!1,this.event_emitter=e,this.opts=t,this.useAuthorizationHeader=Boolean(t.useAuthorizationHeader),this.uploads=[]}t.PREFIX_R0="/_matrix/client/r0",t.PREFIX_UNSTABLE="/_matrix/client/unstable",t.PREFIX_IDENTITY_V1="/_matrix/identity/api/v1",t.PREFIX_IDENTITY_V2="/_matrix/identity/v2",t.PREFIX_MEDIA_R0="/_matrix/media/r0",d.prototype={setIdBaseUrl:function(e){this.opts.idBaseUrl=e},getContentUri:function(){const e={access_token:this.opts.accessToken};return{base:this.opts.baseUrl,path:"/_matrix/media/r0/upload",params:e}},uploadContent:function(e,t){a.isFunction(t)?t={callback:t}:void 0===t&&(t={});const n=!1!==t.includeFilename,r=t.type||e.type||"application/octet-stream",s=t.name||e.name;let o=e;o.stream&&"function"!=typeof o.stream&&(c.logger.warn("Using `file.stream` as the content to upload. Future versions of the js-sdk will change this to expect `file` to be the content directly."),o=o.stream);let h=t.rawResponse;void 0===h&&(i.g.XMLHttpRequest?h=!1:(c.logger.warn("Returning the raw JSON from uploadContent(). Future versions of the js-sdk will change this default, to return the parsed object. Set opts.rawResponse=false to change this behaviour now."),h=!0));let u=t.onlyContentUri;h||void 0!==u||(i.g.XMLHttpRequest?(c.logger.warn("Returning only the content-uri from uploadContent(). Future versions of the js-sdk will change this default, to return the whole response object. Set opts.onlyContentUri=false to change this behaviour now."),u=!0):u=!1);const d={loaded:0,total:0};let g,f=null;if(h||(f=function(e){let t=JSON.parse(e);if(u&&(t=t.content_uri,void 0===t))throw Error("Bad response");return t}),i.g.XMLHttpRequest){const e=a.defer(),c=new i.g.XMLHttpRequest;d.xhr=c;const h=p(e,t.callback,this.opts.onlyData),u=function(){c.abort(),h(new Error("Timeout"))};c.timeout_timer=l.setTimeout(u,3e4),c.onreadystatechange=function(){let e;switch(c.readyState){case i.g.XMLHttpRequest.DONE:l.clearTimeout(c.timeout_timer);try{if(0===c.status)throw new m;if(!c.responseText)throw new Error("No response body.");e=c.responseText,f&&(e=f(e))}catch(e){return e.http_status=c.status,void h(e)}h(void 0,c,e)}},c.upload.addEventListener("progress",(function(e){l.clearTimeout(c.timeout_timer),d.loaded=e.loaded,d.total=e.total,c.timeout_timer=l.setTimeout(u,3e4),t.progressHandler&&t.progressHandler({loaded:e.loaded,total:e.total})}));let v=this.opts.baseUrl+"/_matrix/media/r0/upload";const y=[];n&&s&&y.push("filename="+encodeURIComponent(s)),this.useAuthorizationHeader||y.push("access_token="+encodeURIComponent(this.opts.accessToken)),y.length>0&&(v+="?"+y.join("&")),c.open("POST",v),this.useAuthorizationHeader&&c.setRequestHeader("Authorization","Bearer "+this.opts.accessToken),c.setRequestHeader("Content-Type",r),c.send(o),g=e.promise,g.abort=c.abort.bind(c)}else{const e={};n&&s&&(e.filename=s),g=this.authedRequest(t.callback,"POST","/upload",e,o,{prefix:"/_matrix/media/r0",headers:{"Content-Type":r},json:!1,bodyParser:f})}const v=this,y=g.finally((function(){for(let e=0;e<v.uploads.length;++e)if(v.uploads[e]===d)return void v.uploads.splice(e,1)}));return y.abort=g.abort,d.promise=y,this.uploads.push(d),y},cancelUpload:function(e){return!!e.abort&&(e.abort(),!0)},getCurrentUploads:function(){return this.uploads},idServerRequest:function(e,t,i,n,r,s){if(!this.opts.idBaseUrl)throw new Error("No Identity Server base URL set");const o=this.opts.idBaseUrl+r+i;if(void 0!==e&&!a.isFunction(e))throw Error("Expected callback to be a function but got "+typeof e);const c={uri:o,method:t,withCredentials:!1,json:!0,_matrix_opts:this.opts,headers:{}};"GET"===t?c.qs=n:"object"==typeof n&&(c.json=n),s&&(c.headers.Authorization=`Bearer ${s}`);const l=a.defer();return this.opts.request(c,p(l,e,this.opts.onlyData)),l.promise},authedRequest:function(e,t,i,n,r,s){n||(n={}),this.useAuthorizationHeader?(isFinite(s)&&(s={localTimeoutMs:s}),s||(s={}),s.headers||(s.headers={}),s.headers.Authorization||(s.headers.Authorization="Bearer "+this.opts.accessToken),n.access_token&&delete n.access_token):n.access_token||(n.access_token=this.opts.accessToken);const o=this.request(e,t,i,n,r,s),a=this;return o.catch((function(e){"M_UNKNOWN_TOKEN"==e.errcode?a.event_emitter.emit("Session.logged_out",e):"M_CONSENT_NOT_GIVEN"==e.errcode&&a.event_emitter.emit("no_consent",e.message,e.data.consent_uri)})),o},request:function(e,t,i,n,r,s){const o=void 0!==(s=s||{}).prefix?s.prefix:this.opts.prefix,a=this.opts.baseUrl+o+i;return this.requestOtherUrl(e,t,a,n,r,s)},requestOtherUrl:function(e,t,i,n,r,s){return null==s?s={}:isFinite(s)&&(s={localTimeoutMs:s}),this._request(e,t,i,n,r,s)},getUrl:function(e,t,i){let n="";return t&&(n="?"+a.encodeParams(t)),this.opts.baseUrl+i+e+n},_request:function(e,t,i,n,r,s){if(void 0!==e&&!a.isFunction(e))throw Error("Expected callback to be a function but got "+typeof e);s=s||{};const o=this;this.opts.extraParams&&(n=u(u({},n),this.opts.extraParams));const c=a.extend({},s.headers||{}),h=void 0===s.json||s.json;let d=s.bodyParser;h&&(r&&(r=JSON.stringify(r),c["content-type"]="application/json"),c.accept||(c.accept="application/json"),void 0===d&&(d=function(e){return JSON.parse(e)}));const f=a.defer();let m,v,y=!1;const _=s.localTimeoutMs||this.opts.localTimeoutMs,S=()=>{_&&(m&&l.clearTimeout(m),m=l.setTimeout((function(){y=!0,v&&v.abort&&v.abort(),f.reject(new g({error:"Locally timed out waiting for a response",errcode:"ORG.MATRIX.JSSDK_TIMEOUT",timeout:_}))}),_))};S();const b=f.promise;try{v=this.opts.request({uri:i,method:t,withCredentials:!1,qs:n,qsStringifyOptions:s.qsStringifyOptions,useQuerystring:!0,body:r,json:!1,timeout:_,headers:c||{},_matrix_opts:this.opts},(function(t,i,n){_&&(l.clearTimeout(m),y)||p(f,e,o.opts.onlyData,d)(t,i,n)})),v&&("onprogress"in v&&(v.onprogress=e=>{S()}),v.abort&&(b.abort=v.abort.bind(v)))}catch(t){f.reject(t),e&&e(t)}return b}};const p=function(e,t,i,n){return t=t||function(){},function(r,s,a){if(r&&("AbortError"===r.name||"aborted"===r||r instanceof g||(r=new f("request failed",r))),!r)try{(s.status||s.statusCode)>=400?r=function(e,t){const i=e.status||e.statusCode,n=function(e){let t;if(e.getResponseHeader?t=e.getResponseHeader("Content-Type"):e.headers&&(t=e.headers["content-type"]||null),!t)return null;try{return(0,o.parse)(t)}catch(e){throw new Error(`Error parsing Content-Type '${t}': ${e}`)}}(e);let r;if(n)if("application/json"===n.type){const e="object"==typeof t?t:JSON.parse(t);r=new g(e)}else"text/plain"===n.type&&(r=new Error(`Server returned ${i} error: ${t}`));return r||(r=new Error(`Server returned ${i} error`)),r.httpStatus=i,r}(s,a):n&&(a=n(a))}catch(e){r=new Error(`Error parsing server response: ${e}`)}if(r)e.reject(r),t(r);else{const n={code:s.status||s.statusCode,headers:s.headers,data:a};e.resolve(i?a:n),t(null,i?a:n)}}};class g extends Error{constructor(e){super(`MatrixError: ${(e=e||{}).errcode}`),this.errcode=e.errcode,this.name=e.errcode||"Unknown error code",this.message=e.error||"Unknown message",this.data=e}}t.MatrixError=g;class f extends Error{constructor(e,t){super(e+(t?`: ${t.message}`:"")),this._cause=t}get name(){return"ConnectionError"}get cause(){return this._cause}}t.ConnectionError=f;class m extends Error{constructor(){super("Operation aborted")}get name(){return"AbortError"}}t.AbortError=m},3415:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.exists=function(e,t){return new Promise(((i,n)=>{let r=!0;const s=e.open(t);s.onupgradeneeded=()=>{r=!1},s.onblocked=()=>n(),s.onsuccess=()=>{s.result.close(),r||e.deleteDatabase(t),i(r)},s.onerror=e=>n(e.target.error)}))}},8670:(e,t,i)=>{"use strict";var n=i(862),r=i(5318);Object.defineProperty(t,"__esModule",{value:!0}),t.InteractiveAuth=h;var s=r(i(8575)),o=n(i(3102)),a=i(7434);const c="m.login.email.identity",l="m.login.msisdn";function h(e){this._matrixClient=e.matrixClient,this._data=e.authData||{},this._requestCallback=e.doRequest,this._busyChangedCallback=e.busyChanged,this._stateUpdatedCallback=e.stateUpdated||e.startAuthStage,this._resolveFunc=null,this._rejectFunc=null,this._inputs=e.inputs||{},this._requestEmailTokenCallback=e.requestEmailToken,e.sessionId&&(this._data.session=e.sessionId),this._clientSecret=e.clientSecret||this._matrixClient.generateClientSecret(),this._emailSid=e.emailSid,void 0===this._emailSid&&(this._emailSid=null),this._requestingEmailToken=!1,this._chosenFlow=null,this._currentStage=null,this._submitPromise=null}h.prototype={attemptAuth:function(){return new Promise(((e,t)=>{if(this._resolveFunc=e,this._rejectFunc=t,this._data&&this._data.flows)this._startNextAuthStage();else{this._busyChangedCallback&&this._busyChangedCallback(!0);let e=null;this._data.session&&(e={session:this._data.session}),this._doRequest(e).finally((()=>{this._busyChangedCallback&&this._busyChangedCallback(!1)}))}}))},poll:async function(){if(!this._data.session)return;if(!this._resolveFunc)return;if(this._submitPromise)return;let e={};if(this._currentStage==c&&this._emailSid){const t={sid:this._emailSid,client_secret:this._clientSecret};if(await this._matrixClient.doesServerRequireIdServerParam()){const e=s.default.parse(this._matrixClient.getIdentityServerUrl());t.id_server=e.host}e={type:c,threepid_creds:t,threepidCreds:t}}this.submitAuthDict(e,!0)},getSessionId:function(){return this._data?this._data.session:void 0},getClientSecret:function(){return this._clientSecret},getStageParams:function(e){let t={};return this._data&&this._data.params&&(t=this._data.params),t[e]},getChosenFlow(){return this._chosenFlow},submitAuthDict:async function(e,t){if(!this._resolveFunc)throw new Error("submitAuthDict() called before attemptAuth()");for(!t&&this._busyChangedCallback&&this._busyChangedCallback(!0);this._submitPromise;)try{await this._submitPromise}catch(e){}let i;this._data.session?(i={session:this._data.session},o.extend(i,e)):i=e;try{this._submitPromise=this._doRequest(i,t),await this._submitPromise}finally{this._submitPromise=null,!t&&this._busyChangedCallback&&this._busyChangedCallback(!1)}},getEmailSid:function(){return this._emailSid},setEmailSid:function(e){this._emailSid=e},_doRequest:async function(e,t){try{const i=await this._requestCallback(e,t);this._resolveFunc(i),this._resolveFunc=null,this._rejectFunc=null}catch(e){const i=e.data?e.data.flows:null,n=this._data.flows||Boolean(i);401===e.httpStatus&&e.data&&n||(t?a.logger.log("Background poll request failed doing UI auth: ignoring",e):this._rejectFunc(e)),e.data.flows||e.data.completed||e.data.session||(e.data.flows=this._data.flows,e.data.completed=this._data.completed,e.data.session=this._data.session),this._data=e.data;try{this._startNextAuthStage()}catch(e){this._rejectFunc(e),this._resolveFunc=null,this._rejectFunc=null}if(!this._emailSid&&!this._requestingEmailToken&&this._chosenFlow.stages.includes("m.login.email.identity")){this._requestingEmailToken=!0;try{const e=await this._requestEmailTokenCallback(this._inputs.emailAddress,this._clientSecret,1,this._data.session);this._emailSid=e.sid}catch(e){this._rejectFunc(e),this._resolveFunc=null,this._rejectFunc=null}finally{this._requestingEmailToken=!1}}}},_startNextAuthStage:function(){const e=this._chooseStage();if(!e)throw new Error("No incomplete flows from the server");if(this._currentStage=e,"m.login.dummy"===e)return void this.submitAuthDict({type:"m.login.dummy"});if(this._data&&this._data.errcode||this._data.error)return void this._stateUpdatedCallback(e,{errcode:this._data.errcode||"",error:this._data.error||""});const t={};e==c&&(t.emailSid=this._emailSid),this._stateUpdatedCallback(e,t)},_chooseStage:function(){null===this._chosenFlow&&(this._chosenFlow=this._chooseFlow()),a.logger.log("Active flow => %s",JSON.stringify(this._chosenFlow));const e=this._firstUncompletedStage(this._chosenFlow);return a.logger.log("Next stage: %s",e),e},_chooseFlow:function(){const e=this._data.flows||[],t=Boolean(this._inputs.emailAddress)||Boolean(this._emailSid),i=Boolean(this._inputs.phoneCountry)&&Boolean(this._inputs.phoneNumber);for(const n of e){let e=!1,r=!1;for(const t of n.stages)t===c?e=!0:t==l&&(r=!0);if(e==t&&r==i)return n}const n=new Error("No appropriate authentication flow found");throw n.name="NoAuthFlowFoundError",n.required_stages=[],t&&n.required_stages.push(c),i&&n.required_stages.push(l),n.available_flows=e,n},_firstUncompletedStage:function(e){const t=(this._data||{}).completed||[];for(let i=0;i<e.stages.length;++i){const n=e.stages[i];if(-1===t.indexOf(n))return n}}}},7434:(e,t,i)=>{"use strict";var n=i(5318);Object.defineProperty(t,"__esModule",{value:!0}),t.logger=void 0;var r=n(i(2043));r.default.methodFactory=function(e,t,i){return function(...t){return this.prefix&&t.unshift(this.prefix),"error"===e||"warn"===e||"trace"===e||"info"===e?console[e](...t):console.log(...t)}};const s=r.default.getLogger("matrix");t.logger=s,s.setLevel(r.default.levels.DEBUG),function e(t){t.withPrefix=function(t){return function(t){const i=r.default.getLogger(`matrix-${t}`);return i.prefix!==t&&(e(i),i.prefix=t,i.setLevel(r.default.levels.DEBUG)),i}((this.prefix||"")+t)}}(s)},8070:(e,t,i)=>{"use strict";var n=i(862);Object.defineProperty(t,"__esModule",{value:!0});var r={request:!0,getRequest:!0,wrapRequest:!0,setCryptoStoreFactory:!0,createClient:!0,ContentHelpers:!0,createNewMatrixCall:!0,setMatrixCallAudioInput:!0,setMatrixCallVideoInput:!0};t.request=function(e){A=e},t.getRequest=function(){return A},t.wrapRequest=function(e){const t=A;A=function(i,n){return e(t,i,n)}},t.setCryptoStoreFactory=function(e){P=e},t.createClient=function(e){return"string"==typeof e&&(e={baseUrl:e}),e.request=e.request||A,e.store=e.store||new o.MemoryStore({localStorage:i.g.localStorage}),e.scheduler=e.scheduler||new a.MatrixScheduler,e.cryptoStore=e.cryptoStore||P(),new c.MatrixClient(e)},Object.defineProperty(t,"createNewMatrixCall",{enumerable:!0,get:function(){return O.createNewMatrixCall}}),Object.defineProperty(t,"setMatrixCallAudioInput",{enumerable:!0,get:function(){return O.setAudioInput}}),Object.defineProperty(t,"setMatrixCallVideoInput",{enumerable:!0,get:function(){return O.setVideoInput}}),t.ContentHelpers=void 0;var s=i(1045);Object.keys(s).forEach((function(e){"default"!==e&&"__esModule"!==e&&(Object.prototype.hasOwnProperty.call(r,e)||e in t&&t[e]===s[e]||Object.defineProperty(t,e,{enumerable:!0,get:function(){return s[e]}}))}));var o=i(1703);Object.keys(o).forEach((function(e){"default"!==e&&"__esModule"!==e&&(Object.prototype.hasOwnProperty.call(r,e)||e in t&&t[e]===o[e]||Object.defineProperty(t,e,{enumerable:!0,get:function(){return o[e]}}))}));var a=i(9443);Object.keys(a).forEach((function(e){"default"!==e&&"__esModule"!==e&&(Object.prototype.hasOwnProperty.call(r,e)||e in t&&t[e]===a[e]||Object.defineProperty(t,e,{enumerable:!0,get:function(){return a[e]}}))}));var c=i(2168);Object.keys(c).forEach((function(e){"default"!==e&&"__esModule"!==e&&(Object.prototype.hasOwnProperty.call(r,e)||e in t&&t[e]===c[e]||Object.defineProperty(t,e,{enumerable:!0,get:function(){return c[e]}}))}));var l=i(7715);Object.keys(l).forEach((function(e){"default"!==e&&"__esModule"!==e&&(Object.prototype.hasOwnProperty.call(r,e)||e in t&&t[e]===l[e]||Object.defineProperty(t,e,{enumerable:!0,get:function(){return l[e]}}))}));var h=i(9118);Object.keys(h).forEach((function(e){"default"!==e&&"__esModule"!==e&&(Object.prototype.hasOwnProperty.call(r,e)||e in t&&t[e]===h[e]||Object.defineProperty(t,e,{enumerable:!0,get:function(){return h[e]}}))}));var u=i(2741);Object.keys(u).forEach((function(e){"default"!==e&&"__esModule"!==e&&(Object.prototype.hasOwnProperty.call(r,e)||e in t&&t[e]===u[e]||Object.defineProperty(t,e,{enumerable:!0,get:function(){return u[e]}}))}));var d=i(9489);Object.keys(d).forEach((function(e){"default"!==e&&"__esModule"!==e&&(Object.prototype.hasOwnProperty.call(r,e)||e in t&&t[e]===d[e]||Object.defineProperty(t,e,{enumerable:!0,get:function(){return d[e]}}))}));var p=i(4369);Object.keys(p).forEach((function(e){"default"!==e&&"__esModule"!==e&&(Object.prototype.hasOwnProperty.call(r,e)||e in t&&t[e]===p[e]||Object.defineProperty(t,e,{enumerable:!0,get:function(){return p[e]}}))}));var g=i(7366);Object.keys(g).forEach((function(e){"default"!==e&&"__esModule"!==e&&(Object.prototype.hasOwnProperty.call(r,e)||e in t&&t[e]===g[e]||Object.defineProperty(t,e,{enumerable:!0,get:function(){return g[e]}}))}));var f=i(142);Object.keys(f).forEach((function(e){"default"!==e&&"__esModule"!==e&&(Object.prototype.hasOwnProperty.call(r,e)||e in t&&t[e]===f[e]||Object.defineProperty(t,e,{enumerable:!0,get:function(){return f[e]}}))}));var m=i(8910);Object.keys(m).forEach((function(e){"default"!==e&&"__esModule"!==e&&(Object.prototype.hasOwnProperty.call(r,e)||e in t&&t[e]===m[e]||Object.defineProperty(t,e,{enumerable:!0,get:function(){return m[e]}}))}));var v=i(3705);Object.keys(v).forEach((function(e){"default"!==e&&"__esModule"!==e&&(Object.prototype.hasOwnProperty.call(r,e)||e in t&&t[e]===v[e]||Object.defineProperty(t,e,{enumerable:!0,get:function(){return v[e]}}))}));var y=i(2848);Object.keys(y).forEach((function(e){"default"!==e&&"__esModule"!==e&&(Object.prototype.hasOwnProperty.call(r,e)||e in t&&t[e]===y[e]||Object.defineProperty(t,e,{enumerable:!0,get:function(){return y[e]}}))}));var _=i(6860);Object.keys(_).forEach((function(e){"default"!==e&&"__esModule"!==e&&(Object.prototype.hasOwnProperty.call(r,e)||e in t&&t[e]===_[e]||Object.defineProperty(t,e,{enumerable:!0,get:function(){return _[e]}}))}));var S=i(3998);Object.keys(S).forEach((function(e){"default"!==e&&"__esModule"!==e&&(Object.prototype.hasOwnProperty.call(r,e)||e in t&&t[e]===S[e]||Object.defineProperty(t,e,{enumerable:!0,get:function(){return S[e]}}))}));var b=i(7906);Object.keys(b).forEach((function(e){"default"!==e&&"__esModule"!==e&&(Object.prototype.hasOwnProperty.call(r,e)||e in t&&t[e]===b[e]||Object.defineProperty(t,e,{enumerable:!0,get:function(){return b[e]}}))}));var w=i(4969);Object.keys(w).forEach((function(e){"default"!==e&&"__esModule"!==e&&(Object.prototype.hasOwnProperty.call(r,e)||e in t&&t[e]===w[e]||Object.defineProperty(t,e,{enumerable:!0,get:function(){return w[e]}}))}));var E=i(8670);Object.keys(E).forEach((function(e){"default"!==e&&"__esModule"!==e&&(Object.prototype.hasOwnProperty.call(r,e)||e in t&&t[e]===E[e]||Object.defineProperty(t,e,{enumerable:!0,get:function(){return E[e]}}))}));var I=i(1415);Object.keys(I).forEach((function(e){"default"!==e&&"__esModule"!==e&&(Object.prototype.hasOwnProperty.call(r,e)||e in t&&t[e]===I[e]||Object.defineProperty(t,e,{enumerable:!0,get:function(){return I[e]}}))}));var k=i(9789);Object.keys(k).forEach((function(e){"default"!==e&&"__esModule"!==e&&(Object.prototype.hasOwnProperty.call(r,e)||e in t&&t[e]===k[e]||Object.defineProperty(t,e,{enumerable:!0,get:function(){return k[e]}}))}));var T=i(5837);Object.keys(T).forEach((function(e){"default"!==e&&"__esModule"!==e&&(Object.prototype.hasOwnProperty.call(r,e)||e in t&&t[e]===T[e]||Object.defineProperty(t,e,{enumerable:!0,get:function(){return T[e]}}))}));var C=i(7585);Object.keys(C).forEach((function(e){"default"!==e&&"__esModule"!==e&&(Object.prototype.hasOwnProperty.call(r,e)||e in t&&t[e]===C[e]||Object.defineProperty(t,e,{enumerable:!0,get:function(){return C[e]}}))}));var x=i(3667);Object.keys(x).forEach((function(e){"default"!==e&&"__esModule"!==e&&(Object.prototype.hasOwnProperty.call(r,e)||e in t&&t[e]===x[e]||Object.defineProperty(t,e,{enumerable:!0,get:function(){return x[e]}}))}));var R=n(i(4656));t.ContentHelpers=R;var O=i(9679);let A,P=()=>new s.MemoryCryptoStore},8807:(e,t,i)=>{"use strict";var n=i(5318);Object.defineProperty(t,"__esModule",{value:!0}),t.MSC3089Branch=void 0;var r=n(i(9713)),s=i(2481);function o(e,t){var i=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),i.push.apply(i,n)}return i}function a(e){for(var t=1;t<arguments.length;t++){var i=null!=arguments[t]?arguments[t]:{};t%2?o(Object(i),!0).forEach((function(t){(0,r.default)(e,t,i[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(i)):o(Object(i)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(i,t))}))}return e}t.MSC3089Branch=class{constructor(e,t){this.client=e,this.indexEvent=t}get id(){return this.indexEvent.getStateKey()}get isActive(){return!0===this.indexEvent.getContent().active}get roomId(){return this.indexEvent.getRoomId()}async delete(){await this.client.sendStateEvent(this.roomId,s.UNSTABLE_MSC3089_BRANCH.name,{},this.id),await this.client.redactEvent(this.roomId,this.id)}getName(){return this.indexEvent.getContent().name||"Unnamed File"}setName(e){return this.client.sendStateEvent(this.roomId,s.UNSTABLE_MSC3089_BRANCH.name,a(a({},this.indexEvent.getContent()),{},{name:e}),this.id)}async getFileInfo(){const e=this.client.getRoom(this.roomId);if(!e)throw new Error("Unknown room");const t=await this.client.getEventTimeline(e.getUnfilteredTimelineSet(),this.id);if(!t)throw new Error("Failed to get timeline for room event");const i=t.getEvents().find((e=>e.getId()===this.id));if(!i)throw new Error("Failed to find event");await this.client.decryptEventIfNeeded(i,{emit:!1,isRetry:!1});const n=i.getContent().file;return{info:n,httpUrl:this.client.mxcUrlToHttp(n.url)}}}},6170:(e,t,i)=>{"use strict";var n=i(5318);Object.defineProperty(t,"__esModule",{value:!0}),t.MSC3089TreeSpace=t.TreePermissions=t.DEFAULT_TREE_POWER_LEVELS_TEMPLATE=void 0;var r=n(i(9713)),s=i(2481),o=i(7434),a=i(3102),c=i(8807),l=n(i(7433)),h=i(7125);function u(e,t){var i=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),i.push.apply(i,n)}return i}function d(e){for(var t=1;t<arguments.length;t++){var i=null!=arguments[t]?arguments[t]:{};t%2?u(Object(i),!0).forEach((function(t){(0,r.default)(e,t,i[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(i)):u(Object(i)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(i,t))}))}return e}const p={invite:100,kick:100,ban:100,redact:50,state_default:50,events_default:50,users_default:0,events:{[s.EventType.RoomPowerLevels]:100,[s.EventType.RoomHistoryVisibility]:100,[s.EventType.RoomTombstone]:100,[s.EventType.RoomEncryption]:100,[s.EventType.RoomName]:50,[s.EventType.RoomMessage]:50,[s.EventType.RoomMessageEncrypted]:50,[s.EventType.Sticker]:50},users:{}};let g;t.DEFAULT_TREE_POWER_LEVELS_TEMPLATE=p,t.TreePermissions=g,function(e){e.Viewer="viewer",e.Editor="editor",e.Owner="owner"}(g||(t.TreePermissions=g={})),t.MSC3089TreeSpace=class{constructor(e,t){if(this.client=e,this.roomId=t,(0,r.default)(this,"room",void 0),this.room=this.client.getRoom(this.roomId),!this.room)throw new Error("Unknown room")}get id(){return this.roomId}get isTopLevel(){const e=this.room.currentState.getStateEvents(s.EventType.SpaceParent);return null==e||!e.length||e.every((e=>{var t;return!(null!==(t=e.getContent())&&void 0!==t&&t.via)}))}setName(e){return this.client.sendStateEvent(this.roomId,s.EventType.RoomName,{name:e},"")}async invite(e,t=!0,i=!0){const n=[this.retryInvite(e)];return t&&n.push(...this.getDirectories().map((n=>n.invite(e,t,i)))),Promise.all(n).then((()=>{i&&(0,h.isRoomSharedHistory)(this.room)&&this.client.sendSharedHistoryKeys(this.roomId,[e])}))}retryInvite(e){return(0,a.simpleRetryOperation)((async()=>{await this.client.invite(this.roomId,e).catch((e=>{if("M_FORBIDDEN"===(null==e?void 0:e.errcode))throw new l.default.AbortError(e);throw e}))}))}async setPermissions(e,t){var i;const n=this.room.currentState.getStateEvents(s.EventType.RoomPowerLevels,"");if(Array.isArray(n))throw new Error("Unexpected return type for power levels");const r=n.getContent()||{},o=r.users_default||0,a=r.events_default||50,c=(null===(i=r.events)||void 0===i?void 0:i[s.EventType.RoomPowerLevels])||100,l=r.users||{};switch(t){case g.Viewer:l[e]=o;break;case g.Editor:l[e]=a;break;case g.Owner:l[e]=c;break;default:throw new Error("Invalid role: "+t)}return r.users=l,this.client.sendStateEvent(this.roomId,s.EventType.RoomPowerLevels,r,"")}async createDirectory(e){const t=await this.client.unstableCreateFileTree(e);return await this.client.sendStateEvent(this.roomId,s.EventType.SpaceChild,{via:[this.client.getDomain()]},t.roomId),await this.client.sendStateEvent(t.roomId,s.EventType.SpaceParent,{via:[this.client.getDomain()]},this.roomId),t}getDirectories(){const e=[],t=this.room.currentState.getStateEvents(s.EventType.SpaceChild);for(const i of t)try{const t=this.client.unstableGetFileTreeSpace(i.getStateKey());t&&e.push(t)}catch(e){o.logger.warn("Unable to create tree space instance for listing. Are we joined?",e)}return e}getDirectory(e){return this.getDirectories().find((t=>t.roomId===e))}async delete(){const e=this.getDirectories();for(const t of e)await t.delete();const t=["invite","knock","join"],i=this.room.currentState.getStateEvents(s.EventType.RoomMember);for(const e of i)e.getStateKey()!==this.client.getUserId()&&t.includes(e.getContent().membership)&&await this.client.kick(this.roomId,e.getStateKey(),"Room deleted");await this.client.leave(this.roomId)}getOrderedChildren(e){const t=e.map((e=>({roomId:e.getStateKey(),order:e.getContent().order})));return t.sort(((e,t)=>{if(e.order&&!t.order)return-1;if(!e.order&&t.order)return 1;if(e.order||t.order)return(0,a.lexicographicCompare)(e.order,t.order);{var i,n,r,o;const c=this.client.getRoom(e.roomId),l=this.client.getRoom(t.roomId);if(!c||!l)return(0,a.lexicographicCompare)(e.roomId,t.roomId);const h=null!==(i=null===(n=c.currentState.getStateEvents(s.EventType.RoomCreate,""))||void 0===n?void 0:n.getTs())&&void 0!==i?i:0,u=null!==(r=null===(o=l.currentState.getStateEvents(s.EventType.RoomCreate,""))||void 0===o?void 0:o.getTs())&&void 0!==r?r:0;return h===u?(0,a.lexicographicCompare)(e.roomId,t.roomId):h-u}})),t}getParentRoom(){const e=this.room.currentState.getStateEvents(s.EventType.SpaceParent)[0];if(!e)throw new Error("Expected to have a parent in a non-top level space");const t=this.client.getRoom(e.getStateKey());if(!t)throw new Error("Unable to locate room for parent");return t}getOrder(){if(this.isTopLevel)return-1;const e=this.getParentRoom().currentState.getStateEvents(s.EventType.SpaceChild);return this.getOrderedChildren(e).findIndex((e=>e.roomId===this.roomId))}async setOrder(e){var t;if(this.isTopLevel)throw new Error("Cannot set order of top level spaces currently");const i=this.getParentRoom(),n=i.currentState.getStateEvents(s.EventType.SpaceChild),r=this.getOrderedChildren(n);e=Math.max(Math.min(e,r.length-1),0);const o=this.getOrder()<e;o&&e===r.length-1?e--:o||0!==e||e++;const c=r[o?e:e-1],l=r[o?e+1:e];let h=a.DEFAULT_ALPHABET[0],u=!1;if(c)if(e===r.length-1)null!=l&&l.order&&(h=(0,a.nextString)(l.order));else{const e=null==c?void 0:c.order,t=null==l?void 0:l.order;e&&t?h=e===t?(0,a.nextString)(e):(0,a.averageBetweenStrings)(e,t):e?h=(0,a.nextString)(e):t?h=(0,a.prevString)(t):u=!0}else null!=l&&l.order&&(h=(0,a.prevString)(l.order));if(u){let t;for(let n=0;n<=e;n++){const e=r[n];if(0===n&&(t=e.order),e.order)t=e.order;else{var p;t=t?(0,a.nextString)(t):a.DEFAULT_ALPHABET[0];const n=i.currentState.getStateEvents(s.EventType.SpaceChild,e.roomId),r=null!==(p=null==n?void 0:n.getContent())&&void 0!==p?p:{via:[this.client.getDomain()]};await this.client.sendStateEvent(i.roomId,s.EventType.SpaceChild,d(d({},r),{},{order:t}),e.roomId)}}h=(0,a.nextString)(t)}const g=i.currentState.getStateEvents(s.EventType.SpaceChild,this.roomId),f=null!==(t=null==g?void 0:g.getContent())&&void 0!==t?t:{via:[this.client.getDomain()]};await this.client.sendStateEvent(i.roomId,s.EventType.SpaceChild,d(d({},f),{},{order:h}),this.roomId)}async createFile(e,t,i){const n=await this.client.uploadContent(new Blob([t]),{includeFilename:!1,onlyContentUri:!0});i.url=n;const r=await this.client.sendMessage(this.roomId,{msgtype:s.MsgType.File,body:e,url:n,file:i,[s.UNSTABLE_MSC3089_LEAF.name]:{}});await this.client.sendStateEvent(this.roomId,s.UNSTABLE_MSC3089_BRANCH.name,{active:!0,name:e},r.event_id)}getFile(e){const t=this.room.currentState.getStateEvents(s.UNSTABLE_MSC3089_BRANCH.name,e);return t?new c.MSC3089Branch(this.client,t):null}listFiles(){var e;return(null!==(e=this.room.currentState.getStateEvents(s.UNSTABLE_MSC3089_BRANCH.name))&&void 0!==e?e:[]).map((e=>new c.MSC3089Branch(this.client,e))).filter((e=>e.isActive))}}},3558:(e,t,i)=>{"use strict";var n=i(5318);Object.defineProperty(t,"__esModule",{value:!0}),t.EventContext=void 0;var r=n(i(9713)),s=i(8910);t.EventContext=class{constructor(e){(0,r.default)(this,"timeline",void 0),(0,r.default)(this,"ourEventIndex",0),(0,r.default)(this,"paginateTokens",{[s.Direction.Backward]:null,[s.Direction.Forward]:null}),this.timeline=[e]}getEvent(){return this.timeline[this.ourEventIndex]}getTimeline(){return this.timeline}getOurEventIndex(){return this.ourEventIndex}getPaginateToken(e=!1){return this.paginateTokens[e?s.Direction.Backward:s.Direction.Forward]}setPaginateToken(e,t=!1){this.paginateTokens[t?s.Direction.Backward:s.Direction.Forward]=e}addEvents(e,t=!1){t?(this.timeline=e.concat(this.timeline),this.ourEventIndex+=e.length):this.timeline=this.timeline.concat(e)}}},3705:(e,t,i)=>{"use strict";var n=i(5318);Object.defineProperty(t,"__esModule",{value:!0}),t.EventTimelineSet=void 0;var r=n(i(9713)),s=i(7187),o=i(8910),a=i(4369),c=i(7434),l=i(9690);let h;h=c.logger.log.bind(c.logger);class u extends s.EventEmitter{constructor(e,t){super(),this.room=e,(0,r.default)(this,"timelineSupport",void 0),(0,r.default)(this,"unstableClientRelationAggregation",void 0),(0,r.default)(this,"liveTimeline",void 0),(0,r.default)(this,"timelines",void 0),(0,r.default)(this,"_eventIdToTimeline",void 0),(0,r.default)(this,"filter",void 0),(0,r.default)(this,"relations",void 0),this.timelineSupport=Boolean(t.timelineSupport),this.liveTimeline=new o.EventTimeline(this),this.unstableClientRelationAggregation=!!t.unstableClientRelationAggregation,this.timelines=[this.liveTimeline],this._eventIdToTimeline={},this.filter=t.filter,this.unstableClientRelationAggregation&&(this.relations={})}getTimelines(){return this.timelines}getFilter(){return this.filter}setFilter(e){this.filter=e}getPendingEvents(){return this.room?this.filter?this.filter.filterRoomTimeline(this.room.getPendingEvents()):this.room.getPendingEvents():[]}getLiveTimeline(){return this.liveTimeline}eventIdToTimeline(e){return this._eventIdToTimeline[e]}replaceEventId(e,t){const i=this._eventIdToTimeline[e];i&&(delete this._eventIdToTimeline[e],this._eventIdToTimeline[t]=i)}resetLiveTimeline(e,t){const i=!this.timelineSupport||!t,n=this.liveTimeline,r=i?n.forkLive(o.EventTimeline.FORWARDS):n.fork(o.EventTimeline.FORWARDS);i?(this.timelines=[r],this._eventIdToTimeline={}):this.timelines.push(r),t&&n.setPaginationToken(t,o.EventTimeline.FORWARDS),r.setPaginationToken(e,o.EventTimeline.BACKWARDS),this.liveTimeline=r,this.emit("Room.timelineReset",this.room,this,i)}getTimelineForEvent(e){const t=this._eventIdToTimeline[e];return void 0===t?null:t}findEventById(e){const t=this.getTimelineForEvent(e);if(t)return t.getEvents().find((function(t){return t.getId()==e}))}addTimeline(){if(!this.timelineSupport)throw new Error("timeline support is disabled. Set the 'timelineSupport' parameter to true when creating MatrixClient to enable it.");const e=new o.EventTimeline(this);return this.timelines.push(e),e}addEventsToTimeline(e,t,i,n){if(!i)throw new Error("'timeline' not specified for EventTimelineSet.addEventsToTimeline");if(!t&&i==this.liveTimeline)throw new Error("EventTimelineSet.addEventsToTimeline cannot be used for adding events to the live timeline - use Room.addLiveEvents instead");if(this.filter&&!(e=this.filter.filterRoomTimeline(e)).length)return;const r=t?o.EventTimeline.BACKWARDS:o.EventTimeline.FORWARDS,s=t?o.EventTimeline.FORWARDS:o.EventTimeline.BACKWARDS;let a=!1,l=!1;for(let n=0;n<e.length;n++){const u=e[n],d=u.getId(),p=this._eventIdToTimeline[d];if(!p){this.addEventToTimeline(u,i,t),l=!0,a=!0;continue}if(l=!1,p==i){h("Event "+d+" already in timeline "+i);continue}const g=i.getNeighbouringTimeline(r);if(g){h(p==g?"Event "+d+" in neighbouring timeline - switching to "+p:"Event "+d+" already in a different timeline "+p),i=p;continue}c.logger.info("Already have timeline for "+d+" - joining timeline "+i+" to "+p);const f=p===this.liveTimeline,m=i===this.liveTimeline,v=r===o.EventTimeline.BACKWARDS&&f,y=r===o.EventTimeline.FORWARDS&&m;v||y?(v&&c.logger.warn("Refusing to set a preceding existingTimeLine on our timeline as the existingTimeLine is live ("+p+")"),y&&c.logger.warn("Refusing to set our preceding timeline on a existingTimeLine as our timeline is live ("+i+")")):(i.setNeighbouringTimeline(p,r),p.setNeighbouringTimeline(i,s),i=p,a=!0)}if(l||!a){if(r===o.EventTimeline.FORWARDS&&i===this.liveTimeline)return c.logger.warn({lastEventWasNew:l,didUpdate:a}),void c.logger.warn(`Refusing to set forwards pagination token of live timeline ${i} to ${n}`);i.setPaginationToken(n,r)}}addLiveEvent(e,t,i=!1){if(this.filter&&!this.filter.filterRoomTimeline([e]).length)return;const n=this._eventIdToTimeline[e.getId()];if(n)if("replace"===t){h("EventTimelineSet.addLiveEvent: replacing duplicate event "+e.getId());const t=n.getEvents();for(let i=0;i<t.length;i++)if(t[i].getId()===e.getId()){o.EventTimeline.setEventMetadata(e,n.getState(o.EventTimeline.FORWARDS),!1),t[i]=e;break}}else h("EventTimelineSet.addLiveEvent: ignoring duplicate event "+e.getId());else this.addEventToTimeline(e,this.liveTimeline,!1,i)}addEventToTimeline(e,t,i,n=!1){const r=e.getId();t.addEvent(e,i),this._eventIdToTimeline[r]=t,this.setRelationsTarget(e),this.aggregateRelations(e);const s={timeline:t,liveEvent:!i&&t==this.liveTimeline&&!n};this.emit("Room.timeline",e,this.room,Boolean(i),!1,s)}handleRemoteEcho(e,t,i){const n=this._eventIdToTimeline[t];n?(delete this._eventIdToTimeline[t],this._eventIdToTimeline[i]=n):this.filter?this.filter.filterRoomTimeline([e]).length&&this.addEventToTimeline(e,this.liveTimeline,!1):this.addEventToTimeline(e,this.liveTimeline,!1)}removeEvent(e){const t=this._eventIdToTimeline[e];if(!t)return null;const i=t.removeEvent(e);if(i){delete this._eventIdToTimeline[e];const n={timeline:t};this.emit("Room.timeline",i,this.room,void 0,!0,n)}return i}compareEventOrdering(e,t){if(e==t)return 0;const i=this._eventIdToTimeline[e],n=this._eventIdToTimeline[t];if(void 0===i)return null;if(void 0===n)return null;if(i===n){let n,r;const s=i.getEvents();for(let i=0;i<s.length&&(void 0===n||void 0===r);i++){const o=s[i].getId();o==e&&(n=i),o==t&&(r=i)}return n-r}let r=i;for(;r;){if(r===n)return-1;r=r.getNeighbouringTimeline(o.EventTimeline.FORWARDS)}for(r=i;r;){if(r===n)return 1;r=r.getNeighbouringTimeline(o.EventTimeline.BACKWARDS)}return null}getRelationsForEvent(e,t,i){if(!this.unstableClientRelationAggregation)throw new Error("Client-side relation aggregation is disabled");if(!e||!t||!i)throw new Error("Invalid arguments for `getRelationsForEvent`");return((this.relations[e]||{})[t]||{})[i]}setRelationsTarget(e){if(!this.unstableClientRelationAggregation)return;const t=this.relations[e.getId()];if(t)for(const i of Object.values(t))for(const t of Object.values(i))t.setTargetEvent(e)}aggregateRelations(e){if(!this.unstableClientRelationAggregation)return;if(e.isRedacted()||e.status===a.EventStatus.CANCELLED)return;if(e.isBeingDecrypted()||e.shouldAttemptDecryption())return void e.once("Event.decrypted",(()=>{this.aggregateRelations(e)}));const t=e.getRelation();if(!t)return;const i=t.event_id,n=t.rel_type,r=e.getType();let s=this.relations[i];s||(s=this.relations[i]={});let o=s[n];o||(o=s[n]={});let c,h=o[r];h||(h=o[r]=new l.Relations(n,r,this.room),c=this.findEventById(i)||this.room.getPendingEvent(i),c&&h.setTargetEvent(c)),h.addEvent(e)}}t.EventTimelineSet=u},8910:(e,t,i)=>{"use strict";var n=i(5318);Object.defineProperty(t,"__esModule",{value:!0}),t.EventTimeline=t.Direction=void 0;var r=n(i(9713)),s=i(6860),o=i(2481);let a;t.Direction=a,function(e){e.Backward="b",e.Forward="f"}(a||(t.Direction=a={}));class c{static setEventMetadata(e,t,i){e.sender||(e.sender=t.getSentinelMember(e.getSender())),e.target||e.getType()!==o.EventType.RoomMember||(e.target=t.getSentinelMember(e.getStateKey())),e.isState()&&i&&(e.forwardLooking=!1)}constructor(e){var t,i;this.eventTimelineSet=e,(0,r.default)(this,"roomId",void 0),(0,r.default)(this,"name",void 0),(0,r.default)(this,"events",[]),(0,r.default)(this,"baseIndex",0),(0,r.default)(this,"startState",void 0),(0,r.default)(this,"endState",void 0),(0,r.default)(this,"prevTimeline",void 0),(0,r.default)(this,"nextTimeline",void 0),(0,r.default)(this,"paginationRequests",{[a.Backward]:null,[a.Forward]:null}),this.roomId=null!==(t=null===(i=e.room)||void 0===i?void 0:i.roomId)&&void 0!==t?t:null,this.startState=new s.RoomState(this.roomId),this.startState.paginationToken=null,this.endState=new s.RoomState(this.roomId),this.endState.paginationToken=null,this.prevTimeline=null,this.nextTimeline=null,this.paginationRequests={b:null,f:null},this.name=this.roomId+":"+(new Date).toISOString()}initialiseState(e){if(this.events.length>0)throw new Error("Cannot initialise state after events are added");for(const t of e)Object.freeze(t);this.startState.setStateEvents(e),this.endState.setStateEvents(e)}forkLive(e){const t=this.getState(e),i=new c(this.eventTimelineSet);return i.startState=t.clone(),i.endState=t,this.endState=t.clone(),i}fork(e){const t=this.getState(e),i=new c(this.eventTimelineSet);return i.startState=t.clone(),i.endState=t.clone(),i}getRoomId(){return this.roomId}getFilter(){return this.eventTimelineSet.getFilter()}getTimelineSet(){return this.eventTimelineSet}getBaseIndex(){return this.baseIndex}getEvents(){return this.events}getState(e){if(e==c.BACKWARDS)return this.startState;if(e==c.FORWARDS)return this.endState;throw new Error("Invalid direction '"+e+"'")}getPaginationToken(e){return this.getState(e).paginationToken}setPaginationToken(e,t){this.getState(t).paginationToken=e}getNeighbouringTimeline(e){if(e==c.BACKWARDS)return this.prevTimeline;if(e==c.FORWARDS)return this.nextTimeline;throw new Error("Invalid direction '"+e+"'")}setNeighbouringTimeline(e,t){if(this.getNeighbouringTimeline(t))throw new Error("timeline already has a neighbouring timeline - cannot reset neighbour (direction: "+t+")");if(t==c.BACKWARDS)this.prevTimeline=e;else{if(t!=c.FORWARDS)throw new Error("Invalid direction '"+t+"'");this.nextTimeline=e}this.setPaginationToken(null,t)}addEvent(e,t){const i=t?this.startState:this.endState,n=this.getTimelineSet();let r;n.room&&(c.setEventMetadata(e,i,t),e.isState()&&n.room.getUnfilteredTimelineSet()===n&&(i.setStateEvents([e]),e.sender&&("m.room.member"!==e.getType()||t)||c.setEventMetadata(e,i,t))),r=t?0:this.events.length,this.events.splice(r,0,e),t&&this.baseIndex++}removeEvent(e){for(let t=this.events.length-1;t>=0;t--){const i=this.events[t];if(i.getId()==e)return this.events.splice(t,1),t<this.baseIndex&&this.baseIndex--,i}return null}toString(){return this.name}}t.EventTimeline=c,(0,r.default)(c,"BACKWARDS",a.Backward),(0,r.default)(c,"FORWARDS",a.Forward)},4369:(e,t,i)=>{"use strict";var n=i(5318);Object.defineProperty(t,"__esModule",{value:!0}),t.MatrixEvent=t.EventStatus=void 0;var r=n(i(9713)),s=i(7187),o=i(7434),a=i(2481),c=i(3102);let l;t.EventStatus=l,function(e){e.NOT_SENT="not_sent",e.ENCRYPTING="encrypting",e.SENDING="sending",e.QUEUED="queued",e.SENT="sent",e.CANCELLED="cancelled"}(l||(t.EventStatus=l={}));const h={};function u(e){return h[e]||(h[e]=e),h[e]}class d extends s.EventEmitter{constructor(e={}){super(),this.event=e,(0,r.default)(this,"pushActions",null),(0,r.default)(this,"_replacingEvent",null),(0,r.default)(this,"_localRedactionEvent",null),(0,r.default)(this,"_isCancelled",!1),(0,r.default)(this,"clearEvent",{}),(0,r.default)(this,"senderCurve25519Key",null),(0,r.default)(this,"claimedEd25519Key",null),(0,r.default)(this,"forwardingCurve25519KeyChain",[]),(0,r.default)(this,"untrusted",null),(0,r.default)(this,"_decryptionPromise",null),(0,r.default)(this,"retryDecryption",!1),(0,r.default)(this,"txnId",null),(0,r.default)(this,"localTimestamp",void 0),(0,r.default)(this,"sender",null),(0,r.default)(this,"target",null),(0,r.default)(this,"status",null),(0,r.default)(this,"error",null),(0,r.default)(this,"forwardLooking",!0),(0,r.default)(this,"verificationRequest",null),["state_key","type","sender","room_id","membership"].forEach((t=>{"string"==typeof e[t]&&(e[t]=u(e[t]))})),["membership","avatar_url","displayname"].forEach((t=>{var i;"string"==typeof(null===(i=e.content)||void 0===i?void 0:i[t])&&(e.content[t]=u(e.content[t]))})),["rel_type"].forEach((t=>{var i,n;"string"==typeof(null===(i=e.content)||void 0===i||null===(n=i["m.relates_to"])||void 0===n?void 0:n[t])&&(e.content["m.relates_to"][t]=u(e.content["m.relates_to"][t]))})),this.txnId=e.txn_id||null,this.localTimestamp=Date.now()-this.getAge()}getId(){return this.event.event_id}getSender(){return this.event.sender||this.event.user_id}getType(){return this.clearEvent.type||this.event.type}getWireType(){return this.event.type}getRoomId(){return this.event.room_id}getTs(){return this.event.origin_server_ts}getDate(){return this.event.origin_server_ts?new Date(this.event.origin_server_ts):null}getOriginalContent(){return this._localRedactionEvent?{}:this.clearEvent.content||this.event.content||{}}getContent(){return this._localRedactionEvent?{}:this._replacingEvent?this._replacingEvent.getContent()["m.new_content"]||{}:this.getOriginalContent()}getWireContent(){return this.event.content||{}}getPrevContent(){return this.getUnsigned().prev_content||this.event.prev_content||{}}getDirectionalContent(){return this.forwardLooking?this.getContent():this.getPrevContent()}getAge(){return this.getUnsigned().age||this.event.age}getLocalAge(){return Date.now()-this.localTimestamp}getStateKey(){return this.event.state_key}isState(){return void 0!==this.event.state_key}makeEncrypted(e,t,i,n){this.clearEvent={type:this.event.type,content:this.event.content},this.event.type=e,this.event.content=t,this.senderCurve25519Key=i,this.claimedEd25519Key=n}isBeingDecrypted(){return null!=this._decryptionPromise}getDecryptionPromise(){return this._decryptionPromise}isDecryptionFailure(){var e,t;return"m.bad.encrypted"===(null===(e=this.clearEvent)||void 0===e||null===(t=e.content)||void 0===t?void 0:t.msgtype)}shouldAttemptDecryption(){return this.isEncrypted()&&!this.isBeingDecrypted()&&null===this.getClearContent()}async attemptDecryption(e,t={}){if("boolean"==typeof t&&(t={isRetry:t}),!this.isEncrypted())throw new Error("Attempt to decrypt event which isn't encrypted");if(this.clearEvent&&this.clearEvent.content&&"m.bad.encrypted"!==this.clearEvent.content.msgtype)throw new Error("Attempt to decrypt event which has already been decrypted");return this._decryptionPromise?(o.logger.log(`Event ${this.getId()} already being decrypted; queueing a retry`),this.retryDecryption=!0,this._decryptionPromise):(this._decryptionPromise=this.decryptionLoop(e,t),this._decryptionPromise)}cancelAndResendKeyRequest(e,t){const i=this.getWireContent();return e.requestRoomKey({algorithm:i.algorithm,room_id:this.getRoomId(),session_id:i.session_id,sender_key:i.sender_key},this.getKeyRequestRecipients(t),!0)}getKeyRequestRecipients(e){const t=this.getWireContent(),i=[{userId:e,deviceId:"*"}],n=this.getSender();return n!==e&&i.push({userId:n,deviceId:t.device_id}),i}async decryptionLoop(e,t={}){for(await Promise.resolve();;){let i,n;this.retryDecryption=!1;try{e?(i=await e.decryptEvent(this),!0===t.isRetry&&o.logger.info(`Decrypted event on retry (id=${this.getId()})`)):i=this.badEncryptedMessage("Encryption not enabled")}catch(e){if("DecryptionError"!==e.name){const i=t.isRetry?"re":"";return o.logger.error(`Error ${i}decrypting event (id=${this.getId()}): ${e.stack||e}`),this._decryptionPromise=null,void(this.retryDecryption=!1)}if(n=e,this.retryDecryption){o.logger.log(`Got error decrypting event (id=${this.getId()}: ${e}), but retrying`);continue}o.logger.warn(`Error decrypting event (id=${this.getId()}): ${e.detailedString}`),i=this.badEncryptedMessage(e.message)}return this._decryptionPromise=null,this.retryDecryption=!1,this.setClearData(i),this.setPushActions(null),void(!1!==t.emit&&this.emit("Event.decrypted",this,n))}}badEncryptedMessage(e){return{clearEvent:{type:"m.room.message",content:{msgtype:"m.bad.encrypted",body:"** Unable to decrypt: "+e+" **"}}}}setClearData(e){this.clearEvent=e.clearEvent,this.senderCurve25519Key=e.senderCurve25519Key||null,this.claimedEd25519Key=e.claimedEd25519Key||null,this.forwardingCurve25519KeyChain=e.forwardingCurve25519KeyChain||[],this.untrusted=e.untrusted||!1}getClearContent(){const e=this.clearEvent;return e&&e.content?e.content:null}isEncrypted(){return!this.isState()&&"m.room.encrypted"===this.event.type}getSenderKey(){return this.senderCurve25519Key}getKeysClaimed(){return{ed25519:this.claimedEd25519Key}}getClaimedEd25519Key(){return this.claimedEd25519Key}getForwardingCurve25519KeyChain(){return this.forwardingCurve25519KeyChain}isKeySourceUntrusted(){return this.untrusted}getUnsigned(){return this.event.unsigned||{}}unmarkLocallyRedacted(){const e=this._localRedactionEvent;return this._localRedactionEvent=null,this.event.unsigned&&(this.event.unsigned.redacted_because=null),!!e}markLocallyRedacted(e){this._localRedactionEvent||(this.emit("Event.beforeRedaction",this,e),this._localRedactionEvent=e,this.event.unsigned||(this.event.unsigned={}),this.event.unsigned.redacted_because=e.event)}makeRedacted(e){if(!e.event)throw new Error("invalid redactionEvent in makeRedacted");let t;for(t in this._localRedactionEvent=null,this.emit("Event.beforeRedaction",this,e),this._replacingEvent=null,this.event.unsigned||(this.event.unsigned={}),this.event.unsigned.redacted_because=e.event,this.event)this.event.hasOwnProperty(t)&&(p.has(t)||delete this.event[t]);const i=g[this.getType()]||{},n=this.getContent();for(t in n)n.hasOwnProperty(t)&&(i[t]||delete n[t])}isRedacted(){return Boolean(this.getUnsigned().redacted_because)}isRedaction(){return"m.room.redaction"===this.getType()}getRedactionEvent(){return this.isRedacted()?this.clearEvent.unsigned?this.clearEvent.unsigned.redacted_because:this.event.unsigned.redacted_because?this.event.unsigned.redacted_because:{}:null}getPushActions(){return this.pushActions}setPushActions(e){this.pushActions=e}handleRemoteEcho(e){const t=this.getUnsigned(),i=this.getId();this.event=e,t.redacted_because&&(this.event.unsigned||(this.event.unsigned={}),this.event.unsigned.redacted_because=t.redacted_because),this.setStatus(null),this.getId()!==i&&this.emit("Event.localEventIdReplaced",this)}isSending(){return!!this.status}setStatus(e){this.status=e,this.emit("Event.status",this,e)}replaceLocalEventId(e){this.event.event_id=e,this.emit("Event.localEventIdReplaced",this)}isRelation(e){const t=this.getWireContent(),i=t&&t["m.relates_to"];return i&&i.rel_type&&i.event_id&&(e&&i.rel_type===e||!e)}getRelation(){return this.isRelation()?this.getWireContent()["m.relates_to"]:null}makeReplaced(e){this.isRedacted()&&e||this._replacingEvent!==e&&(this._replacingEvent=e,this.emit("Event.replaced",this))}getAssociatedStatus(){return this._replacingEvent?this._replacingEvent.status:this._localRedactionEvent?this._localRedactionEvent.status:this.status}getServerAggregatedRelation(e){const t=this.getUnsigned()["m.relations"];if(t)return t[e]}replacingEventId(){const e=this.getServerAggregatedRelation(a.RelationType.Replace);return e?e.event_id:this._replacingEvent?this._replacingEvent.getId():void 0}replacingEvent(){return this._replacingEvent}replacingEventDate(){const e=this.getServerAggregatedRelation(a.RelationType.Replace);if(e){const t=e.origin_server_ts;if(Number.isFinite(t))return new Date(t)}else if(this._replacingEvent)return this._replacingEvent.getDate()}localRedactionEvent(){return this._localRedactionEvent}getAssociatedId(){const e=this.getRelation();return e?e.event_id:this.isRedaction()?this.event.redacts:void 0}hasAssocation(){return!!this.getAssociatedId()}updateAssociatedId(e){const t=this.getRelation();t?t.event_id=e:this.isRedaction()&&(this.event.redacts=e)}flagCancelled(e=!0){this._isCancelled=e}isCancelled(){return this._isCancelled}toSnapshot(){const e=new d(JSON.parse(JSON.stringify(this.event)));for(const[t,i]of Object.entries(this))"event"!==t&&(e[t]=i);return e}isEquivalentTo(e){if(!e)return!1;if(e===this)return!0;const t=(0,c.deepSortedObjectEntries)(this.event),i=(0,c.deepSortedObjectEntries)(e.event);return JSON.stringify(t)===JSON.stringify(i)}toJSON(){const e={type:this.getType(),sender:this.getSender(),content:this.getContent(),event_id:this.getId(),origin_server_ts:this.getTs(),unsigned:this.getUnsigned(),room_id:this.getRoomId()};return this.isRedaction()&&(e.redacts=this.event.redacts),this.isEncrypted()?{decrypted:e,encrypted:this.event}:e}setVerificationRequest(e){this.verificationRequest=e}setTxnId(e){this.txnId=e}getTxnId(){return this.txnId}}t.MatrixEvent=d;const p=new Set(["event_id","type","room_id","user_id","sender","state_key","prev_state","content","unsigned","origin_server_ts"]),g={"m.room.member":{membership:1},"m.room.create":{creator:1},"m.room.join_rules":{join_rule:1},"m.room.power_levels":{ban:1,events:1,events_default:1,kick:1,redact:1,state_default:1,users:1,users_default:1},"m.room.aliases":{aliases:1}}},142:(e,t,i)=>{"use strict";var n=i(862);Object.defineProperty(t,"__esModule",{value:!0}),t.Group=o;var r=n(i(3102)),s=i(7187);function o(e){this.groupId=e,this.name=null,this.avatarUrl=null,this.myMembership=null,this.inviter=null}r.inherits(o,s.EventEmitter),o.prototype.setProfile=function(e,t){this.name===e&&this.avatarUrl===t||(this.name=e||this.groupId,this.avatarUrl=t,this.emit("Group.profile",this))},o.prototype.setMyMembership=function(e){this.myMembership!==e&&(this.myMembership=e,this.emit("Group.myMembership",this))},o.prototype.setInviter=function(e){this.inviter=e}},9690:(e,t,i)=>{"use strict";var n=i(5318);Object.defineProperty(t,"__esModule",{value:!0}),t.Relations=void 0;var r=n(i(9713)),s=i(7187),o=i(4369),a=i(7434),c=i(2481);class l extends s.EventEmitter{constructor(e,t,i){super(),this.relationType=e,this.eventType=t,this.room=i,(0,r.default)(this,"relationEventIds",new Set),(0,r.default)(this,"relations",new Set),(0,r.default)(this,"annotationsByKey",{}),(0,r.default)(this,"annotationsBySender",{}),(0,r.default)(this,"sortedAnnotationsByKey",[]),(0,r.default)(this,"targetEvent",null),(0,r.default)(this,"creationEmitted",!1),(0,r.default)(this,"onEventStatus",((e,t)=>{e.isSending()?t===o.EventStatus.CANCELLED&&(e.removeListener("Event.status",this.onEventStatus),this.removeEvent(e)):e.removeListener("Event.status",this.onEventStatus)})),(0,r.default)(this,"onBeforeRedaction",(async e=>{if(this.relations.has(e)){if(this.relations.delete(e),this.relationType===c.RelationType.Annotation)this.removeAnnotationFromAggregation(e);else if(this.relationType===c.RelationType.Replace&&this.targetEvent){const e=await this.getLastReplacement();this.targetEvent.makeReplaced(e)}e.removeListener("Event.beforeRedaction",this.onBeforeRedaction),this.emit("Relations.redaction",e)}}))}async addEvent(e){if(this.relationEventIds.has(e.getId()))return;const t=e.getRelation();if(!t)return void a.logger.error("Event must have relation info");const i=t.rel_type,n=e.getType();if(this.relationType===i&&this.eventType===n){if(e.isSending()&&e.on("Event.status",this.onEventStatus),this.relations.add(e),this.relationEventIds.add(e.getId()),this.relationType===c.RelationType.Annotation)this.addAnnotationToAggregation(e);else if(this.relationType===c.RelationType.Replace&&this.targetEvent){const e=await this.getLastReplacement();this.targetEvent.makeReplaced(e)}e.on("Event.beforeRedaction",this.onBeforeRedaction),this.emit("Relations.add",e),this.maybeEmitCreated()}else a.logger.error("Event relation info doesn't match this container")}async removeEvent(e){if(!this.relations.has(e))return;const t=e.getRelation();if(!t)return void a.logger.error("Event must have relation info");const i=t.rel_type,n=e.getType();if(this.relationType===i&&this.eventType===n){if(this.relations.delete(e),this.relationType===c.RelationType.Annotation)this.removeAnnotationFromAggregation(e);else if(this.relationType===c.RelationType.Replace&&this.targetEvent){const e=await this.getLastReplacement();this.targetEvent.makeReplaced(e)}this.emit("Relations.remove",e)}else a.logger.error("Event relation info doesn't match this container")}getRelations(){return[...this.relations]}addAnnotationToAggregation(e){const{key:t}=e.getRelation();if(!t)return;let i=this.annotationsByKey[t];i||(i=this.annotationsByKey[t]=new Set,this.sortedAnnotationsByKey.push([t,i])),i.add(e),this.sortedAnnotationsByKey.sort(((e,t)=>{const i=e[1];return t[1].size-i.size}));const n=e.getSender();let r=this.annotationsBySender[n];r||(r=this.annotationsBySender[n]=new Set),r.add(e)}removeAnnotationFromAggregation(e){const{key:t}=e.getRelation();if(!t)return;const i=this.annotationsByKey[t];i&&(i.delete(e),this.sortedAnnotationsByKey.sort(((e,t)=>{const i=e[1];return t[1].size-i.size})));const n=e.getSender(),r=this.annotationsBySender[n];r&&r.delete(e)}getSortedAnnotationsByKey(){return this.relationType!==c.RelationType.Annotation?null:this.sortedAnnotationsByKey}getAnnotationsBySender(){return this.relationType!==c.RelationType.Annotation?null:this.annotationsBySender}async getLastReplacement(){if(this.relationType!==c.RelationType.Replace)return null;if(!this.targetEvent)return null;const e=this.targetEvent.getServerAggregatedRelation(c.RelationType.Replace),t=e&&e.origin_server_ts,i=this.getRelations().reduce(((e,i)=>i.getSender()!==this.targetEvent.getSender()||t&&t>i.getTs()||e&&e.getTs()>i.getTs()?e:i),null);return null!=i&&i.shouldAttemptDecryption()?await i.attemptDecryption(this.room.client.crypto):null!=i&&i.isBeingDecrypted()&&await i.getDecryptionPromise(),i}async setTargetEvent(e){if(!this.targetEvent){if(this.targetEvent=e,this.relationType===c.RelationType.Replace){const e=await this.getLastReplacement();e&&this.targetEvent.makeReplaced(e)}this.maybeEmitCreated()}}maybeEmitCreated(){this.creationEmitted||this.targetEvent&&this.relations.size&&(this.creationEmitted=!0,this.targetEvent.emit("Event.relationsCreated",this.relationType,this.eventType))}}t.Relations=l},2848:(e,t,i)=>{"use strict";var n=i(862),r=i(5318);Object.defineProperty(t,"__esModule",{value:!0}),t.RoomMember=void 0;var s=r(i(9713)),o=i(7187),a=i(3667),c=n(i(3102));class l extends o.EventEmitter{constructor(e,t){super(),this.roomId=e,this.userId=t,(0,s.default)(this,"_isOutOfBand",!1),(0,s.default)(this,"_modified",void 0),(0,s.default)(this,"_requestedProfileInfo",void 0),(0,s.default)(this,"typing",!1),(0,s.default)(this,"name",void 0),(0,s.default)(this,"rawDisplayName",void 0),(0,s.default)(this,"powerLevel",0),(0,s.default)(this,"powerLevelNorm",0),(0,s.default)(this,"user",null),(0,s.default)(this,"membership",null),(0,s.default)(this,"disambiguate",!1),(0,s.default)(this,"events",{member:null}),this.name=t,this.rawDisplayName=t,this.updateModifiedTime()}markOutOfBand(){this._isOutOfBand=!0}isOutOfBand(){return this._isOutOfBand}setMembershipEvent(e,t){const i=e.getDirectionalContent().displayname;if("m.room.member"!==e.getType())return;this._isOutOfBand=!1,this.events.member=e;const n=this.membership;this.membership=e.getDirectionalContent().membership,this.disambiguate=function(e,t,i){return!(!t||t===e)&&(!!c.removeHiddenChars(t)&&(!!i&&(!!h.test(t)||(!!u.test(t)||!!i.getUserIdsWithDisplayName(t).some((t=>t!==e))))))}(this.userId,i,t);const r=this.name;this.name=function(e,t,i,n){return n?t+" ("+e+")":t&&t!==e&&c.removeHiddenChars(t)?t:e}(this.userId,i,0,this.disambiguate),this.rawDisplayName=e.getDirectionalContent().displayname||this.userId,n!==this.membership&&(this.updateModifiedTime(),this.emit("RoomMember.membership",e,this,n)),r!==this.name&&(this.updateModifiedTime(),this.emit("RoomMember.name",e,this,r))}setPowerLevelEvent(e){if("m.room.power_levels"!==e.getType())return;const t=e.getDirectionalContent();let i=t.users_default||0;const n=t.users||{};Object.values(n).forEach((function(e){i=Math.max(i,e)}));const r=this.powerLevel,s=this.powerLevelNorm;void 0!==n[this.userId]&&Number.isInteger(n[this.userId])?this.powerLevel=n[this.userId]:void 0!==t.users_default?this.powerLevel=t.users_default:this.powerLevel=0,this.powerLevelNorm=0,i>0&&(this.powerLevelNorm=100*this.powerLevel/i),r===this.powerLevel&&s===this.powerLevelNorm||(this.updateModifiedTime(),this.emit("RoomMember.powerLevel",e,this))}setTypingEvent(e){if("m.typing"!==e.getType())return;const t=this.typing;this.typing=!1;const i=e.getContent().user_ids;Array.isArray(i)&&(-1!==i.indexOf(this.userId)&&(this.typing=!0),t!==this.typing&&(this.updateModifiedTime(),this.emit("RoomMember.typing",e,this)))}updateModifiedTime(){this._modified=Date.now()}getLastModifiedTime(){return this._modified}isKicked(){return"leave"===this.membership&&this.events.member.getSender()!==this.events.member.getStateKey()}getDMInviter(){if(this.events.member){const e=this.events.member;let t=e.getContent(),i=e.getSender();if("join"===t.membership&&(t=e.getPrevContent(),i=e.getUnsigned().prev_sender),"invite"===t.membership&&t.is_direct)return i}}getAvatarUrl(e,t,i,n,r=!0,s){const o=this.getMxcAvatarUrl();if(!o&&!r)return null;return(0,a.getHttpUriForMxc)(e,o,t,i,n,s)||null}getMxcAvatarUrl(){return this.events.member?this.events.member.getDirectionalContent().avatar_url:this.user?this.user.avatarUrl:null}}t.RoomMember=l;const h=/@.+:.+/,u=/[\u200E\u200F\u202A-\u202F]/},6860:(e,t,i)=>{"use strict";var n=i(862),r=i(5318);Object.defineProperty(t,"__esModule",{value:!0}),t.RoomState=void 0;var s,o=r(i(9713)),a=i(7187),c=i(2848),l=i(7434),h=n(i(3102)),u=i(2481);!function(e){e[e.NotStarted=0]="NotStarted",e[e.InProgress=1]="InProgress",e[e.Finished=2]="Finished"}(s||(s={}));class d extends a.EventEmitter{constructor(e,t={status:s.NotStarted}){super(),this.roomId=e,this.oobMemberFlags=t,(0,o.default)(this,"sentinels",{}),(0,o.default)(this,"displayNameToUserIds",{}),(0,o.default)(this,"userIdsToDisplayNames",{}),(0,o.default)(this,"tokenToInvite",{}),(0,o.default)(this,"joinedMemberCount",null),(0,o.default)(this,"summaryJoinedMemberCount",null),(0,o.default)(this,"invitedMemberCount",null),(0,o.default)(this,"summaryInvitedMemberCount",null),(0,o.default)(this,"modified",void 0),(0,o.default)(this,"members",{}),(0,o.default)(this,"events",new Map),(0,o.default)(this,"paginationToken",null),this.updateModifiedTime()}getJoinedMemberCount(){return null!==this.summaryJoinedMemberCount?this.summaryJoinedMemberCount:(null===this.joinedMemberCount&&(this.joinedMemberCount=this.getMembers().reduce(((e,t)=>"join"===t.membership?e+1:e),0)),this.joinedMemberCount)}setJoinedMemberCount(e){this.summaryJoinedMemberCount=e}getInvitedMemberCount(){return null!==this.summaryInvitedMemberCount?this.summaryInvitedMemberCount:(null===this.invitedMemberCount&&(this.invitedMemberCount=this.getMembers().reduce(((e,t)=>"invite"===t.membership?e+1:e),0)),this.invitedMemberCount)}setInvitedMemberCount(e){this.summaryInvitedMemberCount=e}getMembers(){return Object.values(this.members)}getMembersExcept(e){return this.getMembers().filter((t=>!e.includes(t.userId)))}getMember(e){return this.members[e]||null}getSentinelMember(e){if(!e)return null;let t=this.sentinels[e];if(void 0===t){t=new c.RoomMember(this.roomId,e);const i=this.members[e];i&&t.setMembershipEvent(i.events.member,this),this.sentinels[e]=t}return t}getStateEvents(e,t){if(!this.events.has(e))return void 0===t?[]:null;if(void 0===t)return Array.from(this.events.get(e).values());return this.events.get(e).get(t)||null}clone(){const e=new d(this.roomId,this.oobMemberFlags),t=this.oobMemberFlags.status;return this.oobMemberFlags.status=s.NotStarted,Array.from(this.events.values()).forEach((t=>{e.setStateEvents(Array.from(t.values()))})),this.oobMemberFlags.status=t,null!==this.summaryInvitedMemberCount&&e.setInvitedMemberCount(this.getInvitedMemberCount()),null!==this.summaryJoinedMemberCount&&e.setJoinedMemberCount(this.getJoinedMemberCount()),this.oobMemberFlags.status==s.Finished&&this.getMembers().forEach((t=>{t.isOutOfBand()&&e.getMember(t.userId).markOutOfBand()})),e}setUnknownStateEvents(e){const t=e.filter((e=>!this.events.has(e.getType())||!this.events.get(e.getType()).has(e.getStateKey())));this.setStateEvents(t)}setStateEvents(e){this.updateModifiedTime(),e.forEach((e=>{if(e.getRoomId()!==this.roomId)return;if(!e.isState())return;const t=this.getStateEventMatching(e);this.setStateEvent(e),e.getType()===u.EventType.RoomMember&&(this.updateDisplayNameCache(e.getStateKey(),e.getContent().displayname),this.updateThirdPartyTokenCache(e)),this.emit("RoomState.events",e,this,t)})),e.forEach((e=>{if(e.getRoomId()===this.roomId&&e.isState())if(e.getType()===u.EventType.RoomMember){const t=e.getStateKey();"leave"!==e.getContent().membership&&"ban"!==e.getContent().membership||(e.getContent().avatar_url=e.getContent().avatar_url||e.getPrevContent().avatar_url,e.getContent().displayname=e.getContent().displayname||e.getPrevContent().displayname);const i=this.getOrCreateMember(t,e);i.setMembershipEvent(e,this),this.updateMember(i),this.emit("RoomState.members",e,this,i)}else if(e.getType()===u.EventType.RoomPowerLevels){if(""!==e.getStateKey())return;Object.values(this.members).forEach((t=>{const i=t.getLastModifiedTime();t.setPowerLevelEvent(e),i!==t.getLastModifiedTime()&&this.emit("RoomState.members",e,this,t)})),this.sentinels={}}}))}getOrCreateMember(e,t){let i=this.members[e];return i||(i=new c.RoomMember(this.roomId,e),this.members[e]=i,this.emit("RoomState.newMember",t,this,i)),i}setStateEvent(e){this.events.has(e.getType())||this.events.set(e.getType(),new Map),this.events.get(e.getType()).set(e.getStateKey(),e)}getStateEventMatching(e){return this.events.has(e.getType())?this.events.get(e.getType()).get(e.getStateKey()):null}updateMember(e){const t=this.getStateEvents(u.EventType.RoomPowerLevels,"");t&&e.setPowerLevelEvent(t),delete this.sentinels[e.userId],this.members[e.userId]=e,this.joinedMemberCount=null,this.invitedMemberCount=null}needsOutOfBandMembers(){return this.oobMemberFlags.status===s.NotStarted}markOutOfBandMembersStarted(){this.oobMemberFlags.status===s.NotStarted&&(this.oobMemberFlags.status=s.InProgress)}markOutOfBandMembersFailed(){this.oobMemberFlags.status===s.InProgress&&(this.oobMemberFlags.status=s.NotStarted)}clearOutOfBandMembers(){let e=0;Object.keys(this.members).forEach((t=>{this.members[t].isOutOfBand()&&(++e,delete this.members[t])})),l.logger.log(`LL: RoomState removed ${e} members...`),this.oobMemberFlags.status=s.NotStarted}setOutOfBandMembers(e){l.logger.log(`LL: RoomState about to set ${e.length} OOB members ...`),this.oobMemberFlags.status===s.InProgress&&(l.logger.log("LL: RoomState put in finished state ..."),this.oobMemberFlags.status=s.Finished,e.forEach((e=>this.setOutOfBandMember(e))))}setOutOfBandMember(e){if(e.getType()!==u.EventType.RoomMember)return;const t=e.getStateKey(),i=this.getMember(t);if(i&&!i.isOutOfBand())return;const n=this.getOrCreateMember(t,e);n.setMembershipEvent(e,this),n.markOutOfBand(),this.updateDisplayNameCache(n.userId,n.name),this.setStateEvent(e),this.updateMember(n),this.emit("RoomState.members",e,this,n)}setTypingEvent(e){Object.values(this.members).forEach((function(t){t.setTypingEvent(e)}))}getInviteForThreePidToken(e){return this.tokenToInvite[e]||null}updateModifiedTime(){this.modified=Date.now()}getLastModifiedTime(){return this.modified}getUserIdsWithDisplayName(e){return this.displayNameToUserIds[h.removeHiddenChars(e)]||[]}maySendRedactionForEvent(e,t){const i=this.getMember(t);if(!i||"leave"===i.membership)return!1;if(e.status||e.isRedacted())return!1;const n=this.maySendEvent(u.EventType.RoomRedaction,t);return e.getSender()===t?n:this.hasSufficientPowerLevelFor("redact",i.powerLevel)}hasSufficientPowerLevelFor(e,t){const i=this.getStateEvents(u.EventType.RoomPowerLevels,"");let n={};i&&(n=i.getContent());let r=50;return h.isNumber(n[e])&&(r=n[e]),t>=r}maySendMessage(e){return this.maySendEventOfType(u.EventType.RoomMessage,e,!1)}maySendEvent(e,t){return this.maySendEventOfType(e,t,!1)}mayClientSendStateEvent(e,t){return!t.isGuest()&&this.maySendStateEvent(e,t.credentials.userId)}maySendStateEvent(e,t){return this.maySendEventOfType(e,t,!0)}maySendEventOfType(e,t,i){const n=this.getStateEvents(u.EventType.RoomPowerLevels,"");let r,s={},o=0,a=0,c=0;if(n){r=n.getContent(),s=r.events||{},o=Number.isSafeInteger(r.state_default)?r.state_default:50;const e=r.users&&r.users[t];Number.isSafeInteger(e)?c=e:Number.isSafeInteger(r.users_default)&&(c=r.users_default),Number.isSafeInteger(r.events_default)&&(a=r.events_default)}let l=i?o:a;return Number.isSafeInteger(s[e])&&(l=s[e]),c>=l}mayTriggerNotifOfType(e,t){const i=this.getMember(t);if(!i)return!1;const n=this.getStateEvents(u.EventType.RoomPowerLevels,"");let r=50;return n&&n.getContent()&&n.getContent().notifications&&h.isNumber(n.getContent().notifications[e])&&(r=n.getContent().notifications[e]),i.powerLevel>=r}getJoinRule(){const e=this.getStateEvents(u.EventType.RoomJoinRules,"");return(e?e.getContent():{}).join_rule||"invite"}updateThirdPartyTokenCache(e){if(!e.getContent().third_party_invite)return;const t=(e.getContent().third_party_invite.signed||{}).token;t&&this.getStateEvents(u.EventType.RoomThirdPartyInvite,t)&&(this.tokenToInvite[t]=e)}updateDisplayNameCache(e,t){const i=this.userIdsToDisplayNames[e];if(delete this.userIdsToDisplayNames[e],i){const t=h.removeHiddenChars(i),n=this.displayNameToUserIds[t];if(n){const i=n.filter((t=>t!==e));this.displayNameToUserIds[t]=i}}this.userIdsToDisplayNames[e]=t;const n=t&&h.removeHiddenChars(t);n&&(this.displayNameToUserIds[n]||(this.displayNameToUserIds[n]=[]),this.displayNameToUserIds[n].push(e))}}t.RoomState=d},5205:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.RoomSummary=void 0,t.RoomSummary=class{constructor(e,t){this.roomId=e}}},7366:(e,t,i)=>{"use strict";var n=i(862),r=i(5318);Object.defineProperty(t,"__esModule",{value:!0}),t.Room=t.NotificationCountType=void 0;var s=r(i(9713)),o=i(7187),a=i(3705),c=i(8910),l=i(3667),h=n(i(3102)),u=i(4369),d=i(2848),p=i(5205),g=i(7434),f=i(771),m=i(2481),v=i(2168);function y(e,t){var i=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),i.push.apply(i,n)}return i}function _(e){for(var t=1;t<arguments.length;t++){var i=null!=arguments[t]?arguments[t]:{};t%2?y(Object(i),!0).forEach((function(t){(0,s.default)(e,t,i[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(i)):y(Object(i)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(i,t))}))}return e}const S=["1","2","3","4","5","6"];function b(e,t,i){const n={content:{},type:"m.receipt",room_id:t.getRoomId()};return n.content[t.getId()]={},n.content[t.getId()][i]={},n.content[t.getId()][i][e]={ts:t.getTs()},new u.MatrixEvent(n)}let w;t.NotificationCountType=w,function(e){e.Highlight="highlight",e.Total="total"}(w||(t.NotificationCountType=w={}));class E extends o.EventEmitter{constructor(e,t,i,n={}){if(super(),this.roomId=e,this.client=t,this.myUserId=i,this.opts=n,(0,s.default)(this,"reEmitter",void 0),(0,s.default)(this,"txnToEvent",{}),(0,s.default)(this,"receipts",{}),(0,s.default)(this,"receiptCacheByEventId",{}),(0,s.default)(this,"realReceipts",{}),(0,s.default)(this,"notificationCounts",{}),(0,s.default)(this,"timelineSets",void 0),(0,s.default)(this,"filteredTimelineSets",{}),(0,s.default)(this,"pendingEventList",void 0),(0,s.default)(this,"blacklistUnverifiedDevices",null),(0,s.default)(this,"selfMembership",null),(0,s.default)(this,"summaryHeroes",null),(0,s.default)(this,"getTypeWarning",!1),(0,s.default)(this,"getVersionWarning",!1),(0,s.default)(this,"membersPromise",void 0),(0,s.default)(this,"name",void 0),(0,s.default)(this,"normalizedName",void 0),(0,s.default)(this,"tags",{}),(0,s.default)(this,"accountData",{}),(0,s.default)(this,"summary",null),(0,s.default)(this,"storageToken",void 0),(0,s.default)(this,"timeline",void 0),(0,s.default)(this,"oldState",void 0),(0,s.default)(this,"currentState",void 0),this.setMaxListeners(100),this.reEmitter=new f.ReEmitter(this),n.pendingEventOrdering=n.pendingEventOrdering||"chronological",-1===["chronological","detached"].indexOf(n.pendingEventOrdering))throw new Error("opts.pendingEventOrdering MUST be either 'chronological' or 'detached'. Got: '"+n.pendingEventOrdering+"'");if(this.name=e,this.timelineSets=[new a.EventTimelineSet(this,n)],this.reEmitter.reEmit(this.getUnfilteredTimelineSet(),["Room.timeline","Room.timelineReset"]),this.fixUpLegacyTimelineFields(),"detached"==this.opts.pendingEventOrdering){this.pendingEventList=[];const e=t.sessionStore.store.getItem(I(this.roomId));e&&JSON.parse(e).forEach((async e=>{const t=new u.MatrixEvent(e);t.getType()===m.EventType.RoomMessageEncrypted&&await t.attemptDecryption(this.client.crypto),t.setStatus(u.EventStatus.NOT_SENT),this.addPendingEvent(t,t.getTxnId())}))}this.opts.lazyLoadMembers?this.membersPromise=null:this.membersPromise=Promise.resolve(!1)}decryptCriticalEvents(){const e=this.getEventReadUpTo(this.client.getUserId(),!0),t=this.getLiveTimeline().getEvents(),i=t.findIndex((t=>t.event.event_id===e)),n=t.slice(i).filter((e=>e.shouldAttemptDecryption())).reverse().map((e=>e.attemptDecryption(this.client.crypto,{isRetry:!0})));return Promise.allSettled(n)}decryptAllEvents(){const e=this.getUnfilteredTimelineSet().getLiveTimeline().getEvents().filter((e=>e.shouldAttemptDecryption())).reverse().map((e=>e.attemptDecryption(this.client.crypto,{isRetry:!0})));return Promise.allSettled(e)}getVersion(){const e=this.currentState.getStateEvents(m.EventType.RoomCreate,"");if(!e)return this.getVersionWarning||(g.logger.warn("[getVersion] Room "+this.roomId+" does not have an m.room.create event"),this.getVersionWarning=!0),"1";const t=e.getContent().room_version;return void 0===t?"1":t}shouldUpgradeToVersion(){return S.includes(this.getVersion())?null:"6"}async getRecommendedVersion(){let e=(await this.client.getCapabilities())["m.room_versions"];if(!e){e={default:"6",available:{}};for(const t of S)e.available[t]=v.RoomVersionStability.Stable}let t=this.checkVersionAgainstCapability(e);if(t.urgent&&t.needsUpgrade){if(g.logger.warn("Refreshing room version capability because the server looks to be supporting a newer room version we don't know about."),e=(await this.client.getCapabilities(!0))["m.room_versions"],!e)return g.logger.warn("No room version capability - assuming upgrade required."),t;t=this.checkVersionAgainstCapability(e)}return t}checkVersionAgainstCapability(e){const t=this.getVersion();g.logger.log(`[${this.roomId}] Current version: ${t}`),g.logger.log(`[${this.roomId}] Version capability: `,e);const i={version:t,needsUpgrade:!1,urgent:!1};return t===e.default||Object.keys(e.available).filter((t=>"stable"===e.available[t])).includes(t)||(i.version=e.default,i.needsUpgrade=!0,i.urgent=!!this.getVersion().match(/^[0-9]+[0-9.]*$/g),i.urgent?g.logger.warn(`URGENT upgrade required on ${this.roomId}`):g.logger.warn(`Non-urgent upgrade required on ${this.roomId}`)),i}userMayUpgradeRoom(e){return this.currentState.maySendStateEvent(m.EventType.RoomTombstone,e)}getPendingEvents(){if("detached"!==this.opts.pendingEventOrdering)throw new Error("Cannot call getPendingEvents with pendingEventOrdering == "+this.opts.pendingEventOrdering);return this.pendingEventList}removePendingEvent(e){if("detached"!==this.opts.pendingEventOrdering)throw new Error("Cannot call removePendingEvent with pendingEventOrdering == "+this.opts.pendingEventOrdering);const t=h.removeElement(this.pendingEventList,(function(t){return t.getId()==e}),!1);return this.savePendingEvents(),t}hasPendingEvent(e){return"detached"===this.opts.pendingEventOrdering&&this.pendingEventList.some((t=>t.getId()===e))}getPendingEvent(e){return"detached"!==this.opts.pendingEventOrdering?null:this.pendingEventList.find((t=>t.getId()===e))}getLiveTimeline(){return this.getUnfilteredTimelineSet().getLiveTimeline()}getLastActiveTimestamp(){const e=this.getLiveTimeline().getEvents();return e.length?e[e.length-1].getTs():Number.MIN_SAFE_INTEGER}getMyMembership(){return this.selfMembership}getDMInviter(){if(this.myUserId){const e=this.getMember(this.myUserId);if(e)return e.getDMInviter()}if("invite"===this.selfMembership&&2==this.getInvitedAndJoinedMemberCount()&&this.summaryHeroes.length)return this.summaryHeroes[0]}guessDMUserId(){const e=this.getMember(this.myUserId);if(e){const t=e.getDMInviter();if(t)return t}if(Array.isArray(this.summaryHeroes)&&this.summaryHeroes.length)return this.summaryHeroes[0];const t=this.currentState.getMembers().find((e=>e.userId!==this.myUserId));return t?t.userId:this.myUserId}getAvatarFallbackMember(){if(this.getInvitedAndJoinedMemberCount()>2)return;const e=Array.isArray(this.summaryHeroes)&&this.summaryHeroes.length;if(e){const e=this.summaryHeroes.map((e=>this.getMember(e))).find((e=>!!e));if(e)return e}const t=this.currentState.getMembers();if(t.length<=2){const e=t.find((e=>e.userId!==this.myUserId));if(e)return e}if(e){const e=this.summaryHeroes.map((e=>this.client.getUser(e))).find((e=>!!e));if(e){const t=new d.RoomMember(this.roomId,e.userId);return t.user=e,t}}}updateMyMembership(e){const t=this.selfMembership;this.selfMembership=e,t!==e&&("leave"===e&&this.cleanupAfterLeaving(),this.emit("Room.myMembership",this,e,t))}async loadMembersFromServer(){const e=this.client.store.getSyncToken(),t=h.encodeParams({not_membership:"leave",at:e}),i=h.encodeUri("/rooms/$roomId/members?"+t,{$roomId:this.roomId}),n=this.client.http;return(await n.authedRequest(void 0,"GET",i)).chunk}async loadMembers(){let e=!1,t=await this.client.store.getOutOfBandMembers(this.roomId);return null===t&&(e=!0,t=await this.loadMembersFromServer(),g.logger.log(`LL: got ${t.length} members from server for room ${this.roomId}`)),{memberEvents:t.map(this.client.getEventMapper()),fromServer:e}}loadMembersIfNeeded(){if(this.membersPromise)return this.membersPromise;this.currentState.markOutOfBandMembersStarted();const e=this.loadMembers().then((e=>(this.currentState.setOutOfBandMembers(e.memberEvents),this.client.isCryptoEnabled()&&this.client.isRoomEncrypted(this.roomId)&&this.client.crypto.trackRoomDevices(this.roomId),e.fromServer))).catch((e=>{throw this.membersPromise=null,this.currentState.markOutOfBandMembersFailed(),e}));return e.then((e=>{if(e){const e=this.currentState.getMembers().filter((e=>e.isOutOfBand())).map((e=>e.events.member.event));return g.logger.log(`LL: telling store to write ${e.length} members for room ${this.roomId}`),this.client.store.setOutOfBandMembers(this.roomId,e).catch((e=>{g.logger.log("LL: storing OOB room members failed, oh well",e)}))}})).catch((e=>{g.logger.error(e)})),this.membersPromise=e,this.membersPromise}async clearLoadedMembersIfNeeded(){this.opts.lazyLoadMembers&&this.membersPromise&&(await this.loadMembersIfNeeded(),await this.client.store.clearOutOfBandMembers(this.roomId),this.currentState.clearOutOfBandMembers(),this.membersPromise=null)}cleanupAfterLeaving(){this.clearLoadedMembersIfNeeded().catch((e=>{g.logger.error(`error after clearing loaded members from room ${this.roomId} after leaving`),g.logger.log(e)}))}resetLiveTimeline(e,t){for(let i=0;i<this.timelineSets.length;i++)this.timelineSets[i].resetLiveTimeline(e,t);this.fixUpLegacyTimelineFields()}fixUpLegacyTimelineFields(){this.timeline=this.getLiveTimeline().getEvents(),this.oldState=this.getLiveTimeline().getState(c.EventTimeline.BACKWARDS),this.currentState=this.getLiveTimeline().getState(c.EventTimeline.FORWARDS)}async hasUnverifiedDevices(){if(!this.client.isRoomEncrypted(this.roomId))return!1;const e=await this.getEncryptionTargetMembers();for(const t of e)if(this.client.getStoredDevicesForUser(t.userId).some((e=>e.isUnverified())))return!0;return!1}getTimelineSets(){return this.timelineSets}getUnfilteredTimelineSet(){return this.timelineSets[0]}getTimelineForEvent(e){return this.getUnfilteredTimelineSet().getTimelineForEvent(e)}addTimeline(){return this.getUnfilteredTimelineSet().addTimeline()}findEventById(e){return this.getUnfilteredTimelineSet().findEventById(e)}getUnreadNotificationCount(e=w.Total){return this.notificationCounts[e]}setUnreadNotificationCount(e,t){this.notificationCounts[e]=t}setSummary(e){const t=e["m.heroes"],i=e["m.joined_member_count"],n=e["m.invited_member_count"];Number.isInteger(i)&&this.currentState.setJoinedMemberCount(i),Number.isInteger(n)&&this.currentState.setInvitedMemberCount(n),Array.isArray(t)&&(this.summaryHeroes=t.filter((e=>e!==this.myUserId)))}setBlacklistUnverifiedDevices(e){this.blacklistUnverifiedDevices=e}getBlacklistUnverifiedDevices(){return this.blacklistUnverifiedDevices}getAvatarUrl(e,t,i,n,r=!0){const s=this.currentState.getStateEvents(m.EventType.RoomAvatar,"");if(!s&&!r)return null;const o=s?s.getContent().url:null;return o?(0,l.getHttpUriForMxc)(e,o,t,i,n):null}getMxcAvatarUrl(){var e,t;return(null===(e=this.currentState.getStateEvents(m.EventType.RoomAvatar,""))||void 0===e||null===(t=e.getContent())||void 0===t?void 0:t.url)||null}getAliases(){const e=[],t=this.currentState.getStateEvents(m.EventType.RoomAliases);if(t)for(let i=0;i<t.length;++i){const n=t[i];if(Array.isArray(n.getContent().aliases)){const t=n.getContent().aliases.filter((e=>"string"==typeof e&&"#"===e[0]&&!!e.endsWith(`:${n.getStateKey()}`)));Array.prototype.push.apply(e,t)}}return e}getCanonicalAlias(){const e=this.currentState.getStateEvents(m.EventType.RoomCanonicalAlias,"");return e&&e.getContent().alias||null}getAltAliases(){const e=this.currentState.getStateEvents(m.EventType.RoomCanonicalAlias,"");return e&&e.getContent().alt_aliases||[]}addEventsToTimeline(e,t,i,n){i.getTimelineSet().addEventsToTimeline(e,t,i,n)}getMember(e){return this.currentState.getMember(e)}getMembers(){return this.currentState.getMembers()}getJoinedMembers(){return this.getMembersWithMembership("join")}getJoinedMemberCount(){return this.currentState.getJoinedMemberCount()}getInvitedMemberCount(){return this.currentState.getInvitedMemberCount()}getInvitedAndJoinedMemberCount(){return this.getInvitedMemberCount()+this.getJoinedMemberCount()}getMembersWithMembership(e){return this.currentState.getMembers().filter((function(t){return t.membership===e}))}async getEncryptionTargetMembers(){await this.loadMembersIfNeeded();let e=this.getMembersWithMembership("join");return this.shouldEncryptForInvitedMembers()&&(e=e.concat(this.getMembersWithMembership("invite"))),e}shouldEncryptForInvitedMembers(){var e;const t=this.currentState.getStateEvents(m.EventType.RoomHistoryVisibility,"");return"joined"!==(null==t||null===(e=t.getContent())||void 0===e?void 0:e.history_visibility)}getDefaultRoomName(e){return this.calculateRoomName(e,!0)}hasMembershipState(e,t){const i=this.getMember(e);return!!i&&i.membership===t}getOrCreateFilteredTimelineSet(e){if(this.filteredTimelineSets[e.filterId])return this.filteredTimelineSets[e.filterId];const t=Object.assign({filter:e},this.opts),i=new a.EventTimelineSet(this,t);this.reEmitter.reEmit(i,["Room.timeline","Room.timelineReset"]),this.filteredTimelineSets[e.filterId]=i,this.timelineSets.push(i);const n=this.getLiveTimeline();n.getEvents().forEach((function(e){i.addLiveEvent(e)}));let r=n;for(;r.getNeighbouringTimeline(c.EventTimeline.BACKWARDS);)r=r.getNeighbouringTimeline(c.EventTimeline.BACKWARDS);return i.getLiveTimeline().setPaginationToken(r.getPaginationToken(c.EventTimeline.BACKWARDS),c.EventTimeline.BACKWARDS),i}removeFilteredTimelineSet(e){const t=this.filteredTimelineSets[e.filterId];delete this.filteredTimelineSets[e.filterId];const i=this.timelineSets.indexOf(t);i>-1&&this.timelineSets.splice(i,1)}addLiveEvent(e,t,i=!1){if(e.isRedaction()){const t=e.event.redacts,i=this.getUnfilteredTimelineSet().findEventById(t);i&&(i.makeRedacted(e),i.getStateKey()&&this.currentState.getStateEvents(i.getType(),i.getStateKey()).getId()===i.getId()&&this.currentState.setStateEvents([i]),this.emit("Room.redaction",e,this))}if(e.getUnsigned().transaction_id){const t=this.txnToEvent[e.getUnsigned().transaction_id];if(t)return void this.handleRemoteEcho(e,t)}for(let n=0;n<this.timelineSets.length;n++)this.timelineSets[n].addLiveEvent(e,t,i);e.sender&&e.getType()!==m.EventType.RoomRedaction&&this.addReceipt(b(e.sender.userId,e,"m.read"),!0)}addPendingEvent(e,t){if(e.status!==u.EventStatus.SENDING&&e.status!==u.EventStatus.NOT_SENT)throw new Error("addPendingEvent called on an event with status "+e.status);if(this.txnToEvent[t])throw new Error("addPendingEvent called on an event with known txnId "+t);if(c.EventTimeline.setEventMetadata(e,this.getLiveTimeline().getState(c.EventTimeline.FORWARDS),!1),this.txnToEvent[t]=e,"detached"==this.opts.pendingEventOrdering){if(this.pendingEventList.some((e=>e.status===u.EventStatus.NOT_SENT))&&(g.logger.warn("Setting event as NOT_SENT due to messages in the same state"),e.setStatus(u.EventStatus.NOT_SENT)),this.pendingEventList.push(e),this.savePendingEvents(),e.isRelation()&&this.aggregateNonLiveRelation(e),e.isRedaction()){const t=e.event.redacts;let i=this.pendingEventList&&this.pendingEventList.find((e=>e.getId()===t));i||(i=this.getUnfilteredTimelineSet().findEventById(t)),i&&(i.markLocallyRedacted(e),this.emit("Room.redaction",e,this))}}else for(let t=0;t<this.timelineSets.length;t++){const i=this.timelineSets[t];i.getFilter()?i.getFilter().filterRoomTimeline([e]).length&&i.addEventToTimeline(e,i.getLiveTimeline(),!1):i.addEventToTimeline(e,i.getLiveTimeline(),!1)}this.emit("Room.localEchoUpdated",e,this,null,null)}savePendingEvents(){if(this.pendingEventList){const e=this.pendingEventList.map((e=>_(_({},e.event),{},{txn_id:e.getTxnId()}))).filter((e=>{const t=e.type===m.EventType.RoomMessageEncrypted,i=this.client.isRoomEncrypted(this.roomId);return t||!i})),{store:t}=this.client.sessionStore;this.pendingEventList.length>0?t.setItem(I(this.roomId),JSON.stringify(e)):t.removeItem(I(this.roomId))}}aggregateNonLiveRelation(e){for(let t=0;t<this.timelineSets.length;t++){const i=this.timelineSets[t];i.getFilter()?i.getFilter().filterRoomTimeline([e]).length&&i.aggregateRelations(e):i.aggregateRelations(e)}}handleRemoteEcho(e,t){const i=t.getId(),n=e.getId(),r=t.status;g.logger.debug(`Got remote echo for event ${i} -> ${n} old status ${r}`),delete this.txnToEvent[e.getUnsigned().transaction_id],this.pendingEventList&&this.removePendingEvent(i),t.handleRemoteEcho(e.event);for(let e=0;e<this.timelineSets.length;e++)this.timelineSets[e].handleRemoteEcho(t,i,n);this.emit("Room.localEchoUpdated",t,this,i,r)}updatePendingEvent(e,t,i){if(g.logger.log(`setting pendingEvent status to ${t} in ${e.getRoomId()} event ID ${e.getId()} -> ${i}`),t==u.EventStatus.SENT&&!i)throw new Error("updatePendingEvent called with status=SENT, but no new event id");if(t==u.EventStatus.SENT&&this.getUnfilteredTimelineSet().eventIdToTimeline(i))return;const n=e.status,r=e.getId();if(!n)throw new Error("updatePendingEventStatus called on an event which is not a local echo.");const s=k[n];if(!s||s.indexOf(t)<0)throw new Error("Invalid EventStatus transition "+n+"->"+t);if(e.setStatus(t),t==u.EventStatus.SENT){e.replaceLocalEventId(i);for(let e=0;e<this.timelineSets.length;e++)this.timelineSets[e].replaceEventId(r,i)}else if(t==u.EventStatus.CANCELLED){if(this.pendingEventList){const e=this.pendingEventList.findIndex((e=>e.getId()===r));if(-1!==e){const[t]=this.pendingEventList.splice(e,1);t.isRedaction()&&this.revertRedactionLocalEcho(t)}}this.removeEvent(r)}this.savePendingEvents(),this.emit("Room.localEchoUpdated",e,this,r,n)}revertRedactionLocalEcho(e){const t=e.event.redacts;if(!t)return;const i=this.getUnfilteredTimelineSet().findEventById(t);i&&(i.unmarkLocallyRedacted(),this.emit("Room.redactionCancelled",e,this),i.isRelation()&&this.aggregateNonLiveRelation(i))}addLiveEvents(e,t,i=!1){let n;if(t&&-1===["replace","ignore"].indexOf(t))throw new Error("duplicateStrategy MUST be either 'replace' or 'ignore'");for(n=0;n<this.timelineSets.length;n++){const e=this.timelineSets[n].getLiveTimeline();if(e.getPaginationToken(c.EventTimeline.FORWARDS))throw new Error("live timeline "+n+" is no longer live - it has a pagination token ("+e.getPaginationToken(c.EventTimeline.FORWARDS)+")");if(e.getNeighbouringTimeline(c.EventTimeline.FORWARDS))throw new Error("live timeline "+n+" is no longer live - it has a neighbouring timeline")}for(n=0;n<e.length;n++)this.addLiveEvent(e[n],t,i)}addEphemeralEvents(e){for(const t of e)"m.typing"===t.getType()?this.currentState.setTypingEvent(t):"m.receipt"===t.getType()&&this.addReceipt(t)}removeEvents(e){for(let t=0;t<e.length;++t)this.removeEvent(e[t])}removeEvent(e){let t=!1;for(let i=0;i<this.timelineSets.length;i++){const n=this.timelineSets[i].removeEvent(e);n&&(n.isRedaction()&&this.revertRedactionLocalEcho(n),t=!0)}return t}recalculate(){const e=this.currentState.getStateEvents(m.EventType.RoomMember,this.myUserId);e&&"invite"===e.getContent().membership&&(e.getUnsigned().invite_room_state||[]).forEach((e=>{this.currentState.getStateEvents(e.type,e.state_key)||this.currentState.setStateEvents([new u.MatrixEvent({type:e.type,state_key:e.state_key,content:e.content,event_id:"$fake"+Date.now(),room_id:this.roomId,user_id:this.myUserId})])}));const t=this.name;this.name=this.calculateRoomName(this.myUserId),this.normalizedName=(0,h.normalize)(this.name),this.summary=new p.RoomSummary(this.roomId,{title:this.name}),t!==this.name&&this.emit("Room.name",this)}getUsersReadUpTo(e){return this.getReceiptsForEvent(e).filter((function(e){return"m.read"===e.type})).map((function(e){return e.userId}))}getEventReadUpTo(e,t=!1){let i=this.receipts;return t&&(i=this.realReceipts),void 0===i["m.read"]||void 0===i["m.read"][e]?null:i["m.read"][e].eventId}hasUserReadEvent(e,t){const i=this.getEventReadUpTo(e,!1);if(i===t)return!0;if(this.timeline.length&&this.timeline[this.timeline.length-1].getSender()&&this.timeline[this.timeline.length-1].getSender()===e)return!0;for(let e=this.timeline.length-1;e>=0;--e){const n=this.timeline[e];if(n.getId()===t)return!1;if(n.getId()===i)return!0}return!1}getReceiptsForEvent(e){return this.receiptCacheByEventId[e.getId()]||[]}addReceipt(e,t=!1){t||this.addReceiptsToStructure(e,this.realReceipts),this.addReceiptsToStructure(e,this.receipts),this.receiptCacheByEventId=this.buildReceiptCache(this.receipts),this.emit("Room.receipt",e,this)}addReceiptsToStructure(e,t){const i=e.getContent();Object.keys(i).forEach((e=>{Object.keys(i[e]).forEach((n=>{Object.keys(i[e][n]).forEach((r=>{const s=i[e][n][r];t[n]||(t[n]={});const o=t[n][r];if(o){const t=this.getUnfilteredTimelineSet().compareEventOrdering(o.eventId,e);if(null!==t&&t>=0)return}else t[n][r]={};t[n][r]={eventId:e,data:s}}))}))}))}buildReceiptCache(e){const t={};return Object.keys(e).forEach((function(i){Object.keys(e[i]).forEach((function(n){const r=e[i][n];t[r.eventId]||(t[r.eventId]=[]),t[r.eventId].push({userId:n,type:i,data:r.data})}))})),t}addLocalEchoReceipt(e,t,i){this.addReceipt(b(e,t,i),!0)}addTags(e){this.tags=e.getContent().tags||{},this.emit("Room.tags",e,this)}addAccountData(e){for(let t=0;t<e.length;t++){const i=e[t];"m.tag"===i.getType()&&this.addTags(i);const n=this.accountData[i.getType()];this.accountData[i.getType()]=i,this.emit("Room.accountData",i,this,n)}}getAccountData(e){return this.accountData[e]}maySendMessage(){return"join"===this.getMyMembership()&&this.currentState.maySendEvent(m.EventType.RoomMessage,this.myUserId)}canInvite(e){let t="join"===this.getMyMembership();const i=this.currentState.getStateEvents(m.EventType.RoomPowerLevels,""),n=i&&i.getContent(),r=this.getMember(e);return n&&r&&n.invite>r.powerLevel&&(t=!1),t}getJoinRule(){return this.currentState.getJoinRule()}getType(){const e=this.currentState.getStateEvents(m.EventType.RoomCreate,"");if(e)return e.getContent()[m.RoomCreateTypeField];this.getTypeWarning||(g.logger.warn("[getType] Room "+this.roomId+" does not have an m.room.create event"),this.getTypeWarning=!0)}isSpaceRoom(){return this.getType()===m.RoomType.Space}calculateRoomName(e,t=!1){if(!t){const e=this.currentState.getStateEvents(m.EventType.RoomName,"");if(e&&e.getContent()&&e.getContent().name)return e.getContent().name}let i=this.getCanonicalAlias();if(!i){const e=this.getAltAliases();e.length&&(i=e[0])}if(i)return i;const n=this.currentState.getJoinedMemberCount()+this.currentState.getInvitedMemberCount()-1;let r=null;if(this.summaryHeroes)r=this.summaryHeroes.map((e=>{const t=this.getMember(e);return t?t.name:e}));else{let t=this.currentState.getMembers().filter((t=>t.userId!==e&&("invite"===t.membership||"join"===t.membership)));t.sort(((e,t)=>e.userId.localeCompare(t.userId))),t=t.slice(0,5),r=t.map((e=>e.name))}if(n)return T(r,n);if("join"==this.getMyMembership()){const e=this.currentState.getStateEvents(m.EventType.RoomThirdPartyInvite);if(e&&e.length)return`Inviting ${T(e.map((e=>e.getContent().display_name)))}`}let s=r;return s.length||(s=this.currentState.getMembers().filter((t=>t.userId!==e&&"invite"!==t.membership&&"join"!==t.membership)).map((e=>e.name))),s.length?`Empty room (was ${T(s)})`:"Empty room"}}function I(e){return`mx_pending_events_${e}`}t.Room=E;const k={};function T(e,t=e.length+1){const i=t-1;return e.length?1===e.length&&i<=1?e[0]:2===e.length&&i<=2?`${e[0]} and ${e[1]}`:i>1?`${e[0]} and ${i} others`:`${e[0]} and 1 other`:"Empty room"}k[u.EventStatus.ENCRYPTING]=[u.EventStatus.SENDING,u.EventStatus.NOT_SENT],k[u.EventStatus.SENDING]=[u.EventStatus.ENCRYPTING,u.EventStatus.QUEUED,u.EventStatus.NOT_SENT,u.EventStatus.SENT],k[u.EventStatus.QUEUED]=[u.EventStatus.SENDING,u.EventStatus.CANCELLED],k[u.EventStatus.SENT]=[],k[u.EventStatus.NOT_SENT]=[u.EventStatus.SENDING,u.EventStatus.QUEUED,u.EventStatus.CANCELLED],k[u.EventStatus.CANCELLED]=[]},1398:(e,t,i)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.SearchResult=r;var n=i(3558);function r(e,t){this.rank=e,this.context=t}r.fromJson=function(e,t){const i=e.context||{},s=i.events_before||[],o=i.events_after||[],a=new n.EventContext(t(e.result));return a.setPaginateToken(i.start,!0),a.addEvents(s.map(t),!0),a.addEvents(o.map(t),!1),a.setPaginateToken(i.end,!1),new r(e.rank,a)}},3998:(e,t,i)=>{"use strict";var n=i(5318);Object.defineProperty(t,"__esModule",{value:!0}),t.User=void 0;var r=n(i(9713)),s=i(7187);class o extends s.EventEmitter{constructor(e){super(),this.userId=e,(0,r.default)(this,"modified",void 0),(0,r.default)(this,"displayName",void 0),(0,r.default)(this,"rawDisplayName",void 0),(0,r.default)(this,"avatarUrl",void 0),(0,r.default)(this,"presenceStatusMsg",null),(0,r.default)(this,"presence","offline"),(0,r.default)(this,"lastActiveAgo",0),(0,r.default)(this,"lastPresenceTs",0),(0,r.default)(this,"currentlyActive",!1),(0,r.default)(this,"events",{presence:null,profile:null}),(0,r.default)(this,"unstable_statusMessage",""),this.displayName=e,this.rawDisplayName=e,this.avatarUrl=null,this.updateModifiedTime()}setPresenceEvent(e){if("m.presence"!==e.getType())return;const t=null===this.events.presence;this.events.presence=e;const i=[];(e.getContent().presence!==this.presence||t)&&i.push("User.presence"),e.getContent().avatar_url&&e.getContent().avatar_url!==this.avatarUrl&&i.push("User.avatarUrl"),e.getContent().displayname&&e.getContent().displayname!==this.displayName&&i.push("User.displayName"),void 0!==e.getContent().currently_active&&e.getContent().currently_active!==this.currentlyActive&&i.push("User.currentlyActive"),this.presence=e.getContent().presence,i.push("User.lastPresenceTs"),e.getContent().status_msg&&(this.presenceStatusMsg=e.getContent().status_msg),e.getContent().displayname&&(this.displayName=e.getContent().displayname),e.getContent().avatar_url&&(this.avatarUrl=e.getContent().avatar_url),this.lastActiveAgo=e.getContent().last_active_ago,this.lastPresenceTs=Date.now(),this.currentlyActive=e.getContent().currently_active,this.updateModifiedTime();for(let t=0;t<i.length;t++)this.emit(i[t],e,this)}setDisplayName(e){const t=this.displayName;this.displayName="string"==typeof e?e:void 0,e!==t&&this.updateModifiedTime()}setRawDisplayName(e){this.rawDisplayName="string"==typeof e?e:void 0}setAvatarUrl(e){const t=this.avatarUrl;this.avatarUrl=e,e!==t&&this.updateModifiedTime()}updateModifiedTime(){this.modified=Date.now()}getLastModifiedTime(){return this.modified}getLastActiveTs(){return this.lastPresenceTs-this.lastActiveAgo}unstable_updateStatusMessage(e){e.getContent()?this.unstable_statusMessage=e.getContent().status:this.unstable_statusMessage="",this.updateModifiedTime(),this.emit("User.unstable_statusMessage",this)}}t.User=o},1707:(e,t,i)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.PushProcessor=a;var n=i(3102),r=i(7434);const s=["override","content","room","sender","underride"],o=[{rule_id:".m.rule.tombstone",default:!0,enabled:!0,conditions:[{kind:"event_match",key:"type",pattern:"m.room.tombstone"},{kind:"event_match",key:"state_key",pattern:""}],actions:["notify",{set_tweak:"highlight",value:!0}]},{rule_id:".m.rule.reaction",default:!0,enabled:!0,conditions:[{kind:"event_match",key:"type",pattern:"m.reaction"}],actions:["dont_notify"]}];function a(e){const t={},i=(e,t)=>{for(let i=0;i<s.length;++i){const n=s[i],o=t[n];if(o)for(let t=0;t<o.length;++t){const i=o[t];if(!i.enabled)continue;const s=r(n,i);if(s&&this.ruleMatchesEvent(s,e))return i.kind=n,i}}return null},r=function(e,t){const i={rule_id:t.rule_id,actions:t.actions,conditions:[]};switch(e){case"underride":case"override":i.conditions=t.conditions;break;case"room":if(!t.rule_id)return null;i.conditions.push({kind:"event_match",key:"room_id",value:t.rule_id});break;case"sender":if(!t.rule_id)return null;i.conditions.push({kind:"event_match",key:"user_id",value:t.rule_id});break;case"content":if(!t.pattern)return null;i.conditions.push({kind:"event_match",key:"content.body",pattern:t.pattern})}return i},o=function(e,t){const i={event_match:u,contains_display_name:h,room_member_count:l,sender_notification_permission:c};return!!i[e.kind]&&i[e.kind](e,t)},c=function(t,i){const n=t.key;if(!n)return!1;const r=e.getRoom(i.getRoomId());return!(!r||!r.currentState)&&r.currentState.mayTriggerNotifOfType(n,i.getSender())},l=function(t,i){if(!t.is)return!1;const n=e.getRoom(i.getRoomId());if(!n||!n.currentState||!n.currentState.members)return!1;const r=n.currentState.getJoinedMemberCount(),s=t.is.match(/^([=<>]*)([0-9]*)$/);if(!s)return!1;const o=s[1],a=parseInt(s[2]);if(isNaN(a))return!1;switch(o){case"":case"==":return r==a;case"<":return r<a;case">":return r>a;case"<=":return r<=a;case">=":return r>=a;default:return!1}},h=function(t,i){let r=i.getContent();if(i.isEncrypted()&&i.getClearContent()&&(r=i.getClearContent()),!r||!r.body||"string"!=typeof r.body)return!1;const s=e.getRoom(i.getRoomId());if(!(s&&s.currentState&&s.currentState.members&&s.currentState.getMember(e.credentials.userId)))return!1;const o=s.currentState.getMember(e.credentials.userId).name,a=new RegExp("(^|\\W)"+(0,n.escapeRegExp)(o)+"(\\W|$)","i");return r.body.search(a)>-1},u=function(e,t){if(!e.key)return!1;const i=p(e.key,t);if("string"!=typeof i)return!1;if(e.value)return e.value===i;if("string"!=typeof e.pattern)return!1;let n;return n="content.body"==e.key?d("(^|\\W)",e.pattern,"(\\W|$)"):d("^",e.pattern,"$"),!!i.match(n)},d=function(e,i,r){return t[i]||(t[i]=new RegExp(e+(0,n.globToRegexp)(i)+r,"i")),t[i]},p=function(e,t){const i=e.split(".");let r;const s=i[0];for("content"===s?(r=t.getContent(),i.shift()):"type"===s?(r=t.getType(),i.shift()):r=t.event;i.length>0;){const e=i.shift();if((0,n.isNullOrUndefined)(r[e]))return null;r=r[e]}return r};this.ruleMatchesEvent=function(e,t){let i=!0;for(let n=0;n<e.conditions.length;++n){const r=e.conditions[n];i&=o(r,t)}return i},this.actionsForEvent=function(t){return function(t,n){const r=function(t,n){return n?t.getSender()===e.credentials.userId?null:i(t,n.global):null}(t,n);if(!r)return{};const s=a.actionListToActionsObject(r.actions);return void 0===s.tweaks.highlight&&(s.tweaks.highlight="content"==r.kind),s}(t,e.pushRules)},this.getPushRuleById=function(t){for(const i of["global"])if(void 0!==e.pushRules[i])for(const n of s)if(void 0!==e.pushRules[i][n])for(const r of e.pushRules[i][n])if(r.rule_id===t)return r;return null}}a.actionListToActionsObject=function(e){const t={notify:!1,tweaks:{}};for(let i=0;i<e.length;++i){const n=e[i];"notify"===n?t.notify=!0:"object"==typeof n&&(void 0===n.value&&(n.value=!0),t.tweaks[n.set_tweak]=n.value)}return t},a.rewriteDefaultRules=function(e){let t=JSON.parse(JSON.stringify(e));t||(t={}),t.global||(t.global={}),t.global.override||(t.global.override=[]);const i=t.global.override;for(const e of o){const t=i.find((t=>t.rule_id===e.rule_id));if(t)t.default=e.default,t.conditions=e.conditions,t.actions=e.actions;else{const t=e.rule_id;r.logger.warn(`Adding default global override for ${t}`),i.push(e)}}return t}},8401:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.randomString=function(e){return r(e,n+i+"0123456789")},t.randomLowercaseString=function(e){return r(e,i)},t.randomUppercaseString=function(e){return r(e,n)};const i="abcdefghijklmnopqrstuvwxyz",n="ABCDEFGHIJKLMNOPQRSTUVWXYZ";function r(e,t){let i="";for(let n=0;n<e;++n)i+=t.charAt(Math.floor(Math.random()*t.length));return i}},2731:(e,t,i)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.setNow=function(e){a=e||Date.now},t.setTimeout=function(e,t){(t=t||0)<0&&(t=0);const i=Array.prototype.slice.call(arguments,2),n=a()+t,r=s++,l={runAt:n,func:e,params:i,key:r},u=h(o,(function(e){return e.runAt-n}));return o.splice(u,0,l),c(),r},t.clearTimeout=function(e){if(0===o.length)return;let t;for(t=0;t<o.length;t++)if(o[t].key==e){o.splice(t,1);break}0===t&&c()};var n=i(7434);let r,s=0;const o=[];let a=Date.now;function c(){r&&i.g.clearTimeout(r);const e=o[0];if(!e)return;const t=a(),n=Math.min(e.runAt-t,1e3);r=i.g.setTimeout(l,n)}function l(){let e;const t=a(),r=[];for(;;){const i=o[0];if(!i||i.runAt>t)break;e=o.shift(),e.key,r.push(e)}c();for(let t=0;t<r.length;t++){e=r[t];try{e.func.apply(i.g,e.params)}catch(e){n.logger.error("Uncaught exception in callback function",e.stack||e)}}}function h(e,t){let i=0,n=e.length;for(;i<n;){const r=i+n>>1;t(e[r])>0?n=r:i=r+1}return i}},9443:(e,t,i)=>{"use strict";var n=i(862);Object.defineProperty(t,"__esModule",{value:!0}),t.MatrixScheduler=s;var r=n(i(3102));function s(e,t){this.retryAlgorithm=e||s.RETRY_BACKOFF_RATELIMIT,this.queueAlgorithm=t||s.QUEUE_MESSAGES,this._queues={},this._activeQueues=[],this._procFn=null}function o(e){e._procFn&&Object.keys(e._queues).filter((function(t){return-1===e._activeQueues.indexOf(t)&&e._queues[t].length>0})).forEach((function(t){e._activeQueues.push(t),l(),a(e,t)}))}function a(e,t){const i=function(e,t){const i=e._queues[t];return Array.isArray(i)?i[0]:null}(e,t);if(!i){const i=e._activeQueues.indexOf(t);return i>=0&&e._activeQueues.splice(i,1),void l()}l(e._queues[t].length),Promise.resolve().then((()=>e._procFn(i.event))).then((function(n){c(e,t),l(i.event.getId()),i.defer.resolve(n),a(e,t)}),(function(n){i.attempts+=1;const r=e.retryAlgorithm(i.event,i.attempts,n);l(i.attempts,i.event.getId()),-1===r?(l(i.event.getId()),c(e,t),i.defer.reject(n),a(e,t)):setTimeout((function(){a(e,t)}),r)}))}function c(e,t){const i=e._queues[t];return Array.isArray(i)?i.shift():null}function l(){}i(7434),s.prototype.getQueueForEvent=function(e){const t=this.queueAlgorithm(e);return t&&this._queues[t]?this._queues[t].map((function(e){return e.event})):null},s.prototype.removeEventFromQueue=function(e){const t=this.queueAlgorithm(e);if(!t||!this._queues[t])return!1;let i=!1;return r.removeElement(this._queues[t],(function(t){if(t.event.getId()===e.getId())return i=!0,!0})),i},s.prototype.setProcessFunction=function(e){this._procFn=e,o(this)},s.prototype.queueEvent=function(e){const t=this.queueAlgorithm(e);if(!t)return null;this._queues[t]||(this._queues[t]=[]);const i=r.defer();return this._queues[t].push({event:e,defer:i,attempts:0}),e.getId(),o(this),i.promise},s.RETRY_BACKOFF_RATELIMIT=function(e,t,i){if(400===i.httpStatus||403===i.httpStatus||401===i.httpStatus)return-1;if("rejected"===i.cors)return-1;if("M_TOO_LARGE"===i.name)return-1;if("M_LIMIT_EXCEEDED"===i.name){const e=i.data.retry_after_ms;if(e>0)return e}return t>4?-1:1e3*Math.pow(2,t)},s.QUEUE_MESSAGES=function(e){return"m.room.message"===e.getType()||e.hasAssocation()?"message":null}},1415:(e,t)=>{"use strict";let i;Object.defineProperty(t,"__esModule",{value:!0}),t.SERVICE_TYPES=void 0,t.SERVICE_TYPES=i,function(e){e.IS="SERVICE_TYPE_IS",e.IM="SERVICE_TYPE_IM"}(i||(t.SERVICE_TYPES=i={}))},3861:(e,t,i)=>{"use strict";var n=i(862);Object.defineProperty(t,"__esModule",{value:!0}),t.LocalIndexedDBStoreBackend=d;var r=i(2741),s=n(i(3102)),o=n(i(3415)),a=i(7434);function c(e,t,i){const n=e.openCursor(t);return new Promise(((e,t)=>{const r=[];n.onerror=e=>{t(new Error("Query failed: "+e.target.errorCode))},n.onsuccess=t=>{const n=t.target.result;n?(r.push(i(n)),n.continue()):e(r)}}))}function l(e){return new Promise(((t,i)=>{e.oncomplete=function(e){t(e)},e.onerror=function(e){i(e.target.error)}}))}function h(e){return new Promise(((t,i)=>{e.onsuccess=function(e){t(e)},e.onerror=function(e){i(e.target.error)}}))}function u(e){return h(e).then((e=>e.target.result))}function d(e,t){this.indexedDB=e,this._dbName="matrix-js-sdk:"+(t||"default"),this.db=null,this._disconnected=!0,this._syncAccumulator=new r.SyncAccumulator,this._isNewlyCreated=!1}d.exists=function(e,t){return t="matrix-js-sdk:"+(t||"default"),o.exists(e,t)},d.prototype={connect:function(){if(!this._disconnected)return a.logger.log("LocalIndexedDBStoreBackend.connect: already connected or connecting"),Promise.resolve();this._disconnected=!1,a.logger.log("LocalIndexedDBStoreBackend.connect: connecting...");const e=this.indexedDB.open(this._dbName,3);return e.onupgradeneeded=e=>{const t=e.target.result,i=e.oldVersion;a.logger.log(`LocalIndexedDBStoreBackend.connect: upgrading from ${i}`),i<1&&(this._isNewlyCreated=!0,function(e){e.createObjectStore("users",{keyPath:["userId"]}),e.createObjectStore("accountData",{keyPath:["type"]}),e.createObjectStore("sync",{keyPath:["clobber"]})}(t)),i<2&&function(e){e.createObjectStore("oob_membership_events",{keyPath:["room_id","state_key"]}).createIndex("room","room_id")}(t),i<3&&function(e){e.createObjectStore("client_options",{keyPath:["clobber"]})}(t)},e.onblocked=()=>{a.logger.log("can't yet open LocalIndexedDBStoreBackend because it is open elsewhere")},a.logger.log("LocalIndexedDBStoreBackend.connect: awaiting connection..."),h(e).then((e=>(a.logger.log("LocalIndexedDBStoreBackend.connect: connected"),this.db=e.target.result,this.db.onversionchange=()=>{this.db.close()},this._init())))},isNewlyCreated:function(){return Promise.resolve(this._isNewlyCreated)},_init:function(){return Promise.all([this._loadAccountData(),this._loadSyncData()]).then((([e,t])=>{a.logger.log("LocalIndexedDBStoreBackend: loaded initial data"),this._syncAccumulator.accumulate({next_batch:t.nextBatch,rooms:t.roomsData,groups:t.groupsData,account_data:{events:e}},!0)}))},getOutOfBandMembers:function(e){return new Promise(((t,i)=>{const n=this.db.transaction(["oob_membership_events"],"readonly").objectStore("oob_membership_events").index("room"),r=IDBKeyRange.only(e),s=n.openCursor(r),o=[];let a=!1;s.onsuccess=e=>{const i=e.target.result;if(!i)return o.length||a?t(o):t(null);const n=i.value;n.oob_written?a=!0:o.push(n),i.continue()},s.onerror=e=>{i(e)}})).then((t=>(a.logger.log(`LL: got ${t&&t.length} membershipEvents from storage for room ${e} ...`),t)))},setOutOfBandMembers:async function(e,t){a.logger.log(`LL: backend about to store ${t.length} members for ${e}`);const i=this.db.transaction(["oob_membership_events"],"readwrite"),n=i.objectStore("oob_membership_events");t.forEach((e=>{n.put(e)}));const r={room_id:e,oob_written:!0,state_key:0};n.put(r),await l(i),a.logger.log(`LL: backend done storing for ${e}!`)},clearOutOfBandMembers:async function(e){const t=this.db.transaction(["oob_membership_events"],"readonly").objectStore("oob_membership_events").index("room"),i=IDBKeyRange.only(e),n=u(t.openKeyCursor(i,"next")).then((e=>e&&e.primaryKey[1])),r=u(t.openKeyCursor(i,"prev")).then((e=>e&&e.primaryKey[1])),[s,o]=await Promise.all([n,r]),c=this.db.transaction(["oob_membership_events"],"readwrite").objectStore("oob_membership_events"),l=IDBKeyRange.bound([e,s],[e,o]);var h;a.logger.log(`LL: Deleting all users + marker in storage for room ${e}, with key range:`,[e,s],[e,o]),await(h=c.delete(l),new Promise(((e,t)=>{h.onsuccess=()=>e(h),h.onerror=e=>t(e)})))},clearDatabase:function(){return new Promise(((e,t)=>{a.logger.log(`Removing indexeddb instance: ${this._dbName}`);const i=this.indexedDB.deleteDatabase(this._dbName);i.onblocked=()=>{a.logger.log(`can't yet delete indexeddb ${this._dbName} because it is open elsewhere`)},i.onerror=t=>{a.logger.warn(`unable to delete js-sdk store indexeddb: ${t.target.error}`),e()},i.onsuccess=()=>{a.logger.log(`Removed indexeddb instance: ${this._dbName}`),e()}}))},getSavedSync:function(e){void 0===e&&(e=!0);const t=this._syncAccumulator.getJSON();return t.nextBatch?e?Promise.resolve(s.deepCopy(t)):Promise.resolve(t):Promise.resolve(null)},getNextBatchToken:function(){return Promise.resolve(this._syncAccumulator.getNextBatchToken())},setSyncData:function(e){return Promise.resolve().then((()=>{this._syncAccumulator.accumulate(e)}))},syncToDatabase:function(e){const t=this._syncAccumulator.getJSON(!0);return Promise.all([this._persistUserPresenceEvents(e),this._persistAccountData(t.accountData),this._persistSyncData(t.nextBatch,t.roomsData,t.groupsData)])},_persistSyncData:function(e,t,i){return a.logger.log("Persisting sync data up to",e),s.promiseTry((()=>{const n=this.db.transaction(["sync"],"readwrite");return n.objectStore("sync").put({clobber:"-",nextBatch:e,roomsData:t,groupsData:i}),l(n)}))},_persistAccountData:function(e){return s.promiseTry((()=>{const t=this.db.transaction(["accountData"],"readwrite"),i=t.objectStore("accountData");for(let t=0;t<e.length;t++)i.put(e[t]);return l(t)}))},_persistUserPresenceEvents:function(e){return s.promiseTry((()=>{const t=this.db.transaction(["users"],"readwrite"),i=t.objectStore("users");for(const t of e)i.put({userId:t[0],event:t[1]});return l(t)}))},getUserPresenceEvents:function(){return s.promiseTry((()=>c(this.db.transaction(["users"],"readonly").objectStore("users"),void 0,(e=>[e.value.userId,e.value.event]))))},_loadAccountData:function(){return a.logger.log("LocalIndexedDBStoreBackend: loading account data..."),s.promiseTry((()=>c(this.db.transaction(["accountData"],"readonly").objectStore("accountData"),void 0,(e=>e.value)).then((e=>(a.logger.log("LocalIndexedDBStoreBackend: loaded account data"),e)))))},_loadSyncData:function(){return a.logger.log("LocalIndexedDBStoreBackend: loading sync data..."),s.promiseTry((()=>c(this.db.transaction(["sync"],"readonly").objectStore("sync"),void 0,(e=>e.value)).then((e=>(a.logger.log("LocalIndexedDBStoreBackend: loaded sync data"),e.length>1&&a.logger.warn("loadSyncData: More than 1 sync row found."),e.length>0?e[0]:{})))))},getClientOptions:function(){return Promise.resolve().then((()=>c(this.db.transaction(["client_options"],"readonly").objectStore("client_options"),void 0,(e=>{if(e.value&&e.value&&e.value.options)return e.value.options})).then((e=>e[0]))))},storeClientOptions:async function(e){const t=this.db.transaction(["client_options"],"readwrite");t.objectStore("client_options").put({clobber:"-",options:e}),await l(t)}}},4215:(e,t,i)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.RemoteIndexedDBStoreBackend=s;var n=i(7434),r=i(3102);function s(e,t,i){this._workerScript=e,this._dbName=t,this._workerApi=i,this._worker=null,this._nextSeq=0,this._inFlight={},this._startPromise=null}s.prototype={connect:function(){return this._ensureStarted().then((()=>this._doCmd("connect")))},clearDatabase:function(){return this._ensureStarted().then((()=>this._doCmd("clearDatabase")))},isNewlyCreated:function(){return this._doCmd("isNewlyCreated")},getSavedSync:function(){return this._doCmd("getSavedSync")},getNextBatchToken:function(){return this._doCmd("getNextBatchToken")},setSyncData:function(e){return this._doCmd("setSyncData",[e])},syncToDatabase:function(e){return this._doCmd("syncToDatabase",[e])},getOutOfBandMembers:function(e){return this._doCmd("getOutOfBandMembers",[e])},setOutOfBandMembers:function(e,t){return this._doCmd("setOutOfBandMembers",[e,t])},clearOutOfBandMembers:function(e){return this._doCmd("clearOutOfBandMembers",[e])},getClientOptions:function(){return this._doCmd("getClientOptions")},storeClientOptions:function(e){return this._doCmd("storeClientOptions",[e])},getUserPresenceEvents:function(){return this._doCmd("getUserPresenceEvents")},_ensureStarted:function(){return null===this._startPromise&&(this._worker=new this._workerApi(this._workerScript),this._worker.onmessage=this._onWorkerMessage.bind(this),this._startPromise=this._doCmd("_setupWorker",[this._dbName]).then((()=>{n.logger.log("IndexedDB worker is ready")}))),this._startPromise},_doCmd:function(e,t){return Promise.resolve().then((()=>{const i=this._nextSeq++,n=(0,r.defer)();return this._inFlight[i]=n,this._worker.postMessage({command:e,seq:i,args:t}),n.promise}))},_onWorkerMessage:function(e){const t=e.data;if("cmd_success"==t.command||"cmd_fail"==t.command){if(void 0===t.seq)return void n.logger.error("Got reply from worker with no seq");const e=this._inFlight[t.seq];if(void 0===e)return void n.logger.error("Got reply for unknown seq "+t.seq);if(delete this._inFlight[t.seq],"cmd_success"==t.command)e.resolve(t.result);else{const i=new Error(t.error.message);i.name=t.error.name,e.reject(i)}}else n.logger.warn("Unrecognised message from worker: "+t)}}},9789:(e,t,i)=>{"use strict";var n=i(5318);Object.defineProperty(t,"__esModule",{value:!0}),t.IndexedDBStore=void 0;var r=n(i(9713)),s=i(7187),o=i(1703),a=i(3861),c=i(4215),l=i(3998),h=i(4369),u=i(7434);class d extends o.MemoryStore{static exists(e,t){return a.LocalIndexedDBStoreBackend.exists(e,t)}constructor(e){if(super(e),(0,r.default)(this,"backend",void 0),(0,r.default)(this,"startedUp",!1),(0,r.default)(this,"syncTs",0),(0,r.default)(this,"userModifiedMap",{}),(0,r.default)(this,"emitter",new s.EventEmitter),(0,r.default)(this,"on",this.emitter.on.bind(this.emitter)),(0,r.default)(this,"getSavedSync",this.degradable((()=>this.backend.getSavedSync()),"getSavedSync")),(0,r.default)(this,"isNewlyCreated",this.degradable((()=>this.backend.isNewlyCreated()),"isNewlyCreated")),(0,r.default)(this,"getSavedSyncToken",this.degradable((()=>this.backend.getNextBatchToken()),"getSavedSyncToken")),(0,r.default)(this,"deleteAllData",this.degradable((()=>(super.deleteAllData(),this.backend.clearDatabase().then((()=>{u.logger.log("Deleted indexeddb data.")}),(e=>{throw u.logger.error(`Failed to delete indexeddb data: ${e}`),e})))))),(0,r.default)(this,"reallySave",this.degradable((()=>{this.syncTs=Date.now();const e=[];for(const t of this.getUsers())this.userModifiedMap[t.userId]!==t.getLastModifiedTime()&&t.events.presence&&(e.push([t.userId,t.events.presence.event]),this.userModifiedMap[t.userId]=t.getLastModifiedTime());return this.backend.syncToDatabase(e)}))),(0,r.default)(this,"setSyncData",this.degradable((e=>this.backend.setSyncData(e)),"setSyncData")),(0,r.default)(this,"getOutOfBandMembers",this.degradable((e=>this.backend.getOutOfBandMembers(e)),"getOutOfBandMembers")),(0,r.default)(this,"setOutOfBandMembers",this.degradable(((e,t)=>(super.setOutOfBandMembers(e,t),this.backend.setOutOfBandMembers(e,t))),"setOutOfBandMembers")),(0,r.default)(this,"clearOutOfBandMembers",this.degradable((e=>(super.clearOutOfBandMembers(e),this.backend.clearOutOfBandMembers(e))),"clearOutOfBandMembers")),(0,r.default)(this,"getClientOptions",this.degradable((()=>this.backend.getClientOptions()),"getClientOptions")),(0,r.default)(this,"storeClientOptions",this.degradable((e=>(super.storeClientOptions(e),this.backend.storeClientOptions(e))),"storeClientOptions")),!e.indexedDB)throw new Error("Missing required option: indexedDB");if(e.workerScript){let t=e.workerApi;t||(t=i.g.Worker),this.backend=new c.RemoteIndexedDBStoreBackend(e.workerScript,e.dbName,t)}else this.backend=new a.LocalIndexedDBStoreBackend(e.indexedDB,e.dbName)}startup(){return this.startedUp?(u.logger.log("IndexedDBStore.startup: already started"),Promise.resolve()):(u.logger.log("IndexedDBStore.startup: connecting to backend"),this.backend.connect().then((()=>(u.logger.log("IndexedDBStore.startup: loading presence events"),this.backend.getUserPresenceEvents()))).then((e=>{u.logger.log("IndexedDBStore.startup: processing presence events"),e.forEach((([e,t])=>{const i=new l.User(e);t&&i.setPresenceEvent(new h.MatrixEvent(t)),this.userModifiedMap[i.userId]=i.getLastModifiedTime(),this.storeUser(i)}))})))}wantsSave(){return Date.now()-this.syncTs>3e5}save(e=!1){return e||this.wantsSave()?this.reallySave():Promise.resolve()}degradable(e,t){const i=super[t];return async(...t)=>{try{return e.call(this,...t)}catch(e){u.logger.error("IndexedDBStore failure, degrading to MemoryStore",e),this.emitter.emit("degraded",e);try{u.logger.log("IndexedDBStore trying to delete degraded data"),await this.backend.clearDatabase(),u.logger.log("IndexedDBStore delete after degrading succeeded")}catch(e){u.logger.warn("IndexedDBStore delete after degrading failed",e)}if(i)return i(...t)}}}}t.IndexedDBStore=d},1703:(e,t,i)=>{"use strict";var n=i(5318);Object.defineProperty(t,"__esModule",{value:!0}),t.MemoryStore=void 0;var r=n(i(9713)),s=i(3998);function o(e){return"string"==typeof e&&!!e&&"undefined"!==e&&"null"!==e||"number"==typeof e}t.MemoryStore=class{constructor(e={}){(0,r.default)(this,"rooms",{}),(0,r.default)(this,"groups",{}),(0,r.default)(this,"users",{}),(0,r.default)(this,"syncToken",null),(0,r.default)(this,"filters",{}),(0,r.default)(this,"accountData",{}),(0,r.default)(this,"localStorage",void 0),(0,r.default)(this,"oobMembers",{}),(0,r.default)(this,"clientOptions",{}),(0,r.default)(this,"onRoomMember",((e,t,i)=>{if("invite"===i.membership)return;const n=this.users[i.userId]||new s.User(i.userId);i.name&&(n.setDisplayName(i.name),i.events.member&&n.setRawDisplayName(i.events.member.getDirectionalContent().displayname)),i.events.member&&i.events.member.getContent().avatar_url&&n.setAvatarUrl(i.events.member.getContent().avatar_url),this.users[n.userId]=n})),this.localStorage=e.localStorage}getSyncToken(){return this.syncToken}isNewlyCreated(){return Promise.resolve(!0)}setSyncToken(e){this.syncToken=e}storeGroup(e){this.groups[e.groupId]=e}getGroup(e){return this.groups[e]||null}getGroups(){return Object.values(this.groups)}storeRoom(e){this.rooms[e.roomId]=e,e.currentState.on("RoomState.members",this.onRoomMember),e.currentState.getMembers().forEach((t=>{this.onRoomMember(null,e.currentState,t)}))}getRoom(e){return this.rooms[e]||null}getRooms(){return Object.values(this.rooms)}removeRoom(e){this.rooms[e]&&this.rooms[e].removeListener("RoomState.members",this.onRoomMember),delete this.rooms[e]}getRoomSummaries(){return Object.values(this.rooms).map((function(e){return e.summary}))}storeUser(e){this.users[e.userId]=e}getUser(e){return this.users[e]||null}getUsers(){return Object.values(this.users)}scrollback(e,t){return[]}storeEvents(e,t,i,n){}storeFilter(e){e&&(this.filters[e.userId]||(this.filters[e.userId]={}),this.filters[e.userId][e.filterId]=e)}getFilter(e,t){return this.filters[e]&&this.filters[e][t]?this.filters[e][t]:null}getFilterIdByName(e){if(!this.localStorage)return null;const t="mxjssdk_memory_filter_"+e;try{const e=this.localStorage.getItem(t);if(o(e))return e}catch(e){}return null}setFilterIdByName(e,t){if(!this.localStorage)return;const i="mxjssdk_memory_filter_"+e;try{o(t)?this.localStorage.setItem(i,t):this.localStorage.removeItem(i)}catch(e){}}storeAccountDataEvents(e){e.forEach((e=>{this.accountData[e.getType()]=e}))}getAccountData(e){return this.accountData[e]}setSyncData(e){return Promise.resolve()}wantsSave(){return!1}save(e){}startup(){return Promise.resolve()}getSavedSync(){return Promise.resolve(null)}getSavedSyncToken(){return Promise.resolve(null)}deleteAllData(){return this.rooms={},this.users={},this.syncToken=null,this.filters={},this.accountData={},Promise.resolve()}getOutOfBandMembers(e){return Promise.resolve(this.oobMembers[e]||null)}setOutOfBandMembers(e,t){return this.oobMembers[e]=t,Promise.resolve()}clearOutOfBandMembers(e){return this.oobMembers={},Promise.resolve()}getClientOptions(){return Promise.resolve(this.clientOptions)}storeClientOptions(e){return this.clientOptions=Object.assign({},e),Promise.resolve()}}},5837:(e,t,i)=>{"use strict";var n=i(862);Object.defineProperty(t,"__esModule",{value:!0}),t.WebStorageSessionStore=o;var r=n(i(3102));i(7434);const s="session.e2e.";function o(e){if(this.store=e,!(r.isFunction(e.getItem)&&r.isFunction(e.setItem)&&r.isFunction(e.removeItem)&&r.isFunction(e.key)&&"number"==typeof e.length))throw new Error("Supplied webStore does not meet the WebStorage API interface")}o.prototype={removeEndToEndAccount:function(){this.store.removeItem(a)},getEndToEndAccount:function(){return this.store.getItem(a)},getAllEndToEndDevices:function(){const e=u(""),t={};for(let i=0;i<this.store.length;++i){const n=this.store.key(i),r=n.substr(e.length);n.startsWith(e)&&(t[r]=g(this.store,n))}return t},getEndToEndDeviceTrackingStatus:function(){return g(this.store,l)},getEndToEndDeviceSyncToken:function(){return g(this.store,c)},removeEndToEndDeviceData:function(){m(this.store,u("")),m(this.store,l),m(this.store,c)},getEndToEndSessions:function(e){return g(this.store,d(e))},getAllEndToEndSessions:function(){const e=f(this.store,d("")),t={};for(const i of e)t[i.substr(d("").length)]=g(this.store,i);return t},removeAllEndToEndSessions:function(){m(this.store,d(""))},getAllEndToEndInboundGroupSessionKeys:function(){const e=s+"inboundgroupsessions/",t=[];for(let i=0;i<this.store.length;i++){const n=this.store.key(i);n.startsWith(e)&&t.push({senderKey:n.substr(e.length,43),sessionId:n.substr(e.length+44)})}return t},getEndToEndInboundGroupSession:function(e,t){const i=function(e,t){return s+"inboundgroupsessions/"+e+"/"+t}(e,t);return this.store.getItem(i)},removeAllEndToEndInboundGroupSessions:function(){m(this.store,s+"inboundgroupsessions/")},getAllEndToEndRooms:function(){const e=f(this.store,p("")),t={};for(const i of e)t[i.substr(p("").length)]=g(this.store,i);return t},removeAllEndToEndRooms:function(){m(this.store,p(""))},setLocalTrustedBackupPubKey:function(e){this.store.setItem(h,e)},getLocalTrustedBackupPubKey:function(){return this.store.getItem(h)}};const a=s+"account",c=s+"device_sync_token",l=s+"device_tracking",h=s+"trusted_backup_pubkey";function u(e){return s+"devices/"+e}function d(e){return s+"sessions/"+e}function p(e){return s+"rooms/"+e}function g(e,t){try{return JSON.parse(e.getItem(t))}catch(e){v(),v(e.stack)}return null}function f(e,t){const i=[];for(let n=0;n<e.length;++n){const r=e.key(n);r.startsWith(t)&&i.push(r)}return i}function m(e,t){const i=[];for(let n=0;n<e.length;++n){const r=e.key(n);r.startsWith(t)&&i.push(r)}for(const t of i)e.removeItem(t)}function v(){}},5641:(e,t,i)=>{"use strict";var n=i(5318);Object.defineProperty(t,"__esModule",{value:!0}),t.StubStore=void 0;var r=n(i(9713));t.StubStore=class{constructor(){(0,r.default)(this,"fromToken",null)}isNewlyCreated(){return Promise.resolve(!0)}getSyncToken(){return this.fromToken}setSyncToken(e){this.fromToken=e}storeGroup(e){}getGroup(e){return null}getGroups(){return[]}storeRoom(e){}getRoom(e){return null}getRooms(){return[]}removeRoom(e){}getRoomSummaries(){return[]}storeUser(e){}getUser(e){return null}getUsers(){return[]}scrollback(e,t){return[]}storeEvents(e,t,i,n){}storeFilter(e){}getFilter(e,t){return null}getFilterIdByName(e){return null}setFilterIdByName(e,t){}storeAccountDataEvents(e){}getAccountData(e){}setSyncData(e){return Promise.resolve()}wantsSave(){return!1}save(){}startup(){return Promise.resolve()}getSavedSync(){return Promise.resolve(null)}getSavedSyncToken(){return Promise.resolve(null)}deleteAllData(){return Promise.resolve()}getOutOfBandMembers(){return Promise.resolve(null)}setOutOfBandMembers(e,t){return Promise.resolve()}clearOutOfBandMembers(){return Promise.resolve()}getClientOptions(){return Promise.resolve({})}storeClientOptions(e){return Promise.resolve()}}},2741:(e,t,i)=>{"use strict";var n=i(5318);Object.defineProperty(t,"__esModule",{value:!0}),t.SyncAccumulator=t.Category=void 0;var r=n(i(9713)),s=i(7434),o=i(3102);let a;function c(e,t){null!==t.state_key&&void 0!==t.state_key&&t.type&&(e[t.type]||(e[t.type]=Object.create(null)),e[t.type][t.state_key]=t)}t.Category=a,function(e){e.Invite="invite",e.Leave="leave",e.Join="join"}(a||(t.Category=a={})),t.SyncAccumulator=class{constructor(e={}){this.opts=e,(0,r.default)(this,"accountData",{}),(0,r.default)(this,"inviteRooms",{}),(0,r.default)(this,"joinRooms",{}),(0,r.default)(this,"nextBatch",null),(0,r.default)(this,"groups",{invite:{},join:{},leave:{}}),this.opts.maxTimelineEntries=this.opts.maxTimelineEntries||50}accumulate(e,t=!1){this.accumulateRooms(e,t),this.accumulateGroups(e),this.accumulateAccountData(e),this.nextBatch=e.next_batch}accumulateAccountData(e){e.account_data&&e.account_data.events&&e.account_data.events.forEach((e=>{this.accountData[e.type]=e}))}accumulateRooms(e,t=!1){e.rooms&&(e.rooms.invite&&Object.keys(e.rooms.invite).forEach((i=>{this.accumulateRoom(i,a.Invite,e.rooms.invite[i],t)})),e.rooms.join&&Object.keys(e.rooms.join).forEach((i=>{this.accumulateRoom(i,a.Join,e.rooms.join[i],t)})),e.rooms.leave&&Object.keys(e.rooms.leave).forEach((i=>{this.accumulateRoom(i,a.Leave,e.rooms.leave[i],t)})))}accumulateRoom(e,t,i,n=!1){switch(t){case a.Invite:this.accumulateInviteState(e,i);break;case a.Join:this.inviteRooms[e]&&delete this.inviteRooms[e],this.accumulateJoinState(e,i,n);break;case a.Leave:this.inviteRooms[e]?delete this.inviteRooms[e]:delete this.joinRooms[e];break;default:s.logger.error("Unknown cateogory: ",t)}}accumulateInviteState(e,t){if(!t.invite_state||!t.invite_state.events)return;if(!this.inviteRooms[e])return void(this.inviteRooms[e]={invite_state:t.invite_state});const i=this.inviteRooms[e];t.invite_state.events.forEach((e=>{let t=!1;for(let n=0;n<i.invite_state.events.length;n++){const r=i.invite_state.events[n];r.type===e.type&&r.state_key==e.state_key&&(i.invite_state.events[n]=e,t=!0)}t||i.invite_state.events.push(e)}))}accumulateJoinState(e,t,i=!1){this.joinRooms[e]||(this.joinRooms[e]={_currentState:Object.create(null),_timeline:[],_accountData:Object.create(null),_unreadNotifications:{},_summary:{},_readReceipts:{}});const n=this.joinRooms[e];if(t.account_data&&t.account_data.events&&t.account_data.events.forEach((e=>{n._accountData[e.type]=e})),t.unread_notifications&&(n._unreadNotifications=t.unread_notifications),t.summary){const e="m.heroes",i="m.invited_member_count",r="m.joined_member_count",s=n._summary,o=t.summary;s[e]=o[e]||s[e],s[r]=o[r]||s[r],s[i]=o[i]||s[i]}if(t.ephemeral&&t.ephemeral.events&&t.ephemeral.events.forEach((e=>{"m.receipt"===e.type&&e.content&&Object.keys(e.content).forEach((t=>{e.content[t]["m.read"]&&Object.keys(e.content[t]["m.read"]).forEach((i=>{n._readReceipts[i]={data:e.content[t]["m.read"][i],eventId:t}}))}))})),t.timeline&&t.timeline.limited&&(n._timeline=[]),t.state&&t.state.events&&t.state.events.forEach((e=>{c(n._currentState,e)})),t.timeline&&t.timeline.events&&t.timeline.events.forEach(((e,r)=>{let s;if(c(n._currentState,e),i)s=e;else{s=Object.assign({},e),void 0!==s.unsigned&&(s.unsigned=Object.assign({},s.unsigned));const t=e.unsigned?e.unsigned.age:e.age;void 0!==t&&(s._localTs=Date.now()-t)}n._timeline.push({event:s,token:0===r?t.timeline.prev_batch:null})})),n._timeline.length>this.opts.maxTimelineEntries)for(let e=n._timeline.length-this.opts.maxTimelineEntries;e<n._timeline.length;e++)if(n._timeline[e].token){n._timeline=n._timeline.slice(e,n._timeline.length);break}}accumulateGroups(e){e.groups&&(e.groups.invite&&Object.keys(e.groups.invite).forEach((t=>{this.accumulateGroup(t,a.Invite,e.groups.invite[t])})),e.groups.join&&Object.keys(e.groups.join).forEach((t=>{this.accumulateGroup(t,a.Join,e.groups.join[t])})),e.groups.leave&&Object.keys(e.groups.leave).forEach((t=>{this.accumulateGroup(t,a.Leave,e.groups.leave[t])})))}accumulateGroup(e,t,i){for(const t of[a.Invite,a.Leave,a.Join])delete this.groups[t][e];this.groups[t][e]=i}getJSON(e=!1){const t={join:{},invite:{},leave:{}};Object.keys(this.inviteRooms).forEach((e=>{t.invite[e]=this.inviteRooms[e]})),Object.keys(this.joinRooms).forEach((i=>{const n=this.joinRooms[i],r={ephemeral:{events:[]},account_data:{events:[]},state:{events:[]},timeline:{events:[],prev_batch:null},unread_notifications:n._unreadNotifications,summary:n._summary};Object.keys(n._accountData).forEach((e=>{r.account_data.events.push(n._accountData[e])}));const s={type:"m.receipt",room_id:i,content:{}};Object.keys(n._readReceipts).forEach((e=>{const t=n._readReceipts[e];s.content[t.eventId]||(s.content[t.eventId]={"m.read":{}}),s.content[t.eventId]["m.read"][e]=t.data})),Object.keys(s.content).length>0&&r.ephemeral.events.push(s),n._timeline.forEach((t=>{if(!r.timeline.prev_batch){if(!t.token)return;r.timeline.prev_batch=t.token}let i;!e&&t.event._localTs?(i=Object.assign({},t.event),void 0!==i.unsigned&&(i.unsigned=Object.assign({},i.unsigned)),delete i._localTs,i.unsigned=i.unsigned||{},i.unsigned.age=Date.now()-t.event._localTs):i=t.event,r.timeline.events.push(i)}));const a=Object.create(null);for(let e=r.timeline.events.length-1;e>=0;e--){const t=r.timeline.events[e];if(null===t.state_key||void 0===t.state_key)continue;const i=(0,o.deepCopy)(t);i.unsigned&&(i.unsigned.prev_content&&(i.content=i.unsigned.prev_content),i.unsigned.prev_sender&&(i.sender=i.unsigned.prev_sender)),c(a,i)}Object.keys(n._currentState).forEach((e=>{Object.keys(n._currentState[e]).forEach((t=>{let i=n._currentState[e][t];a[e]&&a[e][t]&&(i=a[e][t]),r.state.events.push(i)}))})),t.join[i]=r}));const i=[];return Object.keys(this.accountData).forEach((e=>{i.push(this.accountData[e])})),{nextBatch:this.nextBatch,roomsData:t,groupsData:this.groups,accountData:i}}getNextBatchToken(){return this.nextBatch}}},9180:(e,t)=>{"use strict";let i;Object.defineProperty(t,"__esModule",{value:!0}),t.SyncState=void 0,t.SyncState=i,function(e){e.Error="ERROR",e.Prepared="PREPARED",e.Stopped="STOPPED",e.Syncing="SYNCING",e.Catchup="CATCHUP",e.Reconnecting="RECONNECTING"}(i||(t.SyncState=i={}))},4551:(e,t,i)=>{"use strict";var n=i(862),r=i(5318);Object.defineProperty(t,"__esModule",{value:!0}),t.SyncApi=void 0;var s=r(i(9713)),o=i(3998),a=i(7366),c=i(142),l=n(i(3102)),h=i(7906),u=i(8910),d=i(1707),p=i(7434),g=i(9489),f=i(2168),m=i(9180),v=i(2741);function y(e,t){return"FILTER_SYNC_"+e+(t?"_"+t:"")}function _(...e){p.logger.log(...e)}function S(e,t){const i=new o.User(t);return e.reEmitter.reEmit(i,["User.avatarUrl","User.displayName","User.presence","User.currentlyActive","User.lastPresenceTs"]),i}t.SyncApi=class{constructor(e,t={}){var i;this.client=e,this.opts=t,(0,s.default)(this,"_peekRoom",null),(0,s.default)(this,"currentSyncRequest",null),(0,s.default)(this,"syncState",null),(0,s.default)(this,"syncStateData",null),(0,s.default)(this,"catchingUp",!1),(0,s.default)(this,"running",!1),(0,s.default)(this,"keepAliveTimer",null),(0,s.default)(this,"connectionReturnedDefer",null),(0,s.default)(this,"notifEvents",[]),(0,s.default)(this,"failedSyncCount",0),(0,s.default)(this,"storeIsInvalid",!1),(0,s.default)(this,"onOnline",(()=>{_("Browser thinks we are back online"),this.startKeepAlives(0)})),this.opts.initialSyncLimit=null!==(i=this.opts.initialSyncLimit)&&void 0!==i?i:8,this.opts.resolveInvitesToProfiles=this.opts.resolveInvitesToProfiles||!1,this.opts.pollTimeout=this.opts.pollTimeout||3e4,this.opts.pendingEventOrdering=this.opts.pendingEventOrdering||f.PendingEventOrdering.Chronological,t.canResetEntireTimeline||(t.canResetEntireTimeline=e=>!1),e.getNotifTimelineSet()&&e.reEmitter.reEmit(e.getNotifTimelineSet(),["Room.timeline","Room.timelineReset"])}createRoom(e){const t=this.client,{timelineSupport:i,unstableClientRelationAggregation:n}=t,r=new a.Room(e,t,t.getUserId(),{lazyLoadMembers:this.opts.lazyLoadMembers,pendingEventOrdering:this.opts.pendingEventOrdering,timelineSupport:i,unstableClientRelationAggregation:n});return t.reEmitter.reEmit(r,["Room.name","Room.timeline","Room.redaction","Room.redactionCancelled","Room.receipt","Room.tags","Room.timelineReset","Room.localEchoUpdated","Room.accountData","Room.myMembership","Room.replaceEvent"]),this.registerStateListeners(r),r}createGroup(e){const t=this.client,i=new c.Group(e);return t.reEmitter.reEmit(i,["Group.profile","Group.myMembership"]),t.store.storeGroup(i),i}registerStateListeners(e){const t=this.client;t.reEmitter.reEmit(e.currentState,["RoomState.events","RoomState.members","RoomState.newMember"]),e.currentState.on("RoomState.newMember",(function(e,i,n){n.user=t.getUser(n.userId),t.reEmitter.reEmit(n,["RoomMember.name","RoomMember.typing","RoomMember.powerLevel","RoomMember.membership"])}))}deregisterStateListeners(e){e.currentState.removeAllListeners("RoomState.events"),e.currentState.removeAllListeners("RoomState.members"),e.currentState.removeAllListeners("RoomState.newMember")}syncLeftRooms(){const e=this.client,t=new h.Filter(this.client.credentials.userId);t.setTimelineLimit(1),t.setIncludeLeaveRooms(!0);const i=this.opts.pollTimeout+8e4,n={timeout:0};return e.getOrCreateFilter(y(e.credentials.userId,"LEFT_ROOMS"),t).then((function(t){return n.filter=t,e.http.authedRequest(void 0,"GET","/sync",n,void 0,i)})).then((t=>{let i=[];t.rooms&&t.rooms.leave&&(i=this.mapSyncResponseToRoomArray(t.rooms.leave));const n=[];return i.forEach((t=>{const i=t.room;if(n.push(i),!t.isBrandNewRoom)return;t.timeline=t.timeline||{};const r=this.mapSyncEventsFormat(t.timeline,i),s=this.mapSyncEventsFormat(t.state,i);i.getLiveTimeline().setPaginationToken(t.timeline.prev_batch,u.EventTimeline.BACKWARDS),this.processRoomEvents(i,s,r),i.recalculate(),e.store.storeRoom(i),e.emit("Room",i),this.processEventsForNotifs(i,r)})),n}))}peek(e){if(this._peekRoom&&this._peekRoom.roomId===e)return Promise.resolve(this._peekRoom);const t=this.client;return this._peekRoom=this.createRoom(e),this.client.roomInitialSync(e,20).then((e=>{e.messages=e.messages||{},e.messages.chunk=e.messages.chunk||[],e.state=e.state||[];const i=l.deepCopy(e.state).map(t.getEventMapper()),n=e.state.map(t.getEventMapper()),r=e.messages.chunk.map(t.getEventMapper());return e.presence&&Array.isArray(e.presence)&&e.presence.map(t.getEventMapper()).forEach((function(e){let i=t.store.getUser(e.getContent().user_id);i?i.setPresenceEvent(e):(i=S(t,e.getContent().user_id),i.setPresenceEvent(e),t.store.storeUser(i)),t.emit("event",e)})),e.messages.start&&(this._peekRoom.oldState.paginationToken=e.messages.start),this._peekRoom.oldState.setStateEvents(i),this._peekRoom.currentState.setStateEvents(n),this.resolveInvites(this._peekRoom),this._peekRoom.recalculate(),this._peekRoom.addEventsToTimeline(r.reverse(),!0,this._peekRoom.getLiveTimeline(),e.messages.start),t.store.storeRoom(this._peekRoom),t.emit("Room",this._peekRoom),this.peekPoll(this._peekRoom),this._peekRoom}))}stopPeeking(){this._peekRoom=null}peekPoll(e,t){this._peekRoom===e?this.client.http.authedRequest(void 0,"GET","/events",{room_id:e.roomId,timeout:3e4,from:t},void 0,5e4).then((t=>{if(this._peekRoom!==e)return void _("Stopped peeking in room %s",e.roomId);t.chunk.filter((function(e){return"m.presence"===e.type})).map(this.client.getEventMapper()).forEach((e=>{let t=this.client.store.getUser(e.getContent().user_id);t?t.setPresenceEvent(e):(t=S(this.client,e.getContent().user_id),t.setPresenceEvent(e),this.client.store.storeUser(t)),this.client.emit("event",e)}));const i=t.chunk.filter((function(t){return t.room_id===e.roomId&&t.event_id})).map(this.client.getEventMapper());e.addLiveEvents(i),this.peekPoll(e,t.end)}),(i=>{p.logger.error("[%s] Peek poll failed: %s",e.roomId,i),setTimeout((()=>{this.peekPoll(e,t)}),3e4)})):_("Stopped peeking in room %s",e.roomId)}getSyncState(){return this.syncState}getSyncStateData(){return this.syncStateData}async recoverFromSyncStartupError(e,t){await e;const i=this.startKeepAlives();this.updateSyncState(m.SyncState.Error,{error:t}),await i}async wasLazyLoadingToggled(e=!1){let t=!1;if(!await this.client.store.isNewlyCreated()){const i=await this.client.store.getClientOptions();return i&&(t=!!i.lazyLoadMembers),t!==e}return!1}shouldAbortSync(e){return"M_UNKNOWN_TOKEN"===e.errcode&&(p.logger.warn("Token no longer valid - assuming logout"),this.stop(),!0)}sync(){const e=this.client;this.running=!0,i.g.window&&i.g.window.addEventListener&&i.g.window.addEventListener("online",this.onOnline,!1);let t=Promise.resolve(),n=null;const r=async()=>{try{_("Getting push rules...");const t=await e.getPushRules();_("Got push rules"),e.pushRules=t}catch(e){if(p.logger.error("Getting push rules failed",e),this.shouldAbortSync(e))return;return _("Waiting for saved sync before retrying push rules..."),await this.recoverFromSyncStartupError(t,e),void r()}o()},s=()=>{const t=new h.Filter(e.credentials.userId);return t.setTimelineLimit(this.opts.initialSyncLimit),t},o=async()=>{if(_("Checking lazy load status..."),this.opts.lazyLoadMembers&&e.isGuest()&&(this.opts.lazyLoadMembers=!1),this.opts.lazyLoadMembers&&(_("Checking server lazy load support..."),await e.doesServerSupportLazyLoading()?(_("Enabling lazy load on sync filter..."),this.opts.filter||(this.opts.filter=s()),this.opts.filter.setLazyLoadMembers(!0)):(_("LL: lazy loading requested but not supported by server, so disabling"),this.opts.lazyLoadMembers=!1)),_("Checking whether lazy loading has changed in store..."),await this.wasLazyLoadingToggled(this.opts.lazyLoadMembers)){this.storeIsInvalid=!0;const e=g.InvalidStoreError.TOGGLED_LAZY_LOADING,t=new g.InvalidStoreError(e,!!this.opts.lazyLoadMembers);return this.updateSyncState(m.SyncState.Error,{error:t}),void p.logger.warn("InvalidStoreError: store is not usable: stopping sync.")}this.opts.lazyLoadMembers&&this.opts.crypto&&this.opts.crypto.enableLazyLoading();try{_("Storing client options..."),await this.client.storeClientOptions(),_("Stored client options")}catch(e){throw p.logger.error("Storing client options failed",e),e}a()},a=async()=>{let i,r;_("Getting filter..."),i=this.opts.filter?this.opts.filter:s();try{r=await e.getOrCreateFilter(y(e.credentials.userId),i)}catch(e){if(p.logger.error("Getting filter failed",e),this.shouldAbortSync(e))return;return _("Waiting for saved sync before retrying filter..."),await this.recoverFromSyncStartupError(t,e),void a()}e.resetNotifTimelineSet(),null===this.currentSyncRequest&&(_("Sending first sync request..."),this.currentSyncRequest=this.doSyncRequest({filterId:r},n)),_("Waiting for saved sync before starting sync processing..."),await t,this._sync({filterId:r})};e.isGuest()?this._sync({}):(_("Getting saved sync token..."),t=e.store.getSavedSyncToken().then((t=>(_("Got saved sync token"),n=t,_("Getting saved sync..."),e.store.getSavedSync()))).then((e=>{if(_(`Got reply from saved sync, exists? ${!!e}`),e)return this.syncFromCache(e)})).catch((e=>{p.logger.error("Getting saved sync failed",e)})),r())}stop(){_("SyncApi.stop"),i.g.window&&i.g.window.removeEventListener("online",this.onOnline,!1),this.running=!1,this.currentSyncRequest&&this.currentSyncRequest.abort(),this.keepAliveTimer&&(clearTimeout(this.keepAliveTimer),this.keepAliveTimer=null)}retryImmediately(){return!!this.connectionReturnedDefer&&(this.startKeepAlives(0),!0)}async syncFromCache(e){_("sync(): not doing HTTP hit, instead returning stored /sync data");const t=e.nextBatch;this.client.store.setSyncToken(t);const i={oldSyncToken:null,nextSyncToken:t,catchingUp:!1,fromCache:!0},n={next_batch:t,rooms:e.roomsData,groups:e.groupsData,account_data:{events:e.accountData}};try{await this.processSyncResponse(i,n)}catch(e){p.logger.error("Error processing cached sync",e.stack||e)}this.storeIsInvalid||this.updateSyncState(m.SyncState.Prepared,i)}async _sync(e){const t=this.client;if(!this.running)return _("Sync no longer running: exiting."),this.connectionReturnedDefer&&(this.connectionReturnedDefer.reject(),this.connectionReturnedDefer=null),void this.updateSyncState(m.SyncState.Stopped);const i=t.store.getSyncToken();let n;try{null===this.currentSyncRequest&&(this.currentSyncRequest=this.doSyncRequest(e,i)),n=await this.currentSyncRequest}catch(t){return void this.onSyncError(t,e)}finally{this.currentSyncRequest=null}t.store.setSyncToken(n.next_batch),this.failedSyncCount=0,await t.store.setSyncData(n);const r={oldSyncToken:i,nextSyncToken:n.next_batch,catchingUp:this.catchingUp};this.opts.crypto&&await this.opts.crypto.onSyncWillProcess(r);try{await this.processSyncResponse(r,n)}catch(e){p.logger.error("Caught /sync error",e.stack||e),this.client.emit("sync.unexpectedError",e)}r.catchingUp=this.catchingUp,e.hasSyncedBefore||(this.updateSyncState(m.SyncState.Prepared,r),e.hasSyncedBefore=!0),this.opts.crypto&&await this.opts.crypto.onSyncCompleted(r),this.updateSyncState(m.SyncState.Syncing,r),t.store.wantsSave()&&(this.opts.crypto&&await this.opts.crypto.saveDeviceList(0),t.store.save()),this._sync(e)}doSyncRequest(e,t){const i=this.getSyncParams(e,t);return this.client.http.authedRequest(void 0,"GET","/sync",i,void 0,i.timeout+8e4)}getSyncParams(e,t){let i=this.opts.pollTimeout;("SYNCING"!==this.getSyncState()||this.catchingUp)&&(this.catchingUp=!0,i=0);let n=e.filterId;this.client.isGuest()&&!n&&(n=this.getGuestFilter());const r={filter:n,timeout:i};return this.opts.disablePresence&&(r.set_presence="offline"),t?r.since=t:r._cacheBuster=Date.now(),"ERROR"!=this.getSyncState()&&"RECONNECTING"!=this.getSyncState()||(r.timeout=0),r}onSyncError(e,t){if(!this.running)return _("Sync no longer running: exiting"),this.connectionReturnedDefer&&(this.connectionReturnedDefer.reject(),this.connectionReturnedDefer=null),void this.updateSyncState(m.SyncState.Stopped);p.logger.error("/sync error %s",e),p.logger.error(e),this.shouldAbortSync(e)||(this.failedSyncCount++,p.logger.log("Number of consecutive failed sync requests:",this.failedSyncCount),_("Starting keep-alive"),this.startKeepAlives().then((e=>{e&&this.getSyncState()===m.SyncState.Error&&this.updateSyncState(m.SyncState.Catchup,{oldSyncToken:null,nextSyncToken:null,catchingUp:!0}),this._sync(t)})),this.currentSyncRequest=null,this.updateSyncState(this.failedSyncCount>=3?m.SyncState.Error:m.SyncState.Reconnecting,{error:e}))}async processSyncResponse(e,t){const i=this.client;if(t.presence&&Array.isArray(t.presence.events)&&t.presence.events.map(i.getEventMapper()).forEach((function(e){let t=i.store.getUser(e.getSender());t?t.setPresenceEvent(e):(t=S(i,e.getSender()),t.setPresenceEvent(e),i.store.storeUser(t)),i.emit("event",e)})),t.account_data&&Array.isArray(t.account_data.events)){const e=t.account_data.events.map(i.getEventMapper()),n=e.reduce(((e,t)=>(e[t.getId()]=i.store.getAccountData(t.getType()),e)),{});i.store.storeAccountDataEvents(e),e.forEach((function(e){if("m.push_rules"===e.getType()){const t=e.getContent();i.pushRules=d.PushProcessor.rewriteDefaultRules(t)}const t=n[e.getId()];return i.emit("accountData",e,t),e}))}if(t.to_device&&Array.isArray(t.to_device.events)&&t.to_device.events.length>0){const e=[];t.to_device.events.map(i.getEventMapper()).map((t=>{if("m.key.verification.cancel"===t.getType()){const i=t.getContent().transaction_id;i&&e.push(i)}return t})).forEach((function(t){const n=t.getContent();if("m.room.message"!=t.getType()||"m.bad.encrypted"!=n.msgtype){if("m.key.verification.start"===t.getType()||"m.key.verification.request"===t.getType()){const i=n.transaction_id;e.includes(i)&&t.flagCancelled()}i.emit("toDeviceEvent",t)}else p.logger.log("Ignoring undecryptable to-device event from "+t.getSender())}))}else this.catchingUp=!1;t.groups&&(t.groups.invite&&this.processGroupSyncEntry(t.groups.invite,v.Category.Invite),t.groups.join&&this.processGroupSyncEntry(t.groups.join,v.Category.Join),t.groups.leave&&this.processGroupSyncEntry(t.groups.leave,v.Category.Leave));let n=[],r=[],s=[];if(t.rooms&&(t.rooms.invite&&(n=this.mapSyncResponseToRoomArray(t.rooms.invite)),t.rooms.join&&(r=this.mapSyncResponseToRoomArray(t.rooms.join)),t.rooms.leave&&(s=this.mapSyncResponseToRoomArray(t.rooms.leave))),this.notifEvents=[],n.forEach((e=>{const t=e.room,n=this.mapSyncEventsFormat(e.invite_state,t);this.processRoomEvents(t,n),e.isBrandNewRoom&&(t.recalculate(),i.store.storeRoom(t),i.emit("Room",t)),n.forEach((function(e){i.emit("event",e)})),t.updateMyMembership("invite")})),await l.promiseMapSeries(r,(async t=>{const n=t.room,r=this.mapSyncEventsFormat(t.state,n),s=this.mapSyncEventsFormat(t.timeline,n,!1),o=this.mapSyncEventsFormat(t.ephemeral),c=this.mapSyncEventsFormat(t.account_data),h=i.isRoomEncrypted(n.roomId);if(t.unread_notifications&&(n.setUnreadNotificationCount(a.NotificationCountType.Total,t.unread_notifications.notification_count),(!h||h&&n.getUnreadNotificationCount(a.NotificationCountType.Highlight)<=0)&&n.setUnreadNotificationCount(a.NotificationCountType.Highlight,t.unread_notifications.highlight_count)),t.timeline=t.timeline||{},t.isBrandNewRoom)n.getLiveTimeline().setPaginationToken(t.timeline.prev_batch,u.EventTimeline.BACKWARDS);else if(t.timeline.limited){let r=!0;for(let e=s.length-1;e>=0;e--){const t=s[e].getId();if(n.getTimelineForEvent(t)){_("Already have event "+t+" in limited sync - not resetting"),r=!1,s.splice(0,e);break}}r&&(this.deregisterStateListeners(n),n.resetLiveTimeline(t.timeline.prev_batch,this.opts.canResetEntireTimeline(n.roomId)?null:e.oldSyncToken),i.resetNotifTimelineSet(),this.registerStateListeners(n))}this.processRoomEvents(n,r,s,e.fromCache),t.summary&&n.setSummary(t.summary),n.addEphemeralEvents(o),n.addAccountData(c),n.recalculate(),t.isBrandNewRoom&&(i.store.storeRoom(n),i.emit("Room",n)),this.processEventsForNotifs(n,s);const d=async e=>{if(i.emit("event",e),e.isState()&&"m.room.encryption"==e.getType()&&this.opts.crypto&&await this.opts.crypto.onCryptoEvent(e),e.isState()&&"im.vector.user_status"===e.getType()){let t=i.store.getUser(e.getStateKey());t?t.unstable_updateStatusMessage(e):(t=S(i,e.getStateKey()),t.unstable_updateStatusMessage(e),i.store.storeUser(t))}};await l.promiseMapSeries(r,d),await l.promiseMapSeries(s,d),o.forEach((function(e){i.emit("event",e)})),c.forEach((function(e){i.emit("event",e)})),n.updateMyMembership("join"),n.decryptCriticalEvents()})),s.forEach((e=>{const t=e.room,n=this.mapSyncEventsFormat(e.state,t),r=this.mapSyncEventsFormat(e.timeline,t),s=this.mapSyncEventsFormat(e.account_data);this.processRoomEvents(t,n,r),t.addAccountData(s),t.recalculate(),e.isBrandNewRoom&&(i.store.storeRoom(t),i.emit("Room",t)),this.processEventsForNotifs(t,r),n.forEach((function(e){i.emit("event",e)})),r.forEach((function(e){i.emit("event",e)})),s.forEach((function(e){i.emit("event",e)})),t.updateMyMembership("leave")})),e.oldSyncToken&&this.notifEvents.length&&(this.notifEvents.sort((function(e,t){return e.getTs()-t.getTs()})),this.notifEvents.forEach((function(e){i.getNotifTimelineSet().addLiveEvent(e)}))),t.device_lists&&this.opts.crypto&&await this.opts.crypto.handleDeviceListChanges(e,t.device_lists),this.opts.crypto&&t.device_one_time_keys_count){const e=t.device_one_time_keys_count.signed_curve25519||0;this.opts.crypto.updateOneTimeKeyCount(e)}if(this.opts.crypto&&t["org.matrix.msc2732.device_unused_fallback_key_types"]){const e=t["org.matrix.msc2732.device_unused_fallback_key_types"];this.opts.crypto.setNeedsNewFallback(e instanceof Array&&!e.includes("signed_curve25519"))}}startKeepAlives(e){return void 0===e&&(e=2e3+Math.floor(5e3*Math.random())),null!==this.keepAliveTimer&&clearTimeout(this.keepAliveTimer),e>0?this.keepAliveTimer=setTimeout(this.pokeKeepAlive.bind(this),e):this.pokeKeepAlive(),this.connectionReturnedDefer||(this.connectionReturnedDefer=l.defer()),this.connectionReturnedDefer.promise}pokeKeepAlive(e=!1){const t=()=>{clearTimeout(this.keepAliveTimer),this.connectionReturnedDefer&&(this.connectionReturnedDefer.resolve(e),this.connectionReturnedDefer=null)};this.client.http.request(void 0,"GET","/_matrix/client/versions",void 0,void 0,{prefix:"",localTimeoutMs:15e3}).then((()=>{t()}),(i=>{400==i.httpStatus||404==i.httpStatus?this.keepAliveTimer=setTimeout(t,2e3):(e=!0,this.keepAliveTimer=setTimeout(this.pokeKeepAlive.bind(this,e),5e3+Math.floor(5e3*Math.random())),this.updateSyncState(m.SyncState.Error,{error:i}))}))}processGroupSyncEntry(e,t){for(const i of Object.keys(e)){const n=e[i];let r=this.client.store.getGroup(i);const s=null===r;null===r&&(r=this.createGroup(i)),n.profile&&r.setProfile(n.profile.name,n.profile.avatar_url),n.inviter&&r.setInviter({userId:n.inviter}),r.setMyMembership(t),s&&this.client.emit("Group",r)}}mapSyncResponseToRoomArray(e){const t=this.client;return Object.keys(e).map((i=>{const n=e[i];let r=t.store.getRoom(i),s=!1;return r||(r=this.createRoom(i),s=!0),n.room=r,n.isBrandNewRoom=s,n}))}mapSyncEventsFormat(e,t,i=!0){if(!e||!Array.isArray(e.events))return[];const n=this.client.getEventMapper({decrypt:i});return e.events.map((function(e){return t&&(e.room_id=t.roomId),n(e)}))}resolveInvites(e){if(!e||!this.opts.resolveInvitesToProfiles)return;const t=this.client;e.getMembersWithMembership("invite").forEach((function(i){if(i._requestedProfileInfo)return;i._requestedProfileInfo=!0;const n=t.getUser(i.userId);let r;r=n?Promise.resolve({avatar_url:n.avatarUrl,displayname:n.displayName}):t.getProfileInfo(i.userId),r.then((function(t){const n=i.events.member;"invite"===n.getContent().membership&&(n.getContent().avatar_url=t.avatar_url,n.getContent().displayname=t.displayname,i.setMembershipEvent(n,e.currentState))}),(function(e){}))}))}processRoomEvents(e,t,i,n=!1){const r=e.getLiveTimeline(),s=0==r.getEvents().length;if(s){for(const e of t)this.client.getPushActionsForEvent(e);r.initialiseState(t)}this.resolveInvites(e),e.recalculate(),s||(e.oldState.setStateEvents(t||[]),e.currentState.setStateEvents(t||[])),e.addLiveEvents(i||[],null,n)}processEventsForNotifs(e,t){if(this.client.getNotifTimelineSet())for(let e=0;e<t.length;e++){const i=this.client.getPushActionsForEvent(t[e]);i&&i.notify&&i.tweaks&&i.tweaks.highlight&&this.notifEvents.push(t[e])}}getGuestFilter(){return"{}"}updateSyncState(e,t){const i=this.syncState;this.syncState=e,this.syncStateData=t,this.client.emit("sync",this.syncState,i,t)}}},4969:(e,t,i)=>{"use strict";var n=i(5318);Object.defineProperty(t,"__esModule",{value:!0}),t.TimelineIndex=t.TimelineWindow=void 0;var r=n(i(9713)),s=i(8910);i(7434);t.TimelineWindow=class{constructor(e,t,i={}){this.client=e,this.timelineSet=t,(0,r.default)(this,"windowLimit",void 0),(0,r.default)(this,"start",null),(0,r.default)(this,"end",null),(0,r.default)(this,"eventCount",0),this.windowLimit=i.windowLimit||1e3}load(e,t=20){const i=i=>{let n;const r=i.getEvents();if(e){for(let t=0;t<r.length;t++)if(r[t].getId()==e){n=t;break}if(void 0===n)throw new Error("getEventTimeline result didn't include requested event")}else n=r.length;const s=Math.min(r.length,n+Math.ceil(t/2)),a=Math.max(0,s-t);this.start=new o(i,a-i.getBaseIndex()),this.end=new o(i,s-i.getBaseIndex()),this.eventCount=s-a};if(e){const t=this.timelineSet.getTimelineForEvent(e);return t?(i(t),Promise.resolve(t)):this.client.getEventTimeline(this.timelineSet,e).then(i)}return i(this.timelineSet.getLiveTimeline()),Promise.resolve()}getTimelineIndex(e){if(e==s.EventTimeline.BACKWARDS)return this.start;if(e==s.EventTimeline.FORWARDS)return this.end;throw new Error("Invalid direction '"+e+"'")}extend(e,t){const i=this.getTimelineIndex(e);if(!i)return!1;const n=e==s.EventTimeline.BACKWARDS?i.retreat(t):i.advance(t);if(n){this.eventCount+=n,this.eventCount;const t=this.eventCount-this.windowLimit;return t>0&&this.unpaginate(t,e!=s.EventTimeline.BACKWARDS),!0}return!1}canPaginate(e){const t=this.getTimelineIndex(e);if(!t)return!1;if(e==s.EventTimeline.BACKWARDS){if(t.index>t.minIndex())return!0}else if(t.index<t.maxIndex())return!0;return Boolean(t.timeline.getNeighbouringTimeline(e)||t.timeline.getPaginationToken(e))}paginate(e,t,i=!0,n=5){const r=this.getTimelineIndex(e);if(!r)return Promise.resolve(!1);if(r.pendingPaginate)return r.pendingPaginate;if(this.extend(e,t))return Promise.resolve(!0);if(!i||0===n)return Promise.resolve(!1);if(!r.timeline.getPaginationToken(e))return Promise.resolve(!1);const o=this.client.paginateEventTimeline(r.timeline,{backwards:e==s.EventTimeline.BACKWARDS,limit:t}).finally((function(){r.pendingPaginate=null})).then((i=>!!i&&this.paginate(e,t,!0,n-1)));return r.pendingPaginate=o,o}unpaginate(e,t){const i=t?this.start:this.end;if(e>this.eventCount||e<0)throw new Error("Attemting to unpaginate "+e+" events, but only have "+this.eventCount+" in the timeline");for(;e>0;){const n=t?i.advance(e):i.retreat(e);if(n<=0)throw new Error("Unable to unpaginate any further, but still have "+this.eventCount+" events");e-=n,this.eventCount-=n,this.eventCount}}getEvents(){if(!this.start)return[];const e=[];let t=this.start.timeline;for(;;){const i=t.getEvents();let n=0,r=i.length;t===this.start.timeline&&(n=this.start.index+t.getBaseIndex()),t===this.end.timeline&&(r=this.end.index+t.getBaseIndex());for(let t=n;t<r;t++)e.push(i[t]);if(t===this.end.timeline)break;t=t.getNeighbouringTimeline(s.EventTimeline.FORWARDS)}return e}};class o{constructor(e,t){this.timeline=e,this.index=t,(0,r.default)(this,"pendingPaginate",void 0)}minIndex(){return-1*this.timeline.getBaseIndex()}maxIndex(){return this.timeline.getEvents().length-this.timeline.getBaseIndex()}advance(e){if(!e)return 0;let t;if(e<0){if(t=Math.max(e,this.minIndex()-this.index),t<0)return this.index+=t,t}else if(t=Math.min(e,this.maxIndex()-this.index),t>0)return this.index+=t,t;const i=this.timeline.getNeighbouringTimeline(e<0?s.EventTimeline.BACKWARDS:s.EventTimeline.FORWARDS);return i?(this.timeline=i,this.index=e<0?this.maxIndex():this.minIndex(),this.advance(e)):0}retreat(e){return-1*this.advance(-1*e)}}t.TimelineIndex=o},3102:(e,t,i)=>{"use strict";var n=i(5318);Object.defineProperty(t,"__esModule",{value:!0}),t.encodeParams=function(e){let t="";for(const i in e)e.hasOwnProperty(i)&&(t+="&"+encodeURIComponent(i)+"="+encodeURIComponent(e[i]));return t.substring(1)},t.encodeUri=function(e,t){for(const i in t)t.hasOwnProperty(i)&&(e=e.replace(i,encodeURIComponent(t[i])));return e},t.removeElement=function(e,t,i){let n,r;if(i){for(n=e.length-1;n>=0;n--)if(t(e[n],n,e))return r=e[n],e.splice(n,1),r}else for(n=0;n<e.length;n++)if(t(e[n],n,e))return r=e[n],e.splice(n,1),r;return!1},t.isFunction=function(e){return"[object Function]"===Object.prototype.toString.call(e)},t.checkObjectHasKeys=function(e,t){for(let i=0;i<t.length;i++)if(!e.hasOwnProperty(t[i]))throw new Error("Missing required key: "+t[i])},t.checkObjectHasNoAdditionalKeys=function(e,t){for(const i in e)if(e.hasOwnProperty(i)&&-1===t.indexOf(i))throw new Error("Unknown key: "+i)},t.deepCopy=function(e){return JSON.parse(JSON.stringify(e))},t.deepCompare=function e(t,i){if(t===i)return!0;if(typeof t!=typeof i)return!1;if("number"==typeof t&&isNaN(t)&&isNaN(i))return!0;if(null===t||null===i)return t===i;if(!(t instanceof Object))return!1;if(t.constructor!==i.constructor||t.prototype!==i.prototype)return!1;if(t instanceof RegExp||t instanceof Date)return t.toString()===i.toString();if(t instanceof Array){if(t.length!==i.length)return!1;for(let n=0;n<t.length;n++)if(!e(t[n],i[n]))return!1}else{let n;for(n in i)if(i.hasOwnProperty(n)!==t.hasOwnProperty(n))return!1;for(n in i){if(i.hasOwnProperty(n)!==t.hasOwnProperty(n))return!1;if(!e(t[n],i[n]))return!1}}return!0},t.deepSortedObjectEntries=function e(t){if("object"!=typeof t)return t;if(null==t||Array.isArray(t))return t;const i=[];for(const[n,r]of Object.entries(t))i.push([n,e(r)]);return i.sort(((e,t)=>g(e[0],t[0]))),i},t.extend=function(...e){const t=e[0]||{};for(let i=1;i<e.length;i++){const n=e[i];if(n)for(const e in n)t[e]=n[e]}return t},t.inherits=function(e,t){e.super_=t,e.prototype=Object.create(t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}})},t.polyfillSuper=function(e,t,...i){try{t.call(e,...i)}catch(n){const r=new t(...i);Object.assign(e,r)}},t.isNumber=function(e){return"number"==typeof e&&isFinite(e)},t.removeHiddenChars=o,t.normalize=function(e){return o(e.toLowerCase()).replace(/[\\'!"#$%&()*+,\-./:;<=>?@[\]^_`{|}~\u2000-\u206f\u2e00-\u2e7f]/g,"").toLowerCase()},t.escapeRegExp=c,t.globToRegexp=function(e,t){t="boolean"!=typeof t||t;let i=c(e);return i=i.replace(/\\\*/g,".*"),i=i.replace(/\?/g,"."),t&&(i=i.replace(/\\\[(!|)(.*)\\]/g,(function(e,t,i,n,r){return"["+(t?"^":"")+i.replace(/\\-/,"-")+"]"}))),i},t.ensureNoTrailingSlash=function(e){return e&&e.endsWith("/")?e.substr(0,e.length-1):e},t.sleep=function(e,t){return new Promise((i=>{setTimeout(i,e,t)}))},t.isNullOrUndefined=function(e){return null==e},t.defer=function(){let e,t;const i=new Promise(((i,n)=>{e=i,t=n}));return{resolve:e,reject:t,promise:i}},t.promiseMapSeries=async function(e,t){for(const i of e)await t(await i)},t.promiseTry=function(e){return new Promise((t=>t(e())))},t.chunkPromises=async function(e,t){const i=[];for(let n=0;n<e.length;n+=t)i.push(...await Promise.all(e.slice(n,n+t).map((e=>e()))));return i},t.simpleRetryOperation=function(e){return(0,s.default)((t=>e(t)),{forever:!0,factor:2,minTimeout:3e3,maxTimeout:15e3})},t.setCrypto=function(e){l=e},t.getCrypto=function(){return l},t.alphabetPad=u,t.baseToString=d,t.stringToBase=p,t.averageBetweenStrings=function(e,t,i=h){const n=Math.max(e.length,t.length),r=p(u(e,n,i),i),s=p(u(t,n,i),i),o=(r+s)/BigInt(2);return o===r||o==s?d(o,i)+i[0]:d(o,i)},t.nextString=function(e,t=h){return d(p(e,t)+BigInt(1),t)},t.prevString=function(e,t=h){return d(p(e,t)-BigInt(1),t)},t.lexicographicCompare=g,t.DEFAULT_ALPHABET=void 0;var r=n(i(5067)),s=n(i(7433));function o(e){return"string"==typeof e?(0,r.default)(e.normalize("NFD").replace(a,"")):""}const a=/[\u2000-\u200F\u202A-\u202F\u0300-\u036f\uFEFF\s]/g;function c(e){return e.replace(/[.*+?^${}()|[\]\\]/g,"\\$&")}let l;const h=(()=>{let e="";for(let t=32;t<=126;t++)e+=String.fromCharCode(t);return e})();function u(e,t,i=h){return e.padEnd(t,i[0])}function d(e,t=h){const i=BigInt(t.length);var n;if(e<=i)return null!==(n=t[Number(e)-1])&&void 0!==n?n:"";let r=e/i,s=Number(e%i)-1;return s<0&&(r-=BigInt(Math.abs(s)),s=Number(i)-1),d(r,t)+t[s]}function p(e,t=h){const i=BigInt(t.length);let n=BigInt(0);for(let r=e.length-1,s=BigInt(0);r>=0;r--,s++){const o=e.charCodeAt(r)-t.charCodeAt(0);n+=BigInt(1+o)*i**s}return n}function g(e,t){return e<t?-1:e===t?0:1}t.DEFAULT_ALPHABET=h},9679:(e,t,i)=>{"use strict";var n=i(862),r=i(5318);Object.defineProperty(t,"__esModule",{value:!0}),t.getDesktopCapturerSources=function(){return window.electron.getDesktopCapturerSources({thumbnailSize:{height:176,width:312},types:["screen","window"]})},t.setAudioInput=function(e){k=e},t.setVideoInput=function(e){T=e},t.createNewMatrixCall=function(e,t,i){if("undefined"==typeof window||"undefined"==typeof document)return null;try{if(!Boolean(window.RTCPeerConnection||window.RTCSessionDescription||window.RTCIceCandidate||navigator.mediaDevices))return o.logger.error("WebRTC is not supported in this browser / environment"),null}catch(e){return o.logger.error("Exception thrown when trying to access WebRTC",e),null}const n=!!i&&i.forceTURN,r={client:e,roomId:t,turnServers:e.getTurnServers(),forceTURN:e.forceTURN||n},s=new w(r);return e.reEmitter.reEmit(s,Object.values(v)),s},t.MatrixCall=t.CallError=t.CallErrorCode=t.CallEvent=t.CallParty=t.CallDirection=t.CallType=t.CallState=void 0;var s=r(i(9713)),o=i(7434),a=i(7187),c=n(i(3102)),l=i(2481),h=i(8401),u=i(5964),d=i(9704);let p,g,f,m,v,y;var _;t.CallState=p,function(e){e.Fledgling="fledgling",e.InviteSent="invite_sent",e.WaitLocalMedia="wait_local_media",e.CreateOffer="create_offer",e.CreateAnswer="create_answer",e.Connecting="connecting",e.Connected="connected",e.Ringing="ringing",e.Ended="ended"}(p||(t.CallState=p={})),t.CallType=g,function(e){e.Voice="voice",e.Video="video"}(g||(t.CallType=g={})),t.CallDirection=f,function(e){e.Inbound="inbound",e.Outbound="outbound"}(f||(t.CallDirection=f={})),t.CallParty=m,function(e){e.Local="local",e.Remote="remote"}(m||(t.CallParty=m={})),t.CallEvent=v,function(e){e.Hangup="hangup",e.State="state",e.Error="error",e.Replaced="replaced",e.LocalHoldUnhold="local_hold_unhold",e.RemoteHoldUnhold="remote_hold_unhold",e.HoldUnhold="hold_unhold",e.FeedsChanged="feeds_changed",e.AssertedIdentityChanged="asserted_identity_changed"}(v||(t.CallEvent=v={})),t.CallErrorCode=y,function(e){e.UserHangup="user_hangup",e.LocalOfferFailed="local_offer_failed",e.NoUserMedia="no_user_media",e.UnknownDevices="unknown_devices",e.SendInvite="send_invite",e.CreateAnswer="create_answer",e.SendAnswer="send_answer",e.SetRemoteDescription="set_remote_description",e.SetLocalDescription="set_local_description",e.AnsweredElsewhere="answered_elsewhere",e.IceFailed="ice_failed",e.InviteTimeout="invite_timeout",e.Replaced="replaced",e.SignallingFailed="signalling_timeout",e.UserBusy="user_busy",e.Transfered="transferred"}(y||(t.CallErrorCode=y={})),function(e){e.Audio="audio",e.Video="video"}(_||(_={}));class S extends Error{constructor(e,t,i){super(t+": "+i),(0,s.default)(this,"code",void 0),this.code=e}}function b(){return Date.now().toString()+(0,h.randomString)(16)}t.CallError=S;class w extends a.EventEmitter{constructor(e){super(),(0,s.default)(this,"roomId",void 0),(0,s.default)(this,"type",void 0),(0,s.default)(this,"callId",void 0),(0,s.default)(this,"state",void 0),(0,s.default)(this,"hangupParty",void 0),(0,s.default)(this,"hangupReason",void 0),(0,s.default)(this,"direction",void 0),(0,s.default)(this,"ourPartyId",void 0),(0,s.default)(this,"client",void 0),(0,s.default)(this,"forceTURN",void 0),(0,s.default)(this,"turnServers",void 0),(0,s.default)(this,"candidateSendQueue",void 0),(0,s.default)(this,"candidateSendTries",void 0),(0,s.default)(this,"sentEndOfCandidates",void 0),(0,s.default)(this,"peerConn",void 0),(0,s.default)(this,"feeds",void 0),(0,s.default)(this,"screenSharingStream",void 0),(0,s.default)(this,"localAVStream",void 0),(0,s.default)(this,"inviteOrAnswerSent",void 0),(0,s.default)(this,"waitForLocalAVStream",void 0),(0,s.default)(this,"config",void 0),(0,s.default)(this,"successor",void 0),(0,s.default)(this,"opponentMember",void 0),(0,s.default)(this,"opponentVersion",void 0),(0,s.default)(this,"opponentPartyId",void 0),(0,s.default)(this,"opponentCaps",void 0),(0,s.default)(this,"inviteTimeout",void 0),(0,s.default)(this,"remoteOnHold",void 0),(0,s.default)(this,"micMuted",void 0),(0,s.default)(this,"vidMuted",void 0),(0,s.default)(this,"callStatsAtEnd",void 0),(0,s.default)(this,"makingOffer",void 0),(0,s.default)(this,"ignoreOffer",void 0),(0,s.default)(this,"remoteCandidateBuffer",new Map),(0,s.default)(this,"remoteAssertedIdentity",void 0),(0,s.default)(this,"gotUserMediaForInvite",(async e=>{if(this.successor)this.successor.gotUserMediaForAnswer(e);else if(this.callHasEnded())this.stopAllMedia();else{this.localAVStream=e,o.logger.info("Got local AV stream with id "+this.localAVStream.id),this.setState(p.CreateOffer),o.logger.debug("gotUserMediaForInvite -> "+this.type),this.screenSharingStream?(o.logger.debug("Setting screen sharing stream to the local video element"),this.pushNewFeed(this.screenSharingStream,this.client.getUserId(),u.SDPStreamMetadataPurpose.Screenshare)):this.pushNewFeed(e,this.client.getUserId(),u.SDPStreamMetadataPurpose.Usermedia),E(e.getAudioTracks(),!0);for(const t of e.getAudioTracks())o.logger.info("Adding audio track with id "+t.id),this.peerConn.addTrack(t,e);for(const t of(this.screenSharingStream||e).getVideoTracks())o.logger.info("Adding video track with id "+t.id),this.peerConn.addTrack(t,e)}})),(0,s.default)(this,"gotUserMediaForAnswer",(async e=>{if(this.callHasEnded())return;this.pushNewFeed(e,this.client.getUserId(),u.SDPStreamMetadataPurpose.Usermedia),this.localAVStream=e,o.logger.info("Got local AV stream with id "+this.localAVStream.id),E(e.getAudioTracks(),!0);for(const t of e.getTracks())this.peerConn.addTrack(t,e);let t;this.setState(p.CreateAnswer);try{t=await this.peerConn.createAnswer()}catch(e){return o.logger.debug("Failed to create answer: ",e),void this.terminate(m.Local,y.CreateAnswer,!0)}try{await this.peerConn.setLocalDescription(t),this.setState(p.Connecting),await new Promise((e=>{setTimeout(e,200)})),this.sendAnswer()}catch(e){return o.logger.debug("Error setting local description!",e),void this.terminate(m.Local,y.SetLocalDescription,!0)}})),(0,s.default)(this,"gotLocalIceCandidate",(e=>{if(e.candidate){if(o.logger.debug("Call "+this.callId+" got local ICE "+e.candidate.sdpMid+" candidate: "+e.candidate.candidate),this.callHasEnded())return;""===e.candidate.candidate&&this.sentEndOfCandidates||(this.queueCandidate(e.candidate),""===e.candidate.candidate&&(this.sentEndOfCandidates=!0))}})),(0,s.default)(this,"onIceGatheringStateChange",(e=>{if(o.logger.debug("ice gathering state changed to "+this.peerConn.iceGatheringState),"complete"===this.peerConn.iceGatheringState&&!this.sentEndOfCandidates){const e={candidate:""};this.queueCandidate(e),this.sentEndOfCandidates=!0}})),(0,s.default)(this,"gotLocalOffer",(async e=>{if(o.logger.debug("Created offer: ",e),this.callHasEnded())return void o.logger.debug("Ignoring newly created offer on call ID "+this.callId+" because the call has ended");try{await this.peerConn.setLocalDescription(e)}catch(e){return o.logger.debug("Error setting local description!",e),void this.terminate(m.Local,y.SetLocalDescription,!0)}if("gathering"===this.peerConn.iceGatheringState&&await new Promise((e=>{setTimeout(e,200)})),this.callHasEnded())return;const t=this.state===p.CreateOffer?l.EventType.CallInvite:l.EventType.CallNegotiate,i={lifetime:6e4};this.state===p.CreateOffer?i.offer=this.peerConn.localDescription:i.description=this.peerConn.localDescription,this.client.supportsCallTransfer&&(i.capabilities={"m.call.transferee":!0}),o.logger.info(`Discarding ${this.candidateSendQueue.length} candidates that will be sent in offer`),this.candidateSendQueue=[];try{await this.sendVoipEvent(t,i)}catch(e){o.logger.error("Failed to send invite",e),e.event&&this.client.cancelPendingEvent(e.event);let t=y.SignallingFailed,i="Signalling failed";return this.state===p.CreateOffer&&(t=y.SendInvite,i="Failed to send invite"),"UnknownDeviceError"==e.name&&(t=y.UnknownDevices,i="Unknown devices present in the room"),this.emit(v.Error,new S(t,i,e)),void this.terminate(m.Local,t,!1)}this.sendCandidateQueue(),this.state===p.CreateOffer&&(this.inviteOrAnswerSent=!0,this.setState(p.InviteSent),this.inviteTimeout=setTimeout((()=>{this.inviteTimeout=null,this.state===p.InviteSent&&this.hangup(y.InviteTimeout,!1)}),6e4))})),(0,s.default)(this,"getLocalOfferFailed",(e=>{o.logger.error("Failed to get local offer",e),this.emit(v.Error,new S(y.LocalOfferFailed,"Failed to get local offer!",e)),this.terminate(m.Local,y.LocalOfferFailed,!1)})),(0,s.default)(this,"getUserMediaFailed",(e=>{this.successor?this.successor.getUserMediaFailed(e):(o.logger.warn("Failed to get user media - ending call",e),this.emit(v.Error,new S(y.NoUserMedia,"Couldn't start capturing media! Is your microphone set up and does this app have permission?",e)),this.terminate(m.Local,y.NoUserMedia,!1))})),(0,s.default)(this,"onIceConnectionStateChanged",(()=>{this.callHasEnded()||(o.logger.debug("Call ID "+this.callId+": ICE connection state changed to: "+this.peerConn.iceConnectionState),"connected"==this.peerConn.iceConnectionState?this.setState(p.Connected):"failed"==this.peerConn.iceConnectionState&&this.hangup(y.IceFailed,!1))})),(0,s.default)(this,"onSignallingStateChanged",(()=>{o.logger.debug("call "+this.callId+": Signalling state changed to: "+this.peerConn.signalingState)})),(0,s.default)(this,"onTrack",(e=>{var t;if(0===e.streams.length)return void o.logger.warn(`Streamless ${e.track.kind} found: ignoring.`);const i=null===(t=this.feeds.find((e=>!e.isLocal())))||void 0===t?void 0:t.stream;if(i&&e.streams[0].id!==i.id)return void o.logger.warn(`Ignoring new stream ID ${e.streams[0].id}: we already have stream ID ${i.id}`);i||o.logger.info("Got remote stream with id "+e.streams[0].id);const n=e.streams[0];o.logger.debug(`Track id ${e.track.id} of kind ${e.track.kind} added`),this.pushNewFeed(n,this.getOpponentMember().userId,u.SDPStreamMetadataPurpose.Usermedia),o.logger.info("playing remote. stream active? "+n.active)})),(0,s.default)(this,"onNegotiationNeeded",(async()=>{if(o.logger.info("Negotation is needed!"),this.state===p.CreateOffer||0!==this.opponentVersion){this.makingOffer=!0;try{const e=await this.peerConn.createOffer();await this.gotLocalOffer(e)}catch(e){return void this.getLocalOfferFailed(e)}finally{this.makingOffer=!1}}else o.logger.info("Opponent does not support renegotiation: ignoring negotiationneeded event")})),(0,s.default)(this,"onHangupReceived",(e=>{o.logger.debug("Hangup received for call ID "+this.callId),this.partyIdMatches(e)||this.state===p.Ringing?this.terminate(m.Remote,e.reason||y.UserHangup,!0):o.logger.info(`Ignoring message from party ID ${e.party_id}: our partner is ${this.opponentPartyId}`)})),(0,s.default)(this,"onRejectReceived",(e=>{o.logger.debug("Reject received for call ID "+this.callId),[p.InviteSent,p.Ringing].includes(this.state)||this.state===p.Fledgling&&this.direction===f.Inbound?this.terminate(m.Remote,e.reason||y.UserHangup,!0):o.logger.debug(`Call is in state: ${this.state}: ignoring reject`)})),(0,s.default)(this,"onAnsweredElsewhere",(e=>{o.logger.debug("Call ID "+this.callId+" answered elsewhere"),this.terminate(m.Remote,y.AnsweredElsewhere,!0)})),this.roomId=e.roomId,this.client=e.client,this.type=null,this.forceTURN=e.forceTURN,this.ourPartyId=this.client.deviceId,this.turnServers=e.turnServers||[],0===this.turnServers.length&&this.client.isFallbackICEServerAllowed()&&this.turnServers.push({urls:["stun:turn.matrix.org"]});for(const e of this.turnServers)c.checkObjectHasKeys(e,["urls"]);this.callId=b(),this.state=p.Fledgling,this.candidateSendQueue=[],this.candidateSendTries=0,this.sentEndOfCandidates=!1,this.inviteOrAnswerSent=!1,this.makingOffer=!1,this.remoteOnHold=!1,this.micMuted=!1,this.vidMuted=!1,this.feeds=[]}async placeVoiceCall(){o.logger.debug("placeVoiceCall"),this.checkForErrorListener();const e=I(_.Audio);this.type=g.Voice,await this.placeCallWithConstraints(e)}async placeVideoCall(){o.logger.debug("placeVideoCall"),this.checkForErrorListener();const e=I(_.Video);this.type=g.Video,await this.placeCallWithConstraints(e)}async placeScreenSharingCall(e){o.logger.debug("placeScreenSharingCall"),this.checkForErrorListener();try{var t;const i=await async function(e){var t;if(null!==(t=window.electron)&&void 0!==t&&t.getDesktopCapturerSources&&e){o.logger.debug("Electron getDesktopCapturerSources() is available...");const t=await e();return t?{audio:!1,video:{mandatory:{chromeMediaSource:"desktop",chromeMediaSourceId:t.id}}}:null}return o.logger.debug("Electron desktopCapturer is not available..."),{audio:!1,video:!0}}(e);if(!i)return void this.terminate(m.Local,y.NoUserMedia,!1);null!==(t=window.electron)&&void 0!==t&&t.getDesktopCapturerSources?(o.logger.debug("Getting screen stream using getUserMedia()..."),this.screenSharingStream=await navigator.mediaDevices.getUserMedia(i)):(o.logger.debug("Getting screen stream using getDisplayMedia()..."),this.screenSharingStream=await navigator.mediaDevices.getDisplayMedia(i)),o.logger.debug("Got screen stream, requesting audio stream...");const n=I(_.Audio);this.placeCallWithConstraints(n)}catch(e){this.emit(v.Error,new S(y.NoUserMedia,"Failed to get screen-sharing stream: ",e)),this.terminate(m.Local,y.NoUserMedia,!1)}this.type=g.Video}getOpponentMember(){return this.opponentMember}opponentCanBeTransferred(){return Boolean(this.opponentCaps&&this.opponentCaps["m.call.transferee"])}getRemoteAssertedIdentity(){return this.remoteAssertedIdentity}getFeeds(){return this.feeds}getLocalFeeds(){return this.feeds.filter((e=>e.isLocal()))}getRemoteFeeds(){return this.feeds.filter((e=>!e.isLocal()))}noIncomingFeeds(){return!this.feeds.some((e=>!e.isLocal()))}pushNewFeed(e,t,i){const n=this.feeds.find((t=>t.stream.id===e.id));n?n.setNewStream(e):(this.feeds.push(new d.CallFeed(e,t,i,this.client,this.roomId)),this.emit(v.FeedsChanged,this.feeds))}deleteAllFeeds(){this.feeds=[],this.emit(v.FeedsChanged,this.feeds)}async getCurrentCallStats(){return this.callHasEnded()?this.callStatsAtEnd:this.collectCallStats()}async collectCallStats(){if(!this.peerConn)return;const e=await this.peerConn.getStats(),t=[];for(const i of e)t.push(i[1]);return t}async initWithInvite(e){var t;const i=e.getContent();this.direction=f.Inbound,await this.client.checkTurnServers()||o.logger.warn("Failed to get TURN credentials! Proceeding with call anyway..."),this.peerConn=this.createPeerConnection(),this.chooseOpponent(e);try{await this.peerConn.setRemoteDescription(i.offer),await this.addBufferedIceCandidates()}catch(e){return o.logger.debug("Failed to set remote description",e),void this.terminate(m.Local,y.SetRemoteDescription,!1)}const n=null===(t=this.feeds.find((e=>!e.isLocal())))||void 0===t?void 0:t.stream;if(!n||0===n.getTracks().length)return o.logger.error("No remote stream or no tracks after setting remote description!"),void this.terminate(m.Local,y.SetRemoteDescription,!1);this.type=n.getTracks().some((e=>"video"===e.kind))?g.Video:g.Voice,this.setState(p.Ringing),e.getLocalAge()&&setTimeout((()=>{this.state==p.Ringing&&(o.logger.debug("Call invite has expired. Hanging up."),this.hangupParty=m.Remote,this.setState(p.Ended),this.stopAllMedia(),"closed"!=this.peerConn.signalingState&&this.peerConn.close(),this.emit(v.Hangup))}),i.lifetime-e.getLocalAge())}initWithHangup(e){this.setState(p.Ended)}async answer(){if(!this.inviteOrAnswerSent)if(o.logger.debug(`Answering call ${this.callId} of type ${this.type}`),this.localAVStream||this.waitForLocalAVStream)this.localAVStream?this.gotUserMediaForAnswer(this.localAVStream):this.waitForLocalAVStream&&this.setState(p.WaitLocalMedia);else{const e=I(this.type==g.Video?_.Video:_.Audio);o.logger.log("Getting user media with constraints",e),this.setState(p.WaitLocalMedia),this.waitForLocalAVStream=!0;try{const t=await navigator.mediaDevices.getUserMedia(e);this.waitForLocalAVStream=!1,this.gotUserMediaForAnswer(t)}catch(e){return void this.getUserMediaFailed(e)}}}replacedBy(e){o.logger.debug(this.callId+" being replaced by "+e.callId),this.state===p.WaitLocalMedia?(o.logger.debug("Telling new call to wait for local media"),e.waitForLocalAVStream=!0):(this.state===p.CreateOffer||this.state===p.InviteSent)&&(o.logger.debug("Handing local stream to new call"),e.gotUserMediaForAnswer(this.localAVStream),delete this.localAVStream),this.successor=e,this.emit(v.Replaced,e),this.hangup(y.Replaced,!0)}hangup(e,t){if(this.callHasEnded())return;if(o.logger.debug("Ending call "+this.callId),this.terminate(m.Local,e,!t),this.state===p.WaitLocalMedia)return;const i={};e!==y.UserHangup&&(i.reason=e),this.sendVoipEvent(l.EventType.CallHangup,i)}reject(){if(this.state!==p.Ringing)throw Error("Call must be in 'ringing' state to reject!");if(this.opponentVersion<1)return o.logger.info(`Opponent version is less than 1 (${this.opponentVersion}): sending hangup instead of reject`),void this.hangup(y.UserHangup,!0);o.logger.debug("Rejecting call: "+this.callId),this.terminate(m.Local,y.UserHangup,!0),this.sendVoipEvent(l.EventType.CallReject,{})}setLocalVideoMuted(e){this.vidMuted=e,this.updateMuteStatus()}isLocalVideoMuted(){return this.vidMuted}setMicrophoneMuted(e){this.micMuted=e,this.updateMuteStatus()}isMicrophoneMuted(){return this.micMuted}isRemoteOnHold(){return this.remoteOnHold}setRemoteOnHold(e){if(this.isRemoteOnHold()!==e){this.remoteOnHold=e;for(const t of this.peerConn.getTransceivers())t.direction=e?"sendonly":"sendrecv";this.updateMuteStatus(),this.emit(v.RemoteHoldUnhold,this.remoteOnHold)}}isLocalOnHold(){if(this.state!==p.Connected)return!1;let e=!0;for(const t of this.peerConn.getTransceivers())["inactive","recvonly"].includes(t.currentDirection)||(e=!1);return e}sendDtmfDigit(e){for(const t of this.peerConn.getSenders())if("audio"===t.track.kind&&t.dtmf)return void t.dtmf.insertDTMF(e);throw new Error("Unable to find a track to send DTMF on")}updateMuteStatus(){if(!this.localAVStream)return;const e=this.micMuted||this.remoteOnHold;E(this.localAVStream.getAudioTracks(),!e);const t=this.vidMuted||this.remoteOnHold;E(this.localAVStream.getVideoTracks(),!t)}async sendAnswer(){const e={answer:{sdp:this.peerConn.localDescription.sdp,type:this.peerConn.localDescription.type}};this.client.supportsCallTransfer&&(e.capabilities={"m.call.transferee":!0}),o.logger.info(`Discarding ${this.candidateSendQueue.length} candidates that will be sent in answer`),this.candidateSendQueue=[];try{await this.sendVoipEvent(l.EventType.CallAnswer,e),this.inviteOrAnswerSent=!0}catch(e){this.setState(p.Ringing),this.client.cancelPendingEvent(e.event);let t=y.SendAnswer,i="Failed to send answer";throw"UnknownDeviceError"==e.name&&(t=y.UnknownDevices,i="Unknown devices present in the room"),this.emit(v.Error,new S(t,i,e)),e}this.sendCandidateQueue()}async onRemoteIceCandidatesReceived(e){if(this.callHasEnded())return;const t=e.getContent().candidates;if(!t)return void o.logger.info("Ignoring candidates event with no candidates!");const i=0===e.getContent().version?null:e.getContent().party_id||null;if(void 0===this.opponentPartyId){o.logger.info(`Bufferring ${t.length} candidates until we pick an opponent`);const e=this.remoteCandidateBuffer.get(i)||[];return e.push(...t),void this.remoteCandidateBuffer.set(i,e)}this.partyIdMatches(e.getContent())?await this.addIceCandidates(t):o.logger.info(`Ignoring candidates from party ID ${e.getContent().party_id}: we have chosen party ID ${this.opponentPartyId}`)}async onAnswerReceived(e){if(o.logger.debug(`Got answer for call ID ${this.callId} from party ID ${e.getContent().party_id}`),this.callHasEnded())o.logger.debug(`Ignoring answer because call ID ${this.callId} has ended`);else if(void 0===this.opponentPartyId){this.chooseOpponent(e),await this.addBufferedIceCandidates(),this.setState(p.Connecting);try{await this.peerConn.setRemoteDescription(e.getContent().answer)}catch(e){return o.logger.debug("Failed to set remote description",e),void this.terminate(m.Local,y.SetRemoteDescription,!1)}if(null!==this.opponentPartyId)try{await this.sendVoipEvent(l.EventType.CallSelectAnswer,{selected_party_id:this.opponentPartyId})}catch(e){o.logger.warn("Failed to send select_answer event",e)}}else o.logger.info(`Ignoring answer from party ID ${e.getContent().party_id}: we already have an answer/reject from ${this.opponentPartyId}`)}async onSelectAnswerReceived(e){if(this.direction!==f.Inbound)return void o.logger.warn("Got select_answer for an outbound call: ignoring");const t=e.getContent().selected_party_id;null!=t?t!==this.ourPartyId&&(o.logger.info(`Got select_answer for party ID ${t}: we are party ID ${this.ourPartyId}.`),this.terminate(m.Remote,y.AnsweredElsewhere,!0)):o.logger.warn("Got nonsensical select_answer with null/undefined selected_party_id: ignoring")}async onNegotiateReceived(e){const t=e.getContent().description;if(!t||!t.sdp||!t.type)return void o.logger.info("Ignoring invalid m.call.negotiate event");const i=this.direction===f.Inbound,n="offer"===t.type&&(this.makingOffer||"stable"!=this.peerConn.signalingState);if(this.ignoreOffer=!i&&n,this.ignoreOffer)return void o.logger.info("Ignoring colliding negotiate event because we're impolite");const r=this.isLocalOnHold();try{if(await this.peerConn.setRemoteDescription(t),"offer"===t.type){const e=await this.peerConn.createAnswer();await this.peerConn.setLocalDescription(e),this.sendVoipEvent(l.EventType.CallNegotiate,{description:this.peerConn.localDescription})}}catch(e){o.logger.warn("Failed to complete negotiation",e)}const s=this.isLocalOnHold();r!==s&&(this.emit(v.LocalHoldUnhold,s),this.emit(v.HoldUnhold,s))}async onAssertedIdentityReceived(e){e.getContent().asserted_identity&&(this.remoteAssertedIdentity={id:e.getContent().asserted_identity.id,displayName:e.getContent().asserted_identity.display_name},this.emit(v.AssertedIdentityChanged))}callHasEnded(){return this.state===p.Ended}setState(e){const t=this.state;this.state=e,this.emit(v.State,e,t)}sendVoipEvent(e,t){return this.client.sendEvent(this.roomId,e,Object.assign({},t,{version:1,call_id:this.callId,party_id:this.ourPartyId}))}queueCandidate(e){if(this.candidateSendQueue.push(e),this.state===p.Ringing||!this.inviteOrAnswerSent)return;const t=this.direction===f.Inbound?500:2e3;0===this.candidateSendTries&&setTimeout((()=>{this.sendCandidateQueue()}),t)}async transfer(e){const t=await this.client.getProfileInfo(e),i=b(),n={replacement_id:b(),target_user:{id:e,display_name:t.display_name,avatar_url:t.avatar_url},create_call:i};await this.sendVoipEvent(l.EventType.CallReplaces,n),await this.terminate(m.Local,y.Transfered,!0)}async transferToCall(e){const t=await this.client.getProfileInfo(e.getOpponentMember().userId),i=await this.client.getProfileInfo(this.getOpponentMember().userId),n=b(),r={replacement_id:b(),target_user:{id:this.getOpponentMember().userId,display_name:i.display_name,avatar_url:i.avatar_url},await_call:n};await e.sendVoipEvent(l.EventType.CallReplaces,r);const s={replacement_id:b(),target_user:{id:e.getOpponentMember().userId,display_name:t.display_name,avatar_url:t.avatar_url},create_call:n};await this.sendVoipEvent(l.EventType.CallReplaces,s),await this.terminate(m.Local,y.Replaced,!0),await e.terminate(m.Local,y.Transfered,!0)}async terminate(e,t,i){this.callHasEnded()||(this.callStatsAtEnd=await this.collectCallStats(),this.inviteTimeout&&(clearTimeout(this.inviteTimeout),this.inviteTimeout=null),t!==y.Replaced&&this.stopAllMedia(),this.deleteAllFeeds(),this.hangupParty=e,this.hangupReason=t,this.setState(p.Ended),this.peerConn&&"closed"!==this.peerConn.signalingState&&this.peerConn.close(),i&&this.emit(v.Hangup,this))}stopAllMedia(){o.logger.debug(`stopAllMedia (stream=${this.localAVStream})`);for(const e of this.feeds)for(const t of e.stream.getTracks())t.stop()}checkForErrorListener(){if(0===this.listeners("error").length)throw new Error("You MUST attach an error listener using call.on('error', function() {})")}async sendCandidateQueue(){if(0===this.candidateSendQueue.length)return;const e=this.candidateSendQueue;this.candidateSendQueue=[],++this.candidateSendTries;const t={candidates:e};o.logger.debug("Attempting to send "+e.length+" candidates");try{await this.sendVoipEvent(l.EventType.CallCandidates,t)}catch(t){if(t.event&&this.client.cancelPendingEvent(t.event),this.candidateSendQueue.push(...e),this.candidateSendTries>5){o.logger.debug("Failed to send candidates on attempt "+this.candidateSendTries+". Giving up on this call.",t);const e=y.SignallingFailed,i="Signalling failed";return this.emit(v.Error,new S(e,i,t)),void this.hangup(e,!1)}const i=500*Math.pow(2,this.candidateSendTries);++this.candidateSendTries,o.logger.debug("Failed to send candidates. Retrying in "+i+"ms",t),setTimeout((()=>{this.sendCandidateQueue()}),i)}}async placeCallWithConstraints(e){o.logger.log("Getting user media with constraints",e),this.client.callEventHandler.calls.set(this.callId,this),this.setState(p.WaitLocalMedia),this.direction=f.Outbound,this.config=e,await this.client.checkTurnServers()||o.logger.warn("Failed to get TURN credentials! Proceeding with call anyway..."),this.peerConn=this.createPeerConnection();try{const t=await navigator.mediaDevices.getUserMedia(e);this.gotUserMediaForInvite(t)}catch(e){return void this.getUserMediaFailed(e)}}createPeerConnection(){const e=new window.RTCPeerConnection({iceTransportPolicy:this.forceTURN?"relay":void 0,iceServers:this.turnServers,iceCandidatePoolSize:this.client.iceCandidatePoolSize});return e.addEventListener("iceconnectionstatechange",this.onIceConnectionStateChanged),e.addEventListener("signalingstatechange",this.onSignallingStateChanged),e.addEventListener("icecandidate",this.gotLocalIceCandidate),e.addEventListener("icegatheringstatechange",this.onIceGatheringStateChange),e.addEventListener("track",this.onTrack),e.addEventListener("negotiationneeded",this.onNegotiationNeeded),e}partyIdMatches(e){return(0===e.version?null:e.party_id||null)===this.opponentPartyId}chooseOpponent(e){const t=e.getContent();o.logger.debug(`Choosing party ID ${t.party_id} for call ID ${this.callId}`),this.opponentVersion=t.version,0===this.opponentVersion?this.opponentPartyId=null:this.opponentPartyId=t.party_id||null,this.opponentCaps=t.capabilities||{},this.opponentMember=e.sender}async addBufferedIceCandidates(){const e=this.remoteCandidateBuffer.get(this.opponentPartyId);e&&(o.logger.info(`Adding ${e.length} buffered candidates for opponent ${this.opponentPartyId}`),await this.addIceCandidates(e)),this.remoteCandidateBuffer=null}async addIceCandidates(e){for(const t of e)if(null!==t.sdpMid&&void 0!==t.sdpMid||null!==t.sdpMLineIndex&&void 0!==t.sdpMLineIndex){o.logger.debug("Call "+this.callId+" got remote ICE "+t.sdpMid+" candidate: "+t.candidate);try{await this.peerConn.addIceCandidate(t)}catch(e){this.ignoreOffer||o.logger.info("Failed to add remote ICE candidate",e)}}else o.logger.debug("Ignoring remote ICE candidate with no sdpMid or sdpMLineIndex")}}function E(e,t){for(let i=0;i<e.length;i++)e[i].enabled=t}function I(e){const t=!!navigator.webkitGetUserMedia;switch(e){case _.Audio:return{audio:{deviceId:k?{ideal:k}:void 0},video:!1};case _.Video:return{audio:{deviceId:k?{ideal:k}:void 0},video:{deviceId:T?{ideal:T}:void 0,width:t?{exact:640}:{ideal:640},height:t?{exact:360}:{ideal:360}}}}}let k,T;t.MatrixCall=w},2931:(e,t,i)=>{"use strict";var n=i(5318);Object.defineProperty(t,"__esModule",{value:!0}),t.CallEventHandler=void 0;var r=n(i(9713)),s=i(7434),o=i(9679),a=i(2481);t.CallEventHandler=class{constructor(e){(0,r.default)(this,"client",void 0),(0,r.default)(this,"calls",void 0),(0,r.default)(this,"callEventBuffer",void 0),(0,r.default)(this,"candidateEventsByCall",void 0),(0,r.default)(this,"evaluateEventBuffer",(async()=>{if("SYNCING"===this.client.getSyncState()){await Promise.all(this.callEventBuffer.map((e=>{this.client.decryptEventIfNeeded(e)})));const e=new Set;for(const t of this.callEventBuffer)t.getType()!==a.EventType.CallAnswer&&t.getType()!==a.EventType.CallHangup||e.add(t.getContent().call_id);for(const t of this.callEventBuffer)if(t.getType()!==a.EventType.CallInvite||!e.has(t.getContent().call_id))try{this.handleCallEvent(t)}catch(e){s.logger.error("Caught exception handling call event",e)}this.callEventBuffer=[]}})),(0,r.default)(this,"onEvent",(e=>{this.client.decryptEventIfNeeded(e),(this.eventIsACall(e)||e.isBeingDecrypted())&&this.callEventBuffer.push(e),(e.isBeingDecrypted()||e.isDecryptionFailure())&&e.once("Event.decrypted",(()=>{if(this.eventIsACall(e))if(this.callEventBuffer.includes(e))this.evaluateEventBuffer();else try{this.handleCallEvent(e)}catch(e){s.logger.error("Caught exception handling call event",e)}}))})),this.client=e,this.calls=new Map,this.callEventBuffer=[],this.candidateEventsByCall=new Map}start(){this.client.on("sync",this.evaluateEventBuffer),this.client.on("event",this.onEvent)}stop(){this.client.removeListener("sync",this.evaluateEventBuffer),this.client.removeListener("event",this.onEvent)}eventIsACall(e){const t=e.getType();return t.startsWith("m.call.")||t.startsWith("org.matrix.call.")}handleCallEvent(e){const t=e.getContent();let i=t.call_id?this.calls.get(t.call_id):void 0;if(e.getType()===a.EventType.CallInvite){if(e.getSender()===this.client.credentials.userId)return;if(e.getLocalAge()>t.lifetime-3e3)return;if(i&&i.state===o.CallState.Ended)return;i&&s.logger.log(`WARN: Already have a MatrixCall with id ${t.call_id} but got an invite. Clobbering.`);const n=this.client.getTurnServersExpiry()-Date.now();if(s.logger.info("Current turn creds expire in "+n+" ms"),i=(0,o.createNewMatrixCall)(this.client,e.getRoomId(),{forceTURN:this.client.forceTURN}),!i)return void s.logger.log("Incoming call ID "+t.call_id+" but this client doesn't support WebRTC");if(i.callId=t.call_id,i.initWithInvite(e),this.calls.set(i.callId,i),this.candidateEventsByCall.get(i.callId))for(const e of this.candidateEventsByCall.get(i.callId))i.onRemoteIceCandidatesReceived(e);let r;for(const e of this.calls.values()){const t=[o.CallState.WaitLocalMedia,o.CallState.CreateOffer,o.CallState.InviteSent].includes(e.state);if(i.roomId===e.roomId&&e.direction===o.CallDirection.Outbound&&t){r=e;break}}r?r.state===o.CallState.WaitLocalMedia||r.state===o.CallState.CreateOffer||r.callId>i.callId?(s.logger.log("Glare detected: answering incoming call "+i.callId+" and canceling outgoing call "+r.callId),r.replacedBy(i),i.answer()):(s.logger.log("Glare detected: rejecting incoming call "+i.callId+" and keeping outgoing call "+r.callId),i.hangup(o.CallErrorCode.Replaced,!0)):this.client.emit("Call.incoming",i)}else if(e.getType()===a.EventType.CallAnswer){if(!i)return;e.getSender()===this.client.credentials.userId?i.state===o.CallState.Ringing&&i.onAnsweredElsewhere(t):i.onAnswerReceived(e)}else if(e.getType()===a.EventType.CallCandidates){if(e.getSender()===this.client.credentials.userId)return;i?i.onRemoteIceCandidatesReceived(e):(this.candidateEventsByCall.has(t.call_id)||this.candidateEventsByCall.set(t.call_id,[]),this.candidateEventsByCall.get(t.call_id).push(e))}else if([a.EventType.CallHangup,a.EventType.CallReject].includes(e.getType()))i?i.state!==o.CallState.Ended&&(e.getType()===a.EventType.CallHangup?i.onHangupReceived(t):i.onRejectReceived(t),this.calls.delete(t.call_id)):(i=(0,o.createNewMatrixCall)(this.client,e.getRoomId()),i&&(i.callId=t.call_id,i.initWithHangup(e),this.calls.set(t.call_id,i)));else if(e.getType()===a.EventType.CallSelectAnswer){if(!i)return;if(e.getContent().party_id===i.ourPartyId)return;i.onSelectAnswerReceived(e)}else if(e.getType()===a.EventType.CallNegotiate){if(!i)return;if(e.getContent().party_id===i.ourPartyId)return;i.onNegotiateReceived(e)}else if(e.getType()===a.EventType.CallAssertedIdentity||e.getType()===a.EventType.CallAssertedIdentityPrefix){if(!i)return;if(e.getContent().party_id===i.ourPartyId)return;i.onAssertedIdentityReceived(e)}}}},5964:(e,t)=>{"use strict";let i;Object.defineProperty(t,"__esModule",{value:!0}),t.SDPStreamMetadataPurpose=void 0,t.SDPStreamMetadataPurpose=i,function(e){e.Usermedia="m.usermedia",e.Screenshare="m.screenshare"}(i||(t.SDPStreamMetadataPurpose=i={}))},9704:(e,t,i)=>{"use strict";var n=i(5318);Object.defineProperty(t,"__esModule",{value:!0}),t.CallFeed=t.CallFeedEvent=void 0;var r=n(i(7187));let s;t.CallFeedEvent=s,function(e){e.NewStream="new_stream"}(s||(t.CallFeedEvent=s={}));class o extends r.default{constructor(e,t,i,n,r){super(),this.stream=e,this.userId=t,this.purpose=i,this.client=n,this.roomId=r}getMember(){return this.client.getRoom(this.roomId).getMember(this.userId)}isLocal(){return this.userId===this.client.getUserId()}isAudioMuted(){return 0===this.stream.getAudioTracks().length}isVideoMuted(){return 0===this.stream.getVideoTracks().length}setNewStream(e){this.stream=e,this.emit(s.NewStream,this.stream)}}t.CallFeed=o},7433:(e,t,i)=>{"use strict";const n=i(897),r=["Failed to fetch","NetworkError when attempting to fetch resource.","The Internet connection appears to be offline.","Network request failed"];class s extends Error{constructor(e){super(),e instanceof Error?(this.originalError=e,({message:e}=e)):(this.originalError=new Error(e),this.originalError.stack=this.stack),this.name="AbortError",this.message=e}}const o=(e,t)=>new Promise(((i,o)=>{t={onFailedAttempt:()=>{},retries:10,...t};const a=n.operation(t);a.attempt((async n=>{try{i(await e(n))}catch(e){if(!(e instanceof Error))return void o(new TypeError(`Non-error was thrown: "${e}". You should only throw errors.`));if(e instanceof s)a.stop(),o(e.originalError);else if(e instanceof TypeError&&(c=e.message,!r.includes(c)))a.stop(),o(e);else{((e,t,i)=>{const n=i.retries-(t-1);e.attemptNumber=t,e.retriesLeft=n})(e,n,t);try{await t.onFailedAttempt(e)}catch(e){return void o(e)}a.retry(e)||o(a.mainError())}}var c}))}));e.exports=o,e.exports.default=o,e.exports.AbortError=s},7380:e=>{"use strict";var t=String.prototype.replace,i=/%20/g,n="RFC3986";e.exports={default:n,formatters:{RFC1738:function(e){return t.call(e,i,"+")},RFC3986:function(e){return String(e)}},RFC1738:"RFC1738",RFC3986:n}},1241:(e,t,i)=>{"use strict";var n=i(8194),r=i(3980),s=i(7380);e.exports={formats:s,parse:r,stringify:n}},3980:(e,t,i)=>{"use strict";var n=i(165),r=Object.prototype.hasOwnProperty,s=Array.isArray,o={allowDots:!1,allowPrototypes:!1,allowSparse:!1,arrayLimit:20,charset:"utf-8",charsetSentinel:!1,comma:!1,decoder:n.decode,delimiter:"&",depth:5,ignoreQueryPrefix:!1,interpretNumericEntities:!1,parameterLimit:1e3,parseArrays:!0,plainObjects:!1,strictNullHandling:!1},a=function(e){return e.replace(/&#(\d+);/g,(function(e,t){return String.fromCharCode(parseInt(t,10))}))},c=function(e,t){return e&&"string"==typeof e&&t.comma&&e.indexOf(",")>-1?e.split(","):e},l=function(e,t,i,n){if(e){var s=i.allowDots?e.replace(/\.([^.[]+)/g,"[$1]"):e,o=/(\[[^[\]]*])/g,a=i.depth>0&&/(\[[^[\]]*])/.exec(s),l=a?s.slice(0,a.index):s,h=[];if(l){if(!i.plainObjects&&r.call(Object.prototype,l)&&!i.allowPrototypes)return;h.push(l)}for(var u=0;i.depth>0&&null!==(a=o.exec(s))&&u<i.depth;){if(u+=1,!i.plainObjects&&r.call(Object.prototype,a[1].slice(1,-1))&&!i.allowPrototypes)return;h.push(a[1])}return a&&h.push("["+s.slice(a.index)+"]"),function(e,t,i,n){for(var r=n?t:c(t,i),s=e.length-1;s>=0;--s){var o,a=e[s];if("[]"===a&&i.parseArrays)o=[].concat(r);else{o=i.plainObjects?Object.create(null):{};var l="["===a.charAt(0)&&"]"===a.charAt(a.length-1)?a.slice(1,-1):a,h=parseInt(l,10);i.parseArrays||""!==l?!isNaN(h)&&a!==l&&String(h)===l&&h>=0&&i.parseArrays&&h<=i.arrayLimit?(o=[])[h]=r:o[l]=r:o={0:r}}r=o}return r}(h,t,i,n)}};e.exports=function(e,t){var i=function(e){if(!e)return o;if(null!==e.decoder&&void 0!==e.decoder&&"function"!=typeof e.decoder)throw new TypeError("Decoder has to be a function.");if(void 0!==e.charset&&"utf-8"!==e.charset&&"iso-8859-1"!==e.charset)throw new TypeError("The charset option must be either utf-8, iso-8859-1, or undefined");var t=void 0===e.charset?o.charset:e.charset;return{allowDots:void 0===e.allowDots?o.allowDots:!!e.allowDots,allowPrototypes:"boolean"==typeof e.allowPrototypes?e.allowPrototypes:o.allowPrototypes,allowSparse:"boolean"==typeof e.allowSparse?e.allowSparse:o.allowSparse,arrayLimit:"number"==typeof e.arrayLimit?e.arrayLimit:o.arrayLimit,charset:t,charsetSentinel:"boolean"==typeof e.charsetSentinel?e.charsetSentinel:o.charsetSentinel,comma:"boolean"==typeof e.comma?e.comma:o.comma,decoder:"function"==typeof e.decoder?e.decoder:o.decoder,delimiter:"string"==typeof e.delimiter||n.isRegExp(e.delimiter)?e.delimiter:o.delimiter,depth:"number"==typeof e.depth||!1===e.depth?+e.depth:o.depth,ignoreQueryPrefix:!0===e.ignoreQueryPrefix,interpretNumericEntities:"boolean"==typeof e.interpretNumericEntities?e.interpretNumericEntities:o.interpretNumericEntities,parameterLimit:"number"==typeof e.parameterLimit?e.parameterLimit:o.parameterLimit,parseArrays:!1!==e.parseArrays,plainObjects:"boolean"==typeof e.plainObjects?e.plainObjects:o.plainObjects,strictNullHandling:"boolean"==typeof e.strictNullHandling?e.strictNullHandling:o.strictNullHandling}}(t);if(""===e||null==e)return i.plainObjects?Object.create(null):{};for(var h="string"==typeof e?function(e,t){var i,l={},h=t.ignoreQueryPrefix?e.replace(/^\?/,""):e,u=t.parameterLimit===1/0?void 0:t.parameterLimit,d=h.split(t.delimiter,u),p=-1,g=t.charset;if(t.charsetSentinel)for(i=0;i<d.length;++i)0===d[i].indexOf("utf8=")&&("utf8=%E2%9C%93"===d[i]?g="utf-8":"utf8=%26%2310003%3B"===d[i]&&(g="iso-8859-1"),p=i,i=d.length);for(i=0;i<d.length;++i)if(i!==p){var f,m,v=d[i],y=v.indexOf("]="),_=-1===y?v.indexOf("="):y+1;-1===_?(f=t.decoder(v,o.decoder,g,"key"),m=t.strictNullHandling?null:""):(f=t.decoder(v.slice(0,_),o.decoder,g,"key"),m=n.maybeMap(c(v.slice(_+1),t),(function(e){return t.decoder(e,o.decoder,g,"value")}))),m&&t.interpretNumericEntities&&"iso-8859-1"===g&&(m=a(m)),v.indexOf("[]=")>-1&&(m=s(m)?[m]:m),r.call(l,f)?l[f]=n.combine(l[f],m):l[f]=m}return l}(e,i):e,u=i.plainObjects?Object.create(null):{},d=Object.keys(h),p=0;p<d.length;++p){var g=d[p],f=l(g,h[g],i,"string"==typeof e);u=n.merge(u,f,i)}return!0===i.allowSparse?u:n.compact(u)}},8194:(e,t,i)=>{"use strict";var n=i(7478),r=i(165),s=i(7380),o=Object.prototype.hasOwnProperty,a={brackets:function(e){return e+"[]"},comma:"comma",indices:function(e,t){return e+"["+t+"]"},repeat:function(e){return e}},c=Array.isArray,l=Array.prototype.push,h=function(e,t){l.apply(e,c(t)?t:[t])},u=Date.prototype.toISOString,d=s.default,p={addQueryPrefix:!1,allowDots:!1,charset:"utf-8",charsetSentinel:!1,delimiter:"&",encode:!0,encoder:r.encode,encodeValuesOnly:!1,format:d,formatter:s.formatters[d],indices:!1,serializeDate:function(e){return u.call(e)},skipNulls:!1,strictNullHandling:!1},g=function e(t,i,s,o,a,l,u,d,g,f,m,v,y,_,S){var b,w=t;if(S.has(t))throw new RangeError("Cyclic object value");if("function"==typeof u?w=u(i,w):w instanceof Date?w=f(w):"comma"===s&&c(w)&&(w=r.maybeMap(w,(function(e){return e instanceof Date?f(e):e}))),null===w){if(o)return l&&!y?l(i,p.encoder,_,"key",m):i;w=""}if("string"==typeof(b=w)||"number"==typeof b||"boolean"==typeof b||"symbol"==typeof b||"bigint"==typeof b||r.isBuffer(w))return l?[v(y?i:l(i,p.encoder,_,"key",m))+"="+v(l(w,p.encoder,_,"value",m))]:[v(i)+"="+v(String(w))];var E,I=[];if(void 0===w)return I;if("comma"===s&&c(w))E=[{value:w.length>0?w.join(",")||null:void 0}];else if(c(u))E=u;else{var k=Object.keys(w);E=d?k.sort(d):k}for(var T=0;T<E.length;++T){var C=E[T],x="object"==typeof C&&void 0!==C.value?C.value:w[C];if(!a||null!==x){var R=c(w)?"function"==typeof s?s(i,C):i:i+(g?"."+C:"["+C+"]");S.set(t,!0);var O=n();h(I,e(x,R,s,o,a,l,u,d,g,f,m,v,y,_,O))}}return I};e.exports=function(e,t){var i,r=e,l=function(e){if(!e)return p;if(null!==e.encoder&&void 0!==e.encoder&&"function"!=typeof e.encoder)throw new TypeError("Encoder has to be a function.");var t=e.charset||p.charset;if(void 0!==e.charset&&"utf-8"!==e.charset&&"iso-8859-1"!==e.charset)throw new TypeError("The charset option must be either utf-8, iso-8859-1, or undefined");var i=s.default;if(void 0!==e.format){if(!o.call(s.formatters,e.format))throw new TypeError("Unknown format option provided.");i=e.format}var n=s.formatters[i],r=p.filter;return("function"==typeof e.filter||c(e.filter))&&(r=e.filter),{addQueryPrefix:"boolean"==typeof e.addQueryPrefix?e.addQueryPrefix:p.addQueryPrefix,allowDots:void 0===e.allowDots?p.allowDots:!!e.allowDots,charset:t,charsetSentinel:"boolean"==typeof e.charsetSentinel?e.charsetSentinel:p.charsetSentinel,delimiter:void 0===e.delimiter?p.delimiter:e.delimiter,encode:"boolean"==typeof e.encode?e.encode:p.encode,encoder:"function"==typeof e.encoder?e.encoder:p.encoder,encodeValuesOnly:"boolean"==typeof e.encodeValuesOnly?e.encodeValuesOnly:p.encodeValuesOnly,filter:r,format:i,formatter:n,serializeDate:"function"==typeof e.serializeDate?e.serializeDate:p.serializeDate,skipNulls:"boolean"==typeof e.skipNulls?e.skipNulls:p.skipNulls,sort:"function"==typeof e.sort?e.sort:null,strictNullHandling:"boolean"==typeof e.strictNullHandling?e.strictNullHandling:p.strictNullHandling}}(t);"function"==typeof l.filter?r=(0,l.filter)("",r):c(l.filter)&&(i=l.filter);var u,d=[];if("object"!=typeof r||null===r)return"";u=t&&t.arrayFormat in a?t.arrayFormat:t&&"indices"in t?t.indices?"indices":"repeat":"indices";var f=a[u];i||(i=Object.keys(r)),l.sort&&i.sort(l.sort);for(var m=n(),v=0;v<i.length;++v){var y=i[v];l.skipNulls&&null===r[y]||h(d,g(r[y],y,f,l.strictNullHandling,l.skipNulls,l.encode?l.encoder:null,l.filter,l.sort,l.allowDots,l.serializeDate,l.format,l.formatter,l.encodeValuesOnly,l.charset,m))}var _=d.join(l.delimiter),S=!0===l.addQueryPrefix?"?":"";return l.charsetSentinel&&("iso-8859-1"===l.charset?S+="utf8=%26%2310003%3B&":S+="utf8=%E2%9C%93&"),_.length>0?S+_:""}},165:(e,t,i)=>{"use strict";var n=i(7380),r=Object.prototype.hasOwnProperty,s=Array.isArray,o=function(){for(var e=[],t=0;t<256;++t)e.push("%"+((t<16?"0":"")+t.toString(16)).toUpperCase());return e}(),a=function(e,t){for(var i=t&&t.plainObjects?Object.create(null):{},n=0;n<e.length;++n)void 0!==e[n]&&(i[n]=e[n]);return i};e.exports={arrayToObject:a,assign:function(e,t){return Object.keys(t).reduce((function(e,i){return e[i]=t[i],e}),e)},combine:function(e,t){return[].concat(e,t)},compact:function(e){for(var t=[{obj:{o:e},prop:"o"}],i=[],n=0;n<t.length;++n)for(var r=t[n],o=r.obj[r.prop],a=Object.keys(o),c=0;c<a.length;++c){var l=a[c],h=o[l];"object"==typeof h&&null!==h&&-1===i.indexOf(h)&&(t.push({obj:o,prop:l}),i.push(h))}return function(e){for(;e.length>1;){var t=e.pop(),i=t.obj[t.prop];if(s(i)){for(var n=[],r=0;r<i.length;++r)void 0!==i[r]&&n.push(i[r]);t.obj[t.prop]=n}}}(t),e},decode:function(e,t,i){var n=e.replace(/\+/g," ");if("iso-8859-1"===i)return n.replace(/%[0-9a-f]{2}/gi,unescape);try{return decodeURIComponent(n)}catch(e){return n}},encode:function(e,t,i,r,s){if(0===e.length)return e;var a=e;if("symbol"==typeof e?a=Symbol.prototype.toString.call(e):"string"!=typeof e&&(a=String(e)),"iso-8859-1"===i)return escape(a).replace(/%u[0-9a-f]{4}/gi,(function(e){return"%26%23"+parseInt(e.slice(2),16)+"%3B"}));for(var c="",l=0;l<a.length;++l){var h=a.charCodeAt(l);45===h||46===h||95===h||126===h||h>=48&&h<=57||h>=65&&h<=90||h>=97&&h<=122||s===n.RFC1738&&(40===h||41===h)?c+=a.charAt(l):h<128?c+=o[h]:h<2048?c+=o[192|h>>6]+o[128|63&h]:h<55296||h>=57344?c+=o[224|h>>12]+o[128|h>>6&63]+o[128|63&h]:(l+=1,h=65536+((1023&h)<<10|1023&a.charCodeAt(l)),c+=o[240|h>>18]+o[128|h>>12&63]+o[128|h>>6&63]+o[128|63&h])}return c},isBuffer:function(e){return!(!e||"object"!=typeof e||!(e.constructor&&e.constructor.isBuffer&&e.constructor.isBuffer(e)))},isRegExp:function(e){return"[object RegExp]"===Object.prototype.toString.call(e)},maybeMap:function(e,t){if(s(e)){for(var i=[],n=0;n<e.length;n+=1)i.push(t(e[n]));return i}return t(e)},merge:function e(t,i,n){if(!i)return t;if("object"!=typeof i){if(s(t))t.push(i);else{if(!t||"object"!=typeof t)return[t,i];(n&&(n.plainObjects||n.allowPrototypes)||!r.call(Object.prototype,i))&&(t[i]=!0)}return t}if(!t||"object"!=typeof t)return[t].concat(i);var o=t;return s(t)&&!s(i)&&(o=a(t,n)),s(t)&&s(i)?(i.forEach((function(i,s){if(r.call(t,s)){var o=t[s];o&&"object"==typeof o&&i&&"object"==typeof i?t[s]=e(o,i,n):t.push(i)}else t[s]=i})),t):Object.keys(i).reduce((function(t,s){var o=i[s];return r.call(t,s)?t[s]=e(t[s],o,n):t[s]=o,t}),o)}}},897:(e,t,i)=>{e.exports=i(4058)},4058:(e,t,i)=>{var n=i(3132);t.operation=function(e){var i=t.timeouts(e);return new n(i,{forever:e&&(e.forever||e.retries===1/0),unref:e&&e.unref,maxRetryTime:e&&e.maxRetryTime})},t.timeouts=function(e){if(e instanceof Array)return[].concat(e);var t={retries:10,factor:2,minTimeout:1e3,maxTimeout:1/0,randomize:!1};for(var i in e)t[i]=e[i];if(t.minTimeout>t.maxTimeout)throw new Error("minTimeout is greater than maxTimeout");for(var n=[],r=0;r<t.retries;r++)n.push(this.createTimeout(r,t));return e&&e.forever&&!n.length&&n.push(this.createTimeout(r,t)),n.sort((function(e,t){return e-t})),n},t.createTimeout=function(e,t){var i=t.randomize?Math.random()+1:1,n=Math.round(i*Math.max(t.minTimeout,1)*Math.pow(t.factor,e));return Math.min(n,t.maxTimeout)},t.wrap=function(e,i,n){if(i instanceof Array&&(n=i,i=null),!n)for(var r in n=[],e)"function"==typeof e[r]&&n.push(r);for(var s=0;s<n.length;s++){var o=n[s],a=e[o];e[o]=function(n){var r=t.operation(i),s=Array.prototype.slice.call(arguments,1),o=s.pop();s.push((function(e){r.retry(e)||(e&&(arguments[0]=r.mainError()),o.apply(this,arguments))})),r.attempt((function(){n.apply(e,s)}))}.bind(e,a),e[o].options=i}}},3132:e=>{function t(e,t){"boolean"==typeof t&&(t={forever:t}),this._originalTimeouts=JSON.parse(JSON.stringify(e)),this._timeouts=e,this._options=t||{},this._maxRetryTime=t&&t.maxRetryTime||1/0,this._fn=null,this._errors=[],this._attempts=1,this._operationTimeout=null,this._operationTimeoutCb=null,this._timeout=null,this._operationStart=null,this._timer=null,this._options.forever&&(this._cachedTimeouts=this._timeouts.slice(0))}e.exports=t,t.prototype.reset=function(){this._attempts=1,this._timeouts=this._originalTimeouts.slice(0)},t.prototype.stop=function(){this._timeout&&clearTimeout(this._timeout),this._timer&&clearTimeout(this._timer),this._timeouts=[],this._cachedTimeouts=null},t.prototype.retry=function(e){if(this._timeout&&clearTimeout(this._timeout),!e)return!1;var t=(new Date).getTime();if(e&&t-this._operationStart>=this._maxRetryTime)return this._errors.push(e),this._errors.unshift(new Error("RetryOperation timeout occurred")),!1;this._errors.push(e);var i=this._timeouts.shift();if(void 0===i){if(!this._cachedTimeouts)return!1;this._errors.splice(0,this._errors.length-1),i=this._cachedTimeouts.slice(-1)}var n=this;return this._timer=setTimeout((function(){n._attempts++,n._operationTimeoutCb&&(n._timeout=setTimeout((function(){n._operationTimeoutCb(n._attempts)}),n._operationTimeout),n._options.unref&&n._timeout.unref()),n._fn(n._attempts)}),i),this._options.unref&&this._timer.unref(),!0},t.prototype.attempt=function(e,t){this._fn=e,t&&(t.timeout&&(this._operationTimeout=t.timeout),t.cb&&(this._operationTimeoutCb=t.cb));var i=this;this._operationTimeoutCb&&(this._timeout=setTimeout((function(){i._operationTimeoutCb()}),i._operationTimeout)),this._operationStart=(new Date).getTime(),this._fn(this._attempts)},t.prototype.try=function(e){console.log("Using RetryOperation.try() is deprecated"),this.attempt(e)},t.prototype.start=function(e){console.log("Using RetryOperation.start() is deprecated"),this.attempt(e)},t.prototype.start=t.prototype.try,t.prototype.errors=function(){return this._errors},t.prototype.attempts=function(){return this._attempts},t.prototype.mainError=function(){if(0===this._errors.length)return null;for(var e={},t=null,i=0,n=0;n<this._errors.length;n++){var r=this._errors[n],s=r.message,o=(e[s]||0)+1;e[s]=o,o>=i&&(t=r,i=o)}return t}},631:(e,t,i)=>{var n="function"==typeof Map&&Map.prototype,r=Object.getOwnPropertyDescriptor&&n?Object.getOwnPropertyDescriptor(Map.prototype,"size"):null,s=n&&r&&"function"==typeof r.get?r.get:null,o=n&&Map.prototype.forEach,a="function"==typeof Set&&Set.prototype,c=Object.getOwnPropertyDescriptor&&a?Object.getOwnPropertyDescriptor(Set.prototype,"size"):null,l=a&&c&&"function"==typeof c.get?c.get:null,h=a&&Set.prototype.forEach,u="function"==typeof WeakMap&&WeakMap.prototype?WeakMap.prototype.has:null,d="function"==typeof WeakSet&&WeakSet.prototype?WeakSet.prototype.has:null,p="function"==typeof WeakRef&&WeakRef.prototype?WeakRef.prototype.deref:null,g=Boolean.prototype.valueOf,f=Object.prototype.toString,m=Function.prototype.toString,v=String.prototype.match,y="function"==typeof BigInt?BigInt.prototype.valueOf:null,_=Object.getOwnPropertySymbols,S="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?Symbol.prototype.toString:null,b="function"==typeof Symbol&&"object"==typeof Symbol.iterator,w=Object.prototype.propertyIsEnumerable,E=("function"==typeof Reflect?Reflect.getPrototypeOf:Object.getPrototypeOf)||([].__proto__===Array.prototype?function(e){return e.__proto__}:null),I=i(4654).custom,k=I&&O(I)?I:null,T="function"==typeof Symbol&&void 0!==Symbol.toStringTag?Symbol.toStringTag:null;function C(e,t,i){var n="double"===(i.quoteStyle||t)?'"':"'";return n+e+n}function x(e){return String(e).replace(/"/g,"&quot;")}function R(e){return!("[object Array]"!==D(e)||T&&"object"==typeof e&&T in e)}function O(e){if(b)return e&&"object"==typeof e&&e instanceof Symbol;if("symbol"==typeof e)return!0;if(!e||"object"!=typeof e||!S)return!1;try{return S.call(e),!0}catch(e){}return!1}e.exports=function e(t,i,n,r){var a=i||{};if(P(a,"quoteStyle")&&"single"!==a.quoteStyle&&"double"!==a.quoteStyle)throw new TypeError('option "quoteStyle" must be "single" or "double"');if(P(a,"maxStringLength")&&("number"==typeof a.maxStringLength?a.maxStringLength<0&&a.maxStringLength!==1/0:null!==a.maxStringLength))throw new TypeError('option "maxStringLength", if provided, must be a positive integer, Infinity, or `null`');var c=!P(a,"customInspect")||a.customInspect;if("boolean"!=typeof c&&"symbol"!==c)throw new TypeError("option \"customInspect\", if provided, must be `true`, `false`, or `'symbol'`");if(P(a,"indent")&&null!==a.indent&&"\t"!==a.indent&&!(parseInt(a.indent,10)===a.indent&&a.indent>0))throw new TypeError('options "indent" must be "\\t", an integer > 0, or `null`');if(void 0===t)return"undefined";if(null===t)return"null";if("boolean"==typeof t)return t?"true":"false";if("string"==typeof t)return N(t,a);if("number"==typeof t)return 0===t?1/0/t>0?"0":"-0":String(t);if("bigint"==typeof t)return String(t)+"n";var f=void 0===a.depth?5:a.depth;if(void 0===n&&(n=0),n>=f&&f>0&&"object"==typeof t)return R(t)?"[Array]":"[Object]";var _,w=function(e,t){var i;if("\t"===e.indent)i="\t";else{if(!("number"==typeof e.indent&&e.indent>0))return null;i=Array(e.indent+1).join(" ")}return{base:i,prev:Array(t+1).join(i)}}(a,n);if(void 0===r)r=[];else if(M(r,t)>=0)return"[Circular]";function I(t,i,s){if(i&&(r=r.slice()).push(i),s){var o={depth:a.depth};return P(a,"quoteStyle")&&(o.quoteStyle=a.quoteStyle),e(t,o,n+1,r)}return e(t,a,n+1,r)}if("function"==typeof t){var A=function(e){if(e.name)return e.name;var t=v.call(m.call(e),/^function\s*([\w$]+)/);return t?t[1]:null}(t),B=F(t,I);return"[Function"+(A?": "+A:" (anonymous)")+"]"+(B.length>0?" { "+B.join(", ")+" }":"")}if(O(t)){var q=b?String(t).replace(/^(Symbol\(.*\))_[^)]*$/,"$1"):S.call(t);return"object"!=typeof t||b?q:U(q)}if((_=t)&&"object"==typeof _&&("undefined"!=typeof HTMLElement&&_ instanceof HTMLElement||"string"==typeof _.nodeName&&"function"==typeof _.getAttribute)){for(var V="<"+String(t.nodeName).toLowerCase(),$=t.attributes||[],G=0;G<$.length;G++)V+=" "+$[G].name+"="+C(x($[G].value),"double",a);return V+=">",t.childNodes&&t.childNodes.length&&(V+="..."),V+"</"+String(t.nodeName).toLowerCase()+">"}if(R(t)){if(0===t.length)return"[]";var H=F(t,I);return w&&!function(e){for(var t=0;t<e.length;t++)if(M(e[t],"\n")>=0)return!1;return!0}(H)?"["+j(H,w)+"]":"[ "+H.join(", ")+" ]"}if(function(e){return!("[object Error]"!==D(e)||T&&"object"==typeof e&&T in e)}(t)){var z=F(t,I);return 0===z.length?"["+String(t)+"]":"{ ["+String(t)+"] "+z.join(", ")+" }"}if("object"==typeof t&&c){if(k&&"function"==typeof t[k])return t[k]();if("symbol"!==c&&"function"==typeof t.inspect)return t.inspect()}if(function(e){if(!s||!e||"object"!=typeof e)return!1;try{s.call(e);try{l.call(e)}catch(e){return!0}return e instanceof Map}catch(e){}return!1}(t)){var W=[];return o.call(t,(function(e,i){W.push(I(i,t,!0)+" => "+I(e,t))})),K("Map",s.call(t),W,w)}if(function(e){if(!l||!e||"object"!=typeof e)return!1;try{l.call(e);try{s.call(e)}catch(e){return!0}return e instanceof Set}catch(e){}return!1}(t)){var Y=[];return h.call(t,(function(e){Y.push(I(e,t))})),K("Set",l.call(t),Y,w)}if(function(e){if(!u||!e||"object"!=typeof e)return!1;try{u.call(e,u);try{d.call(e,d)}catch(e){return!0}return e instanceof WeakMap}catch(e){}return!1}(t))return L("WeakMap");if(function(e){if(!d||!e||"object"!=typeof e)return!1;try{d.call(e,d);try{u.call(e,u)}catch(e){return!0}return e instanceof WeakSet}catch(e){}return!1}(t))return L("WeakSet");if(function(e){if(!p||!e||"object"!=typeof e)return!1;try{return p.call(e),!0}catch(e){}return!1}(t))return L("WeakRef");if(function(e){return!("[object Number]"!==D(e)||T&&"object"==typeof e&&T in e)}(t))return U(I(Number(t)));if(function(e){if(!e||"object"!=typeof e||!y)return!1;try{return y.call(e),!0}catch(e){}return!1}(t))return U(I(y.call(t)));if(function(e){return!("[object Boolean]"!==D(e)||T&&"object"==typeof e&&T in e)}(t))return U(g.call(t));if(function(e){return!("[object String]"!==D(e)||T&&"object"==typeof e&&T in e)}(t))return U(I(String(t)));if(!function(e){return!("[object Date]"!==D(e)||T&&"object"==typeof e&&T in e)}(t)&&!function(e){return!("[object RegExp]"!==D(e)||T&&"object"==typeof e&&T in e)}(t)){var J=F(t,I),Q=E?E(t)===Object.prototype:t instanceof Object||t.constructor===Object,X=t instanceof Object?"":"null prototype",Z=!Q&&T&&Object(t)===t&&T in t?D(t).slice(8,-1):X?"Object":"",ee=(Q||"function"!=typeof t.constructor?"":t.constructor.name?t.constructor.name+" ":"")+(Z||X?"["+[].concat(Z||[],X||[]).join(": ")+"] ":"");return 0===J.length?ee+"{}":w?ee+"{"+j(J,w)+"}":ee+"{ "+J.join(", ")+" }"}return String(t)};var A=Object.prototype.hasOwnProperty||function(e){return e in this};function P(e,t){return A.call(e,t)}function D(e){return f.call(e)}function M(e,t){if(e.indexOf)return e.indexOf(t);for(var i=0,n=e.length;i<n;i++)if(e[i]===t)return i;return-1}function N(e,t){if(e.length>t.maxStringLength){var i=e.length-t.maxStringLength,n="... "+i+" more character"+(i>1?"s":"");return N(e.slice(0,t.maxStringLength),t)+n}return C(e.replace(/(['\\])/g,"\\$1").replace(/[\x00-\x1f]/g,B),"single",t)}function B(e){var t=e.charCodeAt(0),i={8:"b",9:"t",10:"n",12:"f",13:"r"}[t];return i?"\\"+i:"\\x"+(t<16?"0":"")+t.toString(16).toUpperCase()}function U(e){return"Object("+e+")"}function L(e){return e+" { ? }"}function K(e,t,i,n){return e+" ("+t+") {"+(n?j(i,n):i.join(", "))+"}"}function j(e,t){if(0===e.length)return"";var i="\n"+t.prev+t.base;return i+e.join(","+i)+"\n"+t.prev}function F(e,t){var i=R(e),n=[];if(i){n.length=e.length;for(var r=0;r<e.length;r++)n[r]=P(e,r)?t(e[r],e):""}var s,o="function"==typeof _?_(e):[];if(b){s={};for(var a=0;a<o.length;a++)s["$"+o[a]]=o[a]}for(var c in e)P(e,c)&&(i&&String(Number(c))===c&&c<e.length||b&&s["$"+c]instanceof Symbol||(/[^\w$]/.test(c)?n.push(t(c,e)+": "+t(e[c],e)):n.push(c+": "+t(e[c],e))));if("function"==typeof _)for(var l=0;l<o.length;l++)w.call(e,o[l])&&n.push("["+t(o[l])+"]: "+t(e[o[l]],e));return n}},3267:function(e,t,i){var n,r,s;(function(o,a){var c=(o=o||i(4158)).window,l=o.document,h=new function(){var e=/^(statics|enumerable|beans|preserve)$/,t=[],i=t.slice,n=Object.create,r=Object.getOwnPropertyDescriptor,s=Object.defineProperty,o=t.forEach||function(e,t){for(var i=0,n=this.length;i<n;i++)e.call(t,this[i],i,this)},c=function(e,t){for(var i in this)this.hasOwnProperty(i)&&e.call(t,this[i],i,this)},l=Object.assign||function(e){for(var t=1,i=arguments.length;t<i;t++){var n=arguments[t];for(var r in n)n.hasOwnProperty(r)&&(e[r]=n[r])}return e},h=function(e,t,i){if(e){var n=r(e,"length");(n&&"number"==typeof n.value?o:c).call(e,t,i=i||e)}return i};function u(t,i,n,o,a){var c={};function l(e,l){"string"==typeof(l=l||(l=r(i,e))&&(l.get?l:l.value))&&"#"===l[0]&&(l=t[l.substring(1)]||l);var h,u="function"==typeof l,p=l,g=a||u&&!l.base?l&&l.get?e in t:t[e]:null;a&&g||(u&&g&&(l.base=g),u&&!1!==o&&(h=e.match(/^([gs]et|is)(([A-Z])(.*))$/))&&(c[h[3].toLowerCase()+h[4]]=h[2]),p&&!u&&p.get&&"function"==typeof p.get&&d.isPlainObject(p)||(p={value:p,writable:!0}),(r(t,e)||{configurable:!0}).configurable&&(p.configurable=!0,p.enumerable=null!=n?n:!h),s(t,e,p))}if(i){for(var h in i)i.hasOwnProperty(h)&&!e.test(h)&&l(h);for(var h in c){var u=c[h],p=t["set"+u],g=t["get"+u]||p&&t["is"+u];!g||!0!==o&&0!==g.length||l(h,{get:g,set:p})}}return t}function d(){for(var e=0,t=arguments.length;e<t;e++){var i=arguments[e];i&&l(this,i)}return this}return u(d,{inject:function(e){if(e){var t=!0===e.statics?e:e.statics,i=e.beans,n=e.preserve;t!==e&&u(this.prototype,e,e.enumerable,i,n),u(this,t,null,i,n)}for(var r=1,s=arguments.length;r<s;r++)this.inject(arguments[r]);return this},extend:function(){for(var e,t,i,r=this,o=0,a=arguments.length;o<a&&(!e||!t);o++)i=arguments[o],e=e||i.initialize,t=t||i.prototype;return t=(e=e||function(){r.apply(this,arguments)}).prototype=t||n(this.prototype),s(t,"constructor",{value:e,writable:!0,configurable:!0}),u(e,this),arguments.length&&this.inject.apply(e,arguments),e.base=r,e}}).inject({enumerable:!1,initialize:d,set:d,inject:function(){for(var e=0,t=arguments.length;e<t;e++){var i=arguments[e];i&&u(this,i,i.enumerable,i.beans,i.preserve)}return this},extend:function(){var e=n(this);return e.inject.apply(e,arguments)},each:function(e,t){return h(this,e,t)},clone:function(){return new this.constructor(this)},statics:{set:l,each:h,create:n,define:s,describe:r,clone:function(e){return l(new e.constructor,e)},isPlainObject:function(e){var t=null!=e&&e.constructor;return t&&(t===Object||t===d||"Object"===t.name)},pick:function(e,t){return e!==a?e:t},slice:function(e,t,n){return i.call(e,t,n)}}})};e.exports=h,h.inject({enumerable:!1,toString:function(){return null!=this._id?(this._class||"Object")+(this._name?" '"+this._name+"'":" @"+this._id):"{ "+h.each(this,(function(e,t){if(!/^_/.test(t)){var i=typeof e;this.push(t+": "+("number"===i?f.instance.number(e):"string"===i?"'"+e+"'":e))}}),[]).join(", ")+" }"},getClassName:function(){return this._class||""},importJSON:function(e){return h.importJSON(e,this)},exportJSON:function(e){return h.exportJSON(this,e)},toJSON:function(){return h.serialize(this)},set:function(e,t){return e&&h.filter(this,e,t,this._prioritize),this}},{beans:!1,statics:{exports:{},extend:function e(){var t=e.base.apply(this,arguments),i=t.prototype._class;return i&&!h.exports[i]&&(h.exports[i]=t),t},equals:function(e,t){if(e===t)return!0;if(e&&e.equals)return e.equals(t);if(t&&t.equals)return t.equals(e);if(e&&t&&"object"==typeof e&&"object"==typeof t){if(Array.isArray(e)&&Array.isArray(t)){if((i=e.length)!==t.length)return!1;for(;i--;)if(!h.equals(e[i],t[i]))return!1}else{var i,n=Object.keys(e);if((i=n.length)!==Object.keys(t).length)return!1;for(;i--;){var r=n[i];if(!t.hasOwnProperty(r)||!h.equals(e[r],t[r]))return!1}}return!0}return!1},read:function(e,t,i,n){if(this===h){var r=this.peek(e,t);return e.__index++,r}var s=this.prototype,o=s._readIndex,c=t||o&&e.__index||0,l=e.length,u=e[c];if(n=n||l-c,u instanceof this||i&&i.readNull&&null==u&&n<=1)return o&&(e.__index=c+1),u&&i&&i.clone?u.clone():u;if(u=h.create(s),o&&(u.__read=!0),u=u.initialize.apply(u,c>0||c+n<l?h.slice(e,c,c+n):e)||u,o){e.__index=c+u.__read;var d=u.__filtered;d&&(e.__filtered=d,u.__filtered=a),u.__read=a}return u},peek:function(e,t){return e[e.__index=t||e.__index||0]},remain:function(e){return e.length-(e.__index||0)},readList:function(e,t,i,n){for(var r,s=[],o=t||0,a=n?o+n:e.length,c=o;c<a;c++)s.push(Array.isArray(r=e[c])?this.read(r,0,i):this.read(e,c,i,1));return s},readNamed:function(e,t,i,n,r){var s=this.getNamed(e,t),o=s!==a;if(o){var c=e.__filtered;if(!c){var l=this.getSource(e);(c=e.__filtered=h.create(l)).__unfiltered=l}c[t]=a}return this.read(o?[s]:e,i,n,r)},readSupported:function(e,t){var i=this.getSource(e),n=this,r=!1;return i&&Object.keys(i).forEach((function(i){if(i in t){var s=n.readNamed(e,i);s!==a&&(t[i]=s),r=!0}})),r},getSource:function(e){var t=e.__source;if(t===a){var i=1===e.length&&e[0];t=e.__source=i&&h.isPlainObject(i)?i:null}return t},getNamed:function(e,t){var i=this.getSource(e);if(i)return t?i[t]:e.__filtered||i},hasNamed:function(e,t){return!!this.getNamed(e,t)},filter:function(e,t,i,n){var r;function s(n){if(!(i&&n in i||r&&n in r)){var s=t[n];s!==a&&(e[n]=s)}}if(n){for(var o,c={},l=0,h=n.length;l<h;l++)(o=n[l])in t&&(s(o),c[o]=!0);r=c}return Object.keys(t.__unfiltered||t).forEach(s),e},isPlainValue:function(e,t){return h.isPlainObject(e)||Array.isArray(e)||t&&"string"==typeof e},serialize:function(e,t,i,n){t=t||{};var r,s=!n;if(s&&(t.formatter=new f(t.precision),n={length:0,definitions:{},references:{},add:function(e,t){var i="#"+e._id,n=this.references[i];if(!n){this.length++;var r=t.call(e),s=e._class;s&&r[0]!==s&&r.unshift(s),this.definitions[i]=r,n=this.references[i]=[i]}return n}}),e&&e._serialize){r=e._serialize(t,n);var o=e._class;!o||e._compactSerialize||!s&&i||r[0]===o||r.unshift(o)}else if(Array.isArray(e)){r=[];for(var a=0,c=e.length;a<c;a++)r[a]=h.serialize(e[a],t,i,n)}else if(h.isPlainObject(e)){r={};var l=Object.keys(e);for(a=0,c=l.length;a<c;a++){var u=l[a];r[u]=h.serialize(e[u],t,i,n)}}else r="number"==typeof e?t.formatter.number(e,t.precision):e;return s&&n.length>0?[["dictionary",n.definitions],r]:r},deserialize:function(e,t,i,n,r){var s=e,o=!i,a=o&&e&&e.length&&"dictionary"===e[0][0];if(i=i||{},Array.isArray(e)){var c=e[0],l="dictionary"===c;if(1==e.length&&/^#/.test(c))return i.dictionary[c];s=[];for(var u=(c=h.exports[c])?1:0,d=e.length;u<d;u++)s.push(h.deserialize(e[u],t,i,l,a));if(c){var p=s;s=t?t(c,p,o||r):new c(p)}}else if(h.isPlainObject(e))for(var g in s={},n&&(i.dictionary=s),e)s[g]=h.deserialize(e[g],t,i);return a?s[1]:s},exportJSON:function(e,t){var i=h.serialize(e,t);return t&&0==t.asString?i:JSON.stringify(i)},importJSON:function(e,t){return h.deserialize("string"==typeof e?JSON.parse(e):e,(function(e,i,n){var r=n&&t&&t.constructor===e,s=r?t:h.create(e.prototype);if(1===i.length&&s instanceof C&&(r||!(s instanceof R))){var o=i[0];h.isPlainObject(o)&&(o.insert=!1,r&&(i=i.concat([{insert:!0}])))}return(r?s.set:e).apply(s,i),r&&(t=null),s}))},push:function(e,t){var i=t.length;if(i<4096)e.push.apply(e,t);else{var n=e.length;e.length+=i;for(var r=0;r<i;r++)e[n+r]=t[r]}return e},splice:function(e,t,i,n){var r=t&&t.length,s=i===a;(i=s?e.length:i)>e.length&&(i=e.length);for(var o=0;o<r;o++)t[o]._index=i+o;if(s)return h.push(e,t),[];var c=[i,n];t&&h.push(c,t);for(var l=e.splice.apply(e,c),u=(o=0,l.length);o<u;o++)l[o]._index=a;for(o=i+r,u=e.length;o<u;o++)e[o]._index=o;return l},capitalize:function(e){return e.replace(/\b[a-z]/g,(function(e){return e.toUpperCase()}))},camelize:function(e){return e.replace(/-(.)/g,(function(e,t){return t.toUpperCase()}))},hyphenate:function(e){return e.replace(/([a-z])([A-Z])/g,"$1-$2").toLowerCase()}}});var u={on:function(e,t){if("string"!=typeof e)h.each(e,(function(e,t){this.on(t,e)}),this);else{var i=this._eventTypes,n=i&&i[e],r=this._callbacks=this._callbacks||{};-1===(r=r[e]=r[e]||[]).indexOf(t)&&(r.push(t),n&&n.install&&1===r.length&&n.install.call(this,e))}return this},off:function(e,t){if("string"==typeof e){var i,n=this._eventTypes,r=n&&n[e],s=this._callbacks&&this._callbacks[e];return s&&(!t||-1!==(i=s.indexOf(t))&&1===s.length?(r&&r.uninstall&&r.uninstall.call(this,e),delete this._callbacks[e]):-1!==i&&s.splice(i,1)),this}h.each(e,(function(e,t){this.off(t,e)}),this)},once:function(e,t){return this.on(e,(function i(){t.apply(this,arguments),this.off(e,i)}))},emit:function(e,t){var i=this._callbacks&&this._callbacks[e];if(!i)return!1;var n=h.slice(arguments,1),r=t&&t.target&&!t.currentTarget;i=i.slice(),r&&(t.currentTarget=this);for(var s=0,o=i.length;s<o;s++)if(0==i[s].apply(this,n)){t&&t.stop&&t.stop();break}return r&&delete t.currentTarget,!0},responds:function(e){return!(!this._callbacks||!this._callbacks[e])},attach:"#on",detach:"#off",fire:"#emit",_installEvents:function(e){var t=this._eventTypes,i=this._callbacks,n=e?"install":"uninstall";if(t)for(var r in i)if(i[r].length>0){var s=t[r],o=s&&s[n];o&&o.call(this,r)}},statics:{inject:function e(t){var i=t._events;if(i){var n={};h.each(i,(function(e,i){var r="string"==typeof e,s=r?e:i,o=h.capitalize(s),a=s.substring(2).toLowerCase();n[a]=r?{}:e,s="_"+s,t["get"+o]=function(){return this[s]},t["set"+o]=function(e){var t=this[s];t&&this.off(a,t),e&&this.on(a,e),this[s]=e}})),t._eventTypes=n}return e.base.apply(this,arguments)}}},d=h.extend({_class:"PaperScope",initialize:function e(){de=this,this.settings=new h({applyMatrix:!0,insertItems:!0,handleSize:4,hitTolerance:0}),this.project=null,this.projects=[],this.tools=[],this._id=e._id++,e._scopes[this._id]=this;var t=e.prototype;if(!this.support){var i=ce.getContext(1,1)||{};t.support={nativeDash:"setLineDash"in i||"mozDash"in i,nativeBlendModes:le.nativeModes},ce.release(i)}if(!this.agent){var n=o.navigator.userAgent.toLowerCase(),r=(/(darwin|win|mac|linux|freebsd|sunos)/.exec(n)||[])[0],s="darwin"===r?"mac":r,a=t.agent=t.browser={platform:s};s&&(a[s]=!0),n.replace(/(opera|chrome|safari|webkit|firefox|msie|trident|atom|node|jsdom)\/?\s*([.\d]+)(?:.*version\/([.\d]+))?(?:.*rv\:v?([.\d]+))?/g,(function(e,t,i,n,r){if(!a.chrome){var s="opera"===t?n:/^(node|trident)$/.test(t)?r:i;a.version=s,a.versionNumber=parseFloat(s),t={trident:"msie",jsdom:"node"}[t]||t,a.name=t,a[t]=!0}})),a.chrome&&delete a.webkit,a.atom&&delete a.chrome}},version:"0.12.15",getView:function(){var e=this.project;return e&&e._view},getPaper:function(){return this},execute:function(e,t){var i=de.PaperScript.execute(e,this,t);return X.updateFocus(),i},install:function(e){var t=this;for(var i in h.each(["project","view","tool"],(function(i){h.define(e,i,{configurable:!0,get:function(){return t[i]}})})),this)!/^_/.test(i)&&this[i]&&(e[i]=this[i])},setup:function(e){return de=this,this.project=new T(e),this},createCanvas:function(e,t){return ce.getCanvas(e,t)},activate:function(){de=this},clear:function(){for(var e=this.projects,t=this.tools,i=e.length-1;i>=0;i--)e[i].remove();for(i=t.length-1;i>=0;i--)t[i].remove()},remove:function(){this.clear(),delete d._scopes[this._id]},statics:new function(){function e(e){return e+="Attribute",function(t,i){return t[e](i)||t[e]("data-paper-"+i)}}return{_scopes:{},_id:0,get:function(e){return this._scopes[e]||null},getAttribute:e("get"),hasAttribute:e("has")}}}),p=h.extend(u,{initialize:function(e){this._scope=de,this._index=this._scope[this._list].push(this)-1,!e&&this._scope[this._reference]||this.activate()},activate:function(){if(!this._scope)return!1;var e=this._scope[this._reference];return e&&e!==this&&e.emit("deactivate"),this._scope[this._reference]=this,this.emit("activate",e),!0},isActive:function(){return this._scope[this._reference]===this},remove:function(){return null!=this._index&&(h.splice(this._scope[this._list],null,this._index,1),this._scope[this._reference]==this&&(this._scope[this._reference]=null),this._scope=null,!0)},getView:function(){return this._scope.getView()}}),g={findItemBoundsCollisions:function(e,t,i){function n(e){for(var t=new Array(e.length),i=0;i<e.length;i++){var n=e[i].getBounds();t[i]=[n.left,n.top,n.right,n.bottom]}return t}var r=n(e),s=t&&t!==e?n(t):r;return this.findBoundsCollisions(r,s,i||0)},findCurveBoundsCollisions:function(e,t,i,n){function r(e){for(var t=Math.min,i=Math.max,n=new Array(e.length),r=0;r<e.length;r++){var s=e[r];n[r]=[t(s[0],s[2],s[4],s[6]),t(s[1],s[3],s[5],s[7]),i(s[0],s[2],s[4],s[6]),i(s[1],s[3],s[5],s[7])]}return n}var s=r(e),o=t&&t!==e?r(t):s;if(n){for(var a=this.findBoundsCollisions(s,o,i||0,!1,!0),c=this.findBoundsCollisions(s,o,i||0,!0,!0),l=[],h=0,u=a.length;h<u;h++)l[h]={hor:a[h],ver:c[h]};return l}return this.findBoundsCollisions(s,o,i||0)},findBoundsCollisions:function(e,t,i,n,r){var s=!t||e===t,o=s?e:e.concat(t),a=e.length,c=o.length;function l(e,t,i){for(var n=0,r=e.length;n<r;){var s=r+n>>>1;o[e[s]][t]<i?n=s+1:r=s}return n-1}for(var h=n?1:0,u=h+2,d=n?0:1,p=d+2,g=new Array(c),f=0;f<c;f++)g[f]=f;g.sort((function(e,t){return o[e][h]-o[t][h]}));var m=[],v=new Array(a);for(f=0;f<c;f++){var y=g[f],_=o[y],S=s?y:y-a,b=y<a,w=s||!b,E=b?[]:null;if(m.length){var I=l(m,u,_[h]-i)+1;if(m.splice(0,I),s&&r){E=E.concat(m);for(var k=0;k<m.length;k++)v[x=m[k]].push(S)}else{var T=_[p],C=_[d];for(k=0;k<m.length;k++){var x=m[k],R=o[x],O=x<a,A=s||x>=a;(r||(b&&A||w&&O)&&T>=R[d]-i&&C<=R[p]+i)&&(b&&A&&E.push(s?x:x-a),w&&O&&v[x].push(S))}}}if(b&&(e===t&&E.push(y),v[y]=E),m.length){var P=l(m,u,_[u]);m.splice(P+1,0,y)}else m.push(y)}for(f=0;f<v.length;f++){var D=v[f];D&&D.sort((function(e,t){return e-t}))}return v}},f=h.extend({initialize:function(e){this.precision=h.pick(e,5),this.multiplier=Math.pow(10,this.precision)},number:function(e){return this.precision<16?Math.round(e*this.multiplier)/this.multiplier:e},pair:function(e,t,i){return this.number(e)+(i||",")+this.number(t)},point:function(e,t){return this.number(e.x)+(t||",")+this.number(e.y)},size:function(e,t){return this.number(e.width)+(t||",")+this.number(e.height)},rectangle:function(e,t){return this.point(e,t)+(t||",")+this.size(e,t)}});f.instance=new f;var m=new function(){var e=[[.5773502691896257],[0,.7745966692414834],[.33998104358485626,.8611363115940526],[0,.5384693101056831,.906179845938664],[.2386191860831969,.6612093864662645,.932469514203152],[0,.4058451513773972,.7415311855993945,.9491079123427585],[.1834346424956498,.525532409916329,.7966664774136267,.9602898564975363],[0,.3242534234038089,.6133714327005904,.8360311073266358,.9681602395076261],[.14887433898163122,.4333953941292472,.6794095682990244,.8650633666889845,.9739065285171717],[0,.26954315595234496,.5190961292068118,.7301520055740494,.8870625997680953,.978228658146057],[.1252334085114689,.3678314989981802,.5873179542866175,.7699026741943047,.9041172563704749,.9815606342467192],[0,.2304583159551348,.44849275103644687,.6423493394403402,.8015780907333099,.9175983992229779,.9841830547185881],[.10805494870734367,.31911236892788974,.5152486363581541,.6872929048116855,.827201315069765,.9284348836635735,.9862838086968123],[0,.20119409399743451,.3941513470775634,.5709721726085388,.7244177313601701,.8482065834104272,.937273392400706,.9879925180204854],[.09501250983763744,.2816035507792589,.45801677765722737,.6178762444026438,.755404408355003,.8656312023878318,.9445750230732326,.9894009349916499]],t=[[1],[.8888888888888888,.5555555555555556],[.6521451548625461,.34785484513745385],[.5688888888888889,.47862867049936647,.23692688505618908],[.46791393457269104,.3607615730481386,.17132449237917036],[.4179591836734694,.3818300505051189,.27970539148927664,.1294849661688697],[.362683783378362,.31370664587788727,.22238103445337448,.10122853629037626],[.3302393550012598,.31234707704000286,.26061069640293544,.1806481606948574,.08127438836157441],[.29552422471475287,.26926671930999635,.21908636251598204,.1494513491505806,.06667134430868814],[.2729250867779006,.26280454451024665,.23319376459199048,.18629021092773426,.1255803694649046,.05566856711617366],[.24914704581340277,.2334925365383548,.20316742672306592,.16007832854334622,.10693932599531843,.04717533638651183],[.2325515532308739,.22628318026289723,.2078160475368885,.17814598076194574,.13887351021978725,.09212149983772845,.04048400476531588],[.2152638534631578,.2051984637212956,.18553839747793782,.15720316715819355,.12151857068790319,.08015808715976021,.03511946033175186],[.2025782419255613,.19843148532711158,.1861610000155622,.16626920581699392,.13957067792615432,.10715922046717194,.07036604748810812,.03075324199611727],[.1894506104550685,.18260341504492358,.16915651939500254,.14959598881657674,.12462897125553388,.09515851168249279,.062253523938647894,.027152459411754096]],i=Math.abs,n=Math.sqrt,r=Math.pow,s=Math.log2||function(e){return Math.log(e)*Math.LOG2E},o=1e-12,a=112e-18;function c(e,t,i){return e<t?t:e>i?i:e}function l(e,t,n){function r(e){var t=134217729*e,i=e-t+t;return[i,e-i]}var s=t*t-e*n,o=t*t+e*n;if(3*i(s)<o){var a=r(e),c=r(t),l=r(n),h=t*t,u=e*n;s=h-u+(c[0]*c[0]-h+2*c[0]*c[1]+c[1]*c[1]-(a[0]*l[0]-u+a[0]*l[1]+a[1]*l[0]+a[1]*l[1]))}return s}function h(){var e=Math.max.apply(Math,arguments);return e&&(e<1e-8||e>1e8)?r(2,-Math.round(s(e))):0}return{EPSILON:o,MACHINE_EPSILON:a,CURVETIME_EPSILON:1e-8,GEOMETRIC_EPSILON:1e-7,TRIGONOMETRIC_EPSILON:1e-8,KAPPA:4*(n(2)-1)/3,isZero:function(e){return e>=-1e-12&&e<=o},isMachineZero:function(e){return e>=-112e-18&&e<=a},clamp:c,integrate:function(i,n,r,s){for(var o=e[s-2],a=t[s-2],c=.5*(r-n),l=c+n,h=0,u=s+1>>1,d=1&s?a[h++]*i(l):0;h<u;){var p=c*o[h];d+=a[h++]*(i(l+p)+i(l-p))}return c*d},findRoot:function(e,t,n,r,s,o,a){for(var l=0;l<o;l++){var h=e(n),u=h/t(n),d=n-u;if(i(u)<a){n=d;break}h>0?(s=n,n=d<=r?.5*(r+s):d):(r=n,n=d>=s?.5*(r+s):d)}return c(n,r,s)},solveQuadratic:function(e,t,r,s,u,d){var p,g=1/0;if(i(e)<o){if(i(t)<o)return i(r)<o?-1:0;p=-r/t}else{var f=l(e,t*=-.5,r);if(f&&i(f)<a){var m=h(i(e),i(t),i(r));m&&(f=l(e*=m,t*=m,r*=m))}if(f>=-112e-18){var v=f<0?0:n(f),y=t+(t<0?-v:v);0===y?g=-(p=r/e):(p=y/e,g=r/y)}}var _=0,S=null==u,b=u-o,w=d+o;return isFinite(p)&&(S||p>b&&p<w)&&(s[_++]=S?p:c(p,u,d)),g!==p&&isFinite(g)&&(S||g>b&&g<w)&&(s[_++]=S?g:c(g,u,d)),_},solveCubic:function(e,t,s,l,u,d,p){var g,f,v,y,_,S=h(i(e),i(t),i(s),i(l));function b(i){var n=e*(g=i);y=(n+(f=n+t))*g+(v=f*g+s),_=v*g+l}if(S&&(e*=S,t*=S,s*=S,l*=S),i(e)<o)e=t,f=s,v=l,g=1/0;else if(i(l)<o)f=t,v=s,g=0;else{b(-t/e/3);var w=_/e,E=r(i(w),1/3),I=w<0?-1:1,k=-y/e,T=k>0?1.324717957244746*Math.max(E,n(k)):E,C=g-I*T;if(C!==g){do{b(C),C=0===y?g:g-_/y/(1+a)}while(I*C>I*g);i(e)*g*g>i(l/g)&&(f=((v=-l/g)-s)/g)}}var x=m.solveQuadratic(e,f,v,u,d,p),R=null==d;return isFinite(g)&&(0===x||x>0&&g!==u[0]&&g!==u[1])&&(R||g>d-o&&g<p+o)&&(u[x++]=R?g:c(g,d,p)),x}}},v={_id:1,_pools:{},get:function(e){if(e){var t=this._pools[e];return t||(t=this._pools[e]={_id:1}),t._id++}return this._id++}},y=h.extend({_class:"Point",_readIndex:!0,initialize:function(e,t){var i=typeof e,n=this.__read,r=0;if("number"===i){var s="number"==typeof t;this._set(e,s?t:e),n&&(r=s?2:1)}else if("undefined"===i||null===e)this._set(0,0),n&&(r=null===e?1:0);else{var o="string"===i?e.split(/[\s,]+/)||[]:e;r=1,Array.isArray(o)?this._set(+o[0],+(o.length>1?o[1]:o[0])):"x"in o?this._set(o.x||0,o.y||0):"width"in o?this._set(o.width||0,o.height||0):"angle"in o?(this._set(o.length||0,0),this.setAngle(o.angle||0)):(this._set(0,0),r=0)}return n&&(this.__read=r),this},set:"#initialize",_set:function(e,t){return this.x=e,this.y=t,this},equals:function(e){return this===e||e&&(this.x===e.x&&this.y===e.y||Array.isArray(e)&&this.x===e[0]&&this.y===e[1])||!1},clone:function(){return new y(this.x,this.y)},toString:function(){var e=f.instance;return"{ x: "+e.number(this.x)+", y: "+e.number(this.y)+" }"},_serialize:function(e){var t=e.formatter;return[t.number(this.x),t.number(this.y)]},getLength:function(){return Math.sqrt(this.x*this.x+this.y*this.y)},setLength:function(e){if(this.isZero()){var t=this._angle||0;this._set(Math.cos(t)*e,Math.sin(t)*e)}else{var i=e/this.getLength();m.isZero(i)&&this.getAngle(),this._set(this.x*i,this.y*i)}},getAngle:function(){return 180*this.getAngleInRadians.apply(this,arguments)/Math.PI},setAngle:function(e){this.setAngleInRadians.call(this,e*Math.PI/180)},getAngleInDegrees:"#getAngle",setAngleInDegrees:"#setAngle",getAngleInRadians:function(){if(arguments.length){var e=y.read(arguments),t=this.getLength()*e.getLength();if(m.isZero(t))return NaN;var i=this.dot(e)/t;return Math.acos(i<-1?-1:i>1?1:i)}return this.isZero()?this._angle||0:this._angle=Math.atan2(this.y,this.x)},setAngleInRadians:function(e){if(this._angle=e,!this.isZero()){var t=this.getLength();this._set(Math.cos(e)*t,Math.sin(e)*t)}},getQuadrant:function(){return this.x>=0?this.y>=0?1:4:this.y>=0?2:3}},{beans:!1,getDirectedAngle:function(){var e=y.read(arguments);return 180*Math.atan2(this.cross(e),this.dot(e))/Math.PI},getDistance:function(){var e=arguments,t=y.read(e),i=t.x-this.x,n=t.y-this.y,r=i*i+n*n,s=h.read(e);return s?r:Math.sqrt(r)},normalize:function(e){e===a&&(e=1);var t=this.getLength(),i=0!==t?e/t:0,n=new y(this.x*i,this.y*i);return i>=0&&(n._angle=this._angle),n},rotate:function(e,t){if(0===e)return this.clone();e=e*Math.PI/180;var i=t?this.subtract(t):this,n=Math.sin(e),r=Math.cos(e);return i=new y(i.x*r-i.y*n,i.x*n+i.y*r),t?i.add(t):i},transform:function(e){return e?e._transformPoint(this):this},add:function(){var e=y.read(arguments);return new y(this.x+e.x,this.y+e.y)},subtract:function(){var e=y.read(arguments);return new y(this.x-e.x,this.y-e.y)},multiply:function(){var e=y.read(arguments);return new y(this.x*e.x,this.y*e.y)},divide:function(){var e=y.read(arguments);return new y(this.x/e.x,this.y/e.y)},modulo:function(){var e=y.read(arguments);return new y(this.x%e.x,this.y%e.y)},negate:function(){return new y(-this.x,-this.y)},isInside:function(){return w.read(arguments).contains(this)},isClose:function(){var e=arguments,t=y.read(e),i=h.read(e);return this.getDistance(t)<=i},isCollinear:function(){var e=y.read(arguments);return y.isCollinear(this.x,this.y,e.x,e.y)},isColinear:"#isCollinear",isOrthogonal:function(){var e=y.read(arguments);return y.isOrthogonal(this.x,this.y,e.x,e.y)},isZero:function(){var e=m.isZero;return e(this.x)&&e(this.y)},isNaN:function(){return isNaN(this.x)||isNaN(this.y)},isInQuadrant:function(e){return this.x*(e>1&&e<4?-1:1)>=0&&this.y*(e>2?-1:1)>=0},dot:function(){var e=y.read(arguments);return this.x*e.x+this.y*e.y},cross:function(){var e=y.read(arguments);return this.x*e.y-this.y*e.x},project:function(){var e=y.read(arguments),t=e.isZero()?0:this.dot(e)/e.dot(e);return new y(e.x*t,e.y*t)},statics:{min:function(){var e=arguments,t=y.read(e),i=y.read(e);return new y(Math.min(t.x,i.x),Math.min(t.y,i.y))},max:function(){var e=arguments,t=y.read(e),i=y.read(e);return new y(Math.max(t.x,i.x),Math.max(t.y,i.y))},random:function(){return new y(Math.random(),Math.random())},isCollinear:function(e,t,i,n){return Math.abs(e*n-t*i)<=1e-8*Math.sqrt((e*e+t*t)*(i*i+n*n))},isOrthogonal:function(e,t,i,n){return Math.abs(e*i+t*n)<=1e-8*Math.sqrt((e*e+t*t)*(i*i+n*n))}}},h.each(["round","ceil","floor","abs"],(function(e){var t=Math[e];this[e]=function(){return new y(t(this.x),t(this.y))}}),{})),_=y.extend({initialize:function(e,t,i,n){this._x=e,this._y=t,this._owner=i,this._setter=n},_set:function(e,t,i){return this._x=e,this._y=t,i||this._owner[this._setter](this),this},getX:function(){return this._x},setX:function(e){this._x=e,this._owner[this._setter](this)},getY:function(){return this._y},setY:function(e){this._y=e,this._owner[this._setter](this)},isSelected:function(){return!!(this._owner._selection&this._getSelection())},setSelected:function(e){this._owner._changeSelection(this._getSelection(),e)},_getSelection:function(){return"setPosition"===this._setter?4:0}}),S=h.extend({_class:"Size",_readIndex:!0,initialize:function(e,t){var i=typeof e,n=this.__read,r=0;if("number"===i){var s="number"==typeof t;this._set(e,s?t:e),n&&(r=s?2:1)}else if("undefined"===i||null===e)this._set(0,0),n&&(r=null===e?1:0);else{var o="string"===i?e.split(/[\s,]+/)||[]:e;r=1,Array.isArray(o)?this._set(+o[0],+(o.length>1?o[1]:o[0])):"width"in o?this._set(o.width||0,o.height||0):"x"in o?this._set(o.x||0,o.y||0):(this._set(0,0),r=0)}return n&&(this.__read=r),this},set:"#initialize",_set:function(e,t){return this.width=e,this.height=t,this},equals:function(e){return e===this||e&&(this.width===e.width&&this.height===e.height||Array.isArray(e)&&this.width===e[0]&&this.height===e[1])||!1},clone:function(){return new S(this.width,this.height)},toString:function(){var e=f.instance;return"{ width: "+e.number(this.width)+", height: "+e.number(this.height)+" }"},_serialize:function(e){var t=e.formatter;return[t.number(this.width),t.number(this.height)]},add:function(){var e=S.read(arguments);return new S(this.width+e.width,this.height+e.height)},subtract:function(){var e=S.read(arguments);return new S(this.width-e.width,this.height-e.height)},multiply:function(){var e=S.read(arguments);return new S(this.width*e.width,this.height*e.height)},divide:function(){var e=S.read(arguments);return new S(this.width/e.width,this.height/e.height)},modulo:function(){var e=S.read(arguments);return new S(this.width%e.width,this.height%e.height)},negate:function(){return new S(-this.width,-this.height)},isZero:function(){var e=m.isZero;return e(this.width)&&e(this.height)},isNaN:function(){return isNaN(this.width)||isNaN(this.height)},statics:{min:function(e,t){return new S(Math.min(e.width,t.width),Math.min(e.height,t.height))},max:function(e,t){return new S(Math.max(e.width,t.width),Math.max(e.height,t.height))},random:function(){return new S(Math.random(),Math.random())}}},h.each(["round","ceil","floor","abs"],(function(e){var t=Math[e];this[e]=function(){return new S(t(this.width),t(this.height))}}),{})),b=S.extend({initialize:function(e,t,i,n){this._width=e,this._height=t,this._owner=i,this._setter=n},_set:function(e,t,i){return this._width=e,this._height=t,i||this._owner[this._setter](this),this},getWidth:function(){return this._width},setWidth:function(e){this._width=e,this._owner[this._setter](this)},getHeight:function(){return this._height},setHeight:function(e){this._height=e,this._owner[this._setter](this)}}),w=h.extend({_class:"Rectangle",_readIndex:!0,beans:!0,initialize:function(e,t,i,n){var r,s=arguments,o=typeof e;if("number"===o?(this._set(e,t,i,n),r=4):"undefined"===o||null===e?(this._set(0,0,0,0),r=null===e?1:0):1===s.length&&(Array.isArray(e)?(this._set.apply(this,e),r=1):e.x!==a||e.width!==a?(this._set(e.x||0,e.y||0,e.width||0,e.height||0),r=1):e.from===a&&e.to===a&&(this._set(0,0,0,0),h.readSupported(s,this)&&(r=1))),r===a){var c,l,u=y.readNamed(s,"from"),d=h.peek(s),p=u.x,g=u.y;if(d&&d.x!==a||h.hasNamed(s,"to")){var f=y.readNamed(s,"to");c=f.x-p,l=f.y-g,c<0&&(p=f.x,c=-c),l<0&&(g=f.y,l=-l)}else{var m=S.read(s);c=m.width,l=m.height}this._set(p,g,c,l),r=s.__index}var v=s.__filtered;return v&&(this.__filtered=v),this.__read&&(this.__read=r),this},set:"#initialize",_set:function(e,t,i,n){return this.x=e,this.y=t,this.width=i,this.height=n,this},clone:function(){return new w(this.x,this.y,this.width,this.height)},equals:function(e){var t=h.isPlainValue(e)?w.read(arguments):e;return t===this||t&&this.x===t.x&&this.y===t.y&&this.width===t.width&&this.height===t.height||!1},toString:function(){var e=f.instance;return"{ x: "+e.number(this.x)+", y: "+e.number(this.y)+", width: "+e.number(this.width)+", height: "+e.number(this.height)+" }"},_serialize:function(e){var t=e.formatter;return[t.number(this.x),t.number(this.y),t.number(this.width),t.number(this.height)]},getPoint:function(e){return new(e?y:_)(this.x,this.y,this,"setPoint")},setPoint:function(){var e=y.read(arguments);this.x=e.x,this.y=e.y},getSize:function(e){return new(e?S:b)(this.width,this.height,this,"setSize")},_fw:1,_fh:1,setSize:function(){var e=S.read(arguments),t=this._sx,i=this._sy,n=e.width,r=e.height;t&&(this.x+=(this.width-n)*t),i&&(this.y+=(this.height-r)*i),this.width=n,this.height=r,this._fw=this._fh=1},getLeft:function(){return this.x},setLeft:function(e){if(!this._fw){var t=e-this.x;this.width-=.5===this._sx?2*t:t}this.x=e,this._sx=this._fw=0},getTop:function(){return this.y},setTop:function(e){if(!this._fh){var t=e-this.y;this.height-=.5===this._sy?2*t:t}this.y=e,this._sy=this._fh=0},getRight:function(){return this.x+this.width},setRight:function(e){if(!this._fw){var t=e-this.x;this.width=.5===this._sx?2*t:t}this.x=e-this.width,this._sx=1,this._fw=0},getBottom:function(){return this.y+this.height},setBottom:function(e){if(!this._fh){var t=e-this.y;this.height=.5===this._sy?2*t:t}this.y=e-this.height,this._sy=1,this._fh=0},getCenterX:function(){return this.x+this.width/2},setCenterX:function(e){this._fw||.5===this._sx?this.x=e-this.width/2:(this._sx&&(this.x+=2*(e-this.x)*this._sx),this.width=2*(e-this.x)),this._sx=.5,this._fw=0},getCenterY:function(){return this.y+this.height/2},setCenterY:function(e){this._fh||.5===this._sy?this.y=e-this.height/2:(this._sy&&(this.y+=2*(e-this.y)*this._sy),this.height=2*(e-this.y)),this._sy=.5,this._fh=0},getCenter:function(e){return new(e?y:_)(this.getCenterX(),this.getCenterY(),this,"setCenter")},setCenter:function(){var e=y.read(arguments);return this.setCenterX(e.x),this.setCenterY(e.y),this},getArea:function(){return this.width*this.height},isEmpty:function(){return 0===this.width||0===this.height},contains:function(e){return e&&e.width!==a||4===(Array.isArray(e)?e:arguments).length?this._containsRectangle(w.read(arguments)):this._containsPoint(y.read(arguments))},_containsPoint:function(e){var t=e.x,i=e.y;return t>=this.x&&i>=this.y&&t<=this.x+this.width&&i<=this.y+this.height},_containsRectangle:function(e){var t=e.x,i=e.y;return t>=this.x&&i>=this.y&&t+e.width<=this.x+this.width&&i+e.height<=this.y+this.height},intersects:function(){var e=w.read(arguments),t=h.read(arguments)||0;return e.x+e.width>this.x-t&&e.y+e.height>this.y-t&&e.x<this.x+this.width+t&&e.y<this.y+this.height+t},intersect:function(){var e=w.read(arguments),t=Math.max(this.x,e.x),i=Math.max(this.y,e.y),n=Math.min(this.x+this.width,e.x+e.width),r=Math.min(this.y+this.height,e.y+e.height);return new w(t,i,n-t,r-i)},unite:function(){var e=w.read(arguments),t=Math.min(this.x,e.x),i=Math.min(this.y,e.y),n=Math.max(this.x+this.width,e.x+e.width),r=Math.max(this.y+this.height,e.y+e.height);return new w(t,i,n-t,r-i)},include:function(){var e=y.read(arguments),t=Math.min(this.x,e.x),i=Math.min(this.y,e.y),n=Math.max(this.x+this.width,e.x),r=Math.max(this.y+this.height,e.y);return new w(t,i,n-t,r-i)},expand:function(){var e=S.read(arguments),t=e.width,i=e.height;return new w(this.x-t/2,this.y-i/2,this.width+t,this.height+i)},scale:function(e,t){return this.expand(this.width*e-this.width,this.height*(t===a?e:t)-this.height)}},h.each([["Top","Left"],["Top","Right"],["Bottom","Left"],["Bottom","Right"],["Left","Center"],["Top","Center"],["Right","Center"],["Bottom","Center"]],(function(e,t){var i=e.join(""),n=/^[RL]/.test(i);t>=4&&(e[1]+=n?"Y":"X");var r=e[n?0:1],s=e[n?1:0],o="get"+r,a="get"+s,c="set"+r,l="set"+s,h="set"+i;this["get"+i]=function(e){return new(e?y:_)(this[o](),this[a](),this,h)},this[h]=function(){var e=y.read(arguments);this[c](e.x),this[l](e.y)}}),{beans:!0})),E=w.extend({initialize:function(e,t,i,n,r,s){this._set(e,t,i,n,!0),this._owner=r,this._setter=s},_set:function(e,t,i,n,r){return this._x=e,this._y=t,this._width=i,this._height=n,r||this._owner[this._setter](this),this}},new function(){var e=w.prototype;return h.each(["x","y","width","height"],(function(e){var t=h.capitalize(e),i="_"+e;this["get"+t]=function(){return this[i]},this["set"+t]=function(e){this[i]=e,this._dontNotify||this._owner[this._setter](this)}}),h.each(["Point","Size","Center","Left","Top","Right","Bottom","CenterX","CenterY","TopLeft","TopRight","BottomLeft","BottomRight","LeftCenter","TopCenter","RightCenter","BottomCenter"],(function(t){var i="set"+t;this[i]=function(){this._dontNotify=!0,e[i].apply(this,arguments),this._dontNotify=!1,this._owner[this._setter](this)}}),{isSelected:function(){return!!(2&this._owner._selection)},setSelected:function(e){var t=this._owner;t._changeSelection&&t._changeSelection(2,e)}}))}),I=h.extend({_class:"Matrix",initialize:function e(t,i){var n=arguments,r=n.length,s=!0;if(r>=6?this._set.apply(this,n):1===r||2===r?t instanceof e?this._set(t._a,t._b,t._c,t._d,t._tx,t._ty,i):Array.isArray(t)?this._set.apply(this,i?t.concat([i]):t):s=!1:r?s=!1:this.reset(),!s)throw new Error("Unsupported matrix parameters");return this},set:"#initialize",_set:function(e,t,i,n,r,s,o){return this._a=e,this._b=t,this._c=i,this._d=n,this._tx=r,this._ty=s,o||this._changed(),this},_serialize:function(e,t){return h.serialize(this.getValues(),e,!0,t)},_changed:function(){var e=this._owner;e&&(e._applyMatrix?e.transform(null,!0):e._changed(25))},clone:function(){return new I(this._a,this._b,this._c,this._d,this._tx,this._ty)},equals:function(e){return e===this||e&&this._a===e._a&&this._b===e._b&&this._c===e._c&&this._d===e._d&&this._tx===e._tx&&this._ty===e._ty},toString:function(){var e=f.instance;return"[["+[e.number(this._a),e.number(this._c),e.number(this._tx)].join(", ")+"], ["+[e.number(this._b),e.number(this._d),e.number(this._ty)].join(", ")+"]]"},reset:function(e){return this._a=this._d=1,this._b=this._c=this._tx=this._ty=0,e||this._changed(),this},apply:function(e,t){var i=this._owner;return!!i&&(i.transform(null,h.pick(e,!0),t),this.isIdentity())},translate:function(){var e=y.read(arguments),t=e.x,i=e.y;return this._tx+=t*this._a+i*this._c,this._ty+=t*this._b+i*this._d,this._changed(),this},scale:function(){var e=arguments,t=y.read(e),i=y.read(e,0,{readNull:!0});return i&&this.translate(i),this._a*=t.x,this._b*=t.x,this._c*=t.y,this._d*=t.y,i&&this.translate(i.negate()),this._changed(),this},rotate:function(e){e*=Math.PI/180;var t=y.read(arguments,1),i=t.x,n=t.y,r=Math.cos(e),s=Math.sin(e),o=i-i*r+n*s,a=n-i*s-n*r,c=this._a,l=this._b,h=this._c,u=this._d;return this._a=r*c+s*h,this._b=r*l+s*u,this._c=-s*c+r*h,this._d=-s*l+r*u,this._tx+=o*c+a*h,this._ty+=o*l+a*u,this._changed(),this},shear:function(){var e=arguments,t=y.read(e),i=y.read(e,0,{readNull:!0});i&&this.translate(i);var n=this._a,r=this._b;return this._a+=t.y*this._c,this._b+=t.y*this._d,this._c+=t.x*n,this._d+=t.x*r,i&&this.translate(i.negate()),this._changed(),this},skew:function(){var e=arguments,t=y.read(e),i=y.read(e,0,{readNull:!0}),n=Math.PI/180,r=new y(Math.tan(t.x*n),Math.tan(t.y*n));return this.shear(r,i)},append:function(e,t){if(e){var i=this._a,n=this._b,r=this._c,s=this._d,o=e._a,a=e._c,c=e._b,l=e._d,h=e._tx,u=e._ty;this._a=o*i+c*r,this._c=a*i+l*r,this._b=o*n+c*s,this._d=a*n+l*s,this._tx+=h*i+u*r,this._ty+=h*n+u*s,t||this._changed()}return this},prepend:function(e,t){if(e){var i=this._a,n=this._b,r=this._c,s=this._d,o=this._tx,a=this._ty,c=e._a,l=e._c,h=e._b,u=e._d,d=e._tx,p=e._ty;this._a=c*i+l*n,this._c=c*r+l*s,this._b=h*i+u*n,this._d=h*r+u*s,this._tx=c*o+l*a+d,this._ty=h*o+u*a+p,t||this._changed()}return this},appended:function(e){return this.clone().append(e)},prepended:function(e){return this.clone().prepend(e)},invert:function(){var e=this._a,t=this._b,i=this._c,n=this._d,r=this._tx,s=this._ty,o=e*n-t*i,a=null;return o&&!isNaN(o)&&isFinite(r)&&isFinite(s)&&(this._a=n/o,this._b=-t/o,this._c=-i/o,this._d=e/o,this._tx=(i*s-n*r)/o,this._ty=(t*r-e*s)/o,a=this),a},inverted:function(){return this.clone().invert()},concatenate:"#append",preConcatenate:"#prepend",chain:"#appended",_shiftless:function(){return new I(this._a,this._b,this._c,this._d,0,0)},_orNullIfIdentity:function(){return this.isIdentity()?null:this},isIdentity:function(){return 1===this._a&&0===this._b&&0===this._c&&1===this._d&&0===this._tx&&0===this._ty},isInvertible:function(){var e=this._a*this._d-this._c*this._b;return e&&!isNaN(e)&&isFinite(this._tx)&&isFinite(this._ty)},isSingular:function(){return!this.isInvertible()},transform:function(e,t,i){return arguments.length<3?this._transformPoint(y.read(arguments)):this._transformCoordinates(e,t,i)},_transformPoint:function(e,t,i){var n=e.x,r=e.y;return t||(t=new y),t._set(n*this._a+r*this._c+this._tx,n*this._b+r*this._d+this._ty,i)},_transformCoordinates:function(e,t,i){for(var n=0,r=2*i;n<r;n+=2){var s=e[n],o=e[n+1];t[n]=s*this._a+o*this._c+this._tx,t[n+1]=s*this._b+o*this._d+this._ty}return t},_transformCorners:function(e){var t=e.x,i=e.y,n=t+e.width,r=i+e.height,s=[t,i,n,i,n,r,t,r];return this._transformCoordinates(s,s,4)},_transformBounds:function(e,t,i){for(var n=this._transformCorners(e),r=n.slice(0,2),s=r.slice(),o=2;o<8;o++){var a=n[o],c=1&o;a<r[c]?r[c]=a:a>s[c]&&(s[c]=a)}return t||(t=new w),t._set(r[0],r[1],s[0]-r[0],s[1]-r[1],i)},inverseTransform:function(){return this._inverseTransform(y.read(arguments))},_inverseTransform:function(e,t,i){var n=this._a,r=this._b,s=this._c,o=this._d,a=this._tx,c=this._ty,l=n*o-r*s,h=null;if(l&&!isNaN(l)&&isFinite(a)&&isFinite(c)){var u=e.x-this._tx,d=e.y-this._ty;t||(t=new y),h=t._set((u*o-d*s)/l,(d*n-u*r)/l,i)}return h},decompose:function(){var e,t,i,n=this._a,r=this._b,s=this._c,o=this._d,a=n*o-r*s,c=Math.sqrt,l=Math.atan2,h=180/Math.PI;if(0!==n||0!==r){var u=c(n*n+r*r);e=Math.acos(n/u)*(r>0?1:-1),t=[u,a/u],i=[l(n*s+r*o,u*u),0]}else if(0!==s||0!==o){var d=c(s*s+o*o);e=Math.asin(s/d)*(o>0?1:-1),t=[a/d,d],i=[0,l(n*s+r*o,d*d)]}else e=0,i=t=[0,0];return{translation:this.getTranslation(),rotation:e*h,scaling:new y(t),skewing:new y(i[0]*h,i[1]*h)}},getValues:function(){return[this._a,this._b,this._c,this._d,this._tx,this._ty]},getTranslation:function(){return new y(this._tx,this._ty)},getScaling:function(){return this.decompose().scaling},getRotation:function(){return this.decompose().rotation},applyToContext:function(e){this.isIdentity()||e.transform(this._a,this._b,this._c,this._d,this._tx,this._ty)}},h.each(["a","b","c","d","tx","ty"],(function(e){var t=h.capitalize(e),i="_"+e;this["get"+t]=function(){return this[i]},this["set"+t]=function(e){this[i]=e,this._changed()}}),{})),k=h.extend({_class:"Line",initialize:function(e,t,i,n,r){var s=!1;arguments.length>=4?(this._px=e,this._py=t,this._vx=i,this._vy=n,s=r):(this._px=e.x,this._py=e.y,this._vx=t.x,this._vy=t.y,s=i),s||(this._vx-=this._px,this._vy-=this._py)},getPoint:function(){return new y(this._px,this._py)},getVector:function(){return new y(this._vx,this._vy)},getLength:function(){return this.getVector().getLength()},intersect:function(e,t){return k.intersect(this._px,this._py,this._vx,this._vy,e._px,e._py,e._vx,e._vy,!0,t)},getSide:function(e,t){return k.getSide(this._px,this._py,this._vx,this._vy,e.x,e.y,!0,t)},getDistance:function(e){return Math.abs(this.getSignedDistance(e))},getSignedDistance:function(e){return k.getSignedDistance(this._px,this._py,this._vx,this._vy,e.x,e.y,!0)},isCollinear:function(e){return y.isCollinear(this._vx,this._vy,e._vx,e._vy)},isOrthogonal:function(e){return y.isOrthogonal(this._vx,this._vy,e._vx,e._vy)},statics:{intersect:function(e,t,i,n,r,s,o,a,c,l){c||(i-=e,n-=t,o-=r,a-=s);var h=i*a-n*o;if(!m.isMachineZero(h)){var u=e-r,d=t-s,p=(o*d-a*u)/h,g=(i*d-n*u)/h,f=-1e-12,v=1+1e-12;if(l||f<p&&p<v&&f<g&&g<v)return l||(p=p<=0?0:p>=1?1:p),new y(e+p*i,t+p*n)}},getSide:function(e,t,i,n,r,s,o,a){o||(i-=e,n-=t);var c=r-e,l=c*n-(s-t)*i;return!a&&m.isMachineZero(l)&&(l=(c*i+c*i)/(i*i+n*n))>=0&&l<=1&&(l=0),l<0?-1:l>0?1:0},getSignedDistance:function(e,t,i,n,r,s,o){return o||(i-=e,n-=t),0===i?n>0?r-e:e-r:0===n?i<0?s-t:t-s:((r-e)*n-(s-t)*i)/(n>i?n*Math.sqrt(1+i*i/(n*n)):i*Math.sqrt(1+n*n/(i*i)))},getDistance:function(e,t,i,n,r,s,o){return Math.abs(k.getSignedDistance(e,t,i,n,r,s,o))}}}),T=p.extend({_class:"Project",_list:"projects",_reference:"project",_compactSerialize:!0,initialize:function(e){p.call(this,!0),this._children=[],this._namedChildren={},this._activeLayer=null,this._currentStyle=new Y(null,null,this),this._view=X.create(this,e||ce.getCanvas(1,1)),this._selectionItems={},this._selectionCount=0,this._updateVersion=0},_serialize:function(e,t){return h.serialize(this._children,e,!0,t)},_changed:function(e,t){if(1&e){var i=this._view;i&&(i._needsUpdate=!0,!i._requested&&i._autoUpdate&&i.requestUpdate())}var n=this._changes;if(n&&t){var r=this._changesById,s=t._id,o=r[s];o?o.flags|=e:n.push(r[s]={item:t,flags:e})}},clear:function(){for(var e=this._children,t=e.length-1;t>=0;t--)e[t].remove()},isEmpty:function(){return!this._children.length},remove:function e(){return!!e.base.call(this)&&(this._view&&this._view.remove(),!0)},getView:function(){return this._view},getCurrentStyle:function(){return this._currentStyle},setCurrentStyle:function(e){this._currentStyle.set(e)},getIndex:function(){return this._index},getOptions:function(){return this._scope.settings},getLayers:function(){return this._children},getActiveLayer:function(){return this._activeLayer||new R({project:this,insert:!0})},getSymbolDefinitions:function(){var e=[],t={};return this.getItems({class:P,match:function(i){var n=i._definition,r=n._id;return t[r]||(t[r]=!0,e.push(n)),!1}}),e},getSymbols:"getSymbolDefinitions",getSelectedItems:function(){var e=this._selectionItems,t=[];for(var i in e){var n=e[i],r=n._selection;1&r&&n.isInserted()?t.push(n):r||this._updateSelection(n)}return t},_updateSelection:function(e){var t=e._id,i=this._selectionItems;e._selection?i[t]!==e&&(this._selectionCount++,i[t]=e):i[t]===e&&(this._selectionCount--,delete i[t])},selectAll:function(){for(var e=this._children,t=0,i=e.length;t<i;t++)e[t].setFullySelected(!0)},deselectAll:function(){var e=this._selectionItems;for(var t in e)e[t].setFullySelected(!1)},addLayer:function(e){return this.insertLayer(a,e)},insertLayer:function(e,t){if(t instanceof R){t._remove(!1,!0),h.splice(this._children,[t],e,0),t._setProject(this,!0);var i=t._name;i&&t.setName(i),this._changes&&t._changed(5),this._activeLayer||(this._activeLayer=t)}else t=null;return t},_insertItem:function(e,t,i){return t=this.insertLayer(e,t)||(this._activeLayer||this._insertItem(a,new R(C.NO_INSERT),!0)).insertChild(e,t),i&&t.activate&&t.activate(),t},getItems:function(e){return C._getItems(this,e)},getItem:function(e){return C._getItems(this,e,null,null,!0)[0]||null},importJSON:function(e){this.activate();var t=this._activeLayer;return h.importJSON(e,t&&t.isEmpty()&&t)},removeOn:function(e){var t=this._removeSets;if(t){"mouseup"===e&&(t.mousedrag=null);var i=t[e];if(i){for(var n in i){var r=i[n];for(var s in t){var o=t[s];o&&o!=i&&delete o[r._id]}r.remove()}t[e]=null}}},draw:function(e,t,i){this._updateVersion++,e.save(),t.applyToContext(e);for(var n=this._children,r=new h({offset:new y(0,0),pixelRatio:i,viewMatrix:t.isIdentity()?null:t,matrices:[new I],updateMatrix:!0}),s=0,o=n.length;s<o;s++)n[s].draw(e,r);if(e.restore(),this._selectionCount>0){e.save(),e.strokeWidth=1;var a=this._selectionItems,c=this._scope.settings.handleSize,l=this._updateVersion;for(var u in a)a[u]._drawSelection(e,t,c,a,l);e.restore()}}}),C=h.extend(u,{statics:{extend:function e(t){return t._serializeFields&&(t._serializeFields=h.set({},this.prototype._serializeFields,t._serializeFields)),e.base.apply(this,arguments)},NO_INSERT:{insert:!1}},_class:"Item",_name:null,_applyMatrix:!0,_canApplyMatrix:!0,_canScaleStroke:!1,_pivot:null,_visible:!0,_blendMode:"normal",_opacity:1,_locked:!1,_guide:!1,_clipMask:!1,_selection:0,_selectBounds:!0,_selectChildren:!1,_serializeFields:{name:null,applyMatrix:null,matrix:new I,pivot:null,visible:!0,blendMode:"normal",opacity:1,locked:!1,guide:!1,clipMask:!1,selected:!1,data:{}},_prioritize:["applyMatrix"]},new function(){var e=["onMouseDown","onMouseUp","onMouseDrag","onClick","onDoubleClick","onMouseMove","onMouseEnter","onMouseLeave"];return h.each(e,(function(e){this._events[e]={install:function(e){this.getView()._countItemEvent(e,1)},uninstall:function(e){this.getView()._countItemEvent(e,-1)}}}),{_events:{onFrame:{install:function(){this.getView()._animateItem(this,!0)},uninstall:function(){this.getView()._animateItem(this,!1)}},onLoad:{},onError:{}},statics:{_itemHandlers:e}})},{initialize:function(){},_initialize:function(e,t){var i=e&&h.isPlainObject(e),n=i&&!0===e.internal,r=this._matrix=new I,s=i&&e.project||de.project,o=de.settings;return this._id=n?null:v.get(),this._parent=this._index=null,this._applyMatrix=this._canApplyMatrix&&o.applyMatrix,t&&r.translate(t),r._owner=this,this._style=new Y(s._currentStyle,this,s),n||i&&0==e.insert||!o.insertItems&&(!i||!0!==e.insert)?this._setProject(s):(i&&e.parent||s)._insertItem(a,this,!0),i&&e!==C.NO_INSERT&&this.set(e,{internal:!0,insert:!0,project:!0,parent:!0}),i},_serialize:function(e,t){var i={},n=this;function r(r){for(var s in r){var o=n[s];h.equals(o,"leading"===s?1.2*r.fontSize:r[s])||(i[s]=h.serialize(o,e,"data"!==s,t))}}return r(this._serializeFields),this instanceof x||r(this._style._defaults),[this._class,i]},_changed:function(e){var t=this._symbol,i=this._parent||t,n=this._project;8&e&&(this._bounds=this._position=this._decomposed=a),16&e&&(this._globalMatrix=a),i&&72&e&&C._clearBoundsCache(i),2&e&&C._clearBoundsCache(this),n&&n._changed(e,this),t&&t._changed(e)},getId:function(){return this._id},getName:function(){return this._name},setName:function(e){if(this._name&&this._removeNamed(),e===+e+"")throw new Error("Names consisting only of numbers are not supported.");var t=this._getOwner();if(e&&t){var i=t._children,n=t._namedChildren;(n[e]=n[e]||[]).push(this),e in i||(i[e]=this)}this._name=e||a,this._changed(256)},getStyle:function(){return this._style},setStyle:function(e){this.getStyle().set(e)}},h.each(["locked","visible","blendMode","opacity","guide"],(function(e){var t=h.capitalize(e),i="_"+e,n={locked:256,visible:265};this["get"+t]=function(){return this[i]},this["set"+t]=function(t){t!=this[i]&&(this[i]=t,this._changed(n[e]||257))}}),{}),{beans:!0,getSelection:function(){return this._selection},setSelection:function(e){if(e!==this._selection){this._selection=e;var t=this._project;t&&(t._updateSelection(this),this._changed(257))}},_changeSelection:function(e,t){var i=this._selection;this.setSelection(t?i|e:i&~e)},isSelected:function(){if(this._selectChildren)for(var e=this._children,t=0,i=e.length;t<i;t++)if(e[t].isSelected())return!0;return!!(1&this._selection)},setSelected:function(e){if(this._selectChildren)for(var t=this._children,i=0,n=t.length;i<n;i++)t[i].setSelected(e);this._changeSelection(1,e)},isFullySelected:function(){var e=this._children,t=!!(1&this._selection);if(e&&t){for(var i=0,n=e.length;i<n;i++)if(!e[i].isFullySelected())return!1;return!0}return t},setFullySelected:function(e){var t=this._children;if(t)for(var i=0,n=t.length;i<n;i++)t[i].setFullySelected(e);this._changeSelection(1,e)},isClipMask:function(){return this._clipMask},setClipMask:function(e){this._clipMask!=(e=!!e)&&(this._clipMask=e,e&&(this.setFillColor(null),this.setStrokeColor(null)),this._changed(257),this._parent&&this._parent._changed(2048))},getData:function(){return this._data||(this._data={}),this._data},setData:function(e){this._data=e},getPosition:function(e){var t=e?y:_,i=this._position||(this._position=this._getPositionFromBounds());return new t(i.x,i.y,this,"setPosition")},setPosition:function(){this.translate(y.read(arguments).subtract(this.getPosition(!0)))},_getPositionFromBounds:function(e){return this._pivot?this._matrix._transformPoint(this._pivot):(e||this.getBounds()).getCenter(!0)},getPivot:function(){var e=this._pivot;return e?new _(e.x,e.y,this,"setPivot"):null},setPivot:function(){this._pivot=y.read(arguments,0,{clone:!0,readNull:!0}),this._position=a}},h.each({getStrokeBounds:{stroke:!0},getHandleBounds:{handle:!0},getInternalBounds:{internal:!0}},(function(e,t){this[t]=function(t){return this.getBounds(t,e)}}),{beans:!0,getBounds:function(e,t){var i=t||e instanceof I,n=h.set({},i?t:e,this._boundsOptions);n.stroke&&!this.getStrokeScaling()||(n.cacheItem=this);var r=this._getCachedBounds(i&&e,n).rect;return arguments.length?r:new E(r.x,r.y,r.width,r.height,this,"setBounds")},setBounds:function(){var e=w.read(arguments),t=this.getBounds(),i=this._matrix,n=new I,r=e.getCenter();n.translate(r),e.width==t.width&&e.height==t.height||(i.isInvertible()||(i.set(i._backup||(new I).translate(i.getTranslation())),t=this.getBounds()),n.scale(0!==t.width?e.width/t.width:0,0!==t.height?e.height/t.height:0)),r=t.getCenter(),n.translate(-r.x,-r.y),this.transform(n)},_getBounds:function(e,t){var i=this._children;return i&&i.length?(C._updateBoundsCache(this,t.cacheItem),C._getBounds(i,e,t)):new w},_getBoundsCacheKey:function(e,t){return[e.stroke?1:0,e.handle?1:0,t?1:0].join("")},_getCachedBounds:function(e,t,i){e=e&&e._orNullIfIdentity();var n=t.internal&&!i,r=t.cacheItem,s=n?null:this._matrix._orNullIfIdentity(),o=r&&(!e||e.equals(s))&&this._getBoundsCacheKey(t,n),a=this._bounds;if(C._updateBoundsCache(this._parent||this._symbol,r),o&&a&&o in a)return{rect:(d=a[o]).rect.clone(),nonscaling:d.nonscaling};var c=this._getBounds(e||s,t),l=c.rect||c,h=this._style,u=c.nonscaling||h.hasStroke()&&!h.getStrokeScaling();if(o){a||(this._bounds=a={});var d=a[o]={rect:l.clone(),nonscaling:u,internal:n}}return{rect:l,nonscaling:u}},_getStrokeMatrix:function(e,t){var i=this.getStrokeScaling()?null:t&&t.internal?this:this._parent||this._symbol&&this._symbol._item,n=i?i.getViewMatrix().invert():e;return n&&n._shiftless()},statics:{_updateBoundsCache:function(e,t){if(e&&t){var i=t._id,n=e._boundsCache=e._boundsCache||{ids:{},list:[]};n.ids[i]||(n.list.push(t),n.ids[i]=t)}},_clearBoundsCache:function(e){var t=e._boundsCache;if(t){e._bounds=e._position=e._boundsCache=a;for(var i=0,n=t.list,r=n.length;i<r;i++){var s=n[i];s!==e&&(s._bounds=s._position=a,s._boundsCache&&C._clearBoundsCache(s))}}},_getBounds:function(e,t,i){var n=1/0,r=-n,s=n,o=r,a=!1;i=i||{};for(var c=0,l=e.length;c<l;c++){var h=e[c];if(h._visible&&!h.isEmpty(!0)){var u=h._getCachedBounds(t&&t.appended(h._matrix),i,!0),d=u.rect;n=Math.min(d.x,n),s=Math.min(d.y,s),r=Math.max(d.x+d.width,r),o=Math.max(d.y+d.height,o),u.nonscaling&&(a=!0)}}return{rect:isFinite(n)?new w(n,s,r-n,o-s):new w,nonscaling:a}}}}),{beans:!0,_decompose:function(){return this._applyMatrix?null:this._decomposed||(this._decomposed=this._matrix.decompose())},getRotation:function(){var e=this._decompose();return e?e.rotation:0},setRotation:function(e){var t=this.getRotation();if(null!=t&&null!=e){var i=this._decomposed;this.rotate(e-t),i&&(i.rotation=e,this._decomposed=i)}},getScaling:function(){var e=this._decompose(),t=e&&e.scaling;return new _(t?t.x:1,t?t.y:1,this,"setScaling")},setScaling:function(){var e=this.getScaling(),t=y.read(arguments,0,{clone:!0,readNull:!0});if(e&&t&&!e.equals(t)){var i=this.getRotation(),n=this._decomposed,r=new I,s=m.isZero;if(s(e.x)||s(e.y))r.translate(n.translation),i&&r.rotate(i),r.scale(t.x,t.y),this._matrix.set(r);else{var o=this.getPosition(!0);r.translate(o),i&&r.rotate(i),r.scale(t.x/e.x,t.y/e.y),i&&r.rotate(-i),r.translate(o.negate()),this.transform(r)}n&&(n.scaling=t,this._decomposed=n)}},getMatrix:function(){return this._matrix},setMatrix:function(){var e=this._matrix;e.set.apply(e,arguments)},getGlobalMatrix:function(e){var t=this._globalMatrix;if(t)for(var i=this._parent,n=[];i;){if(!i._globalMatrix){t=null;for(var r=0,s=n.length;r<s;r++)n[r]._globalMatrix=null;break}n.push(i),i=i._parent}return t||(t=this._globalMatrix=this._matrix.clone(),(i=this._parent)&&t.prepend(i.getGlobalMatrix(!0))),e?t:t.clone()},getViewMatrix:function(){return this.getGlobalMatrix().prepend(this.getView()._matrix)},getApplyMatrix:function(){return this._applyMatrix},setApplyMatrix:function(e){(this._applyMatrix=this._canApplyMatrix&&!!e)&&this.transform(null,!0)},getTransformContent:"#getApplyMatrix",setTransformContent:"#setApplyMatrix"},{getProject:function(){return this._project},_setProject:function(e,t){if(this._project!==e){this._project&&this._installEvents(!1),this._project=e;for(var i=this._children,n=0,r=i&&i.length;n<r;n++)i[n]._setProject(e);t=!0}t&&this._installEvents(!0)},getView:function(){return this._project._view},_installEvents:function e(t){e.base.call(this,t);for(var i=this._children,n=0,r=i&&i.length;n<r;n++)i[n]._installEvents(t)},getLayer:function(){for(var e=this;e=e._parent;)if(e instanceof R)return e;return null},getParent:function(){return this._parent},setParent:function(e){return e.addChild(this)},_getOwner:"#getParent",getChildren:function(){return this._children},setChildren:function(e){this.removeChildren(),this.addChildren(e)},getFirstChild:function(){return this._children&&this._children[0]||null},getLastChild:function(){return this._children&&this._children[this._children.length-1]||null},getNextSibling:function(){var e=this._getOwner();return e&&e._children[this._index+1]||null},getPreviousSibling:function(){var e=this._getOwner();return e&&e._children[this._index-1]||null},getIndex:function(){return this._index},equals:function(e){return e===this||e&&this._class===e._class&&this._style.equals(e._style)&&this._matrix.equals(e._matrix)&&this._locked===e._locked&&this._visible===e._visible&&this._blendMode===e._blendMode&&this._opacity===e._opacity&&this._clipMask===e._clipMask&&this._guide===e._guide&&this._equals(e)||!1},_equals:function(e){return h.equals(this._children,e._children)},clone:function(e){var t=new this.constructor(C.NO_INSERT),i=this._children,n=h.pick(e?e.insert:a,e===a||!0===e),r=h.pick(e?e.deep:a,!0);i&&t.copyAttributes(this),i&&!r||t.copyContent(this),i||t.copyAttributes(this),n&&t.insertAbove(this);var s=this._name,o=this._parent;if(s&&o){i=o._children;for(var c=s,l=1;i[s];)s=c+" "+l++;s!==c&&t.setName(s)}return t},copyContent:function(e){for(var t=e._children,i=0,n=t&&t.length;i<n;i++)this.addChild(t[i].clone(!1),!0)},copyAttributes:function(e,t){this.setStyle(e._style);for(var i=["_locked","_visible","_blendMode","_opacity","_clipMask","_guide"],n=0,r=i.length;n<r;n++){var s=i[n];e.hasOwnProperty(s)&&(this[s]=e[s])}t||this._matrix.set(e._matrix,!0),this.setApplyMatrix(e._applyMatrix),this.setPivot(e._pivot),this.setSelection(e._selection);var o=e._data,a=e._name;this._data=o?h.clone(o):null,a&&this.setName(a)},rasterize:function(e,t){var i,n,r;h.isPlainObject(e)?(i=e.resolution,n=e.insert,r=e.raster):(i=e,n=t),r?r.matrix.reset(!0):r=new A(C.NO_INSERT);var s=this.getStrokeBounds(),o=(i||this.getView().getResolution())/72,c=s.getTopLeft().floor(),l=s.getBottomRight().ceil(),u=new S(l.subtract(c)),d=u.multiply(o);if(r.setSize(d,!0),!d.isZero()){var p=r.getContext(!0),g=(new I).scale(o).translate(c.negate());p.save(),g.applyToContext(p),this.draw(p,new h({matrices:[g]})),p.restore()}return r.transform((new I).translate(c.add(u.divide(2))).scale(1/o)),(n===a||n)&&r.insertAbove(this),r},contains:function(){var e=this._matrix;return e.isInvertible()&&!!this._contains(e._inverseTransform(y.read(arguments)))},_contains:function(e){var t=this._children;if(t){for(var i=t.length-1;i>=0;i--)if(t[i].contains(e))return!0;return!1}return e.isInside(this.getInternalBounds())},isInside:function(){return w.read(arguments).contains(this.getBounds())},_asPathItem:function(){return new j.Rectangle({rectangle:this.getInternalBounds(),matrix:this._matrix,insert:!1})},intersects:function(e,t){return e instanceof C&&this._asPathItem().getIntersections(e._asPathItem(),null,t,!0).length>0}},new function(){function e(){var e=arguments;return this._hitTest(y.read(e),M.getOptions(e))}function t(){var e=arguments,t=y.read(e),i=M.getOptions(e),n=[];return this._hitTest(t,new h({all:n},i)),n}function i(e,t,i,n){var r=this._children;if(r)for(var s=r.length-1;s>=0;s--){var o=r[s],a=o!==n&&o._hitTest(e,t,i);if(a&&!t.all)return a}return null}return T.inject({hitTest:e,hitTestAll:t,_hitTest:i}),{hitTest:e,hitTestAll:t,_hitTestChildren:i}},{_hitTest:function(e,t,i){if(this._locked||!this._visible||this._guide&&!t.guides||this.isEmpty())return null;var n=this._matrix,r=i?i.appended(n):this.getGlobalMatrix().prepend(this.getView()._matrix),s=Math.max(t.tolerance,1e-12),o=t._tolerancePadding=new S(j._getStrokePadding(s,n._shiftless().invert()));if(!(e=n._inverseTransform(e))||!this._children&&!this.getBounds({internal:!0,stroke:!0,handle:!0}).expand(o.multiply(2))._containsPoint(e))return null;var a,c,l=!(t.guides&&!this._guide||t.selected&&!this.isSelected()||t.type&&t.type!==h.hyphenate(this._class)||t.class&&!(this instanceof t.class)),u=t.match,d=this;function p(e){return e&&u&&!u(e)&&(e=null),e&&t.all&&t.all.push(e),e}function g(t,i){var n=i?a["get"+i]():d.getPosition();if(e.subtract(n).divide(o).length<=1)return new M(t,d,{name:i?h.hyphenate(i):t,point:n})}var f=t.position,m=t.center,v=t.bounds;if(l&&this._parent&&(f||m||v)){if((m||v)&&(a=this.getInternalBounds()),!(c=f&&g("position")||m&&g("center","Center"))&&v)for(var y=["TopLeft","TopRight","BottomLeft","BottomRight","LeftCenter","TopCenter","RightCenter","BottomCenter"],_=0;_<8&&!c;_++)c=g("bounds",y[_]);c=p(c)}return c||(c=this._hitTestChildren(e,t,r)||l&&p(this._hitTestSelf(e,t,r,this.getStrokeScaling()?null:r._shiftless().invert()))||null),c&&c.point&&(c.point=n.transform(c.point)),c},_hitTestSelf:function(e,t){if(t.fill&&this.hasFill()&&this._contains(e))return new M("fill",this)},matches:function(e,t){var i=typeof e;if("object"===i){for(var n in e)if(e.hasOwnProperty(n)&&!this.matches(n,e[n]))return!1;return!0}if("function"===i)return e(this);if("match"===e)return t(this);var r=/^(empty|editable)$/.test(e)?this["is"+h.capitalize(e)]():"type"===e?h.hyphenate(this._class):this[e];if("class"===e){if("function"==typeof t)return this instanceof t;r=this._class}if("function"==typeof t)return!!t(r);if(t){if(t.test)return t.test(r);if(h.isPlainObject(t))return function e(t,i){for(var n in t)if(t.hasOwnProperty(n)){var r=t[n],s=i[n];if(h.isPlainObject(r)&&h.isPlainObject(s)){if(!e(r,s))return!1}else if(!h.equals(r,s))return!1}return!0}(t,r)}return h.equals(r,t)},getItems:function(e){return C._getItems(this,e,this._matrix)},getItem:function(e){return C._getItems(this,e,this._matrix,null,!0)[0]||null},statics:{_getItems:function e(t,i,n,r,s){if(!r){var o="object"==typeof i&&i,a=o&&o.overlapping,c=o&&o.inside,l=(y=a||c)&&w.read([y]);r={items:[],recursive:o&&!1!==o.recursive,inside:!!c,overlapping:!!a,rect:l,path:a&&new j.Rectangle({rectangle:l,insert:!1})},o&&(i=h.filter({},i,{recursive:!0,inside:!0,overlapping:!0}))}var u=t._children,d=r.items;n=(l=r.rect)&&(n||new I);for(var p=0,g=u&&u.length;p<g;p++){var f=u[p],m=n&&n.appended(f._matrix),v=!0;if(l){var y=f.getBounds(m);if(!l.intersects(y))continue;l.contains(y)||r.overlapping&&(y.contains(l)||r.path.intersects(f,m))||(v=!1)}if(v&&f.matches(i)&&(d.push(f),s))break;if(!1!==r.recursive&&e(f,i,m,r,s),s&&d.length>0)break}return d}}},{importJSON:function(e){var t=h.importJSON(e,this);return t!==this?this.addChild(t):t},addChild:function(e){return this.insertChild(a,e)},insertChild:function(e,t){var i=t?this.insertChildren(e,[t]):null;return i&&i[0]},addChildren:function(e){return this.insertChildren(this._children.length,e)},insertChildren:function(e,t){var i=this._children;if(i&&t&&t.length>0){for(var n={},r=(t=h.slice(t)).length-1;r>=0;r--){var s=(l=t[r])&&l._id;!l||n[s]?t.splice(r,1):(l._remove(!1,!0),n[s]=!0)}h.splice(i,t,e,0);for(var o=this._project,a=o._changes,c=(r=0,t.length);r<c;r++){var l,u=(l=t[r])._name;l._parent=this,l._setProject(o,!0),u&&l.setName(u),a&&l._changed(5)}this._changed(11)}else t=null;return t},_insertItem:"#insertChild",_insertAt:function(e,t){var i=e&&e._getOwner(),n=e!==this&&i?this:null;return n&&(n._remove(!1,!0),i._insertItem(e._index+t,n)),n},insertAbove:function(e){return this._insertAt(e,1)},insertBelow:function(e){return this._insertAt(e,0)},sendToBack:function(){var e=this._getOwner();return e?e._insertItem(0,this):null},bringToFront:function(){var e=this._getOwner();return e?e._insertItem(a,this):null},appendTop:"#addChild",appendBottom:function(e){return this.insertChild(0,e)},moveAbove:"#insertAbove",moveBelow:"#insertBelow",addTo:function(e){return e._insertItem(a,this)},copyTo:function(e){return this.clone(!1).addTo(e)},reduce:function(e){var t=this._children;if(t&&1===t.length){var i=t[0].reduce(e);return this._parent?(i.insertAbove(this),this.remove()):i.remove(),i}return this},_removeNamed:function(){var e=this._getOwner();if(e){var t=e._children,i=e._namedChildren,n=this._name,r=i[n],s=r?r.indexOf(this):-1;-1!==s&&(t[n]==this&&delete t[n],r.splice(s,1),r.length?t[n]=r[0]:delete i[n])}},_remove:function(e,t){var i=this._getOwner(),n=this._project,r=this._index;return this._style&&this._style._dispose(),!!i&&(this._name&&this._removeNamed(),null!=r&&(n._activeLayer===this&&(n._activeLayer=this.getNextSibling()||this.getPreviousSibling()),h.splice(i._children,null,r,1)),this._installEvents(!1),e&&n._changes&&this._changed(5),t&&i._changed(11,this),this._parent=null,!0)},remove:function(){return this._remove(!0,!0)},replaceWith:function(e){var t=e&&e.insertBelow(this);return t&&this.remove(),t},removeChildren:function(e,t){if(!this._children)return null;e=e||0,t=h.pick(t,this._children.length);for(var i=h.splice(this._children,null,e,t-e),n=i.length-1;n>=0;n--)i[n]._remove(!0,!1);return i.length>0&&this._changed(11),i},clear:"#removeChildren",reverseChildren:function(){if(this._children){this._children.reverse();for(var e=0,t=this._children.length;e<t;e++)this._children[e]._index=e;this._changed(11)}},isEmpty:function(e){var t=this._children,i=t?t.length:0;if(e){for(var n=0;n<i;n++)if(!t[n].isEmpty(e))return!1;return!0}return!i},isEditable:function(){for(var e=this;e;){if(!e._visible||e._locked)return!1;e=e._parent}return!0},hasFill:function(){return this.getStyle().hasFill()},hasStroke:function(){return this.getStyle().hasStroke()},hasShadow:function(){return this.getStyle().hasShadow()},_getOrder:function(e){function t(e){var t=[];do{t.unshift(e)}while(e=e._parent);return t}for(var i=t(this),n=t(e),r=0,s=Math.min(i.length,n.length);r<s;r++)if(i[r]!=n[r])return i[r]._index<n[r]._index?1:-1;return 0},hasChildren:function(){return this._children&&this._children.length>0},isInserted:function(){return!!this._parent&&this._parent.isInserted()},isAbove:function(e){return-1===this._getOrder(e)},isBelow:function(e){return 1===this._getOrder(e)},isParent:function(e){return this._parent===e},isChild:function(e){return e&&e._parent===this},isDescendant:function(e){for(var t=this;t=t._parent;)if(t===e)return!0;return!1},isAncestor:function(e){return!!e&&e.isDescendant(this)},isSibling:function(e){return this._parent===e._parent},isGroupedWith:function(e){for(var t=this._parent;t;){if(t._parent&&/^(Group|Layer|CompoundPath)$/.test(t._class)&&e.isDescendant(t))return!0;t=t._parent}return!1}},h.each(["rotate","scale","shear","skew"],(function(e){var t="rotate"===e;this[e]=function(){var i=arguments,n=(t?h:y).read(i),r=y.read(i,0,{readNull:!0});return this.transform((new I)[e](n,r||this.getPosition(!0)))}}),{translate:function(){var e=new I;return this.transform(e.translate.apply(e,arguments))},transform:function(e,t,i){var n=this._matrix,r=e&&!e.isIdentity(),s=i&&this._canApplyMatrix||this._applyMatrix&&(r||!n.isIdentity()||t&&this._children);if(!r&&!s)return this;if(r){!e.isInvertible()&&n.isInvertible()&&(n._backup=n.getValues()),n.prepend(e,!0);var o=this._style,a=o.getFillColor(!0),c=o.getStrokeColor(!0);a&&a.transform(e),c&&c.transform(e)}if(s&&(s=this._transformContent(n,t,i))){var l=this._pivot;l&&n._transformPoint(l,l,!0),n.reset(!0),i&&this._canApplyMatrix&&(this._applyMatrix=!0)}var h=this._bounds,u=this._position;(r||s)&&this._changed(25);var d=r&&h&&e.decompose();if(d&&d.skewing.isZero()&&d.rotation%90==0){for(var p in h){var g=h[p];if(g.nonscaling)delete h[p];else if(s||!g.internal){var f=g.rect;e._transformBounds(f,f)}}this._bounds=h;var m=h[this._getBoundsCacheKey(this._boundsOptions||{})];m&&(this._position=this._getPositionFromBounds(m.rect))}else r&&u&&this._pivot&&(this._position=e._transformPoint(u,u));return this},_transformContent:function(e,t,i){var n=this._children;if(n){for(var r=0,s=n.length;r<s;r++)n[r].transform(e,t,i);return!0}},globalToLocal:function(){return this.getGlobalMatrix(!0)._inverseTransform(y.read(arguments))},localToGlobal:function(){return this.getGlobalMatrix(!0)._transformPoint(y.read(arguments))},parentToLocal:function(){return this._matrix._inverseTransform(y.read(arguments))},localToParent:function(){return this._matrix._transformPoint(y.read(arguments))},fitBounds:function(e,t){e=w.read(arguments);var i=this.getBounds(),n=i.height/i.width,r=e.height/e.width,s=(t?n>r:n<r)?e.width/i.width:e.height/i.height,o=new w(new y,new S(i.width*s,i.height*s));o.setCenter(e.getCenter()),this.setBounds(o)}}),{_setStyles:function(e,t,i){var n=this._style,r=this._matrix;if(n.hasFill()&&(e.fillStyle=n.getFillColor().toCanvasStyle(e,r)),n.hasStroke()){e.strokeStyle=n.getStrokeColor().toCanvasStyle(e,r),e.lineWidth=n.getStrokeWidth();var s=n.getStrokeJoin(),o=n.getStrokeCap(),a=n.getMiterLimit();if(s&&(e.lineJoin=s),o&&(e.lineCap=o),a&&(e.miterLimit=a),de.support.nativeDash){var c=n.getDashArray(),l=n.getDashOffset();c&&c.length&&("setLineDash"in e?(e.setLineDash(c),e.lineDashOffset=l):(e.mozDash=c,e.mozDashOffset=l))}}if(n.hasShadow()){var h=t.pixelRatio||1,u=i._shiftless().prepend((new I).scale(h,h)),d=u.transform(new y(n.getShadowBlur(),0)),p=u.transform(this.getShadowOffset());e.shadowColor=n.getShadowColor().toCanvasStyle(e),e.shadowBlur=d.getLength(),e.shadowOffsetX=p.x,e.shadowOffsetY=p.y}},draw:function(e,t,i){if(this._updateVersion=this._project._updateVersion,this._visible&&0!==this._opacity){var n=t.matrices,r=t.viewMatrix,s=this._matrix,o=n[n.length-1].appended(s);if(o.isInvertible()){r=r?r.appended(o):o,n.push(o),t.updateMatrix&&(this._globalMatrix=o);var a,c,l,h=this._blendMode,u=m.clamp(this._opacity,0,1),d="normal"===h,p=le.nativeModes[h],g=d&&1===u||t.dontStart||t.clip||(p||d&&u<1)&&this._canComposite(),f=t.pixelRatio||1;if(!g){var v=this.getStrokeBounds(r);if(!v.width||!v.height)return void n.pop();l=t.offset,c=t.offset=v.getTopLeft().floor(),a=e,e=ce.getContext(v.getSize().ceil().add(1).multiply(f)),1!==f&&e.scale(f,f)}e.save();var y=i?i.appended(s):this._canScaleStroke&&!this.getStrokeScaling(!0)&&r,_=!g&&t.clipItem,S=!y||_;if(g?(e.globalAlpha=u,p&&(e.globalCompositeOperation=h)):S&&e.translate(-c.x,-c.y),S&&(g?s:r).applyToContext(e),_&&t.clipItem.draw(e,t.extend({clip:!0})),y){e.setTransform(f,0,0,f,0,0);var b=t.offset;b&&e.translate(-b.x,-b.y)}this._draw(e,t,r,y),e.restore(),n.pop(),t.clip&&!t.dontFinish&&e.clip(this.getFillRule()),g||(le.process(h,e,a,u,c.subtract(l).multiply(f)),ce.release(e),t.offset=l)}}},_isUpdated:function(e){var t=this._parent;if(t instanceof F)return t._isUpdated(e);var i=this._updateVersion===e;return!i&&t&&t._visible&&t._isUpdated(e)&&(this._updateVersion=e,i=!0),i},_drawSelection:function(e,t,i,n,r){var s=this._selection,o=1&s,a=2&s||o&&this._selectBounds,c=4&s;if(this._drawSelected||(o=!1),(o||a||c)&&this._isUpdated(r)){var l,h=this.getSelectedColor(!0)||(l=this.getLayer())&&l.getSelectedColor(!0),u=t.appended(this.getGlobalMatrix(!0)),d=i/2;if(e.strokeStyle=e.fillStyle=h?h.toCanvasStyle(e):"#009dec",o&&this._drawSelected(e,u,n),c){var p=this.getPosition(!0),g=this._parent,f=g?g.localToGlobal(p):p,m=f.x,v=f.y;e.beginPath(),e.arc(m,v,d,0,2*Math.PI,!0),e.stroke();for(var y=[[0,-1],[1,0],[0,1],[-1,0]],_=d,S=i+1,b=0;b<4;b++){var w=y[b],E=w[0],I=w[1];e.moveTo(m+E*_,v+I*_),e.lineTo(m+E*S,v+I*S),e.stroke()}}if(a){var k=u._transformCorners(this.getInternalBounds());for(e.beginPath(),b=0;b<8;b++)e[b?"lineTo":"moveTo"](k[b],k[++b]);for(e.closePath(),e.stroke(),b=0;b<8;b++)e.fillRect(k[b]-d,k[++b]-d,i,i)}}},_canComposite:function(){return!1}},h.each(["down","drag","up","move"],(function(e){this["removeOn"+h.capitalize(e)]=function(){var t={};return t[e]=!0,this.removeOn(t)}}),{removeOn:function(e){for(var t in e)if(e[t]){var i="mouse"+t,n=this._project,r=n._removeSets=n._removeSets||{};r[i]=r[i]||{},r[i][this._id]=this}return this}}),{tween:function(e,t,i){i||(i=t,t=e,e=null,i||(i=t,t=null));var n=i&&i.easing,r=i&&i.start,s=null!=i&&("number"==typeof i?i:i.duration),o=new oe(this,e,t,s,n,r);return s&&this.on("frame",(function e(t){o._handleFrame(1e3*t.time),o.running||this.off("frame",e)})),o},tweenTo:function(e,t){return this.tween(null,e,t)},tweenFrom:function(e,t){return this.tween(e,null,t)}}),x=C.extend({_class:"Group",_selectBounds:!1,_selectChildren:!0,_serializeFields:{children:[]},initialize:function(e){this._children=[],this._namedChildren={},this._initialize(e)||this.addChildren(Array.isArray(e)?e:arguments)},_changed:function e(t){e.base.call(this,t),2050&t&&(this._clipItem=a)},_getClipItem:function(){var e=this._clipItem;if(e===a){e=null;for(var t=this._children,i=0,n=t.length;i<n;i++)if(t[i]._clipMask){e=t[i];break}this._clipItem=e}return e},isClipped:function(){return!!this._getClipItem()},setClipped:function(e){var t=this.getFirstChild();t&&t.setClipMask(e)},_getBounds:function e(t,i){var n=this._getClipItem();return n?n._getCachedBounds(n._matrix.prepended(t),h.set({},i,{stroke:!1})):e.base.call(this,t,i)},_hitTestChildren:function e(t,i,n){var r=this._getClipItem();return(!r||r.contains(t))&&e.base.call(this,t,i,n,r)},_draw:function(e,t){var i=t.clip,n=!i&&this._getClipItem();t=t.extend({clipItem:n,clip:!1}),i?(e.beginPath(),t.dontStart=t.dontFinish=!0):n&&n.draw(e,t.extend({clip:!0}));for(var r=this._children,s=0,o=r.length;s<o;s++){var a=r[s];a!==n&&a.draw(e,t)}}}),R=x.extend({_class:"Layer",initialize:function(){x.apply(this,arguments)},_getOwner:function(){return this._parent||null!=this._index&&this._project},isInserted:function e(){return this._parent?e.base.call(this):null!=this._index},activate:function(){this._project._activeLayer=this},_hitTestSelf:function(){}}),O=C.extend({_class:"Shape",_applyMatrix:!1,_canApplyMatrix:!1,_canScaleStroke:!0,_serializeFields:{type:null,size:null,radius:null},initialize:function(e,t){this._initialize(e,t)},_equals:function(e){return this._type===e._type&&this._size.equals(e._size)&&h.equals(this._radius,e._radius)},copyContent:function(e){this.setType(e._type),this.setSize(e._size),this.setRadius(e._radius)},getType:function(){return this._type},setType:function(e){this._type=e},getShape:"#getType",setShape:"#setType",getSize:function(){var e=this._size;return new b(e.width,e.height,this,"setSize")},setSize:function(){var e=S.read(arguments);if(this._size){if(!this._size.equals(e)){var t=this._type,i=e.width,n=e.height;"rectangle"===t?this._radius.set(S.min(this._radius,e.divide(2).abs())):"circle"===t?(i=n=(i+n)/2,this._radius=i/2):"ellipse"===t&&this._radius._set(i/2,n/2),this._size._set(i,n),this._changed(9)}}else this._size=e.clone()},getRadius:function(){var e=this._radius;return"circle"===this._type?e:new b(e.width,e.height,this,"setRadius")},setRadius:function(e){var t=this._type;if("circle"===t){if(e===this._radius)return;var i=2*e;this._radius=e,this._size._set(i,i)}else if(e=S.read(arguments),this._radius){if(this._radius.equals(e))return;this._radius.set(e),"rectangle"===t?(i=S.max(this._size,e.multiply(2)),this._size.set(i)):"ellipse"===t&&this._size._set(2*e.width,2*e.height)}else this._radius=e.clone();this._changed(9)},isEmpty:function(){return!1},toPath:function(e){var t=new(j[h.capitalize(this._type)])({center:new y,size:this._size,radius:this._radius,insert:!1});return t.copyAttributes(this),de.settings.applyMatrix&&t.setApplyMatrix(!0),(e===a||e)&&t.insertAbove(this),t},toShape:"#clone",_asPathItem:function(){return this.toPath(!1)},_draw:function(e,t,i,n){var r=this._style,s=r.hasFill(),o=r.hasStroke(),a=t.dontFinish||t.clip,c=!n;if(s||o||a){var l=this._type,h=this._radius,u="circle"===l;if(t.dontStart||e.beginPath(),c&&u)e.arc(0,0,h,0,2*Math.PI,!0);else{var d=u?h:h.width,p=u?h:h.height,g=this._size,f=g.width,m=g.height;if(c&&"rectangle"===l&&0===d&&0===p)e.rect(-f/2,-m/2,f,m);else{var v=f/2,y=m/2,_=.44771525016920644,S=d*_,b=p*_,w=[-v,-y+p,-v,-y+b,-v+S,-y,-v+d,-y,v-d,-y,v-S,-y,v,-y+b,v,-y+p,v,y-p,v,y-b,v-S,y,v-d,y,-v+d,y,-v+S,y,-v,y-b,-v,y-p];n&&n.transform(w,w,32),e.moveTo(w[0],w[1]),e.bezierCurveTo(w[2],w[3],w[4],w[5],w[6],w[7]),v!==d&&e.lineTo(w[8],w[9]),e.bezierCurveTo(w[10],w[11],w[12],w[13],w[14],w[15]),y!==p&&e.lineTo(w[16],w[17]),e.bezierCurveTo(w[18],w[19],w[20],w[21],w[22],w[23]),v!==d&&e.lineTo(w[24],w[25]),e.bezierCurveTo(w[26],w[27],w[28],w[29],w[30],w[31])}}e.closePath()}a||!s&&!o||(this._setStyles(e,t,i),s&&(e.fill(r.getFillRule()),e.shadowColor="rgba(0,0,0,0)"),o&&e.stroke())},_canComposite:function(){return!(this.hasFill()&&this.hasStroke())},_getBounds:function(e,t){var i=new w(this._size).setCenter(0,0),n=this._style,r=t.stroke&&n.hasStroke()&&n.getStrokeWidth();return e&&(i=e._transformBounds(i)),r?i.expand(j._getStrokePadding(r,this._getStrokeMatrix(e,t))):i}},new function(){function e(e,t,i){var n=e._radius;if(!n.isZero())for(var r=e._size.divide(2),s=1;s<=4;s++){var o=new y(s>1&&s<4?-1:1,s>2?-1:1),a=o.multiply(r),c=a.subtract(o.multiply(n));if(new w(i?a.add(o.multiply(i)):a,c).contains(t))return{point:c,quadrant:s}}}function t(e,t,i,n){var r=e.divide(t);return(!n||r.isInQuadrant(n))&&r.subtract(r.normalize()).multiply(t).divide(i).length<=1}return{_contains:function t(i){if("rectangle"===this._type){var n=e(this,i);return n?i.subtract(n.point).divide(this._radius).getLength()<=1:t.base.call(this,i)}return i.divide(this.size).getLength()<=.5},_hitTestSelf:function i(n,r,s,o){var a=!1,c=this._style,l=r.stroke&&c.hasStroke(),h=r.fill&&c.hasFill();if(l||h){var u=this._type,d=this._radius,p=l?c.getStrokeWidth()/2:0,g=r._tolerancePadding.add(j._getStrokePadding(p,!c.getStrokeScaling()&&o));if("rectangle"===u){var f=g.multiply(2),m=e(this,n,f);if(m)a=t(n.subtract(m.point),d,g,m.quadrant);else{var v=new w(this._size).setCenter(0,0),y=v.expand(f),_=v.expand(f.negate());a=y._containsPoint(n)&&!_._containsPoint(n)}}else a=t(n,d,g)}return a?new M(l?"stroke":"fill",this):i.base.apply(this,arguments)}}},{statics:new function(){function e(e,t,i,n,r){var s=h.create(O.prototype);return s._type=e,s._size=i,s._radius=n,s._initialize(h.getNamed(r),t),s}return{Circle:function(){var t=arguments,i=y.readNamed(t,"center"),n=h.readNamed(t,"radius");return e("circle",i,new S(2*n),n,t)},Rectangle:function(){var t=arguments,i=w.readNamed(t,"rectangle"),n=S.min(S.readNamed(t,"radius"),i.getSize(!0).divide(2));return e("rectangle",i.getCenter(!0),i.getSize(!0),n,t)},Ellipse:function(){var t=arguments,i=O._readEllipse(t),n=i.radius;return e("ellipse",i.center,n.multiply(2),n,t)},_readEllipse:function(e){var t,i;if(h.hasNamed(e,"radius"))t=y.readNamed(e,"center"),i=S.readNamed(e,"radius");else{var n=w.readNamed(e,"rectangle");t=n.getCenter(!0),i=n.getSize(!0).divide(2)}return{center:t,radius:i}}}}}),A=C.extend({_class:"Raster",_applyMatrix:!1,_canApplyMatrix:!1,_boundsOptions:{stroke:!1,handle:!1},_serializeFields:{crossOrigin:null,source:null},_prioritize:["crossOrigin"],_smoothing:"low",beans:!0,initialize:function(e,t){if(!this._initialize(e,t!==a&&y.read(arguments))){var i,n=typeof e,r="string"===n?l.getElementById(e):"object"===n?e:null;if(r&&r!==C.NO_INSERT)if(r.getContext||null!=r.naturalHeight)i=r;else if(r){var s=S.read(arguments);s.isZero()||(i=ce.getCanvas(s))}i?this.setImage(i):this.setSource(e)}this._size||(this._size=new S,this._loaded=!1)},_equals:function(e){return this.getSource()===e.getSource()},copyContent:function(e){var t=e._image,i=e._canvas;if(t)this._setImage(t);else if(i){var n=ce.getCanvas(e._size);n.getContext("2d").drawImage(i,0,0),this._setImage(n)}this._crossOrigin=e._crossOrigin},getSize:function(){var e=this._size;return new b(e?e.width:0,e?e.height:0,this,"setSize")},setSize:function(e,t){var i=S.read(arguments);if(i.equals(this._size))t&&this.clear();else if(i.width>0&&i.height>0){var n=!t&&this.getElement();this._setImage(ce.getCanvas(i)),n&&this.getContext(!0).drawImage(n,0,0,i.width,i.height)}else this._canvas&&ce.release(this._canvas),this._size=i.clone()},getWidth:function(){return this._size?this._size.width:0},setWidth:function(e){this.setSize(e,this.getHeight())},getHeight:function(){return this._size?this._size.height:0},setHeight:function(e){this.setSize(this.getWidth(),e)},getLoaded:function(){return this._loaded},isEmpty:function(){var e=this._size;return!e||0===e.width&&0===e.height},getResolution:function(){var e=this._matrix,t=new y(0,0).transform(e),i=new y(1,0).transform(e).subtract(t),n=new y(0,1).transform(e).subtract(t);return new S(72/i.getLength(),72/n.getLength())},getPpi:"#getResolution",getImage:function(){return this._image},setImage:function(e){var t=this;function i(e){var i=t.getView(),n=e&&e.type||"load";i&&t.responds(n)&&(de=i._scope,t.emit(n,new ee(e)))}this._setImage(e),this._loaded?setTimeout(i,0):e&&Q.add(e,{load:function(n){t._setImage(e),i(n)},error:i})},_setImage:function(e){this._canvas&&ce.release(this._canvas),e&&e.getContext?(this._image=null,this._canvas=e,this._loaded=!0):(this._image=e,this._canvas=null,this._loaded=!!(e&&e.src&&e.complete)),this._size=new S(e?e.naturalWidth||e.width:0,e?e.naturalHeight||e.height:0),this._context=null,this._changed(1033)},getCanvas:function(){if(!this._canvas){var e=ce.getContext(this._size);try{this._image&&e.drawImage(this._image,0,0),this._canvas=e.canvas}catch(t){ce.release(e)}}return this._canvas},setCanvas:"#setImage",getContext:function(e){return this._context||(this._context=this.getCanvas().getContext("2d")),e&&(this._image=null,this._changed(1025)),this._context},setContext:function(e){this._context=e},getSource:function(){var e=this._image;return e&&e.src||this.toDataURL()},setSource:function(e){var t=new o.Image,i=this._crossOrigin;i&&(t.crossOrigin=i),e&&(t.src=e),this.setImage(t)},getCrossOrigin:function(){var e=this._image;return e&&e.crossOrigin||this._crossOrigin||""},setCrossOrigin:function(e){this._crossOrigin=e;var t=this._image;t&&(t.crossOrigin=e)},getSmoothing:function(){return this._smoothing},setSmoothing:function(e){this._smoothing="string"==typeof e?e:e?"low":"off",this._changed(257)},getElement:function(){return this._canvas||this._loaded&&this._image}},{beans:!1,getSubCanvas:function(){var e=w.read(arguments),t=ce.getContext(e.getSize());return t.drawImage(this.getCanvas(),e.x,e.y,e.width,e.height,0,0,e.width,e.height),t.canvas},getSubRaster:function(){var e=w.read(arguments),t=new A(C.NO_INSERT);return t._setImage(this.getSubCanvas(e)),t.translate(e.getCenter().subtract(this.getSize().divide(2))),t._matrix.prepend(this._matrix),t.insertAbove(this),t},toDataURL:function(){var e=this._image,t=e&&e.src;if(/^data:/.test(t))return t;var i=this.getCanvas();return i?i.toDataURL.apply(i,arguments):null},drawImage:function(e){var t=y.read(arguments,1);this.getContext(!0).drawImage(e,t.x,t.y)},getAverageColor:function(e){var t,i;if(e?e instanceof K?(i=e,t=e.getBounds()):"object"==typeof e&&("width"in e?t=new w(e):"x"in e&&(t=new w(e.x-.5,e.y-.5,1,1))):t=this.getBounds(),!t)return null;var n=Math.min(t.width,32),r=Math.min(t.height,32),s=A._sampleContext;s?s.clearRect(0,0,33,33):s=A._sampleContext=ce.getContext(new S(32)),s.save();var o=(new I).scale(n/t.width,r/t.height).translate(-t.x,-t.y);o.applyToContext(s),i&&i.draw(s,new h({clip:!0,matrices:[o]})),this._matrix.applyToContext(s);var a=this.getElement(),c=this._size;a&&s.drawImage(a,-c.width/2,-c.height/2),s.restore();for(var l=s.getImageData(.5,.5,Math.ceil(n),Math.ceil(r)).data,u=[0,0,0],d=0,p=0,g=l.length;p<g;p+=4){var f=l[p+3];d+=f,f/=255,u[0]+=l[p]*f,u[1]+=l[p+1]*f,u[2]+=l[p+2]*f}for(p=0;p<3;p++)u[p]/=d;return d?H.read(u):null},getPixel:function(){var e=y.read(arguments),t=this.getContext().getImageData(e.x,e.y,1,1).data;return new H("rgb",[t[0]/255,t[1]/255,t[2]/255],t[3]/255)},setPixel:function(){var e=arguments,t=y.read(e),i=H.read(e),n=i._convert("rgb"),r=i._alpha,s=this.getContext(!0),o=s.createImageData(1,1),a=o.data;a[0]=255*n[0],a[1]=255*n[1],a[2]=255*n[2],a[3]=null!=r?255*r:255,s.putImageData(o,t.x,t.y)},clear:function(){var e=this._size;this.getContext(!0).clearRect(0,0,e.width+1,e.height+1)},createImageData:function(){var e=S.read(arguments);return this.getContext().createImageData(e.width,e.height)},getImageData:function(){var e=w.read(arguments);return e.isEmpty()&&(e=new w(this._size)),this.getContext().getImageData(e.x,e.y,e.width,e.height)},setImageData:function(e){var t=y.read(arguments,1);this.getContext(!0).putImageData(e,t.x,t.y)},_getBounds:function(e,t){var i=new w(this._size).setCenter(0,0);return e?e._transformBounds(i):i},_hitTestSelf:function(e){if(this._contains(e)){var t=this;return new M("pixel",t,{offset:e.add(t._size.divide(2)).round(),color:{get:function(){return t.getPixel(this.offset)}}})}},_draw:function(e,t,i){var n=this.getElement();if(n&&n.width>0&&n.height>0){e.globalAlpha=m.clamp(this._opacity,0,1),this._setStyles(e,t,i);var r=this._smoothing,s="off"===r;J.setPrefixed(e,s?"imageSmoothingEnabled":"imageSmoothingQuality",!s&&r),e.drawImage(n,-this._size.width/2,-this._size.height/2)}},_canComposite:function(){return!0}}),P=C.extend({_class:"SymbolItem",_applyMatrix:!1,_canApplyMatrix:!1,_boundsOptions:{stroke:!0},_serializeFields:{symbol:null},initialize:function(e,t){this._initialize(e,t!==a&&y.read(arguments,1))||this.setDefinition(e instanceof D?e:new D(e))},_equals:function(e){return this._definition===e._definition},copyContent:function(e){this.setDefinition(e._definition)},getDefinition:function(){return this._definition},setDefinition:function(e){this._definition=e,this._changed(9)},getSymbol:"#getDefinition",setSymbol:"#setDefinition",isEmpty:function(){return this._definition._item.isEmpty()},_getBounds:function(e,t){var i=this._definition._item;return i._getCachedBounds(i._matrix.prepended(e),t)},_hitTestSelf:function(e,t,i){var n=t.extend({all:!1}),r=this._definition._item._hitTest(e,n,i);return r&&(r.item=this),r},_draw:function(e,t){this._definition._item.draw(e,t)}}),D=h.extend({_class:"SymbolDefinition",initialize:function(e,t){this._id=v.get(),this.project=de.project,e&&this.setItem(e,t)},_serialize:function(e,t){return t.add(this,(function(){return h.serialize([this._class,this._item],e,!1,t)}))},_changed:function(e){8&e&&C._clearBoundsCache(this),1&e&&this.project._changed(e)},getItem:function(){return this._item},setItem:function(e,t){e._symbol&&(e=e.clone()),this._item&&(this._item._symbol=null),this._item=e,e.remove(),e.setSelected(!1),t||e.setPosition(new y),e._symbol=this,this._changed(9)},getDefinition:"#getItem",setDefinition:"#setItem",place:function(e){return new P(this,e)},clone:function(){return new D(this._item.clone(!1))},equals:function(e){return e===this||e&&this._item.equals(e._item)||!1}}),M=h.extend({_class:"HitResult",initialize:function(e,t,i){this.type=e,this.item=t,i&&this.inject(i)},statics:{getOptions:function(e){var t=e&&h.read(e);return new h({type:null,tolerance:de.settings.hitTolerance,fill:!t,stroke:!t,segments:!t,handles:!1,ends:!1,position:!1,center:!1,bounds:!1,guides:!1,selected:!1},t)}}}),N=h.extend({_class:"Segment",beans:!0,_selection:0,initialize:function(e,t,i,n,r,s){var o,c,l,h,u=arguments.length;u>0&&(null==e||"object"==typeof e?1===u&&e&&"point"in e?(o=e.point,c=e.handleIn,l=e.handleOut,h=e.selection):(o=e,c=t,l=i,h=n):(o=[e,t],c=i!==a?[i,n]:null,l=r!==a?[r,s]:null)),new B(o,this,"_point"),new B(c,this,"_handleIn"),new B(l,this,"_handleOut"),h&&this.setSelection(h)},_serialize:function(e,t){var i=this._point,n=this._selection,r=n||this.hasHandles()?[i,this._handleIn,this._handleOut]:i;return n&&r.push(n),h.serialize(r,e,!0,t)},_changed:function(e){var t=this._path;if(t){var i,n=t._curves,r=this._index;n&&(e&&e!==this._point&&e!==this._handleIn||!(i=r>0?n[r-1]:t._closed?n[n.length-1]:null)||i._changed(),e&&e!==this._point&&e!==this._handleOut||!(i=n[r])||i._changed()),t._changed(41)}},getPoint:function(){return this._point},setPoint:function(){this._point.set(y.read(arguments))},getHandleIn:function(){return this._handleIn},setHandleIn:function(){this._handleIn.set(y.read(arguments))},getHandleOut:function(){return this._handleOut},setHandleOut:function(){this._handleOut.set(y.read(arguments))},hasHandles:function(){return!this._handleIn.isZero()||!this._handleOut.isZero()},isSmooth:function(){var e=this._handleIn,t=this._handleOut;return!e.isZero()&&!t.isZero()&&e.isCollinear(t)},clearHandles:function(){this._handleIn._set(0,0),this._handleOut._set(0,0)},getSelection:function(){return this._selection},setSelection:function(e){var t=this._selection,i=this._path;this._selection=e=e||0,i&&e!==t&&(i._updateSelection(this,t,e),i._changed(257))},_changeSelection:function(e,t){var i=this._selection;this.setSelection(t?i|e:i&~e)},isSelected:function(){return!!(7&this._selection)},setSelected:function(e){this._changeSelection(7,e)},getIndex:function(){return this._index!==a?this._index:null},getPath:function(){return this._path||null},getCurve:function(){var e=this._path,t=this._index;return e?(t>0&&!e._closed&&t===e._segments.length-1&&t--,e.getCurves()[t]||null):null},getLocation:function(){var e=this.getCurve();return e?new L(e,this===e._segment1?0:1):null},getNext:function(){var e=this._path&&this._path._segments;return e&&(e[this._index+1]||this._path._closed&&e[0])||null},smooth:function(e,t,i){var n=e||{},r=n.type,s=n.factor,o=this.getPrevious(),c=this.getNext(),l=(o||this)._point,h=this._point,u=(c||this)._point,d=l.getDistance(h),p=h.getDistance(u);if(r&&"catmull-rom"!==r){if("geometric"!==r)throw new Error("Smoothing method '"+r+"' not supported.");if(o&&c){var g=l.subtract(u),f=s===a?.4:s,m=f*d/(d+p);t||this.setHandleIn(g.multiply(m)),i||this.setHandleOut(g.multiply(m-f))}}else{var v=s===a?.5:s,_=Math.pow(d,v),S=_*_,b=Math.pow(p,v),w=b*b;if(!t&&o){var E=2*w+3*b*_+S,I=3*b*(b+_);this.setHandleIn(0!==I?new y((w*l._x+E*h._x-S*u._x)/I-h._x,(w*l._y+E*h._y-S*u._y)/I-h._y):new y)}!i&&c&&(E=2*S+3*_*b+w,I=3*_*(_+b),this.setHandleOut(0!==I?new y((S*u._x+E*h._x-w*l._x)/I-h._x,(S*u._y+E*h._y-w*l._y)/I-h._y):new y))}},getPrevious:function(){var e=this._path&&this._path._segments;return e&&(e[this._index-1]||this._path._closed&&e[e.length-1])||null},isFirst:function(){return!this._index},isLast:function(){var e=this._path;return e&&this._index===e._segments.length-1||!1},reverse:function(){var e=this._handleIn,t=this._handleOut,i=e.clone();e.set(t),t.set(i)},reversed:function(){return new N(this._point,this._handleOut,this._handleIn)},remove:function(){return!!this._path&&!!this._path.removeSegment(this._index)},clone:function(){return new N(this._point,this._handleIn,this._handleOut)},equals:function(e){return e===this||e&&this._class===e._class&&this._point.equals(e._point)&&this._handleIn.equals(e._handleIn)&&this._handleOut.equals(e._handleOut)||!1},toString:function(){var e=["point: "+this._point];return this._handleIn.isZero()||e.push("handleIn: "+this._handleIn),this._handleOut.isZero()||e.push("handleOut: "+this._handleOut),"{ "+e.join(", ")+" }"},transform:function(e){this._transformCoordinates(e,new Array(6),!0),this._changed()},interpolate:function(e,t,i){var n=1-i,r=i,s=e._point,o=t._point,a=e._handleIn,c=t._handleIn,l=t._handleOut,h=e._handleOut;this._point._set(n*s._x+r*o._x,n*s._y+r*o._y,!0),this._handleIn._set(n*a._x+r*c._x,n*a._y+r*c._y,!0),this._handleOut._set(n*h._x+r*l._x,n*h._y+r*l._y,!0),this._changed()},_transformCoordinates:function(e,t,i){var n=this._point,r=i&&this._handleIn.isZero()?null:this._handleIn,s=i&&this._handleOut.isZero()?null:this._handleOut,o=n._x,a=n._y,c=2;return t[0]=o,t[1]=a,r&&(t[c++]=r._x+o,t[c++]=r._y+a),s&&(t[c++]=s._x+o,t[c++]=s._y+a),e&&(e._transformCoordinates(t,t,c/2),o=t[0],a=t[1],i?(n._x=o,n._y=a,c=2,r&&(r._x=t[c++]-o,r._y=t[c++]-a),s&&(s._x=t[c++]-o,s._y=t[c++]-a)):(r||(t[c++]=o,t[c++]=a),s||(t[c++]=o,t[c++]=a))),t}}),B=y.extend({initialize:function(e,t,i){var n,r,s;if(e)if((n=e[0])!==a)r=e[1];else{var o=e;(n=o.x)===a&&(n=(o=y.read(arguments)).x),r=o.y,s=o.selected}else n=r=0;this._x=n,this._y=r,this._owner=t,t[i]=this,s&&this.setSelected(!0)},_set:function(e,t){return this._x=e,this._y=t,this._owner._changed(this),this},getX:function(){return this._x},setX:function(e){this._x=e,this._owner._changed(this)},getY:function(){return this._y},setY:function(e){this._y=e,this._owner._changed(this)},isZero:function(){var e=m.isZero;return e(this._x)&&e(this._y)},isSelected:function(){return!!(this._owner._selection&this._getSelection())},setSelected:function(e){this._owner._changeSelection(this._getSelection(),e)},_getSelection:function(){var e=this._owner;return this===e._point?1:this===e._handleIn?2:this===e._handleOut?4:0}}),U=h.extend({_class:"Curve",beans:!0,initialize:function(e,t,i,n,r,s,o,a){var c,l,h,u,d,p,g=arguments.length;3===g?(this._path=e,c=t,l=i):g?1===g?"segment1"in e?(c=new N(e.segment1),l=new N(e.segment2)):"point1"in e?(h=e.point1,d=e.handle1,p=e.handle2,u=e.point2):Array.isArray(e)&&(h=[e[0],e[1]],u=[e[6],e[7]],d=[e[2]-e[0],e[3]-e[1]],p=[e[4]-e[6],e[5]-e[7]]):2===g?(c=new N(e),l=new N(t)):4===g?(h=e,d=t,p=i,u=n):8===g&&(h=[e,t],u=[o,a],d=[i-e,n-t],p=[r-o,s-a]):(c=new N,l=new N),this._segment1=c||new N(h,null,d),this._segment2=l||new N(u,p,null)},_serialize:function(e,t){return h.serialize(this.hasHandles()?[this.getPoint1(),this.getHandle1(),this.getHandle2(),this.getPoint2()]:[this.getPoint1(),this.getPoint2()],e,!0,t)},_changed:function(){this._length=this._bounds=a},clone:function(){return new U(this._segment1,this._segment2)},toString:function(){var e=["point1: "+this._segment1._point];return this._segment1._handleOut.isZero()||e.push("handle1: "+this._segment1._handleOut),this._segment2._handleIn.isZero()||e.push("handle2: "+this._segment2._handleIn),e.push("point2: "+this._segment2._point),"{ "+e.join(", ")+" }"},classify:function(){return U.classify(this.getValues())},remove:function(){var e=!1;if(this._path){var t=this._segment2,i=t._handleOut;(e=t.remove())&&this._segment1._handleOut.set(i)}return e},getPoint1:function(){return this._segment1._point},setPoint1:function(){this._segment1._point.set(y.read(arguments))},getPoint2:function(){return this._segment2._point},setPoint2:function(){this._segment2._point.set(y.read(arguments))},getHandle1:function(){return this._segment1._handleOut},setHandle1:function(){this._segment1._handleOut.set(y.read(arguments))},getHandle2:function(){return this._segment2._handleIn},setHandle2:function(){this._segment2._handleIn.set(y.read(arguments))},getSegment1:function(){return this._segment1},getSegment2:function(){return this._segment2},getPath:function(){return this._path},getIndex:function(){return this._segment1._index},getNext:function(){var e=this._path&&this._path._curves;return e&&(e[this._segment1._index+1]||this._path._closed&&e[0])||null},getPrevious:function(){var e=this._path&&this._path._curves;return e&&(e[this._segment1._index-1]||this._path._closed&&e[e.length-1])||null},isFirst:function(){return!this._segment1._index},isLast:function(){var e=this._path;return e&&this._segment1._index===e._curves.length-1||!1},isSelected:function(){return this.getPoint1().isSelected()&&this.getHandle1().isSelected()&&this.getHandle2().isSelected()&&this.getPoint2().isSelected()},setSelected:function(e){this.getPoint1().setSelected(e),this.getHandle1().setSelected(e),this.getHandle2().setSelected(e),this.getPoint2().setSelected(e)},getValues:function(e){return U.getValues(this._segment1,this._segment2,e)},getPoints:function(){for(var e=this.getValues(),t=[],i=0;i<8;i+=2)t.push(new y(e[i],e[i+1]));return t}},{getLength:function(){return null==this._length&&(this._length=U.getLength(this.getValues(),0,1)),this._length},getArea:function(){return U.getArea(this.getValues())},getLine:function(){return new k(this._segment1._point,this._segment2._point)},getPart:function(e,t){return new U(U.getPart(this.getValues(),e,t))},getPartLength:function(e,t){return U.getLength(this.getValues(),e,t)},divideAt:function(e){return this.divideAtTime(e&&e.curve===this?e.time:this.getTimeAt(e))},divideAtTime:function(e,t){var i=null;if(e>=1e-8&&e<=.99999999){var n=U.subdivide(this.getValues(),e),r=n[0],s=n[1],o=t||this.hasHandles(),a=this._segment1,c=this._segment2,l=this._path;o&&(a._handleOut._set(r[2]-r[0],r[3]-r[1]),c._handleIn._set(s[4]-s[6],s[5]-s[7]));var h=r[6],u=r[7],d=new N(new y(h,u),o&&new y(r[4]-h,r[5]-u),o&&new y(s[2]-h,s[3]-u));l?(l.insert(a._index+1,d),i=this.getNext()):(this._segment2=d,this._changed(),i=new U(d,c))}return i},splitAt:function(e){var t=this._path;return t?t.splitAt(e):null},splitAtTime:function(e){return this.splitAt(this.getLocationAtTime(e))},divide:function(e,t){return this.divideAtTime(e===a?.5:t?e:this.getTimeAt(e))},split:function(e,t){return this.splitAtTime(e===a?.5:t?e:this.getTimeAt(e))},reversed:function(){return new U(this._segment2.reversed(),this._segment1.reversed())},clearHandles:function(){this._segment1._handleOut._set(0,0),this._segment2._handleIn._set(0,0)},statics:{getValues:function(e,t,i,n){var r=e._point,s=e._handleOut,o=t._handleIn,a=t._point,c=r.x,l=r.y,h=a.x,u=a.y,d=n?[c,l,c,l,h,u,h,u]:[c,l,c+s._x,l+s._y,h+o._x,u+o._y,h,u];return i&&i._transformCoordinates(d,d,4),d},subdivide:function(e,t){var i=e[0],n=e[1],r=e[2],s=e[3],o=e[4],c=e[5],l=e[6],h=e[7];t===a&&(t=.5);var u=1-t,d=u*i+t*r,p=u*n+t*s,g=u*r+t*o,f=u*s+t*c,m=u*o+t*l,v=u*c+t*h,y=u*d+t*g,_=u*p+t*f,S=u*g+t*m,b=u*f+t*v,w=u*y+t*S,E=u*_+t*b;return[[i,n,d,p,y,_,w,E],[w,E,S,b,m,v,l,h]]},getMonoCurves:function(e,t){var i=[],n=t?0:1,r=e[n+0],s=e[n+2],o=e[n+4],a=e[n+6];if(r>=s==s>=o&&s>=o==o>=a||U.isStraight(e))i.push(e);else{var c=3*(s-o)-r+a,l=2*(r+o)-4*s,h=s-r,u=[],d=m.solveQuadratic(c,l,h,u,1e-8,.99999999);if(d){u.sort();var p=u[0],g=U.subdivide(e,p);i.push(g[0]),d>1&&(p=(u[1]-p)/(1-p),g=U.subdivide(g[1],p),i.push(g[0])),i.push(g[1])}else i.push(e)}return i},solveCubic:function(e,t,i,n,r,s){var o=e[t],a=e[t+2],c=e[t+4],l=e[t+6],h=0;if(!(o<i&&l<i&&a<i&&c<i||o>i&&l>i&&a>i&&c>i)){var u=3*(a-o),d=3*(c-a)-u,p=l-o-u-d;h=m.solveCubic(p,d,u,o-i,n,r,s)}return h},getTimeOf:function(e,t){var i=new y(e[0],e[1]),n=new y(e[6],e[7]),r=1e-7;if(null===(t.isClose(i,1e-12)?0:t.isClose(n,1e-12)?1:null))for(var s=[t.x,t.y],o=[],a=0;a<2;a++)for(var c=U.solveCubic(e,a,s[a],o,0,1),l=0;l<c;l++){var h=o[l];if(t.isClose(U.getPoint(e,h),r))return h}return t.isClose(i,r)?0:t.isClose(n,r)?1:null},getNearestTime:function(e,t){if(U.isStraight(e)){var i=e[0],n=e[1],r=e[6]-i,s=e[7]-n,o=r*r+s*s;if(0===o)return 0;var a=((t.x-i)*r+(t.y-n)*s)/o;return a<1e-12?0:a>.999999999999?1:U.getTimeOf(e,new y(i+a*r,n+a*s))}var c=1/0,l=0;function h(i){if(i>=0&&i<=1){var n=t.getDistance(U.getPoint(e,i),!0);if(n<c)return c=n,l=i,!0}}for(var u=0;u<=100;u++)h(u/100);for(var d=.005;d>1e-8;)h(l-d)||h(l+d)||(d/=2);return l},getPart:function(e,t,i){var n=t>i;if(n){var r=t;t=i,i=r}return t>0&&(e=U.subdivide(e,t)[1]),i<1&&(e=U.subdivide(e,(i-t)/(1-t))[0]),n?[e[6],e[7],e[4],e[5],e[2],e[3],e[0],e[1]]:e},isFlatEnough:function(e,t){var i=e[0],n=e[1],r=e[2],s=e[3],o=e[4],a=e[5],c=e[6],l=e[7],h=3*r-2*i-c,u=3*s-2*n-l,d=3*o-2*c-i,p=3*a-2*l-n;return Math.max(h*h,d*d)+Math.max(u*u,p*p)<=16*t*t},getArea:function(e){var t=e[0],i=e[1],n=e[2],r=e[3],s=e[4],o=e[5],a=e[6],c=e[7];return 3*((c-i)*(n+s)-(a-t)*(r+o)+r*(t-s)-n*(i-o)+c*(s+t/3)-a*(o+i/3))/20},getBounds:function(e){for(var t=e.slice(0,2),i=t.slice(),n=[0,0],r=0;r<2;r++)U._addBounds(e[r],e[r+2],e[r+4],e[r+6],r,0,t,i,n);return new w(t[0],t[1],i[0]-t[0],i[1]-t[1])},_addBounds:function(e,t,i,n,r,s,o,a,c){function l(e,t){var i=e-t,n=e+t;i<o[r]&&(o[r]=i),n>a[r]&&(a[r]=n)}s/=2;var h=o[r]+s,u=a[r]-s;if(e<h||t<h||i<h||n<h||e>u||t>u||i>u||n>u)if(t<e!=t<n&&i<e!=i<n)l(e,0),l(n,0);else{var d=3*(t-i)-e+n,p=2*(e+i)-4*t,g=t-e,f=m.solveQuadratic(d,p,g,c);l(n,0);for(var v=0;v<f;v++){var y=c[v],_=1-y;1e-8<=y&&y<=.99999999&&l(_*_*_*e+3*_*_*y*t+3*_*y*y*i+y*y*y*n,s)}}}}},h.each(["getBounds","getStrokeBounds","getHandleBounds"],(function(e){this[e]=function(){this._bounds||(this._bounds={});var t=this._bounds[e];return t||(t=this._bounds[e]=j[e]([this._segment1,this._segment2],!1,this._path)),t.clone()}}),{}),h.each({isStraight:function(e,t,i,n){if(t.isZero()&&i.isZero())return!0;var r=n.subtract(e);if(r.isZero())return!1;if(r.isCollinear(t)&&r.isCollinear(i)){var s=new k(e,n);if(s.getDistance(e.add(t))<1e-7&&s.getDistance(n.add(i))<1e-7){var o=r.dot(r),a=r.dot(t)/o,c=r.dot(i)/o;return a>=0&&a<=1&&c<=0&&c>=-1}}return!1},isLinear:function(e,t,i,n){var r=n.subtract(e).divide(3);return t.equals(r)&&i.negate().equals(r)}},(function(e,t){this[t]=function(t){var i=this._segment1,n=this._segment2;return e(i._point,i._handleOut,n._handleIn,n._point,t)},this.statics[t]=function(t,i){var n=t[0],r=t[1],s=t[6],o=t[7];return e(new y(n,r),new y(t[2]-n,t[3]-r),new y(t[4]-s,t[5]-o),new y(s,o),i)}}),{statics:{},hasHandles:function(){return!this._segment1._handleOut.isZero()||!this._segment2._handleIn.isZero()},hasLength:function(e){return(!this.getPoint1().equals(this.getPoint2())||this.hasHandles())&&this.getLength()>(e||0)},isCollinear:function(e){return e&&this.isStraight()&&e.isStraight()&&this.getLine().isCollinear(e.getLine())},isHorizontal:function(){return this.isStraight()&&Math.abs(this.getTangentAtTime(.5).y)<1e-8},isVertical:function(){return this.isStraight()&&Math.abs(this.getTangentAtTime(.5).x)<1e-8}}),{beans:!1,getLocationAt:function(e,t){return this.getLocationAtTime(t?e:this.getTimeAt(e))},getLocationAtTime:function(e){return null!=e&&e>=0&&e<=1?new L(this,e):null},getTimeAt:function(e,t){return U.getTimeAt(this.getValues(),e,t)},getParameterAt:"#getTimeAt",getTimesWithTangent:function(){var e=y.read(arguments);return e.isZero()?[]:U.getTimesWithTangent(this.getValues(),e)},getOffsetAtTime:function(e){return this.getPartLength(0,e)},getLocationOf:function(){return this.getLocationAtTime(this.getTimeOf(y.read(arguments)))},getOffsetOf:function(){var e=this.getLocationOf.apply(this,arguments);return e?e.getOffset():null},getTimeOf:function(){return U.getTimeOf(this.getValues(),y.read(arguments))},getParameterOf:"#getTimeOf",getNearestLocation:function(){var e=y.read(arguments),t=this.getValues(),i=U.getNearestTime(t,e),n=U.getPoint(t,i);return new L(this,i,n,null,e.getDistance(n))},getNearestPoint:function(){var e=this.getNearestLocation.apply(this,arguments);return e?e.getPoint():e}},new function(){var e=["getPoint","getTangent","getNormal","getWeightedTangent","getWeightedNormal","getCurvature"];return h.each(e,(function(e){this[e+"At"]=function(t,i){var n=this.getValues();return U[e](n,i?t:U.getTimeAt(n,t))},this[e+"AtTime"]=function(t){return U[e](this.getValues(),t)}}),{statics:{_evaluateMethods:e}})},new function(){function e(e){var t=e[0],i=e[1],n=e[2],r=e[3],s=e[4],o=e[5],a=e[6],c=e[7],l=9*(n-s)+3*(a-t),h=6*(t+s)-12*n,u=3*(n-t),d=9*(r-o)+3*(c-i),p=6*(i+o)-12*r,g=3*(r-i);return function(e){var t=(l*e+h)*e+u,i=(d*e+p)*e+g;return Math.sqrt(t*t+i*i)}}function t(e,t){return Math.max(2,Math.min(16,Math.ceil(32*Math.abs(t-e))))}function i(e,t,i,n){if(null==t||t<0||t>1)return null;var r=e[0],s=e[1],o=e[2],a=e[3],c=e[4],l=e[5],h=e[6],u=e[7],d=m.isZero;d(o-r)&&d(a-s)&&(o=r,a=s),d(c-h)&&d(l-u)&&(c=h,l=u);var p,g,f=3*(o-r),v=3*(c-o)-f,_=h-r-f-v,S=3*(a-s),b=3*(l-a)-S,w=u-s-S-b;if(0===i)p=0===t?r:1===t?h:((_*t+v)*t+f)*t+r,g=0===t?s:1===t?u:((w*t+b)*t+S)*t+s;else{var E=1e-8,I=1-E;if(t<E?(p=f,g=S):t>I?(p=3*(h-c),g=3*(u-l)):(p=(3*_*t+2*v)*t+f,g=(3*w*t+2*b)*t+S),n){0===p&&0===g&&(t<E||t>I)&&(p=c-o,g=l-a);var k=Math.sqrt(p*p+g*g);k&&(p/=k,g/=k)}if(3===i){c=6*_*t+2*v,l=6*w*t+2*b;var T=Math.pow(p*p+g*g,1.5);p=0!==T?(p*l-g*c)/T:0,g=0}}return 2===i?new y(g,-p):new y(p,g)}return{statics:{classify:function(e){var t=e[0],i=e[1],n=e[2],r=e[3],s=e[4],o=e[5],c=e[6],l=e[7],h=n*(i-l)+r*(c-t)+t*l-i*c,u=3*(s*(r-i)+o*(t-n)+n*i-r*t),d=u-h,p=d-h+(t*(l-o)+i*(s-c)+c*o-l*s),g=Math.sqrt(p*p+d*d+u*u),f=0!==g?1/g:0,v=m.isZero,y="serpentine";function _(e,t,i){var n=t!==a,r=n&&t>0&&t<1,s=n&&i>0&&i<1;return!n||(r||s)&&("loop"!==e||r&&s)||(e="arch",r=s=!1),{type:e,roots:r||s?r&&s?t<i?[t,i]:[i,t]:[r?t:i]:null}}if(d*=f,u*=f,v(p*=f))return v(d)?_(v(u)?"line":"quadratic"):_(y,u/(3*d));var S=3*d*d-4*p*u;if(v(S))return _("cusp",d/(2*p));var b=S>0?Math.sqrt(S/3):Math.sqrt(-S),w=2*p;return _(S>0?y:"loop",(d+b)/w,(d-b)/w)},getLength:function(i,n,r,s){if(n===a&&(n=0),r===a&&(r=1),U.isStraight(i)){var o=i;r<1&&(o=U.subdivide(o,r)[0],n/=r),n>0&&(o=U.subdivide(o,n)[1]);var c=o[6]-o[0],l=o[7]-o[1];return Math.sqrt(c*c+l*l)}return m.integrate(s||e(i),n,r,t(n,r))},getTimeAt:function(i,n,r){if(r===a&&(r=n<0?1:0),0===n)return r;var s=Math.abs,o=n>0,c=o?r:0,l=o?1:r,h=e(i),u=U.getLength(i,c,l,h),d=s(n)-u;if(s(d)<1e-12)return o?l:c;if(d>1e-12)return null;var p=n/u,g=0;return m.findRoot((function(e){return g+=m.integrate(h,r,e,t(r,e)),r=e,g-n}),h,r+p,c,l,32,1e-12)},getPoint:function(e,t){return i(e,t,0,!1)},getTangent:function(e,t){return i(e,t,1,!0)},getWeightedTangent:function(e,t){return i(e,t,1,!1)},getNormal:function(e,t){return i(e,t,2,!0)},getWeightedNormal:function(e,t){return i(e,t,2,!1)},getCurvature:function(e,t){return i(e,t,3,!1).x},getPeaks:function(e){var t=e[0],i=e[1],n=e[2],r=e[3],s=e[4],o=e[5],a=3*n-t-3*s+e[6],c=3*t-6*n+3*s,l=-3*t+3*n,h=3*r-i-3*o+e[7],u=3*i-6*r+3*o,d=-3*i+3*r,p=[];return m.solveCubic(9*(a*a+h*h),9*(a*c+u*h),2*(c*c+u*u)+3*(l*a+d*h),l*c+u*d,p,1e-8,.99999999),p.sort()}}}},new function(){function e(e,t,i,n,r,s,o){var a=!o&&i.getPrevious()===r,c=!o&&i!==r&&i.getNext()===r,l=1e-8,h=1-l;if(null!==n&&n>=(a?l:0)&&n<=(c?h:1)&&null!==s&&s>=(c?l:0)&&s<=(a?h:1)){var u=new L(i,n,null,o),d=new L(r,s,null,o);u._intersection=d,d._intersection=u,t&&!t(u)||L.insert(e,u,!0)}}function t(n,r,s,o,a,c,l,h,u,d,p,g,f){if(++u>=4096||++h>=40)return u;var m,v,y=r[0],_=r[1],S=r[6],b=r[7],w=k.getSignedDistance,E=w(y,_,S,b,r[2],r[3]),I=w(y,_,S,b,r[4],r[5]),T=E*I>0?3/4:4/9,C=T*Math.min(0,E,I),x=T*Math.max(0,E,I),R=w(y,_,S,b,n[0],n[1]),O=w(y,_,S,b,n[2],n[3]),A=w(y,_,S,b,n[4],n[5]),P=w(y,_,S,b,n[6],n[7]),D=function(e,t,i,n){var r,s=[0,e],o=[1/3,t],a=[2/3,i],c=[1,n],l=t-(2*e+n)/3,h=i-(e+2*n)/3;if(l*h<0)r=[[s,o,c],[s,a,c]];else{var u=l/h;r=[u>=2?[s,o,c]:u<=.5?[s,a,c]:[s,o,a,c],[s,c]]}return(l||h)<0?r.reverse():r}(R,O,A,P),M=D[0],N=D[1];if(0===E&&0===I&&0===R&&0===O&&0===A&&0===P||null==(m=i(M,N,C,x))||null==(v=i(M.reverse(),N.reverse(),C,x)))return u;var B=d+(p-d)*m,L=d+(p-d)*v;if(Math.max(f-g,L-B)<1e-9){var K=(B+L)/2,j=(g+f)/2;e(a,c,l?o:s,l?j:K,l?s:o,l?K:j)}else{n=U.getPart(n,m,v);var F=f-g;if(v-m>.8)if(L-B>F)K=(B+L)/2,u=t(r,(q=U.subdivide(n,.5))[0],o,s,a,c,!l,h,u,g,f,B,K),u=t(r,q[1],o,s,a,c,!l,h,u,g,f,K,L);else{var q;j=(g+f)/2,u=t((q=U.subdivide(r,.5))[0],n,o,s,a,c,!l,h,u,g,j,B,L),u=t(q[1],n,o,s,a,c,!l,h,u,j,f,B,L)}else u=0===F||F>=1e-9?t(r,n,o,s,a,c,!l,h,u,g,f,B,L):t(n,r,s,o,a,c,l,h,u,B,L,g,f)}return u}function i(e,t,i,r){return e[0][1]<i?n(e,!0,i):t[0][1]>r?n(t,!1,r):e[0][0]}function n(e,t,i){for(var n=e[0][0],r=e[0][1],s=1,o=e.length;s<o;s++){var a=e[s][0],c=e[s][1];if(t?c>=i:c<=i)return c===i?a:n+(i-r)*(a-n)/(c-r);n=a,r=c}return null}function r(e,t,i,n,r){var s=m.isZero;if(s(n)&&s(r)){var o=U.getTimeOf(e,new y(t,i));return null===o?[]:[o]}for(var a=Math.atan2(-r,n),c=Math.sin(a),l=Math.cos(a),h=[],u=[],d=0;d<8;d+=2){var p=e[d]-t,g=e[d+1]-i;h.push(p*l-g*c,p*c+g*l)}return U.solveCubic(h,1,0,u,0,1),u}function s(t,i,n,s,o,a,c){for(var l=i[0],h=i[1],u=r(t,l,h,i[6]-l,i[7]-h),d=0,p=u.length;d<p;d++){var g=u[d],f=U.getPoint(t,g),m=U.getTimeOf(i,f);null!==m&&e(o,a,c?s:n,c?m:g,c?n:s,c?g:m)}}function o(t,i,n,r,s,o){var a=k.intersect(t[0],t[1],t[6],t[7],i[0],i[1],i[6],i[7]);a&&e(s,o,n,U.getTimeOf(t,a),r,U.getTimeOf(i,a))}function a(i,n,r,a,c,h){var u=1e-12,d=Math.min,p=Math.max;if(p(i[0],i[2],i[4],i[6])+u>d(n[0],n[2],n[4],n[6])&&d(i[0],i[2],i[4],i[6])-u<p(n[0],n[2],n[4],n[6])&&p(i[1],i[3],i[5],i[7])+u>d(n[1],n[3],n[5],n[7])&&d(i[1],i[3],i[5],i[7])-u<p(n[1],n[3],n[5],n[7])){var g=l(i,n);if(g)for(var f=0;f<2;f++){var m=g[f];e(c,h,r,m[0],a,m[1],!0)}else{var v=U.isStraight(i),_=U.isStraight(n),S=v&&_,b=v&&!_,w=c.length;if((S?o:v||_?s:t)(b?n:i,b?i:n,b?a:r,b?r:a,c,h,b,0,0,0,1,0,1),!S||c.length===w)for(f=0;f<4;f++){var E=f>>1,I=1&f,k=6*E,T=6*I,C=new y(i[k],i[k+1]),x=new y(n[T],n[T+1]);C.isClose(x,u)&&e(c,h,r,E,a,I)}}}return c}function c(t,i,n,r){var s=U.classify(t);if("loop"===s.type){var o=s.roots;e(n,r,i,o[0],i,o[1])}return n}function l(e,t){function i(e){var t=e[6]-e[0],i=e[7]-e[1];return t*t+i*i}var n=Math.abs,r=k.getDistance,s=1e-7,o=U.isStraight(e),a=U.isStraight(t),c=o&&a,l=i(e)<i(t),h=l?t:e,u=l?e:t,d=h[0],p=h[1],g=h[6]-d,f=h[7]-p;if(r(d,p,g,f,u[0],u[1],!0)<s&&r(d,p,g,f,u[6],u[7],!0)<s)!c&&r(d,p,g,f,h[2],h[3],!0)<s&&r(d,p,g,f,h[4],h[5],!0)<s&&r(d,p,g,f,u[2],u[3],!0)<s&&r(d,p,g,f,u[4],u[5],!0)<s&&(o=a=c=!0);else if(c)return null;if(o^a)return null;for(var m=[e,t],v=[],_=0;_<4&&v.length<2;_++){var S=1&_,b=1^S,w=_>>1,E=U.getTimeOf(m[S],new y(m[b][w?6:0],m[b][w?7:1]));if(null!=E){var I=S?[w,E]:[E,w];(!v.length||n(I[0]-v[0][0])>1e-8&&n(I[1]-v[0][1])>1e-8)&&v.push(I)}if(_>2&&!v.length)break}if(2!==v.length)v=null;else if(!c){var T=U.getPart(e,v[0][0],v[1][0]),C=U.getPart(t,v[0][1],v[1][1]);(n(C[2]-T[2])>s||n(C[3]-T[3])>s||n(C[4]-T[4])>s||n(C[5]-T[5])>s)&&(v=null)}return v}return{getIntersections:function(e){var t=this.getValues(),i=e&&e!==this&&e.getValues();return i?a(t,i,this,e,[]):c(t,this,[])},statics:{getOverlaps:l,getIntersections:function(e,t,i,n,r,s){var o=!t;o&&(t=e);for(var l=e.length,h=t.length,u=new Array(l),d=o?u:new Array(h),p=[],f=0;f<l;f++)u[f]=e[f].getValues(n);if(!o)for(f=0;f<h;f++)d[f]=t[f].getValues(r);for(var m=g.findCurveBoundsCollisions(u,d,1e-7),v=0;v<l;v++){var y=e[v],_=u[v];o&&c(_,y,p,i);var S=m[v];if(S)for(var b=0;b<S.length;b++){if(s&&p.length)return p;var w=S[b];if(!o||w>v){var E=t[w];a(_,d[w],y,E,p,i)}}}return p},getCurveLineIntersections:r,getTimesWithTangent:function(e,t){var i=e[0],n=e[1],r=e[2],s=e[3],o=e[4],a=e[5],c=e[6],l=e[7],h=t.normalize(),u=h.x,d=h.y,p=3*c-9*o+9*r-3*i,g=3*l-9*a+9*s-3*n,f=6*o-12*r+6*i,v=6*a-12*s+6*n,y=3*r-3*i,_=3*s-3*n,S=2*p*d-2*g*u,b=[];if(Math.abs(S)<m.CURVETIME_EPSILON){if(0!=(S=p*v-g*f)){var w=-(p*_-g*y)/S;w>=0&&w<=1&&b.push(w)}}else{var E=(f*f-4*p*y)*d*d+(-2*f*v+4*g*y+4*p*_)*u*d+(v*v-4*g*_)*u*u,I=f*d-v*u;if(E>=0&&0!=S){var k=Math.sqrt(E),T=-(I+k)/S,C=(-I+k)/S;T>=0&&T<=1&&b.push(T),C>=0&&C<=1&&b.push(C)}}return b}}}}),L=h.extend({_class:"CurveLocation",initialize:function(e,t,i,n,r){if(t>=.99999999){var s=e.getNext();s&&(t=0,e=s)}this._setCurve(e),this._time=t,this._point=i||e.getPointAtTime(t),this._overlap=n,this._distance=r,this._intersection=this._next=this._previous=null},_setPath:function(e){this._path=e,this._version=e?e._version:0},_setCurve:function(e){this._setPath(e._path),this._curve=e,this._segment=null,this._segment1=e._segment1,this._segment2=e._segment2},_setSegment:function(e){var t=e.getCurve();t?this._setCurve(t):(this._setPath(e._path),this._segment1=e,this._segment2=null),this._segment=e,this._time=e===this._segment1?0:1,this._point=e._point.clone()},getSegment:function(){var e=this._segment;if(!e){var t=this.getCurve(),i=this.getTime();0===i?e=t._segment1:1===i?e=t._segment2:null!=i&&(e=t.getPartLength(0,i)<t.getPartLength(i,1)?t._segment1:t._segment2),this._segment=e}return e},getCurve:function(){var e=this._path,t=this;function i(e){var i=e&&e.getCurve();if(i&&null!=(t._time=i.getTimeOf(t._point)))return t._setCurve(i),i}return e&&e._version!==this._version&&(this._time=this._offset=this._curveOffset=this._curve=null),this._curve||i(this._segment)||i(this._segment1)||i(this._segment2.getPrevious())},getPath:function(){var e=this.getCurve();return e&&e._path},getIndex:function(){var e=this.getCurve();return e&&e.getIndex()},getTime:function(){var e=this.getCurve(),t=this._time;return e&&null==t?this._time=e.getTimeOf(this._point):t},getParameter:"#getTime",getPoint:function(){return this._point},getOffset:function(){var e=this._offset;if(null==e){e=0;var t=this.getPath(),i=this.getIndex();if(t&&null!=i)for(var n=t.getCurves(),r=0;r<i;r++)e+=n[r].getLength();this._offset=e+=this.getCurveOffset()}return e},getCurveOffset:function(){var e=this._curveOffset;if(null==e){var t=this.getCurve(),i=this.getTime();this._curveOffset=e=null!=i&&t&&t.getPartLength(0,i)}return e},getIntersection:function(){return this._intersection},getDistance:function(){return this._distance},divide:function(){var e=this.getCurve(),t=e&&e.divideAtTime(this.getTime());return t&&this._setSegment(t._segment1),t},split:function(){var e=this.getCurve(),t=e._path,i=e&&e.splitAtTime(this.getTime());return i&&this._setSegment(t.getLastSegment()),i},equals:function(e,t){var i=this===e;if(!i&&e instanceof L){var n=this.getCurve(),r=e.getCurve(),s=n._path;if(s===r._path){var o=Math.abs,a=o(this.getOffset()-e.getOffset()),c=!t&&this._intersection,l=!t&&e._intersection;i=(a<1e-7||s&&o(s.getLength()-a)<1e-7)&&(!c&&!l||c&&l&&c.equals(l,!0))}}return i},toString:function(){var e=[],t=this.getPoint(),i=f.instance;t&&e.push("point: "+t);var n=this.getIndex();null!=n&&e.push("index: "+n);var r=this.getTime();return null!=r&&e.push("time: "+i.number(r)),null!=this._distance&&e.push("distance: "+i.number(this._distance)),"{ "+e.join(", ")+" }"},isTouching:function(){var e=this._intersection;if(e&&this.getTangent().isCollinear(e.getTangent())){var t=this.getCurve(),i=e.getCurve();return!(t.isStraight()&&i.isStraight()&&t.getLine().intersect(i.getLine()))}return!1},isCrossing:function(){var e=this._intersection;if(!e)return!1;var t=this.getTime(),i=e.getTime(),n=1e-8,r=1-n,s=t>=n&&t<=r,o=i>=n&&i<=r;if(s&&o)return!this.isTouching();var a=this.getCurve(),c=a&&t<n?a.getPrevious():a,l=e.getCurve(),h=l&&i<n?l.getPrevious():l;if(t>r&&(a=a.getNext()),i>r&&(l=l.getNext()),!(c&&a&&h&&l))return!1;var u=[];function d(e,t){var i=e.getValues(),n=U.classify(i).roots||U.getPeaks(i),r=n.length,s=U.getLength(i,t&&r?n[r-1]:0,!t&&r?n[0]:1);u.push(r?s:s/32)}function p(e,t,i){return t<i?e>t&&e<i:e>t||e<i}s||(d(c,!0),d(a,!1)),o||(d(h,!0),d(l,!1));var g=this.getPoint(),f=Math.min.apply(Math,u),m=s?a.getTangentAtTime(t):a.getPointAt(f).subtract(g),v=s?m.negate():c.getPointAt(-f).subtract(g),y=o?l.getTangentAtTime(i):l.getPointAt(f).subtract(g),_=o?y.negate():h.getPointAt(-f).subtract(g),S=v.getAngle(),b=m.getAngle(),w=_.getAngle(),E=y.getAngle();return!!(s?p(S,w,E)^p(b,w,E)&&p(S,E,w)^p(b,E,w):p(w,S,b)^p(E,S,b)&&p(w,b,S)^p(E,b,S))},hasOverlap:function(){return!!this._overlap}},h.each(U._evaluateMethods,(function(e){var t=e+"At";this[e]=function(){var e=this.getCurve(),i=this.getTime();return null!=i&&e&&e[t](i,!0)}}),{preserve:!0}),new function(){function e(e,t,i){var n=e.length,r=0,s=n-1;function o(i,r){for(var s=i+r;s>=-1&&s<=n;s+=r){var o=e[(s%n+n)%n];if(!t.getPoint().isClose(o.getPoint(),1e-7))break;if(t.equals(o))return o}return null}for(;r<=s;){var a,c=r+s>>>1,l=e[c];if(i&&(a=t.equals(l)?l:o(c,-1)||o(c,1)))return t._overlap&&(a._overlap=a._intersection._overlap=!0),a;var h=t.getPath(),u=l.getPath();(h!==u?h._id-u._id:t.getIndex()+t.getTime()-(l.getIndex()+l.getTime()))<0?s=c-1:r=c+1}return e.splice(r,0,t),t}return{statics:{insert:e,expand:function(t){for(var i=t.slice(),n=t.length-1;n>=0;n--)e(i,t[n]._intersection,!1);return i}}}}),K=C.extend({_class:"PathItem",_selectBounds:!1,_canScaleStroke:!0,beans:!0,initialize:function(){},statics:{create:function(e){var t,i,n;if(h.isPlainObject(e)?(i=e.segments,t=e.pathData):Array.isArray(e)?i=e:"string"==typeof e&&(t=e),i){var r=i[0];n=r&&Array.isArray(r[0])}else t&&(n=(t.match(/m/gi)||[]).length>1||/z\s*\S+/i.test(t));return new(n?F:j)(e)}},_asPathItem:function(){return this},isClockwise:function(){return this.getArea()>=0},setClockwise:function(e){this.isClockwise()!=(e=!!e)&&this.reverse()},setPathData:function(e){var t,i,n,r=e&&e.match(/[mlhvcsqtaz][^mlhvcsqtaz]*/gi),s=!1,o=new y,a=new y;function c(e,i){var n=+t[e];return s&&(n+=o[i]),n}function l(e){return new y(c(e,"x"),c(e+1,"y"))}this.clear();for(var h=0,u=r&&r.length;h<u;h++){var d=r[h],p=d[0],g=p.toLowerCase(),f=(t=d.match(/[+-]?(?:\d*\.\d+|\d+\.?)(?:[eE][+-]?\d+)?/g))&&t.length;switch(s=p===g,"z"!==i||/[mz]/.test(g)||this.moveTo(o),g){case"m":case"l":for(var m="m"===g,v=0;v<f;v+=2)this[m?"moveTo":"lineTo"](o=l(v)),m&&(a=o,m=!1);n=o;break;case"h":case"v":var _="h"===g?"x":"y";for(o=o.clone(),v=0;v<f;v++)o[_]=c(v,_),this.lineTo(o);n=o;break;case"c":for(v=0;v<f;v+=6)this.cubicCurveTo(l(v),n=l(v+2),o=l(v+4));break;case"s":for(v=0;v<f;v+=4)this.cubicCurveTo(/[cs]/.test(i)?o.multiply(2).subtract(n):o,n=l(v),o=l(v+2)),i=g;break;case"q":for(v=0;v<f;v+=4)this.quadraticCurveTo(n=l(v),o=l(v+2));break;case"t":for(v=0;v<f;v+=2)this.quadraticCurveTo(n=/[qt]/.test(i)?o.multiply(2).subtract(n):o,o=l(v)),i=g;break;case"a":for(v=0;v<f;v+=7)this.arcTo(o=l(v+5),new S(+t[v],+t[v+1]),+t[v+2],+t[v+4],+t[v+3]);break;case"z":this.closePath(1e-12),o=a}i=g}},_canComposite:function(){return!(this.hasFill()&&this.hasStroke())},_contains:function(e){var t=e.isInside(this.getBounds({internal:!0,handle:!0}))?this._getWinding(e):{};return t.onPath||!!("evenodd"===this.getFillRule()?1&t.windingL||1&t.windingR:t.winding)},getIntersections:function(e,t,i,n){var r=this===e||!e,s=this._matrix._orNullIfIdentity(),o=r?s:(i||e._matrix)._orNullIfIdentity();return r||this.getBounds(s).intersects(e.getBounds(o),1e-12)?U.getIntersections(this.getCurves(),!r&&e.getCurves(),t,s,o,n):[]},getCrossings:function(e){return this.getIntersections(e,(function(e){return e.isCrossing()}))},getNearestLocation:function(){for(var e=y.read(arguments),t=this.getCurves(),i=1/0,n=null,r=0,s=t.length;r<s;r++){var o=t[r].getNearestLocation(e);o._distance<i&&(i=o._distance,n=o)}return n},getNearestPoint:function(){var e=this.getNearestLocation.apply(this,arguments);return e?e.getPoint():e},interpolate:function(e,t,i){var n=!this._children,r=n?"_segments":"_children",s=e[r],o=t[r],a=this[r];if(!s||!o||s.length!==o.length)throw new Error("Invalid operands in interpolate() call: "+e+", "+t);var c=a.length,l=o.length;if(c<l)for(var h=n?N:j,u=c;u<l;u++)this.add(new h);else c>l&&this[n?"removeSegments":"removeChildren"](l,c);for(u=0;u<l;u++)a[u].interpolate(s[u],o[u],i);n&&(this.setClosed(e._closed),this._changed(9))},compare:function(e){var t=!1;if(e){var i=this._children||[this],n=e._children?e._children.slice():[e],r=i.length,s=n.length,o=[],a=0;t=!0;for(var c=g.findItemBoundsCollisions(i,n,m.GEOMETRIC_EPSILON),l=r-1;l>=0&&t;l--){var h=i[l];t=!1;var u=c[l];if(u)for(var d=u.length-1;d>=0&&!t;d--)h.compare(n[u[d]])&&(o[u[d]]||(o[u[d]]=!0,a++),t=!0)}t=t&&a===s}return t}}),j=K.extend({_class:"Path",_serializeFields:{segments:[],closed:!1},initialize:function(e){this._closed=!1,this._segments=[],this._version=0;var t=arguments,i=Array.isArray(e)?"object"==typeof e[0]?e:t:!e||e.size!==a||e.x===a&&e.point===a?null:t;i&&i.length>0?this.setSegments(i):(this._curves=a,this._segmentSelection=0,i||"string"!=typeof e||(this.setPathData(e),e=null)),this._initialize(!i&&e)},_equals:function(e){return this._closed===e._closed&&h.equals(this._segments,e._segments)},copyContent:function(e){this.setSegments(e._segments),this._closed=e._closed},_changed:function e(t){if(e.base.call(this,t),8&t){if(this._length=this._area=a,32&t)this._version++;else if(this._curves)for(var i=0,n=this._curves.length;i<n;i++)this._curves[i]._changed()}else 64&t&&(this._bounds=a)},getStyle:function(){var e=this._parent;return(e instanceof F?e:this)._style},getSegments:function(){return this._segments},setSegments:function(e){var t=this.isFullySelected(),i=e&&e.length;if(this._segments.length=0,this._segmentSelection=0,this._curves=a,i){var n=e[i-1];"boolean"==typeof n&&(this.setClosed(n),i--),this._add(N.readList(e,0,{},i))}t&&this.setFullySelected(!0)},getFirstSegment:function(){return this._segments[0]},getLastSegment:function(){return this._segments[this._segments.length-1]},getCurves:function(){var e=this._curves,t=this._segments;if(!e){var i=this._countCurves();e=this._curves=new Array(i);for(var n=0;n<i;n++)e[n]=new U(this,t[n],t[n+1]||t[0])}return e},getFirstCurve:function(){return this.getCurves()[0]},getLastCurve:function(){var e=this.getCurves();return e[e.length-1]},isClosed:function(){return this._closed},setClosed:function(e){if(this._closed!=(e=!!e)){if(this._closed=e,this._curves){var t=this._curves.length=this._countCurves();e&&(this._curves[t-1]=new U(this,this._segments[t-1],this._segments[0]))}this._changed(41)}}},{beans:!0,getPathData:function(e,t){var i,n,r,s,o,a,c,l,h=this._segments,u=h.length,d=new f(t),p=new Array(6),g=!0,m=[];function v(t,h){if(t._transformCoordinates(e,p),i=p[0],n=p[1],g)m.push("M"+d.pair(i,n)),g=!1;else if(o=p[2],a=p[3],o===i&&a===n&&c===r&&l===s){if(!h){var u=i-r,f=n-s;m.push(0===u?"v"+d.number(f):0===f?"h"+d.number(u):"l"+d.pair(u,f))}}else m.push("c"+d.pair(c-r,l-s)+" "+d.pair(o-r,a-s)+" "+d.pair(i-r,n-s));r=i,s=n,c=p[4],l=p[5]}if(!u)return"";for(var y=0;y<u;y++)v(h[y]);return this._closed&&u>0&&(v(h[0],!0),m.push("z")),m.join("")},isEmpty:function(){return!this._segments.length},_transformContent:function(e){for(var t=this._segments,i=new Array(6),n=0,r=t.length;n<r;n++)t[n]._transformCoordinates(e,i,!0);return!0},_add:function(e,t){for(var i=this._segments,n=this._curves,r=e.length,s=null==t,o=(t=s?i.length:t,0);o<r;o++){var a=e[o];a._path&&(a=e[o]=a.clone()),a._path=this,a._index=t+o,a._selection&&this._updateSelection(a,0,a._selection)}if(s)h.push(i,e);else{i.splice.apply(i,[t,0].concat(e)),o=t+r;for(var c=i.length;o<c;o++)i[o]._index=o}if(n){var l=this._countCurves(),u=t>0&&t+r-1===l?t-1:t,d=u,p=Math.min(u+r,l);for(e._curves&&(n.splice.apply(n,[u,0].concat(e._curves)),d+=e._curves.length),o=d;o<p;o++)n.splice(o,0,new U(this,null,null));this._adjustCurves(u,p)}return this._changed(41),e},_adjustCurves:function(e,t){for(var i,n=this._segments,r=this._curves,s=e;s<t;s++)(i=r[s])._path=this,i._segment1=n[s],i._segment2=n[s+1]||n[0],i._changed();(i=r[this._closed&&!e?n.length-1:e-1])&&(i._segment2=n[e]||n[0],i._changed()),(i=r[t])&&(i._segment1=n[t],i._changed())},_countCurves:function(){var e=this._segments.length;return!this._closed&&e>0?e-1:e},add:function(e){var t=arguments;return t.length>1&&"number"!=typeof e?this._add(N.readList(t)):this._add([N.read(t)])[0]},insert:function(e,t){var i=arguments;return i.length>2&&"number"!=typeof t?this._add(N.readList(i,1),e):this._add([N.read(i,1)],e)[0]},addSegment:function(){return this._add([N.read(arguments)])[0]},insertSegment:function(e){return this._add([N.read(arguments,1)],e)[0]},addSegments:function(e){return this._add(N.readList(e))},insertSegments:function(e,t){return this._add(N.readList(t),e)},removeSegment:function(e){return this.removeSegments(e,e+1)[0]||null},removeSegments:function(e,t,i){e=e||0,t=h.pick(t,this._segments.length);var n=this._segments,r=this._curves,s=n.length,o=n.splice(e,t-e),a=o.length;if(!a)return o;for(var c=0;c<a;c++){var l=o[c];l._selection&&this._updateSelection(l,l._selection,0),l._index=l._path=null}c=e;for(var u=n.length;c<u;c++)n[c]._index=c;if(r){var d=e>0&&t===s+(this._closed?1:0)?e-1:e;for(c=(r=r.splice(d,a)).length-1;c>=0;c--)r[c]._path=null;i&&(o._curves=r.slice(1)),this._adjustCurves(d,d)}return this._changed(41),o},clear:"#removeSegments",hasHandles:function(){for(var e=this._segments,t=0,i=e.length;t<i;t++)if(e[t].hasHandles())return!0;return!1},clearHandles:function(){for(var e=this._segments,t=0,i=e.length;t<i;t++)e[t].clearHandles()},getLength:function(){if(null==this._length){for(var e=this.getCurves(),t=0,i=0,n=e.length;i<n;i++)t+=e[i].getLength();this._length=t}return this._length},getArea:function(){var e=this._area;if(null==e){var t=this._segments,i=this._closed;e=0;for(var n=0,r=t.length;n<r;n++){var s=n+1===r;e+=U.getArea(U.getValues(t[n],t[s?0:n+1],null,s&&!i))}this._area=e}return e},isFullySelected:function(){var e=this._segments.length;return this.isSelected()&&e>0&&this._segmentSelection===7*e},setFullySelected:function(e){e&&this._selectSegments(!0),this.setSelected(e)},setSelection:function e(t){1&t||this._selectSegments(!1),e.base.call(this,t)},_selectSegments:function(e){var t=this._segments,i=t.length,n=e?7:0;this._segmentSelection=n*i;for(var r=0;r<i;r++)t[r]._selection=n},_updateSelection:function(e,t,i){e._selection=i,(this._segmentSelection+=i-t)>0&&this.setSelected(!0)},divideAt:function(e){var t,i=this.getLocationAt(e);return i&&(t=i.getCurve().divideAt(i.getCurveOffset()))?t._segment1:null},splitAt:function(e){var t=this.getLocationAt(e),i=t&&t.index,n=t&&t.time;n>.99999999&&(i++,n=0);var r=this.getCurves();if(i>=0&&i<r.length){n>=1e-8&&r[i++].divideAtTime(n);var s,o=this.removeSegments(i,this._segments.length,!0);return this._closed?(this.setClosed(!1),s=this):((s=new j(C.NO_INSERT)).insertAbove(this),s.copyAttributes(this)),s._add(o,0),this.addSegment(o[0]),s}return null},split:function(e,t){var i,n=t===a?e:(i=this.getCurves()[e])&&i.getLocationAtTime(t);return null!=n?this.splitAt(n):null},join:function(e,t){var i=t||0;if(e&&e!==this){var n=e._segments,r=this.getLastSegment(),s=e.getLastSegment();if(!s)return this;r&&r._point.isClose(s._point,i)&&e.reverse();var o=e.getFirstSegment();if(r&&r._point.isClose(o._point,i))r.setHandleOut(o._handleOut),this._add(n.slice(1));else{var a=this.getFirstSegment();a&&a._point.isClose(o._point,i)&&e.reverse(),s=e.getLastSegment(),a&&a._point.isClose(s._point,i)?(a.setHandleIn(s._handleIn),this._add(n.slice(0,n.length-1),0)):this._add(n.slice())}e._closed&&this._add([n[0]]),e.remove()}var c=this.getFirstSegment(),l=this.getLastSegment();return c!==l&&c._point.isClose(l._point,i)&&(c.setHandleIn(l._handleIn),l.remove(),this.setClosed(!0)),this},reduce:function(e){for(var t=this.getCurves(),i=e&&e.simplify,n=i?1e-7:0,r=t.length-1;r>=0;r--){var s=t[r];!s.hasHandles()&&(!s.hasLength(n)||i&&s.isCollinear(s.getNext()))&&s.remove()}return this},reverse:function(){this._segments.reverse();for(var e=0,t=this._segments.length;e<t;e++){var i=this._segments[e],n=i._handleIn;i._handleIn=i._handleOut,i._handleOut=n,i._index=e}this._curves=null,this._changed(9)},flatten:function(e){for(var t=new q(this,e||.25,256,!0).parts,i=t.length,n=[],r=0;r<i;r++)n.push(new N(t[r].curve.slice(0,2)));!this._closed&&i>0&&n.push(new N(t[i-1].curve.slice(6))),this.setSegments(n)},simplify:function(e){var t=new V(this).fit(e||2.5);return t&&this.setSegments(t),!!t},smooth:function(e){var t=this,i=e||{},n=i.type||"asymmetric",r=this._segments,s=r.length,o=this._closed;function c(e,i){var n=e&&e.index;if(null!=n){var r=e.path;if(r&&r!==t)throw new Error(e._class+" "+n+" of "+r+" is not part of "+t);i&&e instanceof U&&n++}else n="number"==typeof e?e:i;return Math.min(n<0&&o?n%s:n<0?n+s:n,s-1)}var l=o&&i.from===a&&i.to===a,h=c(i.from,0),u=c(i.to,s-1);if(h>u)if(o)h-=s;else{var d=h;h=u,u=d}if(/^(?:asymmetric|continuous)$/.test(n)){var p="asymmetric"===n,g=Math.min,f=u-h+1,m=f-1,v=l?g(f,4):1,y=v,_=v,S=[];if(o||(y=g(1,h),_=g(1,s-u-1)),(m+=y+_)<=1)return;for(var b=0,w=h-y;b<=m;b++,w++)S[b]=r[(w<0?w+s:w)%s]._point;var E=S[0]._x+2*S[1]._x,I=S[0]._y+2*S[1]._y,k=2,T=m-1,C=[E],x=[I],R=[k],O=[],A=[];for(b=1;b<m;b++){var P=b<T,D=P?4:p?2:7,M=P?4:p?3:8,N=P?2:p?0:1,B=(P||p?1:2)/k;k=R[b]=D-B,E=C[b]=M*S[b]._x+N*S[b+1]._x-B*E,I=x[b]=M*S[b]._y+N*S[b+1]._y-B*I}for(O[T]=C[T]/R[T],A[T]=x[T]/R[T],b=m-2;b>=0;b--)O[b]=(C[b]-O[b+1])/R[b],A[b]=(x[b]-A[b+1])/R[b];O[m]=(3*S[m]._x-O[T])/2,A[m]=(3*S[m]._y-A[T])/2,b=y;var L=m-_;for(w=h;b<=L;b++,w++){var K=r[w<0?w+s:w],j=K._point,F=O[b]-j._x,q=A[b]-j._y;(l||b<L)&&K.setHandleOut(F,q),(l||b>y)&&K.setHandleIn(-F,-q)}}else for(b=h;b<=u;b++)r[b<0?b+s:b].smooth(i,!l&&b===h,!l&&b===u)},toShape:function(e){if(!this._closed)return null;var t,i,n,r,s,o,c,l=this._segments;function h(e,t){var i=l[e],n=i.getNext(),r=l[t],s=r.getNext();return i._handleOut.isZero()&&n._handleIn.isZero()&&r._handleOut.isZero()&&s._handleIn.isZero()&&n._point.subtract(i._point).isCollinear(s._point.subtract(r._point))}function u(e){var t=l[e],i=t.getNext(),n=t._handleOut,r=i._handleIn,s=.5522847498307936;if(n.isOrthogonal(r)){var o=t._point,a=i._point,c=new k(o,n,!0).intersect(new k(a,r,!0),!0);return c&&m.isZero(n.getLength()/c.subtract(o).getLength()-s)&&m.isZero(r.getLength()/c.subtract(a).getLength()-s)}return!1}function d(e,t){return l[e]._point.getDistance(l[t]._point)}if(!this.hasHandles()&&4===l.length&&h(0,2)&&h(1,3)&&(o=(s=l[1]).getPrevious(),c=s.getNext(),o._handleOut.isZero()&&s._handleIn.isZero()&&s._handleOut.isZero()&&c._handleIn.isZero()&&s._point.subtract(o._point).isOrthogonal(c._point.subtract(s._point)))?(t=O.Rectangle,i=new S(d(0,3),d(0,1)),r=l[1]._point.add(l[2]._point).divide(2)):8===l.length&&u(0)&&u(2)&&u(4)&&u(6)&&h(1,5)&&h(3,7)?(t=O.Rectangle,n=(i=new S(d(1,6),d(0,3))).subtract(new S(d(0,7),d(1,2))).divide(2),r=l[3]._point.add(l[4]._point).divide(2)):4===l.length&&u(0)&&u(1)&&u(2)&&u(3)&&(m.isZero(d(0,2)-d(1,3))?(t=O.Circle,n=d(0,2)/2):(t=O.Ellipse,n=new S(d(2,0)/2,d(3,1)/2)),r=l[1]._point),t){var p=this.getPosition(!0),g=new t({center:p,size:i,radius:n,insert:!1});return g.copyAttributes(this,!0),g._matrix.prepend(this._matrix),g.rotate(r.subtract(p).getAngle()+90),(e===a||e)&&g.insertAbove(this),g}return null},toPath:"#clone",compare:function e(t){if(!t||t instanceof F)return e.base.call(this,t);var i=this.getCurves(),n=t.getCurves(),r=i.length,s=n.length;if(!r||!s)return r==s;for(var o,a,c=i[0].getValues(),l=[],h=0,u=0,d=0;d<s;d++){var p=n[d].getValues();if(l.push(p),m=U.getOverlaps(c,p)){o=!d&&m[0][0]>0?s-1:d,a=m[0][1];break}}var g,f=Math.abs;for(p=l[o];c&&p;){var m;if((m=U.getOverlaps(c,p))&&f(m[0][0]-u)<1e-8){1===(u=m[1][0])&&(c=++h<r?i[h].getValues():null,u=0);var v=m[0][1];if(f(v-a)<1e-8){if(g||(g=[o,v]),1===(a=m[1][1])&&(++o>=s&&(o=0),p=l[o]||n[o].getValues(),a=0),!c)return g[0]===o&&g[1]===a;continue}}break}return!1},_hitTestSelf:function(e,t,i,n){var r,s,o,a,c,l,h=this,u=this.getStyle(),d=this._segments,p=d.length,g=this._closed,f=t._tolerancePadding,m=f,v=t.stroke&&u.hasStroke(),y=t.fill&&u.hasFill(),_=t.curves,S=v?u.getStrokeWidth()/2:y&&t.tolerance>0||_?0:null;function b(t,i){return e.subtract(t).divide(i).length<=1}function w(e,i,n){if(!t.selected||i.isSelected()){var r=e._point;if(i!==r&&(i=i.add(r)),b(i,m))return new M(n,h,{segment:e,point:i})}}function E(e,i){return(i||t.segments)&&w(e,e._point,"segment")||!i&&t.handles&&(w(e,e._handleIn,"handle-in")||w(e,e._handleOut,"handle-out"))}function I(e){a.add(e)}function k(t){var i,c=g||t._index>0&&t._index<p-1;return"round"===(c?r:s)?b(t._point,m):(a=new j({internal:!0,closed:!0}),c?t.isSmooth()||j._addBevelJoin(t,r,S,o,null,n,I,!0):"square"===s&&j._addSquareCap(t,s,S,null,n,I,!0),a.isEmpty()?void 0:a.contains(e)||(i=a.getNearestLocation(e))&&b(i.getPoint(),f))}if(null!==S&&(S>0?(r=u.getStrokeJoin(),s=u.getStrokeCap(),o=u.getMiterLimit(),m=m.add(j._getStrokePadding(S,n))):r=s="round"),!t.ends||t.segments||g){if(t.segments||t.handles)for(var T=0;T<p;T++)if(l=E(d[T]))return l}else if(l=E(d[0],!0)||E(d[p-1],!0))return l;if(null!==S){if(c=this.getNearestLocation(e)){var C=c.getTime();0===C||1===C&&p>1?k(c.getSegment())||(c=null):b(c.getPoint(),m)||(c=null)}if(!c&&"miter"===r&&p>1)for(T=0;T<p;T++){var x=d[T];if(e.getDistance(x._point)<=o*S&&k(x)){c=x.getLocation();break}}}return!c&&y&&this._contains(e)||c&&!v&&!_?new M("fill",this):c?new M(v?"stroke":"curve",this,{location:c,point:c.getPoint()}):null}},h.each(U._evaluateMethods,(function(e){this[e+"At"]=function(t){var i=this.getLocationAt(t);return i&&i[e]()}}),{beans:!1,getLocationOf:function(){for(var e=y.read(arguments),t=this.getCurves(),i=0,n=t.length;i<n;i++){var r=t[i].getLocationOf(e);if(r)return r}return null},getOffsetOf:function(){var e=this.getLocationOf.apply(this,arguments);return e?e.getOffset():null},getLocationAt:function(e){if("number"==typeof e){for(var t=this.getCurves(),i=0,n=0,r=t.length;n<r;n++){var s=i,o=t[n];if((i+=o.getLength())>e)return o.getLocationAt(e-s)}if(t.length>0&&e<=this.getLength())return new L(t[t.length-1],1)}else if(e&&e.getPath&&e.getPath()===this)return e;return null},getOffsetsWithTangent:function(){var e=y.read(arguments);if(e.isZero())return[];for(var t=[],i=0,n=this.getCurves(),r=0,s=n.length;r<s;r++){for(var o=n[r],a=o.getTimesWithTangent(e),c=0,l=a.length;c<l;c++){var h=i+o.getOffsetAtTime(a[c]);t.indexOf(h)<0&&t.push(h)}i+=o.length}return t}}),new function(){function e(e,t,i){var n,r,s,o,a,c,l,h,u=t._segments,d=u.length,p=new Array(6),g=!0;function f(t){if(i)t._transformCoordinates(i,p),n=p[0],r=p[1];else{var u=t._point;n=u._x,r=u._y}if(g)e.moveTo(n,r),g=!1;else{if(i)a=p[2],c=p[3];else{var d=t._handleIn;a=n+d._x,c=r+d._y}a===n&&c===r&&l===s&&h===o?e.lineTo(n,r):e.bezierCurveTo(l,h,a,c,n,r)}s=n,o=r,i?(l=p[4],h=p[5]):(d=t._handleOut,l=s+d._x,h=o+d._y)}for(var m=0;m<d;m++)f(u[m]);t._closed&&d>0&&f(u[0])}return{_draw:function(t,i,n,r){var s=i.dontStart,o=i.dontFinish||i.clip,a=this.getStyle(),c=a.hasFill(),l=a.hasStroke(),h=a.getDashArray(),u=!de.support.nativeDash&&l&&h&&h.length;function d(e){return h[(e%u+u)%u]}if(s||t.beginPath(),(c||l&&!u||o)&&(e(t,this,r),this._closed&&t.closePath()),!o&&(c||l)&&(this._setStyles(t,i,n),c&&(t.fill(a.getFillRule()),t.shadowColor="rgba(0,0,0,0)"),l)){if(u){s||t.beginPath();for(var p,g=new q(this,.25,32,!1,r),f=g.length,m=-a.getDashOffset(),v=0;m>0;)m-=d(v--)+d(v--);for(;m<f;)p=m+d(v++),(m>0||p>0)&&g.drawPart(t,Math.max(m,0),Math.max(p,0)),m=p+d(v++)}t.stroke()}},_drawSelected:function(t,i){t.beginPath(),e(t,this,i),t.stroke(),function(e,t,i,n){if(!(n<=0))for(var r,s,o=n/2,a=n-2,c=o-1,l=new Array(6),h=0,u=t.length;h<u;h++){var d=t[h],p=d._selection;if(d._transformCoordinates(i,l),r=l[0],s=l[1],2&p&&f(2),4&p&&f(4),e.fillRect(r-o,s-o,n,n),a>0&&!(1&p)){var g=e.fillStyle;e.fillStyle="#ffffff",e.fillRect(r-c,s-c,a,a),e.fillStyle=g}}function f(t){var i=l[t],n=l[t+1];r==i&&s==n||(e.beginPath(),e.moveTo(r,s),e.lineTo(i,n),e.stroke(),e.beginPath(),e.arc(i,n,o,0,2*Math.PI,!0),e.fill())}}(t,this._segments,i,de.settings.handleSize)}}},new function(){function e(e){var t=e._segments;if(!t.length)throw new Error("Use a moveTo() command first");return t[t.length-1]}return{moveTo:function(){var e=this._segments;1===e.length&&this.removeSegment(0),e.length||this._add([new N(y.read(arguments))])},moveBy:function(){throw new Error("moveBy() is unsupported on Path items.")},lineTo:function(){this._add([new N(y.read(arguments))])},cubicCurveTo:function(){var t=arguments,i=y.read(t),n=y.read(t),r=y.read(t),s=e(this);s.setHandleOut(i.subtract(s._point)),this._add([new N(r,n.subtract(r))])},quadraticCurveTo:function(){var t=arguments,i=y.read(t),n=y.read(t),r=e(this)._point;this.cubicCurveTo(i.add(r.subtract(i).multiply(1/3)),i.add(n.subtract(i).multiply(1/3)),n)},curveTo:function(){var t=arguments,i=y.read(t),n=y.read(t),r=h.pick(h.read(t),.5),s=1-r,o=e(this)._point,a=i.subtract(o.multiply(s*s)).subtract(n.multiply(r*r)).divide(2*r*s);if(a.isNaN())throw new Error("Cannot put a curve through points with parameter = "+r);this.quadraticCurveTo(a,n)},arcTo:function(){var t,i,n,r,s=arguments,o=Math.abs,a=Math.sqrt,c=e(this),l=c._point,u=y.read(s),d=h.peek(s);if("boolean"==typeof(_=h.pick(d,!0)))var p=(w=l.add(u).divide(2)).add(w.subtract(l).rotate(_?-90:90));else if(h.remain(s)<=2)p=u,u=y.read(s);else if(!l.equals(u)){var g=S.read(s),f=m.isZero;if(f(g.width)||f(g.height))return this.lineTo(u);var v=h.read(s),_=!!h.read(s),b=!!h.read(s),w=l.add(u).divide(2),E=(W=l.subtract(w).rotate(-v)).x,T=W.y,C=o(g.width),x=o(g.height),R=C*C,O=x*x,A=E*E,P=T*T,D=a(A/R+P/O);if(D>1&&(R=(C*=D)*C,O=(x*=D)*x),o(D=(R*O-R*P-O*A)/(R*P+O*A))<1e-12&&(D=0),D<0)throw new Error("Cannot create an arc with the given arguments");t=new y(C*T/x,-x*E/C).multiply((b===_?-1:1)*a(D)).rotate(v).add(w),i=(n=(r=(new I).translate(t).rotate(v).scale(C,x))._inverseTransform(l)).getDirectedAngle(r._inverseTransform(u)),!_&&i>0?i-=360:_&&i<0&&(i+=360)}if(p){var M=new k(l.add(p).divide(2),p.subtract(l).rotate(90),!0),B=new k(p.add(u).divide(2),u.subtract(p).rotate(90),!0),U=new k(l,u),L=U.getSide(p);if(!(t=M.intersect(B,!0))){if(!L)return this.lineTo(u);throw new Error("Cannot create an arc with the given arguments")}i=(n=l.subtract(t)).getDirectedAngle(u.subtract(t));var K=U.getSide(t,!0);0===K?i=L*o(i):L===K&&(i+=i<0?360:-360)}if(i){for(var j=1e-7,F=o(i),q=F>=360?4:Math.ceil((F-j)/90),V=i/q,$=V*Math.PI/360,G=4/3*Math.sin($)/(1+Math.cos($)),H=[],z=0;z<=q;z++){var W=u,Y=null;if(z<q&&(Y=n.rotate(90).multiply(G),r?(W=r._transformPoint(n),Y=r._transformPoint(n.add(Y)).subtract(W)):W=t.add(n)),z){var J=n.rotate(-90).multiply(G);r&&(J=r._transformPoint(n.add(J)).subtract(W)),H.push(new N(W,J,Y))}else c.setHandleOut(Y);n=n.rotate(V)}this._add(H)}},lineBy:function(){var t=y.read(arguments),i=e(this)._point;this.lineTo(i.add(t))},curveBy:function(){var t=arguments,i=y.read(t),n=y.read(t),r=h.read(t),s=e(this)._point;this.curveTo(s.add(i),s.add(n),r)},cubicCurveBy:function(){var t=arguments,i=y.read(t),n=y.read(t),r=y.read(t),s=e(this)._point;this.cubicCurveTo(s.add(i),s.add(n),s.add(r))},quadraticCurveBy:function(){var t=arguments,i=y.read(t),n=y.read(t),r=e(this)._point;this.quadraticCurveTo(r.add(i),r.add(n))},arcBy:function(){var t=arguments,i=e(this)._point,n=i.add(y.read(t)),r=h.pick(h.peek(t),!0);"boolean"==typeof r?this.arcTo(n,r):this.arcTo(n,i.add(y.read(t)))},closePath:function(e){this.setClosed(!0),this.join(this,e)}}},{_getBounds:function(e,t){var i=t.handle?"getHandleBounds":t.stroke?"getStrokeBounds":"getBounds";return j[i](this._segments,this._closed,this,e,t)},statics:{getBounds:function(e,t,i,n,r,s){var o=e[0];if(!o)return new w;var a=new Array(6),c=o._transformCoordinates(n,new Array(6)),l=c.slice(0,2),h=l.slice(),u=new Array(2);function d(e){e._transformCoordinates(n,a);for(var t=0;t<2;t++)U._addBounds(c[t],c[t+4],a[t+2],a[t],t,s?s[t]:0,l,h,u);var i=c;c=a,a=i}for(var p=1,g=e.length;p<g;p++)d(e[p]);return t&&d(o),new w(l[0],l[1],h[0]-l[0],h[1]-l[1])},getStrokeBounds:function(e,t,i,n,r){var s=i.getStyle(),o=s.hasStroke(),a=s.getStrokeWidth(),c=o&&i._getStrokeMatrix(n,r),l=o&&j._getStrokePadding(a,c),h=j.getBounds(e,t,i,n,r,l);if(!o)return h;var u=a/2,d=s.getStrokeJoin(),p=s.getStrokeCap(),g=s.getMiterLimit(),f=new w(new S(l));function m(e){h=h.include(e)}function v(e){h=h.unite(f.setCenter(e._point.transform(n)))}function y(e,t){"round"===t||e.isSmooth()?v(e):j._addBevelJoin(e,t,u,g,n,c,m)}function _(e,t){"round"===t?v(e):j._addSquareCap(e,t,u,n,c,m)}var b=e.length-(t?0:1);if(b>0){for(var E=1;E<b;E++)y(e[E],d);t?y(e[0],d):(_(e[0],p),_(e[e.length-1],p))}return h},_getStrokePadding:function(e,t){if(!t)return[e,e];var i=new y(e,0).transform(t),n=new y(0,e).transform(t),r=i.getAngleInRadians(),s=i.getLength(),o=n.getLength(),a=Math.sin(r),c=Math.cos(r),l=Math.tan(r),h=Math.atan2(o*l,s),u=Math.atan2(o,l*s);return[Math.abs(s*Math.cos(h)*c+o*Math.sin(h)*a),Math.abs(o*Math.sin(u)*c+s*Math.cos(u)*a)]},_addBevelJoin:function(e,t,i,n,r,s,o,a){var c=e.getCurve(),l=c.getPrevious(),h=c.getPoint1().transform(r),u=l.getNormalAtTime(1).multiply(i).transform(s),d=c.getNormalAtTime(0).multiply(i).transform(s),p=u.getDirectedAngle(d);if((p<0||p>=180)&&(u=u.negate(),d=d.negate()),a&&o(h),o(h.add(u)),"miter"===t){var g=new k(h.add(u),new y(-u.y,u.x),!0).intersect(new k(h.add(d),new y(-d.y,d.x),!0),!0);g&&h.getDistance(g)<=n*i&&o(g)}o(h.add(d))},_addSquareCap:function(e,t,i,n,r,s,o){var a=e._point.transform(n),c=e.getLocation(),l=c.getNormal().multiply(0===c.getTime()?i:-i).transform(r);"square"===t&&(o&&(s(a.subtract(l)),s(a.add(l))),a=a.add(l.rotate(-90))),s(a.add(l)),s(a.subtract(l))},getHandleBounds:function(e,t,i,n,r){var s,o,a=i.getStyle();if(r.stroke&&a.hasStroke()){var c=i._getStrokeMatrix(n,r),l=a.getStrokeWidth()/2,h=l;"miter"===a.getStrokeJoin()&&(h=l*a.getMiterLimit()),"square"===a.getStrokeCap()&&(h=Math.max(h,l*Math.SQRT2)),s=j._getStrokePadding(l,c),o=j._getStrokePadding(h,c)}for(var u=new Array(6),d=1/0,p=-d,g=d,f=p,m=0,v=e.length;m<v;m++){e[m]._transformCoordinates(n,u);for(var y=0;y<6;y+=2){var _=y?s:o,S=_?_[0]:0,b=_?_[1]:0,E=u[y],I=u[y+1],k=E-S,T=E+S,C=I-b,x=I+b;k<d&&(d=k),T>p&&(p=T),C<g&&(g=C),x>f&&(f=x)}}return new w(d,g,p-d,f-g)}}});j.inject({statics:new function(){var e=.5522847498307936,t=[new N([-1,0],[0,e],[0,-e]),new N([0,-1],[-e,0],[e,0]),new N([1,0],[0,-e],[0,e]),new N([0,1],[e,0],[-e,0])];function i(e,t,i){var n=h.getNamed(i),r=new j(n&&0==n.insert&&C.NO_INSERT);return r._add(e),r._closed=t,r.set(n,{insert:!0})}function n(e,n,r){for(var s=new Array(4),o=0;o<4;o++){var a=t[o];s[o]=new N(a._point.multiply(n).add(e),a._handleIn.multiply(n),a._handleOut.multiply(n))}return i(s,!0,r)}return{Line:function(){var e=arguments;return i([new N(y.readNamed(e,"from")),new N(y.readNamed(e,"to"))],!1,e)},Circle:function(){var e=arguments,t=y.readNamed(e,"center"),i=h.readNamed(e,"radius");return n(t,new S(i),e)},Rectangle:function(){var t,n=arguments,r=w.readNamed(n,"rectangle"),s=S.readNamed(n,"radius",0,{readNull:!0}),o=r.getBottomLeft(!0),a=r.getTopLeft(!0),c=r.getTopRight(!0),l=r.getBottomRight(!0);if(!s||s.isZero())t=[new N(o),new N(a),new N(c),new N(l)];else{var h=(s=S.min(s,r.getSize(!0).divide(2))).width,u=s.height,d=h*e,p=u*e;t=[new N(o.add(h,0),null,[-d,0]),new N(o.subtract(0,u),[0,p]),new N(a.add(0,u),null,[0,-p]),new N(a.add(h,0),[-d,0],null),new N(c.subtract(h,0),null,[d,0]),new N(c.add(0,u),[0,-p],null),new N(l.subtract(0,u),null,[0,p]),new N(l.subtract(h,0),[d,0])]}return i(t,!0,n)},RoundRectangle:"#Rectangle",Ellipse:function(){var e=arguments,t=O._readEllipse(e);return n(t.center,t.radius,e)},Oval:"#Ellipse",Arc:function(){var e=arguments,t=y.readNamed(e,"from"),i=y.readNamed(e,"through"),n=y.readNamed(e,"to"),r=h.getNamed(e),s=new j(r&&0==r.insert&&C.NO_INSERT);return s.moveTo(t),s.arcTo(i,n),s.set(r)},RegularPolygon:function(){for(var e=arguments,t=y.readNamed(e,"center"),n=h.readNamed(e,"sides"),r=h.readNamed(e,"radius"),s=360/n,o=n%3==0,a=new y(0,o?-r:r),c=o?-1:.5,l=new Array(n),u=0;u<n;u++)l[u]=new N(t.add(a.rotate((u+c)*s)));return i(l,!0,e)},Star:function(){for(var e=arguments,t=y.readNamed(e,"center"),n=2*h.readNamed(e,"points"),r=h.readNamed(e,"radius1"),s=h.readNamed(e,"radius2"),o=360/n,a=new y(0,-1),c=new Array(n),l=0;l<n;l++)c[l]=new N(t.add(a.rotate(o*l).multiply(l%2?s:r)));return i(c,!0,e)}}}});var F=K.extend({_class:"CompoundPath",_serializeFields:{children:[]},beans:!0,initialize:function(e){this._children=[],this._namedChildren={},this._initialize(e)||("string"==typeof e?this.setPathData(e):this.addChildren(Array.isArray(e)?e:arguments))},insertChildren:function e(t,i){var n=i,r=n[0];r&&"number"==typeof r[0]&&(n=[n]);for(var s=i.length-1;s>=0;s--){var o=n[s];n!==i||o instanceof j||(n=h.slice(n)),Array.isArray(o)?n[s]=new j({segments:o,insert:!1}):o instanceof F&&(n.splice.apply(n,[s,1].concat(o.removeChildren())),o.remove())}return e.base.call(this,t,n)},reduce:function e(t){for(var i=this._children,n=i.length-1;n>=0;n--){var r;(r=i[n].reduce(t)).isEmpty()&&r.remove()}return i.length?e.base.call(this):((r=new j(C.NO_INSERT)).copyAttributes(this),r.insertAbove(this),this.remove(),r)},isClosed:function(){for(var e=this._children,t=0,i=e.length;t<i;t++)if(!e[t]._closed)return!1;return!0},setClosed:function(e){for(var t=this._children,i=0,n=t.length;i<n;i++)t[i].setClosed(e)},getFirstSegment:function(){var e=this.getFirstChild();return e&&e.getFirstSegment()},getLastSegment:function(){var e=this.getLastChild();return e&&e.getLastSegment()},getCurves:function(){for(var e=this._children,t=[],i=0,n=e.length;i<n;i++)h.push(t,e[i].getCurves());return t},getFirstCurve:function(){var e=this.getFirstChild();return e&&e.getFirstCurve()},getLastCurve:function(){var e=this.getLastChild();return e&&e.getLastCurve()},getArea:function(){for(var e=this._children,t=0,i=0,n=e.length;i<n;i++)t+=e[i].getArea();return t},getLength:function(){for(var e=this._children,t=0,i=0,n=e.length;i<n;i++)t+=e[i].getLength();return t},getPathData:function(e,t){for(var i=this._children,n=[],r=0,s=i.length;r<s;r++){var o=i[r],a=o._matrix;n.push(o.getPathData(e&&!a.isIdentity()?e.appended(a):e,t))}return n.join("")},_hitTestChildren:function e(t,i,n){return e.base.call(this,t,i.class===j||"path"===i.type?i:h.set({},i,{fill:!1}),n)},_draw:function(e,t,i,n){var r=this._children;if(r.length){t=t.extend({dontStart:!0,dontFinish:!0}),e.beginPath();for(var s=0,o=r.length;s<o;s++)r[s].draw(e,t,n);if(!t.clip){this._setStyles(e,t,i);var a=this._style;a.hasFill()&&(e.fill(a.getFillRule()),e.shadowColor="rgba(0,0,0,0)"),a.hasStroke()&&e.stroke()}}},_drawSelected:function(e,t,i){for(var n=this._children,r=0,s=n.length;r<s;r++){var o=n[r],a=o._matrix;i[o._id]||o._drawSelected(e,a.isIdentity()?t:t.appended(a))}}},new function(){function e(e,t){var i=e._children;if(t&&!i.length)throw new Error("Use a moveTo() command first");return i[i.length-1]}return h.each(["lineTo","cubicCurveTo","quadraticCurveTo","curveTo","arcTo","lineBy","cubicCurveBy","quadraticCurveBy","curveBy","arcBy"],(function(t){this[t]=function(){var i=e(this,!0);i[t].apply(i,arguments)}}),{moveTo:function(){var t=e(this),i=t&&t.isEmpty()?t:new j(C.NO_INSERT);i!==t&&this.addChild(i),i.moveTo.apply(i,arguments)},moveBy:function(){var t=e(this,!0),i=t&&t.getLastSegment(),n=y.read(arguments);this.moveTo(i?n.add(i._point):n)},closePath:function(t){e(this,!0).closePath(t)}})},h.each(["reverse","flatten","simplify","smooth"],(function(e){this[e]=function(t){for(var i,n=this._children,r=0,s=n.length;r<s;r++)i=n[r][e](t)||i;return i}}),{}));K.inject(new function(){var e=Math.min,t=Math.max,i=Math.abs,n={unite:{1:!0,2:!0},intersect:{2:!0},subtract:{1:!0},exclude:{1:!0,"-1":!0}};function r(e){return e._children||[e]}function s(e,t){var i=e.clone(!1).reduce({simplify:!0}).transform(null,!0,!0);if(t){for(var n=r(i),s=0,o=n.length;s<o;s++)(e=n[s])._closed||e.isEmpty()||(e.closePath(1e-12),e.getFirstSegment().setHandleIn(0,0),e.getLastSegment().setHandleOut(0,0));i=i.resolveCrossings().reorient("nonzero"===i.getFillRule(),!0)}return i}function o(e,t,i,n,r){var s=new F(C.NO_INSERT);return s.addChildren(e,!0),s=s.reduce({simplify:t}),r&&0==r.insert||s.insertAbove(n&&i.isSibling(n)&&i.getIndex()<n.getIndex()?n:i),s.copyAttributes(i,!0),s}function c(e){return e.hasOverlap()||e.isCrossing()}function l(e,t,i,a){if(a&&(0==a.trace||a.stroke)&&/^(subtract|intersect)$/.test(i))return u(e,t,i);var l=s(e,!0),d=t&&e!==t&&s(t,!0),p=n[i];p[i]=!0,d&&(p.subtract||p.exclude)^d.isClockwise()^l.isClockwise()&&d.reverse();var m,y=v(L.expand(l.getIntersections(d,c))),b=r(l),w=d&&r(d),E=[],I=[];function k(e){for(var t=0,i=e.length;t<i;t++){var n=e[t];h.push(E,n._segments),h.push(I,n.getCurves()),n._overlapsOnly=!0}}function T(e){for(var t=[],i=0,n=e&&e.length;i<n;i++)t.push(I[e[i]]);return t}if(y.length){k(b),w&&k(w);for(var C=new Array(I.length),x=0,R=I.length;x<R;x++)C[x]=I[x].getValues();var O=g.findCurveBoundsCollisions(C,C,0,!0),A={};for(x=0;x<I.length;x++){var P=I[x],D=P._path._id;(A[D]=A[D]||{})[P.getIndex()]={hor:T(O[x].hor),ver:T(O[x].ver)}}for(x=0,R=y.length;x<R;x++)_(y[x]._segment,l,d,A,p);for(x=0,R=E.length;x<R;x++){var M=E[x],N=M._intersection;M._winding||_(M,l,d,A,p),N&&N._overlap||(M._path._overlapsOnly=!1)}m=S(E,p)}else m=f(w?b.concat(w):b.slice(),(function(e){return!!p[e]}));return o(m,!0,e,t,a)}function u(e,t,i){var n=s(e),r=s(t),a=n.getIntersections(r,c),l="subtract"===i,h="divide"===i,u={},d=[];function p(e){if(!u[e._id]&&(h||r.contains(e.getPointAt(e.getLength()/2))^l))return d.unshift(e),u[e._id]=!0}for(var g=a.length-1;g>=0;g--){var f=a[g].split();f&&(p(f)&&f.getFirstSegment().setHandleIn(0,0),n.getLastSegment().setHandleOut(0,0))}return p(n),o(d,!1,e,t)}function d(e,t){for(var i=e;i;){if(i===t)return;i=i._previous}for(;e._next&&e._next!==t;)e=e._next;if(!e._next){for(;t._previous;)t=t._previous;e._next=t,t._previous=e}}function p(e){for(var t=e.length-1;t>=0;t--)e[t].clearHandles()}function f(e,t,n){var r=e&&e.length;if(r){var s=h.each(e,(function(e,t){this[e._id]={container:null,winding:e.isClockwise()?1:-1,index:t}}),{}),o=e.slice().sort((function(e,t){return i(t.getArea())-i(e.getArea())})),a=o[0],c=g.findItemBoundsCollisions(o,null,m.GEOMETRIC_EPSILON);null==n&&(n=a.isClockwise());for(var l=0;l<r;l++){var u=o[l],d=s[u._id],p=0,f=c[l];if(f)for(var v=null,y=f.length-1;y>=0;y--)if(f[y]<l){v=v||u.getInteriorPoint();var _=o[f[y]];if(_.contains(v)){var S=s[_._id];p=S.winding,d.winding+=p,d.container=S.exclude?S.container:_;break}}if(t(d.winding)===t(p))d.exclude=!0,e[d.index]=null;else{var b=d.container;u.setClockwise(b?!b.isClockwise():n)}}}return e}function v(e,t,i){var n,r,s,o=t&&[],a=!1,c=i||[],l=i&&{};function h(e){return e._path._id+"."+e._segment1._index}for(var u=(i&&i.length)-1;u>=0;u--)(g=i[u])._path&&(l[h(g)]=!0);for(u=e.length-1;u>=0;u--){var g,f,m=e[u],v=m._time,y=v,_=t&&!t(m);if((g=m._curve)&&(g!==r?(a=!g.hasHandles()||l&&l[h(g)],n=[],s=null,r=g):s>=1e-8&&(v/=s)),_)n&&n.push(m);else{if(t&&o.unshift(m),s=y,v<1e-8)f=g._segment1;else if(v>.99999999)f=g._segment2;else{var S=g.divideAtTime(v,!0);a&&c.push(g,S),f=S._segment1;for(var b=n.length-1;b>=0;b--){var w=n[b];w._time=(w._time-v)/(1-v)}}m._setSegment(f);var E=f._intersection,I=m._intersection;if(E){d(E,I);for(var k=E;k;)d(k._intersection,E),k=k._next}else f._intersection=I}}return i||p(c),o||e}function y(n,r,s,o,a){var c,l,h=Array.isArray(r)?r:r[s?"hor":"ver"],u=s?1:0,d=1^u,p=[n.x,n.y],g=p[u],f=p[d],m=1e-6,v=g-1e-9,_=g+1e-9,S=0,b=0,w=0,E=0,I=!1,k=!1,T=1,C=[];function x(i){var l=i[d+0],h=i[d+6];if(!(f<e(l,h)||f>t(l,h))){var p=i[u+0],S=i[u+2],b=i[u+4],k=i[u+6];if(l!==h){var x=f===l?0:f===h||v>t(p,S,b,k)||_<e(p,S,b,k)?1:U.solveCubic(i,d,f,C,0,1)>0?C[0]:1,R=0===x?p:1===x?k:U.getPoint(i,x)[s?"y":"x"],O=l>h?1:-1,A=c[d]>c[d+6]?1:-1,P=c[u+6];return f!==l?(R<v?w+=O:R>_?E+=O:I=!0,R>g-m&&R<g+m&&(T/=2)):(O!==A?p<v?w+=O:p>_&&(E+=O):p!=P&&(P<_&&R>_?(E+=O,I=!0):P>v&&R<v&&(w+=O,I=!0)),T/=4),c=i,!a&&R>v&&R<_&&0===U.getTangent(i,x)[s?"x":"y"]&&y(n,r,!s,o,!0)}(p<_&&k>v||k<_&&p>v)&&(I=!0)}}function R(i){var n=i[d+0],r=i[d+2],o=i[d+4],a=i[d+6];if(f<=t(n,r,o,a)&&f>=e(n,r,o,a))for(var c,l=i[u+0],h=i[u+2],p=i[u+4],g=i[u+6],m=v>t(l,h,p,g)||_<e(l,h,p,g)?[i]:U.getMonoCurves(i,s),y=0,S=m.length;y<S;y++)if(c=x(m[y]))return c}for(var O=0,A=h.length;O<A;O++){var P,D=h[O],M=D._path,N=D.getValues();if(!(O&&h[O-1]._path===M||(c=null,M._closed||(l=U.getValues(M.getLastCurve().getSegment2(),D.getSegment1(),null,!o))[d]!==l[d+6]&&(c=l),c))){c=N;for(var B=M.getLastCurve();B&&B!==D;){var L=B.getValues();if(L[d]!==L[d+6]){c=L;break}B=B.getPrevious()}}if(P=R(N))return P;if(O+1===A||h[O+1]._path!==M){if(l&&(P=R(l)))return P;!I||w||E||(w=E=M.isClockwise(o)^s?1:-1),S+=w,b+=E,w=E=0,I&&(k=!0,I=!1),l=null}}return S=i(S),b=i(b),{winding:t(S,b),windingL:S,windingR:b,quality:T,onPath:k}}function _(e,t,n,r,s){var o=[],a=e,c=0;do{if(_=e.getCurve()){var l=_.getLength();o.push({segment:e,curve:_,length:l}),c+=l}e=e.getNext()}while(e&&!e._intersection&&e!==a);for(var h=[.5,.25,.75],u={winding:0,quality:-1},d=0;d<h.length&&u.quality<.5;d++){l=c*h[d];for(var p=0,g=o.length;p<g;p++){var f=o[p],v=f.length;if(l<=v){var _,S=(_=f.curve)._path,b=S._parent,w=b instanceof F?b:S,E=m.clamp(_.getTimeAt(l),.001,.999),I=_.getPointAtTime(E),k=i(_.getTangentAtTime(E).y)<Math.SQRT1_2,T=null;if(s.subtract&&n){var C=(w===t?n:t)._getWinding(I,k,!0);if(w===t&&C.winding||w===n&&!C.winding){if(C.quality<1)continue;T={winding:0,quality:1}}}(T=T||y(I,r[S._id][_.getIndex()],k,!0)).quality>u.quality&&(u=T);break}l-=v}}for(p=o.length-1;p>=0;p--)o[p].segment._winding=u}function S(e,t){var i,n=[];function r(e){var i;return!(!e||e._visited||t&&(!t[(i=e._winding||{}).winding]||t.unite&&2===i.winding&&i.windingL&&i.windingR))}function s(e){if(e)for(var t=0,n=i.length;t<n;t++)if(e===i[t])return!0;return!1}function o(e){for(var t=e._segments,i=0,n=t.length;i<n;i++)t[i]._visited=!0}function a(e,t){var n=e._intersection,o=n,a=[];function c(n,o){for(;n&&n!==o;){var c=n._segment,l=c&&c._path;if(l){var h=c.getNext()||l.getFirstSegment(),u=h._intersection;c!==e&&(s(c)||s(h)||h&&r(c)&&(r(h)||u&&r(u._segment)))&&a.push(c),t&&i.push(c)}n=n._next}}if(t&&(i=[e]),n){for(c(n);n&&n._previous;)n=n._previous;c(n,o)}return a}e.sort((function(e,t){var i=e._intersection,n=t._intersection,r=!(!i||!i._overlap),s=!(!n||!n._overlap),o=e._path,a=t._path;return r^s?r?1:-1:!i^!n?i?1:-1:o!==a?o._id-a._id:e._index-t._index}));for(var c=0,l=e.length;c<l;c++){var h,u,d,p=e[c],g=r(p),f=null,m=!1,v=!0,y=[];if(g&&p._path._overlapsOnly){var _=p._path,S=p._intersection._segment._path;_.compare(S)&&(_.getArea()&&n.push(_.clone(!1)),o(_),o(S),g=!1)}for(;g;){var b=!f,w=a(p,b),E=w.shift(),I=!(m=!b&&(s(p)||s(E)))&&E;if(b&&(f=new j(C.NO_INSERT),h=null),m){(p.isFirst()||p.isLast())&&(v=p._path._closed),p._visited=!0;break}if(I&&h&&(y.push(h),h=null),h||(I&&w.push(p),h={start:f._segments.length,crossings:w,visited:u=[],handleIn:d}),I&&(p=E),!r(p)){f.removeSegments(h.start);for(var k=0,T=u.length;k<T;k++)u[k]._visited=!1;u.length=0;do{(p=h&&h.crossings.shift())&&p._path||(p=null,(h=y.pop())&&(u=h.visited,d=h.handleIn))}while(h&&!r(p));if(!p)break}var x=p.getNext();f.add(new N(p._point,d,x&&p._handleOut)),p._visited=!0,u.push(p),p=x||p._path.getFirstSegment(),d=x&&x._handleIn}m&&(v&&(f.getFirstSegment().setHandleIn(d),f.setClosed(v)),0!==f.getArea()&&n.push(f))}return n}return{_getWinding:function(e,t,i){return y(e,this.getCurves(),t,i)},unite:function(e,t){return l(this,e,"unite",t)},intersect:function(e,t){return l(this,e,"intersect",t)},subtract:function(e,t){return l(this,e,"subtract",t)},exclude:function(e,t){return l(this,e,"exclude",t)},divide:function(e,t){return t&&(0==t.trace||t.stroke)?u(this,e,"divide"):o([this.subtract(e,t),this.intersect(e,t)],!0,this,e,t)},resolveCrossings:function(){var e=this._children,t=e||[this];function i(e,t){var i=e&&e._intersection;return i&&i._overlap&&i._path===t}var n=!1,r=!1,s=this.getIntersections(null,(function(e){return e.hasOverlap()&&(n=!0)||e.isCrossing()&&(r=!0)})),o=n&&r&&[];if(s=L.expand(s),n)for(var a=v(s,(function(e){return e.hasOverlap()}),o),c=a.length-1;c>=0;c--){var l=a[c],u=l._path,d=l._segment,g=d.getPrevious(),f=d.getNext();i(g,u)&&i(f,u)&&(d.remove(),g._handleOut._set(0,0),f._handleIn._set(0,0),g===d||g.getCurve().hasLength()||(f._handleIn.set(g._handleIn),g.remove()))}r&&(v(s,n&&function(e){var t=e.getCurve(),i=e.getSegment(),n=e._intersection,r=n._curve,s=n._segment;if(t&&r&&t._path&&r._path)return!0;i&&(i._intersection=null),s&&(s._intersection=null)},o),o&&p(o),t=S(h.each(t,(function(e){h.push(this,e._segments)}),[])));var m,y=t.length;return y>1&&e?(t!==e&&this.setChildren(t),m=this):1!==y||e||(t[0]!==this&&this.setSegments(t[0].removeSegments()),m=this),m||((m=new F(C.NO_INSERT)).addChildren(t),(m=m.reduce()).copyAttributes(this),this.replaceWith(m)),m},reorient:function(e,t){var i=this._children;return i&&i.length?this.setChildren(f(this.removeChildren(),(function(t){return!!(e?t:1&t)}),t)):t!==a&&this.setClockwise(t),this},getInteriorPoint:function(){var i=this.getBounds().getCenter(!0);if(!this.contains(i)){for(var n=this.getCurves(),r=i.y,s=[],o=[],a=0,c=n.length;a<c;a++){var l=n[a].getValues(),h=l[1],u=l[3],d=l[5],p=l[7];if(r>=e(h,u,d,p)&&r<=t(h,u,d,p))for(var g=U.getMonoCurves(l),f=0,m=g.length;f<m;f++){var v=g[f],y=v[1],_=v[7];if(y!==_&&(r>=y&&r<=_||r>=_&&r<=y)){var S=r===y?v[0]:r===_?v[6]:1===U.solveCubic(v,1,r,o,0,1)?U.getPoint(v,o[0]).x:(v[0]+v[6])/2;s.push(S)}}}s.length>1&&(s.sort((function(e,t){return e-t})),i.x=(s[0]+s[1])/2)}return i}}});var q=h.extend({_class:"PathFlattener",initialize:function(e,t,i,n,r){var s,o=[],a=[],c=0,l=1/(i||32),h=e._segments,u=h[0];function d(e,t){var i=U.getValues(e,t,r);o.push(i),p(i,e._index,0,1)}function p(e,i,r,s){if(!(s-r>l)||n&&U.isStraight(e)||U.isFlatEnough(e,t||.25)){var o=e[6]-e[0],h=e[7]-e[1],u=Math.sqrt(o*o+h*h);u>0&&(c+=u,a.push({offset:c,curve:e,index:i,time:s}))}else{var d=U.subdivide(e,.5),g=(r+s)/2;p(d[0],i,r,g),p(d[1],i,g,s)}}for(var g=1,f=h.length;g<f;g++)d(u,s=h[g]),u=s;e._closed&&d(s||u,h[0]),this.curves=o,this.parts=a,this.length=c,this.index=0},_get:function(e){for(var t,i=this.parts,n=i.length,r=this.index;t=r,r&&!(i[--r].offset<e););for(;t<n;t++){var s=i[t];if(s.offset>=e){this.index=t;var o=i[t-1],a=o&&o.index===s.index?o.time:0,c=o?o.offset:0;return{index:s.index,time:a+(s.time-a)*(e-c)/(s.offset-c)}}}return{index:i[n-1].index,time:1}},drawPart:function(e,t,i){for(var n=this._get(t),r=this._get(i),s=n.index,o=r.index;s<=o;s++){var a=U.getPart(this.curves[s],s===n.index?n.time:0,s===r.index?r.time:1);s===n.index&&e.moveTo(a[0],a[1]),e.bezierCurveTo.apply(e,a.slice(2))}}},h.each(U._evaluateMethods,(function(e){this[e+"At"]=function(t){var i=this._get(t);return U[e](this.curves[i.index],i.time)}}),{})),V=h.extend({initialize:function(e){for(var t,i=this.points=[],n=e._segments,r=e._closed,s=0,o=n.length;s<o;s++){var a=n[s].point;t&&t.equals(a)||i.push(t=a.clone())}r&&(i.unshift(i[i.length-1]),i.push(i[1])),this.closed=r},fit:function(e){var t=this.points,i=t.length,n=null;return i>0&&(n=[new N(t[0])],i>1&&(this.fitCubic(n,e,0,i-1,t[1].subtract(t[0]),t[i-2].subtract(t[i-1])),this.closed&&(n.shift(),n.pop()))),n},fitCubic:function(e,t,i,n,r,s){var o=this.points;if(n-i!=1){for(var a,c=this.chordLengthParameterize(i,n),l=Math.max(t,t*t),h=!0,u=0;u<=4;u++){var d=this.generateBezier(i,n,c,r,s),p=this.findMaxError(i,n,d,c);if(p.error<t&&h)return void this.addCurve(e,d);if(a=p.index,p.error>=l)break;h=this.reparameterize(i,n,c,d),l=p.error}var g=o[a-1].subtract(o[a+1]);this.fitCubic(e,t,i,a,r,g),this.fitCubic(e,t,a,n,g.negate(),s)}else{var f=o[i],m=o[n],v=f.getDistance(m)/3;this.addCurve(e,[f,f.add(r.normalize(v)),m.add(s.normalize(v)),m])}},addCurve:function(e,t){e[e.length-1].setHandleOut(t[1].subtract(t[0])),e.push(new N(t[3],t[2].subtract(t[3])))},generateBezier:function(e,t,i,n,r){for(var s=1e-12,o=Math.abs,a=this.points,c=a[e],l=a[t],h=[[0,0],[0,0]],u=[0,0],d=0,p=t-e+1;d<p;d++){var g=i[d],f=1-g,m=3*g*f,v=f*f*f,y=m*f,_=m*g,S=g*g*g,b=n.normalize(y),w=r.normalize(_),E=a[e+d].subtract(c.multiply(v+y)).subtract(l.multiply(_+S));h[0][0]+=b.dot(b),h[0][1]+=b.dot(w),h[1][0]=h[0][1],h[1][1]+=w.dot(w),u[0]+=b.dot(E),u[1]+=w.dot(E)}var I,k,T=h[0][0]*h[1][1]-h[1][0]*h[0][1];if(o(T)>s){var C=h[0][0]*u[1]-h[1][0]*u[0];I=(u[0]*h[1][1]-u[1]*h[0][1])/T,k=C/T}else{var x=h[0][0]+h[0][1],R=h[1][0]+h[1][1];I=k=o(x)>s?u[0]/x:o(R)>s?u[1]/R:0}var O,A,P=l.getDistance(c),D=s*P;if(I<D||k<D)I=k=P/3;else{var M=l.subtract(c);O=n.normalize(I),A=r.normalize(k),O.dot(M)-A.dot(M)>P*P&&(I=k=P/3,O=A=null)}return[c,c.add(O||n.normalize(I)),l.add(A||r.normalize(k)),l]},reparameterize:function(e,t,i,n){for(var r=e;r<=t;r++)i[r-e]=this.findRoot(n,this.points[r],i[r-e]);r=1;for(var s=i.length;r<s;r++)if(i[r]<=i[r-1])return!1;return!0},findRoot:function(e,t,i){for(var n=[],r=[],s=0;s<=2;s++)n[s]=e[s+1].subtract(e[s]).multiply(3);for(s=0;s<=1;s++)r[s]=n[s+1].subtract(n[s]).multiply(2);var o=this.evaluate(3,e,i),a=this.evaluate(2,n,i),c=this.evaluate(1,r,i),l=o.subtract(t),h=a.dot(a)+l.dot(c);return m.isMachineZero(h)?i:i-l.dot(a)/h},evaluate:function(e,t,i){for(var n=t.slice(),r=1;r<=e;r++)for(var s=0;s<=e-r;s++)n[s]=n[s].multiply(1-i).add(n[s+1].multiply(i));return n[0]},chordLengthParameterize:function(e,t){for(var i=[0],n=e+1;n<=t;n++)i[n-e]=i[n-e-1]+this.points[n].getDistance(this.points[n-1]);n=1;for(var r=t-e;n<=r;n++)i[n]/=i[r];return i},findMaxError:function(e,t,i,n){for(var r=Math.floor((t-e+1)/2),s=0,o=e+1;o<t;o++){var a=this.evaluate(3,i,n[o-e]).subtract(this.points[o]),c=a.x*a.x+a.y*a.y;c>=s&&(s=c,r=o)}return{error:s,index:r}}}),$=C.extend({_class:"TextItem",_applyMatrix:!1,_canApplyMatrix:!1,_serializeFields:{content:null},_boundsOptions:{stroke:!1,handle:!1},initialize:function(e){this._content="",this._lines=[];var t=e&&h.isPlainObject(e)&&e.x===a&&e.y===a;this._initialize(t&&e,!t&&y.read(arguments))},_equals:function(e){return this._content===e._content},copyContent:function(e){this.setContent(e._content)},getContent:function(){return this._content},setContent:function(e){this._content=""+e,this._lines=this._content.split(/\r\n|\n|\r/gm),this._changed(521)},isEmpty:function(){return!this._content},getCharacterStyle:"#getStyle",setCharacterStyle:"#setStyle",getParagraphStyle:"#getStyle",setParagraphStyle:"#setStyle"}),G=$.extend({_class:"PointText",initialize:function(){$.apply(this,arguments)},getPoint:function(){var e=this._matrix.getTranslation();return new _(e.x,e.y,this,"setPoint")},setPoint:function(){var e=y.read(arguments);this.translate(e.subtract(this._matrix.getTranslation()))},_draw:function(e,t,i){if(this._content){this._setStyles(e,t,i);var n=this._lines,r=this._style,s=r.hasFill(),o=r.hasStroke(),a=r.getLeading(),c=e.shadowColor;e.font=r.getFontStyle(),e.textAlign=r.getJustification();for(var l=0,h=n.length;l<h;l++){e.shadowColor=c;var u=n[l];s&&(e.fillText(u,0,0),e.shadowColor="rgba(0,0,0,0)"),o&&e.strokeText(u,0,0),e.translate(0,a)}}},_getBounds:function(e,t){var i=this._style,n=this._lines,r=n.length,s=i.getJustification(),o=i.getLeading(),a=this.getView().getTextWidth(i.getFontStyle(),n),c=0;"left"!==s&&(c-=a/("center"===s?2:1));var l=new w(c,r?-.75*o:0,a,r*o);return e?e._transformBounds(l,l):l}}),H=h.extend(new function(){var e,t={gray:["gray"],rgb:["red","green","blue"],hsb:["hue","saturation","brightness"],hsl:["hue","saturation","lightness"],gradient:["gradient","origin","destination","highlight"]},i={},n={transparent:[0,0,0,0]};function r(t){var i,r=t.match(/^#([\da-f]{2})([\da-f]{2})([\da-f]{2})([\da-f]{2})?$/i)||t.match(/^#([\da-f])([\da-f])([\da-f])([\da-f])?$/i),s="rgb";if(r){var o=r[4]?4:3;i=new Array(o);for(var a=0;a<o;a++){var l=r[a+1];i[a]=parseInt(1==l.length?l+l:l,16)/255}}else if(r=t.match(/^(rgb|hsl)a?\((.*)\)$/)){s=r[1],i=r[2].trim().split(/[,\s]+/g);for(var h="hsl"===s,u=(a=0,Math.min(i.length,4));a<u;a++){var d=i[a];if(l=parseFloat(d),h)if(0===a){var p=d.match(/([a-z]*)$/)[1];l*={turn:360,rad:180/Math.PI,grad:.9}[p]||1}else a<3&&(l/=100);else a<3&&(l/=/%$/.test(d)?100:255);i[a]=l}}else{var g=n[t];if(!g)if(c){e||((e=ce.getContext(1,1)).globalCompositeOperation="copy"),e.fillStyle="rgba(0,0,0,0)",e.fillStyle=t,e.fillRect(0,0,1,1);var f=e.getImageData(0,0,1,1).data;g=n[t]=[f[0]/255,f[1]/255,f[2]/255]}else g=[0,0,0];i=g.slice()}return[s,i]}var s=[[0,3,1],[2,0,1],[1,0,3],[1,2,0],[3,1,0],[0,1,2]],o={"rgb-hsb":function(e,t,i){var n=Math.max(e,t,i),r=n-Math.min(e,t,i);return[0===r?0:60*(n==e?(t-i)/r+(t<i?6:0):n==t?(i-e)/r+2:(e-t)/r+4),0===n?0:r/n,n]},"hsb-rgb":function(e,t,i){var n,r=(e=(e/60%6+6)%6)-(n=Math.floor(e)),o=[i,i*(1-t),i*(1-t*r),i*(1-t*(1-r))];return[o[(n=s[n])[0]],o[n[1]],o[n[2]]]},"rgb-hsl":function(e,t,i){var n=Math.max(e,t,i),r=Math.min(e,t,i),s=n-r,o=0===s,a=(n+r)/2;return[o?0:60*(n==e?(t-i)/s+(t<i?6:0):n==t?(i-e)/s+2:(e-t)/s+4),o?0:a<.5?s/(n+r):s/(2-n-r),a]},"hsl-rgb":function(e,t,i){if(0===t)return[i,i,i];for(var n=[(e=(e/360%1+1)%1)+1/3,e,e-1/3],r=i<.5?i*(1+t):i+t-i*t,s=2*i-r,o=[],a=0;a<3;a++){var c=n[a];c<0&&(c+=1),c>1&&(c-=1),o[a]=6*c<1?s+6*(r-s)*c:2*c<1?r:3*c<2?s+(r-s)*(2/3-c)*6:s}return o},"rgb-gray":function(e,t,i){return[.2989*e+.587*t+.114*i]},"gray-rgb":function(e){return[e,e,e]},"gray-hsb":function(e){return[0,0,e]},"gray-hsl":function(e){return[0,0,e]},"gradient-rgb":function(){return[]},"rgb-gradient":function(){return[]}};return h.each(t,(function(e,n){i[n]=[],h.each(e,(function(e,r){var s=h.capitalize(e),o=/^(hue|saturation)$/.test(e),a=i[n][r]="gradient"===n?"gradient"===e?function(e){var t=this._components[0];return t!==(e=z.read(Array.isArray(e)?e:arguments,0,{readNull:!0}))&&(t&&t._removeOwner(this),e&&e._addOwner(this)),e}:function(){return y.read(arguments,0,{readNull:"highlight"===e,clone:!0})}:function(e){return null==e||isNaN(e)?0:+e};this["get"+s]=function(){return this._type===n||o&&/^hs[bl]$/.test(this._type)?this._components[r]:this._convert(n)[r]},this["set"+s]=function(e){this._type===n||o&&/^hs[bl]$/.test(this._type)||(this._components=this._convert(n),this._properties=t[n],this._type=n),this._components[r]=a.call(this,e),this._changed()}}),this)}),{_class:"Color",_readIndex:!0,initialize:function e(n){var s,o,a,c,l=arguments,u=this.__read,d=0;Array.isArray(n)&&(n=(l=n)[0]);var p=null!=n&&typeof n;if("string"===p&&n in t&&(s=n,n=l[1],Array.isArray(n)?(o=n,a=l[2]):(u&&(d=1),l=h.slice(l,1),p=typeof n)),!o){if(c="number"===p?l:"object"===p&&null!=n.length?n:null){s||(s=c.length>=3?"rgb":"gray");var g=t[s].length;a=c[g],u&&(d+=c===arguments?g+(null!=a?1:0):1),c.length>g&&(c=h.slice(c,0,g))}else if("string"===p){var f=r(n);s=f[0],4===(o=f[1]).length&&(a=o[3],o.length--)}else if("object"===p)if(n.constructor===e){if(s=n._type,o=n._components.slice(),a=n._alpha,"gradient"===s)for(var m=1,v=o.length;m<v;m++){var y=o[m];y&&(o[m]=y.clone())}}else if(n.constructor===z)s="gradient",c=l;else{var _=t[s="hue"in n?"lightness"in n?"hsl":"hsb":"gradient"in n||"stops"in n||"radial"in n?"gradient":"gray"in n?"gray":"rgb"],S=i[s];for(this._components=o=[],m=0,v=_.length;m<v;m++)null==(b=n[_[m]])&&!m&&"gradient"===s&&"stops"in n&&(b={stops:n.stops,radial:n.radial}),null!=(b=S[m].call(this,b))&&(o[m]=b);a=n.alpha}u&&s&&(d=1)}if(this._type=s||"rgb",!o)for(this._components=o=[],m=0,v=(S=i[this._type]).length;m<v;m++){var b;null!=(b=S[m].call(this,c&&c[m]))&&(o[m]=b)}return this._components=o,this._properties=t[this._type],this._alpha=a,u&&(this.__read=d),this},set:"#initialize",_serialize:function(e,t){var i=this.getComponents();return h.serialize(/^(gray|rgb)$/.test(this._type)?i:[this._type].concat(i),e,!0,t)},_changed:function(){this._canvasStyle=null,this._owner&&(this._setter?this._owner[this._setter](this):this._owner._changed(129))},_convert:function(e){var t;return this._type===e?this._components.slice():(t=o[this._type+"-"+e])?t.apply(this,this._components):o["rgb-"+e].apply(this,o[this._type+"-rgb"].apply(this,this._components))},convert:function(e){return new H(e,this._convert(e),this._alpha)},getType:function(){return this._type},setType:function(e){this._components=this._convert(e),this._properties=t[e],this._type=e},getComponents:function(){var e=this._components.slice();return null!=this._alpha&&e.push(this._alpha),e},getAlpha:function(){return null!=this._alpha?this._alpha:1},setAlpha:function(e){this._alpha=null==e?null:Math.min(Math.max(e,0),1),this._changed()},hasAlpha:function(){return null!=this._alpha},equals:function(e){var t=h.isPlainValue(e,!0)?H.read(arguments):e;return t===this||t&&this._class===t._class&&this._type===t._type&&this.getAlpha()===t.getAlpha()&&h.equals(this._components,t._components)||!1},toString:function(){for(var e=this._properties,t=[],i="gradient"===this._type,n=f.instance,r=0,s=e.length;r<s;r++){var o=this._components[r];null!=o&&t.push(e[r]+": "+(i?o:n.number(o)))}return null!=this._alpha&&t.push("alpha: "+n.number(this._alpha)),"{ "+t.join(", ")+" }"},toCSS:function(e){var t=this._convert("rgb"),i=e||null==this._alpha?1:this._alpha;function n(e){return Math.round(255*(e<0?0:e>1?1:e))}return t=[n(t[0]),n(t[1]),n(t[2])],i<1&&t.push(i<0?0:i),e?"#"+((1<<24)+(t[0]<<16)+(t[1]<<8)+t[2]).toString(16).slice(1):(4==t.length?"rgba(":"rgb(")+t.join(",")+")"},toCanvasStyle:function(e,t){if(this._canvasStyle)return this._canvasStyle;if("gradient"!==this._type)return this._canvasStyle=this.toCSS();var i,n=this._components,r=n[0],s=r._stops,o=n[1],a=n[2],c=n[3],l=t&&t.inverted();if(l&&(o=l._transformPoint(o),a=l._transformPoint(a),c&&(c=l._transformPoint(c))),r._radial){var h=a.getDistance(o);if(c){var u=c.subtract(o);u.getLength()>h&&(c=o.add(u.normalize(h-.1)))}var d=c||o;i=e.createRadialGradient(d.x,d.y,0,o.x,o.y,h)}else i=e.createLinearGradient(o.x,o.y,a.x,a.y);for(var p=0,g=s.length;p<g;p++){var f=s[p],m=f._offset;i.addColorStop(null==m?p/(g-1):m,f._color.toCanvasStyle())}return this._canvasStyle=i},transform:function(e){if("gradient"===this._type){for(var t=this._components,i=1,n=t.length;i<n;i++){var r=t[i];e._transformPoint(r,r,!0)}this._changed()}},statics:{_types:t,random:function(){var e=Math.random;return new H(e(),e(),e())},_setOwner:function(e,t,i){return e&&(e._owner&&t&&e._owner!==t&&(e=e.clone()),!e._owner^!t&&(e._owner=t||null,e._setter=i||null)),e}}})},new function(){return h.each({add:function(e,t){return e+t},subtract:function(e,t){return e-t},multiply:function(e,t){return e*t},divide:function(e,t){return e/t}},(function(e,t){this[t]=function(t){t=H.read(arguments);for(var i=this._type,n=this._components,r=t._convert(i),s=0,o=n.length;s<o;s++)r[s]=e(n[s],r[s]);return new H(i,r,null!=this._alpha?e(this._alpha,t.getAlpha()):null)}}),{})}),z=h.extend({_class:"Gradient",initialize:function(e,t){this._id=v.get(),e&&h.isPlainObject(e)&&(this.set(e),e=t=null),null==this._stops&&this.setStops(e||["white","black"]),null==this._radial&&this.setRadial("string"==typeof t&&"radial"===t||t||!1)},_serialize:function(e,t){return t.add(this,(function(){return h.serialize([this._stops,this._radial],e,!0,t)}))},_changed:function(){for(var e=0,t=this._owners&&this._owners.length;e<t;e++)this._owners[e]._changed()},_addOwner:function(e){this._owners||(this._owners=[]),this._owners.push(e)},_removeOwner:function(e){var t=this._owners?this._owners.indexOf(e):-1;-1!=t&&(this._owners.splice(t,1),this._owners.length||(this._owners=a))},clone:function(){for(var e=[],t=0,i=this._stops.length;t<i;t++)e[t]=this._stops[t].clone();return new z(e,this._radial)},getStops:function(){return this._stops},setStops:function(e){if(e.length<2)throw new Error("Gradient stop list needs to contain at least two stops.");var t=this._stops;if(t)for(var i=0,n=t.length;i<n;i++)t[i]._owner=a;for(i=0,n=(t=this._stops=W.readList(e,0,{clone:!0})).length;i<n;i++)t[i]._owner=this;this._changed()},getRadial:function(){return this._radial},setRadial:function(e){this._radial=e,this._changed()},equals:function(e){if(e===this)return!0;if(e&&this._class===e._class){var t=this._stops,i=e._stops,n=t.length;if(n===i.length){for(var r=0;r<n;r++)if(!t[r].equals(i[r]))return!1;return!0}}return!1}}),W=h.extend({_class:"GradientStop",initialize:function(e,t){var i=e,n=t;"object"==typeof e&&t===a&&(Array.isArray(e)&&"number"!=typeof e[0]?(i=e[0],n=e[1]):("color"in e||"offset"in e||"rampPoint"in e)&&(i=e.color,n=e.offset||e.rampPoint||0)),this.setColor(i),this.setOffset(n)},clone:function(){return new W(this._color.clone(),this._offset)},_serialize:function(e,t){var i=this._color,n=this._offset;return h.serialize(null==n?[i]:[i,n],e,!0,t)},_changed:function(){this._owner&&this._owner._changed(129)},getOffset:function(){return this._offset},setOffset:function(e){this._offset=e,this._changed()},getRampPoint:"#getOffset",setRampPoint:"#setOffset",getColor:function(){return this._color},setColor:function(){H._setOwner(this._color,null),this._color=H._setOwner(H.read(arguments,0),this,"setColor"),this._changed()},equals:function(e){return e===this||e&&this._class===e._class&&this._color.equals(e._color)&&this._offset==e._offset||!1}}),Y=h.extend(new function(){var e={fillColor:null,fillRule:"nonzero",strokeColor:null,strokeWidth:1,strokeCap:"butt",strokeJoin:"miter",strokeScaling:!0,miterLimit:10,dashOffset:0,dashArray:[],shadowColor:null,shadowBlur:0,shadowOffset:new y,selectedColor:null},t=h.set({},e,{fontFamily:"sans-serif",fontWeight:"normal",fontSize:12,leading:null,justification:"left"}),i=h.set({},t,{fillColor:new H}),n={strokeWidth:193,strokeCap:193,strokeJoin:193,strokeScaling:201,miterLimit:193,fontFamily:9,fontWeight:9,fontSize:9,font:9,leading:9,justification:9},r={beans:!0},s={_class:"Style",beans:!0,initialize:function(n,r,s){this._values={},this._owner=r,this._project=r&&r._project||s||de.project,this._defaults=!r||r instanceof x?t:r instanceof $?i:e,n&&this.set(n)}};return h.each(t,(function(e,t){var i=/Color$/.test(t),o="shadowOffset"===t,c=h.capitalize(t),l=n[t],u="set"+c,d="get"+c;s[u]=function(e){var n=this._owner,r=n&&n._children,s=r&&r.length>0&&!(n instanceof F);if(s)for(var o=0,a=r.length;o<a;o++)r[o]._style[u](e);if(("selectedColor"===t||!s)&&t in this._defaults){var c=this._values[t];c!==e&&(i&&(c&&(H._setOwner(c,null),c._canvasStyle=null),e&&e.constructor===H&&(e=H._setOwner(e,n,s&&u))),this._values[t]=e,n&&n._changed(l||129))}},s[d]=function(e){var n=this._owner,r=n&&n._children,s=r&&r.length>0&&!(n instanceof F);if(s&&!e)for(var c=0,l=r.length;c<l;c++){var p=r[c]._style[d]();if(c){if(!h.equals(g,p))return a}else g=p}else if(t in this._defaults){var g;if((g=this._values[t])===a)(g=this._defaults[t])&&g.clone&&(g=g.clone());else{var f=i?H:o?y:null;!f||g&&g.constructor===f||(this._values[t]=g=f.read([g],0,{readNull:!0,clone:!0}))}}return g&&i&&(g=H._setOwner(g,n,s&&u)),g},r[d]=function(e){return this._style[d](e)},r[u]=function(e){this._style[u](e)}})),h.each({Font:"FontFamily",WindingRule:"FillRule"},(function(e,t){var i="get"+t,n="set"+t;s[i]=r[i]="#get"+e,s[n]=r[n]="#set"+e})),C.inject(r),s},{set:function(e){var t=e instanceof Y,i=t?e._values:e;if(i)for(var n in i)if(n in this._defaults){var r=i[n];this[n]=r&&t&&r.clone?r.clone():r}},equals:function(e){function t(e,t,i){var n=e._values,r=t._values,s=t._defaults;for(var o in n){var c=n[o],l=r[o];if(!(i&&o in r||h.equals(c,l===a?s[o]:l)))return!1}return!0}return e===this||e&&this._class===e._class&&t(this,e)&&t(e,this,!0)||!1},_dispose:function(){var e;(e=this.getFillColor())&&(e._canvasStyle=null),(e=this.getStrokeColor())&&(e._canvasStyle=null),(e=this.getShadowColor())&&(e._canvasStyle=null)},hasFill:function(){var e=this.getFillColor();return!!e&&e.alpha>0},hasStroke:function(){var e=this.getStrokeColor();return!!e&&e.alpha>0&&this.getStrokeWidth()>0},hasShadow:function(){var e=this.getShadowColor();return!!e&&e.alpha>0&&(this.getShadowBlur()>0||!this.getShadowOffset().isZero())},getView:function(){return this._project._view},getFontStyle:function(){var e=this.getFontSize();return this.getFontWeight()+" "+e+(/[a-z]/i.test(e+"")?" ":"px ")+this.getFontFamily()},getFont:"#getFontFamily",setFont:"#setFontFamily",getLeading:function e(){var t=e.base.call(this),i=this.getFontSize();return/pt|em|%|px/.test(i)&&(i=this.getView().getPixelSize(i)),null!=t?t:1.2*i}}),J=new function(){function e(e,t,i,n){for(var r=["","webkit","moz","Moz","ms","o"],s=t[0].toUpperCase()+t.substring(1),o=0;o<6;o++){var a=r[o],c=a?a+s:t;if(c in e){if(!i)return e[c];e[c]=n;break}}}return{getStyles:function(e){var t=e&&9!==e.nodeType?e.ownerDocument:e,i=t&&t.defaultView;return i&&i.getComputedStyle(e,"")},getBounds:function(e,t){var i,n=e.ownerDocument,r=n.body,s=n.documentElement;try{i=e.getBoundingClientRect()}catch(e){i={left:0,top:0,width:0,height:0}}var o=i.left-(s.clientLeft||r.clientLeft||0),a=i.top-(s.clientTop||r.clientTop||0);if(!t){var c=n.defaultView;o+=c.pageXOffset||s.scrollLeft||r.scrollLeft,a+=c.pageYOffset||s.scrollTop||r.scrollTop}return new w(o,a,i.width,i.height)},getViewportBounds:function(e){var t=e.ownerDocument,i=t.defaultView,n=t.documentElement;return new w(0,0,i.innerWidth||n.clientWidth,i.innerHeight||n.clientHeight)},getOffset:function(e,t){return J.getBounds(e,t).getPoint()},getSize:function(e){return J.getBounds(e,!0).getSize()},isInvisible:function(e){return J.getSize(e).equals(new S(0,0))},isInView:function(e){return!J.isInvisible(e)&&J.getViewportBounds(e).intersects(J.getBounds(e,!0))},isInserted:function(e){return l.body.contains(e)},getPrefixed:function(t,i){return t&&e(t,i)},setPrefixed:function(t,i,n){if("object"==typeof i)for(var r in i)e(t,r,!0,i[r]);else e(t,i,!0,n)}}},Q={add:function(e,t){if(e)for(var i in t)for(var n=t[i],r=i.split(/[\s,]+/g),s=0,o=r.length;s<o;s++){var a=r[s],c=e===l&&("touchstart"===a||"touchmove"===a)&&{passive:!1};e.addEventListener(a,n,c)}},remove:function(e,t){if(e)for(var i in t)for(var n=t[i],r=i.split(/[\s,]+/g),s=0,o=r.length;s<o;s++)e.removeEventListener(r[s],n,!1)},getPoint:function(e){var t=e.targetTouches?e.targetTouches.length?e.targetTouches[0]:e.changedTouches[0]:e;return new y(t.pageX||t.clientX+l.documentElement.scrollLeft,t.pageY||t.clientY+l.documentElement.scrollTop)},getTarget:function(e){return e.target||e.srcElement},getRelatedTarget:function(e){return e.relatedTarget||e.toElement},getOffset:function(e,t){return Q.getPoint(e).subtract(J.getOffset(t||Q.getTarget(e)))}};Q.requestAnimationFrame=new function(){var e,t=J.getPrefixed(c,"requestAnimationFrame"),i=!1,n=[];function r(){var e=n;n=[];for(var s=0,o=e.length;s<o;s++)e[s]();(i=t&&n.length)&&t(r)}return function(s){n.push(s),t?i||(t(r),i=!0):e||(e=setInterval(r,1e3/60))}};var X=h.extend(u,{_class:"View",initialize:function e(t,i){function n(e){return i[e]||parseInt(i.getAttribute(e),10)}function r(){var e=J.getSize(i);return e.isNaN()||e.isZero()?new S(n("width"),n("height")):e}var s;if(c&&i){this._id=i.getAttribute("id"),null==this._id&&i.setAttribute("id",this._id="paper-view-"+e._id++),Q.add(i,this._viewEvents);var o="none";if(J.setPrefixed(i.style,{userDrag:o,userSelect:o,touchCallout:o,contentZooming:o,tapHighlightColor:"rgba(0,0,0,0)"}),d.hasAttribute(i,"resize")){var a=this;Q.add(c,this._windowEvents={resize:function(){a.setViewSize(r())}})}if(s=r(),d.hasAttribute(i,"stats")&&"undefined"!=typeof Stats){this._stats=new Stats;var h=this._stats.domElement,u=h.style,p=J.getOffset(i);u.position="absolute",u.left=p.x+"px",u.top=p.y+"px",l.body.appendChild(h)}}else s=new S(i),i=null;this._project=t,this._scope=t._scope,this._element=i,this._pixelRatio||(this._pixelRatio=c&&c.devicePixelRatio||1),this._setElementSize(s.width,s.height),this._viewSize=s,e._views.push(this),e._viewsById[this._id]=this,(this._matrix=new I)._owner=this,e._focused||(e._focused=this),this._frameItems={},this._frameItemCount=0,this._itemEvents={native:{},virtual:{}},this._autoUpdate=!de.agent.node,this._needsUpdate=!1},remove:function(){if(!this._project)return!1;X._focused===this&&(X._focused=null),X._views.splice(X._views.indexOf(this),1),delete X._viewsById[this._id];var e=this._project;return e._view===this&&(e._view=null),Q.remove(this._element,this._viewEvents),Q.remove(c,this._windowEvents),this._element=this._project=null,this.off("frame"),this._animate=!1,this._frameItems={},!0},_events:h.each(C._itemHandlers.concat(["onResize","onKeyDown","onKeyUp"]),(function(e){this[e]={}}),{onFrame:{install:function(){this.play()},uninstall:function(){this.pause()}}}),_animate:!1,_time:0,_count:0,getAutoUpdate:function(){return this._autoUpdate},setAutoUpdate:function(e){this._autoUpdate=e,e&&this.requestUpdate()},update:function(){},draw:function(){this.update()},requestUpdate:function(){if(!this._requested){var e=this;Q.requestAnimationFrame((function(){if(e._requested=!1,e._animate){e.requestUpdate();var t=e._element;J.getPrefixed(l,"hidden")&&"true"!==d.getAttribute(t,"keepalive")||!J.isInView(t)||e._handleFrame()}e._autoUpdate&&e.update()})),this._requested=!0}},play:function(){this._animate=!0,this.requestUpdate()},pause:function(){this._animate=!1},_handleFrame:function(){de=this._scope;var e=Date.now()/1e3,t=this._last?e-this._last:0;this._last=e,this.emit("frame",new h({delta:t,time:this._time+=t,count:this._count++})),this._stats&&this._stats.update()},_animateItem:function(e,t){var i=this._frameItems;t?(i[e._id]={item:e,time:0,count:0},1==++this._frameItemCount&&this.on("frame",this._handleFrameItems)):(delete i[e._id],0==--this._frameItemCount&&this.off("frame",this._handleFrameItems))},_handleFrameItems:function(e){for(var t in this._frameItems){var i=this._frameItems[t];i.item.emit("frame",new h(e,{time:i.time+=e.delta,count:i.count++}))}},_changed:function(){this._project._changed(4097),this._bounds=this._decomposed=a},getElement:function(){return this._element},getPixelRatio:function(){return this._pixelRatio},getResolution:function(){return 72*this._pixelRatio},getViewSize:function(){var e=this._viewSize;return new b(e.width,e.height,this,"setViewSize")},setViewSize:function(){var e=S.read(arguments),t=e.subtract(this._viewSize);t.isZero()||(this._setElementSize(e.width,e.height),this._viewSize.set(e),this._changed(),this.emit("resize",{size:e,delta:t}),this._autoUpdate&&this.update())},_setElementSize:function(e,t){var i=this._element;i&&(i.width!==e&&(i.width=e),i.height!==t&&(i.height=t))},getBounds:function(){return this._bounds||(this._bounds=this._matrix.inverted()._transformBounds(new w(new y,this._viewSize))),this._bounds},getSize:function(){return this.getBounds().getSize()},isVisible:function(){return J.isInView(this._element)},isInserted:function(){return J.isInserted(this._element)},getPixelSize:function(e){var t,i=this._element;if(i){var n=i.parentNode,r=l.createElement("div");r.style.fontSize=e,n.appendChild(r),t=parseFloat(J.getStyles(r).fontSize),n.removeChild(r)}else t=parseFloat(t);return t},getTextWidth:function(e,t){return 0}},h.each(["rotate","scale","shear","skew"],(function(e){var t="rotate"===e;this[e]=function(){var i=arguments,n=(t?h:y).read(i),r=y.read(i,0,{readNull:!0});return this.transform((new I)[e](n,r||this.getCenter(!0)))}}),{_decompose:function(){return this._decomposed||(this._decomposed=this._matrix.decompose())},translate:function(){var e=new I;return this.transform(e.translate.apply(e,arguments))},getCenter:function(){return this.getBounds().getCenter()},setCenter:function(){var e=y.read(arguments);this.translate(this.getCenter().subtract(e))},getZoom:function(){var e=this._decompose().scaling;return(e.x+e.y)/2},setZoom:function(e){this.transform((new I).scale(e/this.getZoom(),this.getCenter()))},getRotation:function(){return this._decompose().rotation},setRotation:function(e){var t=this.getRotation();null!=t&&null!=e&&this.rotate(e-t)},getScaling:function(){var e=this._decompose().scaling;return new _(e.x,e.y,this,"setScaling")},setScaling:function(){var e=this.getScaling(),t=y.read(arguments,0,{clone:!0,readNull:!0});e&&t&&this.scale(t.x/e.x,t.y/e.y)},getMatrix:function(){return this._matrix},setMatrix:function(){var e=this._matrix;e.set.apply(e,arguments)},transform:function(e){this._matrix.append(e)},scrollBy:function(){this.translate(y.read(arguments).negate())}}),{projectToView:function(){return this._matrix._transformPoint(y.read(arguments))},viewToProject:function(){return this._matrix._inverseTransform(y.read(arguments))},getEventPoint:function(e){return this.viewToProject(Q.getOffset(e,this._element))}},{statics:{_views:[],_viewsById:{},_id:0,create:function(e,t){return l&&"string"==typeof t&&(t=l.getElementById(t)),new(c?Z:X)(e,t)}}},new function(){if(c){var e,t,i,n,r,s=!1,o=!1,a=c.navigator;a.pointerEnabled||a.msPointerEnabled?(i="pointerdown MSPointerDown",n="pointermove MSPointerMove",r="pointerup pointercancel MSPointerUp MSPointerCancel"):(i="touchstart",n="touchmove",r="touchend touchcancel","ontouchstart"in c&&a.userAgent.match(/mobile|tablet|ip(ad|hone|od)|android|silk/i)||(i+=" mousedown",n+=" mousemove",r+=" mouseup"));var h={},u={mouseout:function(e){var t=X._focused,i=Q.getRelatedTarget(e);if(t&&(!i||"HTML"===i.nodeName)){var n=Q.getOffset(e,t._element),r=n.x,s=Math.abs,o=s(r),a=o-(1<<25);n.x=s(a)<o?a*(r<0?-1:1):r,C(t,e,t.viewToProject(n))}},scroll:T};h[i]=function(e){var t=X._focused=k(e);s||(s=!0,t._handleMouseEvent("mousedown",e))},u[n]=function(i){var n=X._focused;if(!o){var r=k(i);r?n!==r&&(n&&C(n,i),e||(e=n),n=X._focused=t=r):t&&t===n&&(e&&!e.isInserted()&&(e=null),n=X._focused=e,e=null,T())}n&&C(n,i)},u[i]=function(){o=!0},u[r]=function(e){var t=X._focused;t&&s&&t._handleMouseEvent("mouseup",e),o=s=!1},Q.add(l,u),Q.add(c,{load:T});var d,p,g,f,m,v,y,_,S=!1,b=!1,w={doubleclick:"click",mousedrag:"mousemove"},E=!1,I={mousedown:{mousedown:1,mousedrag:1,click:1,doubleclick:1},mouseup:{mouseup:1,mousedrag:1,click:1,doubleclick:1},mousemove:{mousedrag:1,mousemove:1,mouseenter:1,mouseleave:1}};return{_viewEvents:h,_handleMouseEvent:function(e,t,i){var n=this._itemEvents,r=n.native[e],o="mousemove"===e,a=this._scope.tool,c=this;function l(e){return n.virtual[e]||c.responds(e)||a&&a.responds(e)}o&&s&&l("mousedrag")&&(e="mousedrag"),i||(i=this.getEventPoint(t));var h=this.getBounds().contains(i),u=r&&h&&c._project.hitTest(i,{tolerance:0,fill:!0,stroke:!0}),w=u&&u.item||null,I=!1,k={};if(k[e.substr(5)]=!0,r&&w!==f&&(f&&x(f,null,"mouseleave",t,i),w&&x(w,null,"mouseenter",t,i),f=w),E^h&&(x(this,null,h?"mouseenter":"mouseleave",t,i),I=!0),!h&&!k.drag||i.equals(p)||(R(this,w,o?e:"mousemove",t,i,p),I=!0),E=h,k.down&&h||k.up&&d){if(R(this,w,e,t,i,d),k.down){if(_=w===v&&Date.now()-y<300,g=v=w,!b&&w){for(var T=w;T&&!T.responds("mousedrag");)T=T._parent;T&&(m=w)}d=i}else k.up&&(b||w!==g||(y=Date.now(),R(this,w,_?"doubleclick":"click",t,i,d),_=!1),g=m=null);E=!1,I=!0}p=i,I&&a&&(S=a._handleMouseEvent(e,t,i,k)||S),!1!==t.cancelable&&(S&&!k.move||k.down&&l("mouseup"))&&t.preventDefault()},_handleKeyEvent:function(e,t,i,n){var r,s=this._scope,o=s.tool;function a(o){o.responds(e)&&(de=s,o.emit(e,r=r||new te(e,t,i,n)))}this.isVisible()&&(a(this),o&&o.responds(e)&&a(o))},_countItemEvent:function(e,t){var i=this._itemEvents,n=i.native,r=i.virtual;for(var s in I)n[s]=(n[s]||0)+(I[s][e]||0)*t;r[e]=(r[e]||0)+t},statics:{updateFocus:T,_resetState:function(){s=o=S=E=!1,e=t=d=p=g=f=m=v=y=_=null}}}}function k(e){var t=Q.getTarget(e);return t.getAttribute&&X._viewsById[t.getAttribute("id")]}function T(){var e=X._focused;if(!e||!e.isVisible())for(var i=0,n=X._views.length;i<n;i++)if((e=X._views[i]).isVisible()){X._focused=t=e;break}}function C(e,t,i){e._handleMouseEvent("mousemove",t,i)}function x(e,t,i,n,r,s,o){var a,c=!1;function l(e,i){if(e.responds(i)){if(a||(a=new ne(i,n,r,t||e,s?r.subtract(s):null)),e.emit(i,a)&&(S=!0,a.prevented&&(b=!0),a.stopped))return c=!0}else{var o=w[i];if(o)return l(e,o)}}for(;e&&e!==o&&!l(e,i);)e=e._parent;return c}function R(e,t,i,n,r,s){return e._project.removeOn(i),b=S=!1,m&&x(m,null,i,n,r,s)||t&&t!==m&&!t.isDescendant(m)&&x(t,null,"mousedrag"===i?"mousemove":i,n,r,s,m)||x(e,m||t||e,i,n,r,s)}}),Z=X.extend({_class:"CanvasView",initialize:function(e,t){if(!(t instanceof c.HTMLCanvasElement)){var i=S.read(arguments,1);if(i.isZero())throw new Error("Cannot create CanvasView with the provided argument: "+h.slice(arguments,1));t=ce.getCanvas(i)}var n=this._context=t.getContext("2d");if(n.save(),this._pixelRatio=1,!/^off|false$/.test(d.getAttribute(t,"hidpi"))){var r=c.devicePixelRatio||1,s=J.getPrefixed(n,"backingStorePixelRatio")||1;this._pixelRatio=r/s}X.call(this,e,t),this._needsUpdate=!0},remove:function e(){return this._context.restore(),e.base.call(this)},_setElementSize:function e(t,i){var n=this._pixelRatio;if(e.base.call(this,t*n,i*n),1!==n){var r=this._element,s=this._context;if(!d.hasAttribute(r,"resize")){var o=r.style;o.width=t+"px",o.height=i+"px"}s.restore(),s.save(),s.scale(n,n)}},getContext:function(){return this._context},getPixelSize:function e(t){var i,n=de.agent;if(n&&n.firefox)i=e.base.call(this,t);else{var r=this._context,s=r.font;r.font=t+" serif",i=parseFloat(r.font),r.font=s}return i},getTextWidth:function(e,t){var i=this._context,n=i.font,r=0;i.font=e;for(var s=0,o=t.length;s<o;s++)r=Math.max(r,i.measureText(t[s]).width);return i.font=n,r},update:function(){if(!this._needsUpdate)return!1;var e=this._project,t=this._context,i=this._viewSize;return t.clearRect(0,0,i.width+1,i.height+1),e&&e.draw(t,this._matrix,this._pixelRatio),this._needsUpdate=!1,!0}}),ee=h.extend({_class:"Event",initialize:function(e){this.event=e,this.type=e&&e.type},prevented:!1,stopped:!1,preventDefault:function(){this.prevented=!0,this.event.preventDefault()},stopPropagation:function(){this.stopped=!0,this.event.stopPropagation()},stop:function(){this.stopPropagation(),this.preventDefault()},getTimeStamp:function(){return this.event.timeStamp},getModifiers:function(){return ie.modifiers}}),te=ee.extend({_class:"KeyEvent",initialize:function(e,t,i,n){this.type=e,this.event=t,this.key=i,this.character=n},toString:function(){return"{ type: '"+this.type+"', key: '"+this.key+"', character: '"+this.character+"', modifiers: "+this.getModifiers()+" }"}}),ie=new function(){var e,t,i={"\t":"tab"," ":"space","\b":"backspace","":"delete",Spacebar:"space",Del:"delete",Win:"meta",Esc:"escape"},n={tab:"\t",space:" ",enter:"\r"},r={},s={},o=new h({shift:!1,control:!1,alt:!1,meta:!1,capsLock:!1,space:!1}).inject({option:{get:function(){return this.alt}},command:{get:function(){var e=de&&de.agent;return e&&e.mac?this.meta:this.control}}});function u(e){var t=e.key||e.keyIdentifier;return t=/^U\+/.test(t)?String.fromCharCode(parseInt(t.substr(2),16)):/^Arrow[A-Z]/.test(t)?t.substr(5):"Unidentified"===t||t===a?String.fromCharCode(e.keyCode):t,i[t]||(t.length>1?h.hyphenate(t):t.toLowerCase())}function d(t,i,n,a){var c,l=X._focused;if(r[i]=t,t?s[i]=n:delete s[i],i.length>1&&(c=h.camelize(i))in o){o[c]=t;var u=de&&de.agent;if("meta"===c&&u&&u.mac)if(t)e={};else{for(var p in e)p in s&&d(!1,p,e[p],a);e=null}}else t&&e&&(e[i]=n);l&&l._handleKeyEvent(t?"keydown":"keyup",a,i,n)}return Q.add(l,{keydown:function(e){var i=u(e),r=de&&de.agent;i.length>1||r&&r.chrome&&(e.altKey||r.mac&&e.metaKey||!r.mac&&e.ctrlKey)?d(!0,i,n[i]||(i.length>1?"":i),e):t=i},keypress:function(e){if(t){var i=u(e),n=e.charCode,r=n>=32?String.fromCharCode(n):i.length>1?"":i;i!==t&&(i=r.toLowerCase()),d(!0,i,r,e),t=null}},keyup:function(e){var t=u(e);t in s&&d(!1,t,s[t],e)}}),Q.add(c,{blur:function(e){for(var t in s)d(!1,t,s[t],e)}}),{modifiers:o,isDown:function(e){return!!r[e]}}},ne=ee.extend({_class:"MouseEvent",initialize:function(e,t,i,n,r){this.type=e,this.event=t,this.point=i,this.target=n,this.delta=r},toString:function(){return"{ type: '"+this.type+"', point: "+this.point+", target: "+this.target+(this.delta?", delta: "+this.delta:"")+", modifiers: "+this.getModifiers()+" }"}}),re=ee.extend({_class:"ToolEvent",_item:null,initialize:function(e,t,i){this.tool=e,this.type=t,this.event=i},_choosePoint:function(e,t){return e||(t?t.clone():null)},getPoint:function(){return this._choosePoint(this._point,this.tool._point)},setPoint:function(e){this._point=e},getLastPoint:function(){return this._choosePoint(this._lastPoint,this.tool._lastPoint)},setLastPoint:function(e){this._lastPoint=e},getDownPoint:function(){return this._choosePoint(this._downPoint,this.tool._downPoint)},setDownPoint:function(e){this._downPoint=e},getMiddlePoint:function(){return!this._middlePoint&&this.tool._lastPoint?this.tool._point.add(this.tool._lastPoint).divide(2):this._middlePoint},setMiddlePoint:function(e){this._middlePoint=e},getDelta:function(){return!this._delta&&this.tool._lastPoint?this.tool._point.subtract(this.tool._lastPoint):this._delta},setDelta:function(e){this._delta=e},getCount:function(){return this.tool[/^mouse(down|up)$/.test(this.type)?"_downCount":"_moveCount"]},setCount:function(e){this.tool[/^mouse(down|up)$/.test(this.type)?"downCount":"count"]=e},getItem:function(){if(!this._item){var e=this.tool._scope.project.hitTest(this.getPoint());if(e){for(var t=e.item,i=t._parent;/^(Group|CompoundPath)$/.test(i._class);)t=i,i=i._parent;this._item=t}}return this._item},setItem:function(e){this._item=e},toString:function(){return"{ type: "+this.type+", point: "+this.getPoint()+", count: "+this.getCount()+", modifiers: "+this.getModifiers()+" }"}}),se=p.extend({_class:"Tool",_list:"tools",_reference:"tool",_events:["onMouseDown","onMouseUp","onMouseDrag","onMouseMove","onActivate","onDeactivate","onEditOptions","onKeyDown","onKeyUp"],initialize:function(e){p.call(this),this._moveCount=-1,this._downCount=-1,this.set(e)},getMinDistance:function(){return this._minDistance},setMinDistance:function(e){this._minDistance=e,null!=e&&null!=this._maxDistance&&e>this._maxDistance&&(this._maxDistance=e)},getMaxDistance:function(){return this._maxDistance},setMaxDistance:function(e){this._maxDistance=e,null!=this._minDistance&&null!=e&&e<this._minDistance&&(this._minDistance=e)},getFixedDistance:function(){return this._minDistance==this._maxDistance?this._minDistance:null},setFixedDistance:function(e){this._minDistance=this._maxDistance=e},_handleMouseEvent:function(e,t,i,n){de=this._scope,n.drag&&!this.responds(e)&&(e="mousemove");var r=n.move||n.drag,s=this.responds(e),o=this.minDistance,a=this.maxDistance,c=!1,l=this;function h(e,t){var s=i,o=r?l._point:l._downPoint||s;if(r){if(l._moveCount>=0&&s.equals(o))return!1;if(o&&(null!=e||null!=t)){var a=s.subtract(o),c=a.getLength();if(c<(e||0))return!1;t&&(s=o.add(a.normalize(Math.min(c,t))))}l._moveCount++}return l._point=s,l._lastPoint=o||s,n.down&&(l._moveCount=-1,l._downPoint=s,l._downCount++),!0}function u(){s&&(c=l.emit(e,new re(l,e,t))||c)}if(n.down)h(),u();else if(n.up)h(null,a),u();else if(s)for(;h(o,a);)u();return c}}),oe=h.extend(u,{_class:"Tween",statics:{easings:new h({linear:function(e){return e},easeInQuad:function(e){return e*e},easeOutQuad:function(e){return e*(2-e)},easeInOutQuad:function(e){return e<.5?2*e*e:2*(2-e)*e-1},easeInCubic:function(e){return e*e*e},easeOutCubic:function(e){return--e*e*e+1},easeInOutCubic:function(e){return e<.5?4*e*e*e:(e-1)*(2*e-2)*(2*e-2)+1},easeInQuart:function(e){return e*e*e*e},easeOutQuart:function(e){return 1- --e*e*e*e},easeInOutQuart:function(e){return e<.5?8*e*e*e*e:1-8*--e*e*e*e},easeInQuint:function(e){return e*e*e*e*e},easeOutQuint:function(e){return 1+--e*e*e*e*e},easeInOutQuint:function(e){return e<.5?16*e*e*e*e*e:1+16*--e*e*e*e*e}})},initialize:function e(t,i,n,r,s,o){this.object=t;var a=typeof s,c="function"===a;this.type=c?a:"string"===a?s:"linear",this.easing=c?s:e.easings[this.type],this.duration=r,this.running=!1,this._then=null,this._startTime=null;var l=i||n;this._keys=l?Object.keys(l):[],this._parsedKeys=this._parseKeys(this._keys),this._from=l&&this._getState(i),this._to=l&&this._getState(n),!1!==o&&this.start()},then:function(e){return this._then=e,this},start:function(){return this._startTime=null,this.running=!0,this},stop:function(){return this.running=!1,this},update:function(e){if(this.running){e>=1&&(e=1,this.running=!1);for(var t=this.easing(e),i=this._keys,n=function(i){return"function"==typeof i?i(t,e):i},r=0,s=i&&i.length;r<s;r++){var o=i[r],a=n(this._from[o]),c=n(this._to[o]),l=a&&c&&a.__add&&c.__add?c.__subtract(a).__multiply(t).__add(a):(c-a)*t+a;this._setProperty(this._parsedKeys[o],l)}this.responds("update")&&this.emit("update",new h({progress:e,factor:t})),!this.running&&this._then&&this._then(this.object)}return this},_events:{onUpdate:{}},_handleFrame:function(e){var t=this._startTime,i=t?(e-t)/this.duration:0;t||(this._startTime=e),this.update(i)},_getState:function(e){for(var t=this._keys,i={},n=0,r=t.length;n<r;n++){var s,o=t[n],a=this._parsedKeys[o],c=this._getProperty(a);if(e){var l=this._resolveValue(c,e[o]);this._setProperty(a,l),s=(s=this._getProperty(a))&&s.clone?s.clone():s,this._setProperty(a,c)}else s=c&&c.clone?c.clone():c;i[o]=s}return i},_resolveValue:function(e,t){if(t){if(Array.isArray(t)&&2===t.length){var i=t[0];return i&&i.match&&i.match(/^[+\-\*\/]=/)?this._calculate(e,i[0],t[1]):t}if("string"==typeof t){var n=t.match(/^[+\-*/]=(.*)/);if(n){var r=JSON.parse(n[1].replace(/(['"])?([a-zA-Z0-9_]+)(['"])?:/g,'"$2": '));return this._calculate(e,t[0],r)}}}return t},_calculate:function(e,t,i){return de.PaperScript.calculateBinary(e,t,i)},_parseKeys:function(e){for(var t={},i=0,n=e.length;i<n;i++){var r=e[i],s=r.replace(/\.([^.]*)/g,"/$1").replace(/\[['"]?([^'"\]]*)['"]?\]/g,"/$1");t[r]=s.split("/")}return t},_getProperty:function(e,t){for(var i=this.object,n=0,r=e.length-(t||0);n<r&&i;n++)i=i[e[n]];return i},_setProperty:function(e,t){var i=this._getProperty(e,1);i&&(i[e[e.length-1]]=t)}}),ae=function(e){var t=new o.XMLHttpRequest;return t.open((e.method||"get").toUpperCase(),e.url,h.pick(e.async,!0)),e.mimeType&&t.overrideMimeType(e.mimeType),t.onload=function(){var i=t.status;0===i||200===i?e.onLoad&&e.onLoad.call(t,t.responseText):t.onerror()},t.onerror=function(){var i=t.status,n='Could not load "'+e.url+'" (Status: '+i+")";if(!e.onError)throw new Error(n);e.onError(n,i)},t.send(null)},ce=h.exports.CanvasProvider={canvases:[],getCanvas:function(e,t){if(!c)return null;var i,n=!0;"object"==typeof e&&(t=e.height,e=e.width),this.canvases.length?i=this.canvases.pop():(i=l.createElement("canvas"),n=!1);var r=i.getContext("2d");if(!r)throw new Error("Canvas "+i+" is unable to provide a 2D context.");return i.width===e&&i.height===t?n&&r.clearRect(0,0,e+1,t+1):(i.width=e,i.height=t),r.save(),i},getContext:function(e,t){var i=this.getCanvas(e,t);return i?i.getContext("2d"):null},release:function(e){var t=e&&e.canvas?e.canvas:e;t&&t.getContext&&(t.getContext("2d").restore(),this.canvases.push(t))}},le=new function(){var e,t,i,n,r,s,o,a,c,l,u,d=Math.min,p=Math.max,g=Math.abs;function f(e,t,i){return.2989*e+.587*t+.114*i}function m(e,t,i,n){var r=n-f(e,t,i),s=(n=f(c=e+r,l=t+r,u=i+r),d(c,l,u)),o=p(c,l,u);if(s<0){var a=n-s;c=n+(c-n)*n/a,l=n+(l-n)*n/a,u=n+(u-n)*n/a}if(o>255){var h=255-n,g=o-n;c=n+(c-n)*h/g,l=n+(l-n)*h/g,u=n+(u-n)*h/g}}function v(e,t,i){return p(e,t,i)-d(e,t,i)}function y(e,t,i,n){var r,s=[e,t,i],o=p(e,t,i),a=d(e,t,i);r=0===d(a=a===e?0:a===t?1:2,o=o===e?0:o===t?1:2)?1===p(a,o)?2:1:0,s[o]>s[a]?(s[r]=(s[r]-s[a])*n/(s[o]-s[a]),s[o]=n):s[r]=s[o]=0,s[a]=0,c=s[0],l=s[1],u=s[2]}var _={multiply:function(){c=r*e/255,l=s*t/255,u=o*i/255},screen:function(){c=r+e-r*e/255,l=s+t-s*t/255,u=o+i-o*i/255},overlay:function(){c=r<128?2*r*e/255:255-2*(255-r)*(255-e)/255,l=s<128?2*s*t/255:255-2*(255-s)*(255-t)/255,u=o<128?2*o*i/255:255-2*(255-o)*(255-i)/255},"soft-light":function(){var n=e*r/255;c=n+r*(255-(255-r)*(255-e)/255-n)/255,l=(n=t*s/255)+s*(255-(255-s)*(255-t)/255-n)/255,u=(n=i*o/255)+o*(255-(255-o)*(255-i)/255-n)/255},"hard-light":function(){c=e<128?2*e*r/255:255-2*(255-e)*(255-r)/255,l=t<128?2*t*s/255:255-2*(255-t)*(255-s)/255,u=i<128?2*i*o/255:255-2*(255-i)*(255-o)/255},"color-dodge":function(){c=0===r?0:255===e?255:d(255,255*r/(255-e)),l=0===s?0:255===t?255:d(255,255*s/(255-t)),u=0===o?0:255===i?255:d(255,255*o/(255-i))},"color-burn":function(){c=255===r?255:0===e?0:p(0,255-255*(255-r)/e),l=255===s?255:0===t?0:p(0,255-255*(255-s)/t),u=255===o?255:0===i?0:p(0,255-255*(255-o)/i)},darken:function(){c=r<e?r:e,l=s<t?s:t,u=o<i?o:i},lighten:function(){c=r>e?r:e,l=s>t?s:t,u=o>i?o:i},difference:function(){(c=r-e)<0&&(c=-c),(l=s-t)<0&&(l=-l),(u=o-i)<0&&(u=-u)},exclusion:function(){c=r+e*(255-r-r)/255,l=s+t*(255-s-s)/255,u=o+i*(255-o-o)/255},hue:function(){y(e,t,i,v(r,s,o)),m(c,l,u,f(r,s,o))},saturation:function(){y(r,s,o,v(e,t,i)),m(c,l,u,f(r,s,o))},luminosity:function(){m(r,s,o,f(e,t,i))},color:function(){m(e,t,i,f(r,s,o))},add:function(){c=d(r+e,255),l=d(s+t,255),u=d(o+i,255)},subtract:function(){c=p(r-e,0),l=p(s-t,0),u=p(o-i,0)},average:function(){c=(r+e)/2,l=(s+t)/2,u=(o+i)/2},negation:function(){c=255-g(255-e-r),l=255-g(255-t-s),u=255-g(255-i-o)}},S=this.nativeModes=h.each(["source-over","source-in","source-out","source-atop","destination-over","destination-in","destination-out","destination-atop","lighter","darker","copy","xor"],(function(e){this[e]=!0}),{}),b=ce.getContext(1,1);b&&(h.each(_,(function(e,t){var i="darken"===t,n=!1;b.save();try{b.fillStyle=i?"#300":"#a00",b.fillRect(0,0,1,1),b.globalCompositeOperation=t,b.globalCompositeOperation===t&&(b.fillStyle=i?"#a00":"#300",b.fillRect(0,0,1,1),n=b.getImageData(0,0,1,1).data[0]!==i?170:51)}catch(e){}b.restore(),S[t]=n})),ce.release(b)),this.process=function(h,d,p,g,f){var m=d.canvas,v="normal"===h;if(v||S[h])p.save(),p.setTransform(1,0,0,1,0,0),p.globalAlpha=g,v||(p.globalCompositeOperation=h),p.drawImage(m,f.x,f.y),p.restore();else{var y=_[h];if(!y)return;for(var b=p.getImageData(f.x,f.y,m.width,m.height),w=b.data,E=d.getImageData(0,0,m.width,m.height).data,I=0,k=w.length;I<k;I+=4){e=E[I],r=w[I],t=E[I+1],s=w[I+1],i=E[I+2],o=w[I+2],n=E[I+3],a=w[I+3],y();var T=n*g/255,C=1-T;w[I]=T*c+C*r,w[I+1]=T*l+C*s,w[I+2]=T*u+C*o,w[I+3]=n*g+C*a}p.putImageData(b,f.x,f.y)}}},he=new function(){var e="http://www.w3.org/2000/svg",t="http://www.w3.org/2000/xmlns",i="http://www.w3.org/1999/xlink",n={href:i,xlink:t,xmlns:t+"/","xmlns:xlink":t+"/"};function r(e,t,i){for(var r in t){var s=t[r],o=n[r];"number"==typeof s&&i&&(s=i.number(s)),o?e.setAttributeNS(o,r,s):e.setAttribute(r,s)}return e}return{svg:e,xmlns:t,xlink:i,create:function(t,i,n){return r(l.createElementNS(e,t),i,n)},get:function(e,t){var i=n[t],r=i?e.getAttributeNS(i,t):e.getAttribute(t);return"null"===r?null:r},set:r}},ue=h.each({fillColor:["fill","color"],fillRule:["fill-rule","string"],strokeColor:["stroke","color"],strokeWidth:["stroke-width","number"],strokeCap:["stroke-linecap","string"],strokeJoin:["stroke-linejoin","string"],strokeScaling:["vector-effect","lookup",{true:"none",false:"non-scaling-stroke"},function(e,t){return!t&&(e instanceof K||e instanceof O||e instanceof $)}],miterLimit:["stroke-miterlimit","number"],dashArray:["stroke-dasharray","array"],dashOffset:["stroke-dashoffset","number"],fontFamily:["font-family","string"],fontWeight:["font-weight","string"],fontSize:["font-size","number"],justification:["text-anchor","lookup",{left:"start",center:"middle",right:"end"}],opacity:["opacity","number"],blendMode:["mix-blend-mode","style"]},(function(e,t){var i=h.capitalize(t),n=e[2];this[t]={type:e[1],property:t,attribute:e[0],toSVG:n,fromSVG:n&&h.each(n,(function(e,t){this[e]=t}),{}),exportFilter:e[3],get:"get"+i,set:"set"+i}}),{});new function(){var e;function t(t,i,n){var r,s=new h,o=t.getTranslation();if(i&&(t.isInvertible()?(r=(t=t._shiftless())._inverseTransform(o),o=null):r=new y,s[n?"cx":"x"]=r.x,s[n?"cy":"y"]=r.y),!t.isIdentity()){var a=t.decompose();if(a){var c=[],l=a.rotation,u=a.scaling,d=a.skewing;o&&!o.isZero()&&c.push("translate("+e.point(o)+")"),l&&c.push("rotate("+e.number(l)+")"),m.isZero(u.x-1)&&m.isZero(u.y-1)||c.push("scale("+e.point(u)+")"),d.x&&c.push("skewX("+e.number(d.x)+")"),d.y&&c.push("skewY("+e.number(d.y)+")"),s.transform=c.join(" ")}else s.transform="matrix("+t.getValues().join(",")+")"}return s}function i(i,n){for(var r=t(i._matrix),s=i._children,o=he.create("g",r,e),a=0,l=s.length;a<l;a++){var h=s[a],d=u(h,n);if(d)if(h.isClipMask()){var p=he.create("clipPath");p.appendChild(d),c(h,p,"clip"),he.set(o,{"clip-path":"url(#"+p.id+")"})}else o.appendChild(d)}return o}function n(i){var n=i._type,r=i._radius,s=t(i._matrix,!0,"rectangle"!==n);if("rectangle"===n){n="rect";var o=i._size,a=o.width,c=o.height;s.x-=a/2,s.y-=c/2,s.width=a,s.height=c,r.isZero()&&(r=null)}return r&&("circle"===n?s.r=r:(s.rx=r.width,s.ry=r.height)),he.create(n,s,e)}var r,s={Group:i,Layer:i,Raster:function(i,n){var r=t(i._matrix,!0),s=i.getSize(),o=i.getImage();return r.x-=s.width/2,r.y-=s.height/2,r.width=s.width,r.height=s.height,r.href=0==n.embedImages&&o&&o.src||i.toDataURL(),he.create("image",r,e)},Path:function(i,r){var s=r.matchShapes;if(s){var o=i.toShape(!1);if(o)return n(o)}var a,c=i._segments,l=c.length,h=t(i._matrix);if(s&&l>=2&&!i.hasHandles())if(l>2){a=i._closed?"polygon":"polyline";for(var u=[],d=0;d<l;d++)u.push(e.point(c[d]._point));h.points=u.join(" ")}else{a="line";var p=c[0]._point,g=c[1]._point;h.set({x1:p.x,y1:p.y,x2:g.x,y2:g.y})}else a="path",h.d=i.getPathData(null,r.precision);return he.create(a,h,e)},Shape:n,CompoundPath:function(i,n){var r=t(i._matrix),s=i.getPathData(null,n.precision);return s&&(r.d=s),he.create("path",r,e)},SymbolItem:function(i,n){var r=t(i._matrix,!0),s=i._definition,o=a(s,"symbol"),l=s._item,h=l.getStrokeBounds();return o||((o=he.create("symbol",{viewBox:e.rectangle(h)})).appendChild(u(l,n)),c(s,o,"symbol")),r.href="#"+o.id,r.x+=h.x,r.y+=h.y,r.width=h.width,r.height=h.height,r.overflow="visible",he.create("use",r,e)},PointText:function(i){var n=he.create("text",t(i._matrix,!0),e);return n.textContent=i._content,n}};function a(e,t){return r||(r={ids:{},svgs:{}}),e&&r.svgs[t+"-"+(e._id||e.__id||(e.__id=v.get("svg")))]}function c(e,t,i){r||a();var n=r.ids[i]=(r.ids[i]||0)+1;t.id=i+"-"+n,r.svgs[i+"-"+(e._id||e.__id)]=t}function l(e,t){var i=e,n=null;if(r){for(var s in i="svg"===e.nodeName.toLowerCase()&&e,r.svgs)n||(i||(i=he.create("svg")).appendChild(e),n=i.insertBefore(he.create("defs"),i.firstChild)),n.appendChild(r.svgs[s]);r=null}return t.asString?(new o.XMLSerializer).serializeToString(i):i}function u(t,i,n){var r=s[t._class],o=r&&r(t,i);if(o){var l=i.onExport;l&&(o=l(t,o,i)||o);var u=JSON.stringify(t._data);u&&"{}"!==u&&"null"!==u&&o.setAttribute("data-paper-data",u)}return o&&function(t,i,n){var r={},s=!n&&t.getParent(),o=[];return null!=t._name&&(r.id=t._name),h.each(ue,(function(i){var n=i.get,l=i.type,u=t[n]();if(i.exportFilter?i.exportFilter(t,u):!s||!h.equals(s[n](),u)){if("color"===l&&null!=u){var d=u.getAlpha();d<1&&(r[i.attribute+"-opacity"]=d)}"style"===l?o.push(i.attribute+": "+u):r[i.attribute]=null==u?"none":"color"===l?u.gradient?function(t){var i=a(t,"color");if(!i){var n,r=t.getGradient(),s=r._radial,o=t.getOrigin(),l=t.getDestination();if(s){n={cx:o.x,cy:o.y,r:o.getDistance(l)};var h=t.getHighlight();h&&(n.fx=h.x,n.fy=h.y)}else n={x1:o.x,y1:o.y,x2:l.x,y2:l.y};n.gradientUnits="userSpaceOnUse",i=he.create((s?"radial":"linear")+"Gradient",n,e);for(var u=r._stops,d=0,p=u.length;d<p;d++){var g=u[d],f=g._color,m=f.getAlpha(),v=g._offset;n={offset:null==v?d/(p-1):v},f&&(n["stop-color"]=f.toCSS(!0)),m<1&&(n["stop-opacity"]=m),i.appendChild(he.create("stop",n,e))}c(t,i,"color")}return"url(#"+i.id+")"}(u):u.toCSS(!0):"array"===l?u.join(","):"lookup"===l?i.toSVG[u]:u}})),o.length&&(r.style=o.join(";")),1===r.opacity&&delete r.opacity,t._visible||(r.visibility="hidden"),he.set(i,r,e)}(t,o,n)}function d(t){return t||(t={}),e=new f(t.precision),t}C.inject({exportSVG:function(e){return l(u(this,e=d(e),!0),e)}}),T.inject({exportSVG:function(i){i=d(i);var n=this._children,r=this.getView(),s=h.pick(i.bounds,"view"),o=i.matrix||"view"===s&&r._matrix,a=o&&I.read([o]),c="view"===s?new w([0,0],r.getViewSize()):"content"===s?C._getBounds(n,a,{stroke:!0}).rect:w.read([s],0,{readNull:!0}),p={version:"1.1",xmlns:he.svg,"xmlns:xlink":he.xlink};c&&(p.width=c.width,p.height=c.height,(c.x||0===c.x||c.y||0===c.y)&&(p.viewBox=e.rectangle(c)));var g=he.create("svg",p,e),f=g;a&&!a.isIdentity()&&(f=g.appendChild(he.create("g",t(a),e)));for(var m=0,v=n.length;m<v;m++)f.appendChild(u(n[m],i,!0));return l(g,i)}})},new function(){var e,t={};function i(t,i,n,r,s,o){var a=he.get(t,i)||o,c=null==a?r?null:n?"":0:n?a:parseFloat(a);return/%\s*$/.test(a)?c/100*(s?1:e[/x|^width/.test(i)?"width":"height"]):c}function n(e,t,n,r,s,o,a){return t=i(e,t||"x",!1,r,s,o),n=i(e,n||"y",!1,r,s,a),!r||null!=t&&null!=n?new y(t,n):null}function r(e,t,n,r,s){return t=i(e,t||"width",!1,r,s),n=i(e,n||"height",!1,r,s),!r||null!=t&&null!=n?new S(t,n):null}function s(e,t,i){return"none"===e?null:"number"===t?parseFloat(e):"array"===t?e?e.split(/[\s,]+/g).map(parseFloat):[]:"color"===t?E(e)||e:"lookup"===t?i[e]:e}function u(e,t,i,n){var r=e.childNodes,s="clippath"===t,o="defs"===t,a=new x,c=a._project,l=c._currentStyle,h=[];if(s||o||(a=b(a,e,n),c._currentStyle=a._style.clone()),n)for(var u=e.querySelectorAll("defs"),d=0,p=u.length;d<p;d++)k(u[d],i,!1);for(d=0,p=r.length;d<p;d++){var g,f=r[d];1!==f.nodeType||/^defs$/i.test(f.nodeName)||!(g=k(f,i,!1))||g instanceof D||h.push(g)}return a.addChildren(h),s&&(a=b(a.reduce(),e,n)),c._currentStyle=l,(s||o)&&(a.remove(),a=null),a}function d(e,t){for(var i=e.getAttribute("points").match(/[+-]?(?:\d*\.\d+|\d+\.?)(?:[eE][+-]?\d+)?/g),n=[],r=0,s=i.length;r<s;r+=2)n.push(new y(parseFloat(i[r]),parseFloat(i[r+1])));var o=new j(n);return"polygon"===t&&o.closePath(),o}function p(e,r){var s,o=(i(e,"href",!0)||"").substring(1),a="radialgradient"===r;if(o)(s=t[o].getGradient())._radial^a&&((s=s.clone())._radial=a);else{for(var c=e.childNodes,l=[],h=0,u=c.length;h<u;h++){var d=c[h];1===d.nodeType&&l.push(b(new W,d))}s=new z(l,a)}var p,g,f,m="userSpaceOnUse"!==i(e,"gradientUnits",!0);return a?(g=(p=n(e,"cx","cy",!1,m,"50%","50%")).add(i(e,"r",!1,!1,m,"50%"),0),f=n(e,"fx","fy",!0,m)):(p=n(e,"x1","y1",!1,m,"0%","0%"),g=n(e,"x2","y2",!1,m,"100%","0%")),b(new H(s,p,g,f),e)._scaleToBounds=m,null}var g={"#document":function(e,t,i,n){for(var r=e.childNodes,s=0,o=r.length;s<o;s++){var a=r[s];if(1===a.nodeType)return k(a,i,n)}},g:u,svg:u,clippath:u,polygon:d,polyline:d,path:function(e){return K.create(e.getAttribute("d"))},lineargradient:p,radialgradient:p,image:function(e){var t=new A(i(e,"href",!0));return t.on("load",(function(){var t=r(e);this.setSize(t);var i=n(e).add(t.divide(2));this._matrix.append((new I).translate(i))})),t},symbol:function(e,t,i,n){return new D(u(e,t,i,n),!0)},defs:u,use:function(e){var r=(i(e,"href",!0)||"").substring(1),s=t[r],o=n(e);return s?s instanceof D?s.place(o):s.clone().translate(o):null},circle:function(e){return new O.Circle(n(e,"cx","cy"),i(e,"r"))},ellipse:function(e){return new O.Ellipse({center:n(e,"cx","cy"),radius:r(e,"rx","ry")})},rect:function(e){return new O.Rectangle(new w(n(e),r(e)),r(e,"rx","ry"))},line:function(e){return new j.Line(n(e,"x1","y1"),n(e,"x2","y2"))},text:function(e){var t=new G(n(e).add(n(e,"dx","dy")));return t.setContent(e.textContent.trim()||""),t},switch:u};function f(e,t,i,n){if(e.transform){for(var r=(n.getAttribute(i)||"").split(/\)\s*/g),s=new I,o=0,a=r.length;o<a;o++){var c=r[o];if(!c)break;for(var l=c.split(/\(\s*/),h=l[0],u=l[1].split(/[\s,]+/g),d=0,p=u.length;d<p;d++)u[d]=parseFloat(u[d]);switch(h){case"matrix":s.append(new I(u[0],u[1],u[2],u[3],u[4],u[5]));break;case"rotate":s.rotate(u[0],u[1]||0,u[2]||0);break;case"translate":s.translate(u[0],u[1]||0);break;case"scale":s.scale(u);break;case"skewX":s.skew(u[0],0);break;case"skewY":s.skew(0,u[0])}}e.transform(s)}}function m(e,t,i){var n="fill-opacity"===i?"getFillColor":"getStrokeColor",r=e[n]&&e[n]();r&&r.setAlpha(parseFloat(t))}var v=h.set(h.each(ue,(function(e){this[e.attribute]=function(t,i){if(t[e.set]&&(t[e.set](s(i,e.type,e.fromSVG)),"color"===e.type)){var n=t[e.get]();if(n&&n._scaleToBounds){var r=t.getBounds();n.transform((new I).translate(r.getPoint()).scale(r.getSize()))}}}}),{}),{id:function(e,i){t[i]=e,e.setName&&e.setName(i)},"clip-path":function(e,t){var i=E(t);if(i){if((i=i.clone()).setClipMask(!0),!(e instanceof x))return new x(i,e);e.insertChild(0,i)}},gradientTransform:f,transform:f,"fill-opacity":m,"stroke-opacity":m,visibility:function(e,t){e.setVisible&&e.setVisible("visible"===t)},display:function(e,t){e.setVisible&&e.setVisible(null!==t)},"stop-color":function(e,t){e.setColor&&e.setColor(t)},"stop-opacity":function(e,t){e._color&&e._color.setAlpha(parseFloat(t))},offset:function(e,t){if(e.setOffset){var i=t.match(/(.*)%$/);e.setOffset(i?i[1]/100:parseFloat(t))}},viewBox:function(e,t,i,n,o){var a,c=new w(s(t,"array")),l=r(n,null,null,!0);if(e instanceof x){var h=l?l.divide(c.getSize()):1,u=(new I).scale(h).translate(c.getPoint().negate());a=e}else e instanceof D&&(l&&c.setSize(l),a=e._item);if(a){if("visible"!==_(n,"overflow",o)){var d=new O.Rectangle(c);d.setClipMask(!0),a.addChild(d)}u&&a.transform(u)}}});function _(e,t,i){var n=e.attributes[t],r=n&&n.value;if(!r&&e.style){var s=h.camelize(t);(r=e.style[s])||i.node[s]===i.parent[s]||(r=i.node[s])}return r?"none"===r?null:r:a}function b(e,t,i){var n=t.parentNode,r={node:J.getStyles(t)||{},parent:!i&&!/^defs$/i.test(n.tagName)&&J.getStyles(n)||{}};return h.each(v,(function(i,n){var s=_(t,n,r);e=s!==a&&i(e,s,n,t,r)||e})),e}function E(e){var i=e&&e.match(/\((?:["'#]*)([^"')]+)/),n=i&&i[1],r=n&&t[c?n.replace(c.location.href.split("#")[0]+"#",""):n];return r&&r._scaleToBounds&&((r=r.clone())._scaleToBounds=!0),r}function k(i,n,s){var o,a,c,u=i.nodeName.toLowerCase(),d="#document"!==u,p=l.body;s&&d&&(e=de.getView().getSize(),e=r(i,null,null,!0)||e,o=he.create("svg",{style:"stroke-width: 1px; stroke-miterlimit: 10"}),a=i.parentNode,c=i.nextSibling,o.appendChild(i),p.appendChild(o));var f=de.settings,m=f.applyMatrix,v=f.insertItems;f.applyMatrix=!1,f.insertItems=!1;var y=g[u],_=y&&y(i,u,n,s)||null;if(f.insertItems=v,f.applyMatrix=m,_){!d||_ instanceof x||(_=b(_,i,s));var S=n.onImport,w=d&&i.getAttribute("data-paper-data");S&&(_=S(i,_,n)||_),n.expandShapes&&_ instanceof O&&(_.remove(),_=_.toPath()),w&&(_._data=JSON.parse(w))}return o&&(p.removeChild(o),a&&(c?a.insertBefore(i,c):a.appendChild(i))),s&&(t={},_&&h.pick(n.applyMatrix,m)&&_.matrix.apply(!0,!0)),_}function R(e,t,i){if(!e)return null;t="function"==typeof t?{onLoad:t}:t||{};var n=de,r=null;function s(s){try{var l="object"==typeof s?s:(new o.DOMParser).parseFromString(s.trim(),"image/svg+xml");if(!l.nodeName)throw l=null,new Error("Unsupported SVG source: "+e);de=n,r=k(l,t,!0),t&&!1===t.insert||i._insertItem(a,r);var h=t.onLoad;h&&h(r,s)}catch(e){c(e)}}function c(e,i){var n=t.onError;if(!n)throw new Error(e);n(e,i)}if("string"!=typeof e||/^[\s\S]*</.test(e)){if("undefined"!=typeof File&&e instanceof File){var h=new FileReader;return h.onload=function(){s(h.result)},h.onerror=function(){c(h.error)},h.readAsText(e)}s(e)}else{var u=l.getElementById(e);u?s(u):ae({url:e,async:!0,onLoad:s,onError:c})}return r}C.inject({importSVG:function(e,t){return R(e,t,this)}}),T.inject({importSVG:function(e,t){return this.activate(),R(e,t,this)}})},h.exports.PaperScript=function(){var e,t,u,p=this,g=p.acorn;if(!g)try{g=i(1234)}catch(e){}function f(e,t){return(p.acorn||g).parse(e,t)}g||(g=e=t={},u=function(e){"use strict";var t,i,n,r;e.version="0.5.0",e.parse=function(e,r){return i=String(e),n=i.length,o(r),He(),function(e){v=y=a,t.locations&&(_=new Ge),S=w=null,b=[],Qe();var i=e||lt(),n=!0;for(e||(i.body=[]);d!==O;){var r=bt();i.body.push(r),n&&dt(r)&&ot(!0),n=!1}return ut(i,"Program")}(t.program)};var s=e.defaultOptions={ecmaVersion:5,strictSemicolons:!1,allowTrailingCommas:!0,forbidReserved:!1,allowReturnOutsideFunction:!1,locations:!1,onComment:null,ranges:!1,program:null,sourceFile:null,directSourceFile:null};function o(e){for(var i in t=e||{},s)Object.prototype.hasOwnProperty.call(t,i)||(t[i]=s[i]);r=t.sourceFile||null}var a,c,l,h,u,d,p,g,f,m,v,y,_,S,b,w,E=e.getLineInfo=function(e,t){for(var i=1,n=0;;){qe.lastIndex=n;var r=qe.exec(e);if(!(r&&r.index<t))break;++i,n=r.index+r[0].length}return{line:i,column:t-n}};function I(e,t){var n=E(i,e);t+=" ("+n.line+":"+n.column+")";var r=new SyntaxError(t);throw r.pos=e,r.loc=n,r.raisedAt=a,r}e.tokenize=function(e,r){i=String(e),n=i.length,o(r),He();var s={};function v(e){return y=l,Qe(e),s.start=c,s.end=l,s.startLoc=h,s.endLoc=u,s.type=d,s.value=p,s}return v.jumpTo=function(e,n){var r;if(a=e,t.locations)for(f=1,m=qe.lastIndex=0;(r=qe.exec(i))&&r.index<e;)++f,m=r.index+r[0].length;g=n,Je()},v};var k=[],T={type:"num"},C={type:"regexp"},x={type:"string"},R={type:"name"},O={type:"eof"},A={keyword:"break"},P={keyword:"case",beforeExpr:!0},D={keyword:"catch"},M={keyword:"continue"},N={keyword:"debugger"},B={keyword:"default"},U={keyword:"do",isLoop:!0},L={keyword:"else",beforeExpr:!0},K={keyword:"finally"},j={keyword:"for",isLoop:!0},F={keyword:"function"},q={keyword:"if"},V={keyword:"return",beforeExpr:!0},$={keyword:"switch"},G={keyword:"throw",beforeExpr:!0},H={keyword:"try"},z={keyword:"var"},W={keyword:"while",isLoop:!0},Y={keyword:"with"},J={keyword:"new",beforeExpr:!0},Q={keyword:"this"},X={keyword:"null",atomValue:null},Z={keyword:"true",atomValue:!0},ee={keyword:"false",atomValue:!1},te={keyword:"in",binop:7,beforeExpr:!0},ie={break:A,case:P,catch:D,continue:M,debugger:N,default:B,do:U,else:L,finally:K,for:j,function:F,if:q,return:V,switch:$,throw:G,try:H,var:z,while:W,with:Y,null:X,true:Z,false:ee,new:J,in:te,instanceof:{keyword:"instanceof",binop:7,beforeExpr:!0},this:Q,typeof:{keyword:"typeof",prefix:!0,beforeExpr:!0},void:{keyword:"void",prefix:!0,beforeExpr:!0},delete:{keyword:"delete",prefix:!0,beforeExpr:!0}},ne={type:"[",beforeExpr:!0},re={type:"]"},se={type:"{",beforeExpr:!0},oe={type:"}"},ae={type:"(",beforeExpr:!0},ce={type:")"},le={type:",",beforeExpr:!0},he={type:";",beforeExpr:!0},ue={type:":",beforeExpr:!0},de={type:"."},pe={type:"?",beforeExpr:!0},ge={binop:10,beforeExpr:!0},fe={isAssign:!0,beforeExpr:!0},me={isAssign:!0,beforeExpr:!0},ve={postfix:!0,prefix:!0,isUpdate:!0},ye={prefix:!0,beforeExpr:!0},_e={binop:1,beforeExpr:!0},Se={binop:2,beforeExpr:!0},be={binop:3,beforeExpr:!0},we={binop:4,beforeExpr:!0},Ee={binop:5,beforeExpr:!0},Ie={binop:6,beforeExpr:!0},ke={binop:7,beforeExpr:!0},Te={binop:8,beforeExpr:!0},Ce={binop:9,prefix:!0,beforeExpr:!0},xe={binop:10,beforeExpr:!0};for(var Re in e.tokTypes={bracketL:ne,bracketR:re,braceL:se,braceR:oe,parenL:ae,parenR:ce,comma:le,semi:he,colon:ue,dot:de,question:pe,slash:ge,eq:fe,name:R,eof:O,num:T,regexp:C,string:x},ie)e.tokTypes["_"+Re]=ie[Re];function Oe(e){e=e.split(" ");var t="",i=[];e:for(var n=0;n<e.length;++n){for(var r=0;r<i.length;++r)if(i[r][0].length==e[n].length){i[r].push(e[n]);continue e}i.push([e[n]])}function s(e){if(1==e.length)return t+="return str === "+JSON.stringify(e[0])+";";t+="switch(str){";for(var i=0;i<e.length;++i)t+="case "+JSON.stringify(e[i])+":";t+="return true}return false;"}if(i.length>3){for(i.sort((function(e,t){return t.length-e.length})),t+="switch(str.length){",n=0;n<i.length;++n){var o=i[n];t+="case "+o[0].length+":",s(o)}t+="}"}else s(e);return new Function("str",t)}var Ae,Pe=Oe("abstract boolean byte char class double enum export extends final float goto implements import int interface long native package private protected public short static super synchronized throws transient volatile"),De=Oe("class enum extends super const export import"),Me=Oe("implements interface let package private protected public static yield"),Ne=Oe("eval arguments"),Be=Oe("break case catch continue debugger default do else finally for function if return switch throw try var while with null true false instanceof typeof void delete new in this"),Ue=/[\u1680\u180e\u2000-\u200a\u202f\u205f\u3000\ufeff]/,Le="ªµºÀ-ÖØ-öø-ˁˆ-ˑˠ-ˤˬˮͰ-ʹͶͷͺ-ͽΆΈ-ΊΌΎ-ΡΣ-ϵϷ-ҁҊ-ԧԱ-Ֆՙա-ևא-תװ-ײؠ-يٮٯٱ-ۓەۥۦۮۯۺ-ۼۿܐܒ-ܯݍ-ޥޱߊ-ߪߴߵߺࠀ-ࠕࠚࠤࠨࡀ-ࡘࢠࢢ-ࢬऄ-हऽॐक़-ॡॱ-ॷॹ-ॿঅ-ঌএঐও-নপ-রলশ-হঽৎড়ঢ়য়-ৡৰৱਅ-ਊਏਐਓ-ਨਪ-ਰਲਲ਼ਵਸ਼ਸਹਖ਼-ੜਫ਼ੲ-ੴઅ-ઍએ-ઑઓ-નપ-રલળવ-હઽૐૠૡଅ-ଌଏଐଓ-ନପ-ରଲଳଵ-ହଽଡ଼ଢ଼ୟ-ୡୱஃஅ-ஊஎ-ஐஒ-கஙசஜஞடணதந-பம-ஹௐఅ-ఌఎ-ఐఒ-నప-ళవ-హఽౘౙౠౡಅ-ಌಎ-ಐಒ-ನಪ-ಳವ-ಹಽೞೠೡೱೲഅ-ഌഎ-ഐഒ-ഺഽൎൠൡൺ-ൿඅ-ඖක-නඳ-රලව-ෆก-ะาำเ-ๆກຂຄງຈຊຍດ-ທນ-ຟມ-ຣລວສຫອ-ະາຳຽເ-ໄໆໜ-ໟༀཀ-ཇཉ-ཬྈ-ྌက-ဪဿၐ-ၕၚ-ၝၡၥၦၮ-ၰၵ-ႁႎႠ-ჅჇჍა-ჺჼ-ቈቊ-ቍቐ-ቖቘቚ-ቝበ-ኈኊ-ኍነ-ኰኲ-ኵኸ-ኾዀዂ-ዅወ-ዖዘ-ጐጒ-ጕጘ-ፚᎀ-ᎏᎠ-Ᏼᐁ-ᙬᙯ-ᙿᚁ-ᚚᚠ-ᛪᛮ-ᛰᜀ-ᜌᜎ-ᜑᜠ-ᜱᝀ-ᝑᝠ-ᝬᝮ-ᝰក-ឳៗៜᠠ-ᡷᢀ-ᢨᢪᢰ-ᣵᤀ-ᤜᥐ-ᥭᥰ-ᥴᦀ-ᦫᧁ-ᧇᨀ-ᨖᨠ-ᩔᪧᬅ-ᬳᭅ-ᭋᮃ-ᮠᮮᮯᮺ-ᯥᰀ-ᰣᱍ-ᱏᱚ-ᱽᳩ-ᳬᳮ-ᳱᳵᳶᴀ-ᶿḀ-ἕἘ-Ἕἠ-ὅὈ-Ὅὐ-ὗὙὛὝὟ-ώᾀ-ᾴᾶ-ᾼιῂ-ῄῆ-ῌῐ-ΐῖ-Ίῠ-Ῥῲ-ῴῶ-ῼⁱⁿₐ-ₜℂℇℊ-ℓℕℙ-ℝℤΩℨK-ℭℯ-ℹℼ-ℿⅅ-ⅉⅎⅠ-ↈⰀ-Ⱞⰰ-ⱞⱠ-ⳤⳫ-ⳮⳲⳳⴀ-ⴥⴧⴭⴰ-ⵧⵯⶀ-ⶖⶠ-ⶦⶨ-ⶮⶰ-ⶶⶸ-ⶾⷀ-ⷆⷈ-ⷎⷐ-ⷖⷘ-ⷞⸯ々-〇〡-〩〱-〵〸-〼ぁ-ゖゝ-ゟァ-ヺー-ヿㄅ-ㄭㄱ-ㆎㆠ-ㆺㇰ-ㇿ㐀-䶵一-鿌ꀀ-ꒌꓐ-ꓽꔀ-ꘌꘐ-ꘟꘪꘫꙀ-ꙮꙿ-ꚗꚠ-ꛯꜗ-ꜟꜢ-ꞈꞋ-ꞎꞐ-ꞓꞠ-Ɦꟸ-ꠁꠃ-ꠅꠇ-ꠊꠌ-ꠢꡀ-ꡳꢂ-ꢳꣲ-ꣷꣻꤊ-ꤥꤰ-ꥆꥠ-ꥼꦄ-ꦲꧏꨀ-ꨨꩀ-ꩂꩄ-ꩋꩠ-ꩶꩺꪀ-ꪯꪱꪵꪶꪹ-ꪽꫀꫂꫛ-ꫝꫠ-ꫪꫲ-ꫴꬁ-ꬆꬉ-ꬎꬑ-ꬖꬠ-ꬦꬨ-ꬮꯀ-ꯢ가-힣ힰ-ퟆퟋ-ퟻ豈-舘並-龎ﬀ-ﬆﬓ-ﬗיִײַ-ﬨשׁ-זּטּ-לּמּנּסּףּפּצּ-ﮱﯓ-ﴽﵐ-ﶏﶒ-ﷇﷰ-ﷻﹰ-ﹴﹶ-ﻼＡ-Ｚａ-ｚｦ-ﾾￂ-ￇￊ-ￏￒ-ￗￚ-ￜ",Ke=new RegExp("["+Le+"]"),je=new RegExp("["+Le+"̀-ͯ҃-֑҇-ׇֽֿׁׂׅׄؐ-ؚؠ-ىٲ-ۓۧ-ۨۻ-ۼܰ-݊ࠀ-ࠔࠛ-ࠣࠥ-ࠧࠩ-࠭ࡀ-ࡗࣤ-ࣾऀ-ःऺ-़ा-ॏ॑-ॗॢ-ॣ०-९ঁ-ঃ়া-ৄেৈৗয়-ৠਁ-ਃ਼ਾ-ੂੇੈੋ-੍ੑ੦-ੱੵઁ-ઃ઼ા-ૅે-ૉો-્ૢ-ૣ૦-૯ଁ-ଃ଼ା-ୄେୈୋ-୍ୖୗୟ-ୠ୦-୯ஂா-ூெ-ைொ-்ௗ௦-௯ఁ-ఃె-ైొ-్ౕౖౢ-ౣ౦-౯ಂಃ಼ಾ-ೄೆ-ೈೊ-್ೕೖೢ-ೣ೦-೯ംഃെ-ൈൗൢ-ൣ൦-൯ංඃ්ා-ුූෘ-ෟෲෳิ-ฺเ-ๅ๐-๙ິ-ູ່-ໍ໐-໙༘༙༠-༩༹༵༷ཁ-ཇཱ-྄྆-྇ྍ-ྗྙ-ྼ࿆က-ဩ၀-၉ၧ-ၭၱ-ၴႂ-ႍႏ-ႝ፝-፟ᜎ-ᜐᜠ-ᜰᝀ-ᝐᝲᝳក-ឲ៝០-៩᠋-᠍᠐-᠙ᤠ-ᤫᤰ-᤻ᥑ-ᥭᦰ-ᧀᧈ-ᧉ᧐-᧙ᨀ-ᨕᨠ-ᩓ᩠-᩿᩼-᪉᪐-᪙ᭆ-ᭋ᭐-᭙᭫-᭳᮰-᮹᯦-᯳ᰀ-ᰢ᱀-᱉ᱛ-ᱽ᳐-᳒ᴀ-ᶾḁ-ἕ‌‍‿⁀⁔⃐-⃥⃜⃡-⃰ⶁ-ⶖⷠ-ⷿ〡-〨゙゚Ꙁ-ꙭꙴ-꙽ꚟ꛰-꛱ꟸ-ꠀ꠆ꠋꠣ-ꠧꢀ-ꢁꢴ-꣄꣐-꣙ꣳ-ꣷ꤀-꤉ꤦ-꤭ꤰ-ꥅꦀ-ꦃ꦳-꧀ꨀ-ꨧꩀ-ꩁꩌ-ꩍ꩐-꩙ꩻꫠ-ꫩꫲ-ꫳꯀ-ꯡ꯬꯭꯰-꯹ﬠ-ﬨ︀-️︠-︦︳︴﹍-﹏０-９＿]"),Fe=/[\n\r\u2028\u2029]/,qe=/\r\n|[\n\r\u2028\u2029]/g,Ve=e.isIdentifierStart=function(e){return e<65?36===e:e<91||(e<97?95===e:e<123||e>=170&&Ke.test(String.fromCharCode(e)))},$e=e.isIdentifierChar=function(e){return e<48?36===e:e<58||!(e<65)&&(e<91||(e<97?95===e:e<123||e>=170&&je.test(String.fromCharCode(e))))};function Ge(){this.line=f,this.column=a-m}function He(){f=1,a=m=0,g=!0,Je()}function ze(e,i){l=a,t.locations&&(u=new Ge),d=e,Je(),p=i,g=e.beforeExpr}function We(){var e,n=t.onComment&&t.locations&&new Ge,r=a,s=i.indexOf("*/",a+=2);if(-1===s&&I(a-2,"Unterminated comment"),a=s+2,t.locations)for(qe.lastIndex=r;(e=qe.exec(i))&&e.index<a;)++f,m=e.index+e[0].length;t.onComment&&t.onComment(!0,i.slice(r+2,s),r,a,n,t.locations&&new Ge)}function Ye(){for(var e=a,r=t.onComment&&t.locations&&new Ge,s=i.charCodeAt(a+=2);a<n&&10!==s&&13!==s&&8232!==s&&8233!==s;)++a,s=i.charCodeAt(a);t.onComment&&t.onComment(!1,i.slice(e+2,a),e,a,r,t.locations&&new Ge)}function Je(){for(;a<n;){var e=i.charCodeAt(a);if(32===e)++a;else if(13===e)++a,10===(r=i.charCodeAt(a))&&++a,t.locations&&(++f,m=a);else if(10===e||8232===e||8233===e)++a,t.locations&&(++f,m=a);else if(e>8&&e<14)++a;else if(47===e){var r;if(42===(r=i.charCodeAt(a+1)))We();else{if(47!==r)break;Ye()}}else if(160===e)++a;else{if(!(e>=5760&&Ue.test(String.fromCharCode(e))))break;++a}}}function Qe(e){if(e?a=c+1:c=a,t.locations&&(h=new Ge),e)return Ze();if(a>=n)return ze(O);var r=i.charCodeAt(a);if(Ve(r)||92===r)return rt();var s=function(e){switch(e){case 46:return function(){var e=i.charCodeAt(a+1);return e>=48&&e<=57?tt(!0):(++a,ze(de))}();case 40:return++a,ze(ae);case 41:return++a,ze(ce);case 59:return++a,ze(he);case 44:return++a,ze(le);case 91:return++a,ze(ne);case 93:return++a,ze(re);case 123:return++a,ze(se);case 125:return++a,ze(oe);case 58:return++a,ze(ue);case 63:return++a,ze(pe);case 48:var r=i.charCodeAt(a+1);if(120===r||88===r)return function(){a+=2;var e=et(16);return null==e&&I(c+2,"Expected hexadecimal number"),Ve(i.charCodeAt(a))&&I(a,"Identifier directly after number"),ze(T,e)}();case 49:case 50:case 51:case 52:case 53:case 54:case 55:case 56:case 57:return tt(!1);case 34:case 39:return function(e){a++;for(var r="";;){a>=n&&I(c,"Unterminated string constant");var s=i.charCodeAt(a);if(s===e)return++a,ze(x,r);if(92===s){s=i.charCodeAt(++a);var o=/^[0-7]+/.exec(i.slice(a,a+3));for(o&&(o=o[0]);o&&parseInt(o,8)>255;)o=o.slice(0,-1);if("0"===o&&(o=null),++a,o)w&&I(a-2,"Octal literal in strict mode"),r+=String.fromCharCode(parseInt(o,8)),a+=o.length-1;else switch(s){case 110:r+="\n";break;case 114:r+="\r";break;case 120:r+=String.fromCharCode(it(2));break;case 117:r+=String.fromCharCode(it(4));break;case 85:r+=String.fromCharCode(it(8));break;case 116:r+="\t";break;case 98:r+="\b";break;case 118:r+="\v";break;case 102:r+="\f";break;case 48:r+="\0";break;case 13:10===i.charCodeAt(a)&&++a;case 10:t.locations&&(m=a,++f);break;default:r+=String.fromCharCode(s)}}else 13!==s&&10!==s&&8232!==s&&8233!==s||I(c,"Unterminated string constant"),r+=String.fromCharCode(s),++a}}(e);case 47:return function(){var e=i.charCodeAt(a+1);return g?(++a,Ze()):61===e?Xe(me,2):Xe(ge,1)}();case 37:case 42:return 61===i.charCodeAt(a+1)?Xe(me,2):Xe(xe,1);case 124:case 38:return function(e){var t=i.charCodeAt(a+1);return t===e?Xe(124===e?_e:Se,2):61===t?Xe(me,2):Xe(124===e?be:Ee,1)}(e);case 94:return 61===i.charCodeAt(a+1)?Xe(me,2):Xe(we,1);case 43:case 45:return function(e){var t=i.charCodeAt(a+1);return t===e?45==t&&62==i.charCodeAt(a+2)&&Fe.test(i.slice(y,a))?(a+=3,Ye(),Je(),Qe()):Xe(ve,2):61===t?Xe(me,2):Xe(Ce,1)}(e);case 60:case 62:return function(e){var t=i.charCodeAt(a+1),n=1;return t===e?(n=62===e&&62===i.charCodeAt(a+2)?3:2,61===i.charCodeAt(a+n)?Xe(me,n+1):Xe(Te,n)):33==t&&60==e&&45==i.charCodeAt(a+2)&&45==i.charCodeAt(a+3)?(a+=4,Ye(),Je(),Qe()):(61===t&&(n=61===i.charCodeAt(a+2)?3:2),Xe(ke,n))}(e);case 61:case 33:return function(e){return 61===i.charCodeAt(a+1)?Xe(Ie,61===i.charCodeAt(a+2)?3:2):Xe(61===e?fe:ye,1)}(e);case 126:return Xe(ye,1)}return!1}(r);if(!1===s){var o=String.fromCharCode(r);if("\\"===o||Ke.test(o))return rt();I(a,"Unexpected character '"+o+"'")}return s}function Xe(e,t){var n=i.slice(a,a+t);a+=t,ze(e,n)}function Ze(){for(var e,t,r=a;;){a>=n&&I(r,"Unterminated regular expression");var s=i.charAt(a);if(Fe.test(s)&&I(r,"Unterminated regular expression"),e)e=!1;else{if("["===s)t=!0;else if("]"===s&&t)t=!1;else if("/"===s&&!t)break;e="\\"===s}++a}var o=i.slice(r,a);++a;var c=nt();c&&!/^[gmsiy]*$/.test(c)&&I(r,"Invalid regexp flag");try{var l=new RegExp(o,c)}catch(e){e instanceof SyntaxError&&I(r,e.message),I(e)}return ze(C,l)}function et(e,t){for(var n=a,r=0,s=0,o=null==t?1/0:t;s<o;++s){var c,l=i.charCodeAt(a);if((c=l>=97?l-97+10:l>=65?l-65+10:l>=48&&l<=57?l-48:1/0)>=e)break;++a,r=r*e+c}return a===n||null!=t&&a-n!==t?null:r}function tt(e){var t=a,n=!1,r=48===i.charCodeAt(a);e||null!==et(10)||I(t,"Invalid number"),46===i.charCodeAt(a)&&(++a,et(10),n=!0);var s=i.charCodeAt(a);69!==s&&101!==s||(43!==(s=i.charCodeAt(++a))&&45!==s||++a,null===et(10)&&I(t,"Invalid number"),n=!0),Ve(i.charCodeAt(a))&&I(a,"Identifier directly after number");var o,c=i.slice(t,a);return n?o=parseFloat(c):r&&1!==c.length?/[89]/.test(c)||w?I(t,"Invalid number"):o=parseInt(c,8):o=parseInt(c,10),ze(T,o)}function it(e){var t=et(16,e);return null===t&&I(c,"Bad character escape sequence"),t}function nt(){Ae=!1;for(var e,t=!0,n=a;;){var r=i.charCodeAt(a);if($e(r))Ae&&(e+=i.charAt(a)),++a;else{if(92!==r)break;Ae||(e=i.slice(n,a)),Ae=!0,117!=i.charCodeAt(++a)&&I(a,"Expecting Unicode escape sequence \\uXXXX"),++a;var s=it(4),o=String.fromCharCode(s);o||I(a-1,"Invalid Unicode escape"),(t?Ve(s):$e(s))||I(a-4,"Invalid Unicode escape"),e+=o}t=!1}return Ae?e:i.slice(n,a)}function rt(){var e=nt(),t=R;return!Ae&&Be(e)&&(t=ie[e]),ze(t,e)}function st(){v=c,y=l,_=u,Qe()}function ot(e){if(w=e,a=c,t.locations)for(;a<m;)m=i.lastIndexOf("\n",m-2)+1,--f;Je(),Qe()}function at(){this.type=null,this.start=c,this.end=null}function ct(){this.start=h,this.end=null,null!==r&&(this.source=r)}function lt(){var e=new at;return t.locations&&(e.loc=new ct),t.directSourceFile&&(e.sourceFile=t.directSourceFile),t.ranges&&(e.range=[c,0]),e}function ht(e){var i=new at;return i.start=e.start,t.locations&&(i.loc=new ct,i.loc.start=e.loc.start),t.ranges&&(i.range=[e.range[0],0]),i}function ut(e,i){return e.type=i,e.end=y,t.locations&&(e.loc.end=_),t.ranges&&(e.range[1]=y),e}function dt(e){return t.ecmaVersion>=5&&"ExpressionStatement"===e.type&&"Literal"===e.expression.type&&"use strict"===e.expression.value}function pt(e){if(d===e)return st(),!0}function gt(){return!t.strictSemicolons&&(d===O||d===oe||Fe.test(i.slice(y,c)))}function ft(){pt(he)||gt()||vt()}function mt(e){d===e?st():vt()}function vt(){I(c,"Unexpected token")}function yt(e){"Identifier"!==e.type&&"MemberExpression"!==e.type&&I(e.start,"Assigning to rvalue"),w&&"Identifier"===e.type&&Ne(e.name)&&I(e.start,"Assigning to "+e.name+" in strict mode")}var _t={kind:"loop"},St={kind:"switch"};function bt(){(d===ge||d===me&&"/="==p)&&Qe(!0);var e=d,n=lt();switch(e){case A:case M:st();var r=e===A;pt(he)||gt()?n.label=null:d!==R?vt():(n.label=Bt(),ft());for(var s=0;s<b.length;++s){var o=b[s];if(null==n.label||o.name===n.label.name){if(null!=o.kind&&(r||"loop"===o.kind))break;if(n.label&&r)break}}return s===b.length&&I(n.start,"Unsyntactic "+e.keyword),ut(n,r?"BreakStatement":"ContinueStatement");case N:return st(),ft(),ut(n,"DebuggerStatement");case U:return st(),b.push(_t),n.body=bt(),b.pop(),mt(W),n.test=wt(),ft(),ut(n,"DoWhileStatement");case j:if(st(),b.push(_t),mt(ae),d===he)return It(n,null);if(d===z){var a=lt();return st(),Tt(a,!0),ut(a,"VariableDeclaration"),1===a.declarations.length&&pt(te)?kt(n,a):It(n,a)}return a=Ct(!1,!0),pt(te)?(yt(a),kt(n,a)):It(n,a);case F:return st(),Mt(n,!0);case q:return st(),n.test=wt(),n.consequent=bt(),n.alternate=pt(L)?bt():null,ut(n,"IfStatement");case V:return S||t.allowReturnOutsideFunction||I(c,"'return' outside of function"),st(),pt(he)||gt()?n.argument=null:(n.argument=Ct(),ft()),ut(n,"ReturnStatement");case $:st(),n.discriminant=wt(),n.cases=[],mt(se),b.push(St);for(var l,h;d!=oe;)if(d===P||d===B){var u=d===P;l&&ut(l,"SwitchCase"),n.cases.push(l=lt()),l.consequent=[],st(),u?l.test=Ct():(h&&I(v,"Multiple default clauses"),h=!0,l.test=null),mt(ue)}else l||vt(),l.consequent.push(bt());return l&&ut(l,"SwitchCase"),st(),b.pop(),ut(n,"SwitchStatement");case G:return st(),Fe.test(i.slice(y,c))&&I(y,"Illegal newline after throw"),n.argument=Ct(),ft(),ut(n,"ThrowStatement");case H:if(st(),n.block=Et(),n.handler=null,d===D){var g=lt();st(),mt(ae),g.param=Bt(),w&&Ne(g.param.name)&&I(g.param.start,"Binding "+g.param.name+" in strict mode"),mt(ce),g.guard=null,g.body=Et(),n.handler=ut(g,"CatchClause")}return n.guardedHandlers=k,n.finalizer=pt(K)?Et():null,n.handler||n.finalizer||I(n.start,"Missing catch or finally clause"),ut(n,"TryStatement");case z:return st(),Tt(n),ft(),ut(n,"VariableDeclaration");case W:return st(),n.test=wt(),b.push(_t),n.body=bt(),b.pop(),ut(n,"WhileStatement");case Y:return w&&I(c,"'with' in strict mode"),st(),n.object=wt(),n.body=bt(),ut(n,"WithStatement");case se:return Et();case he:return st(),ut(n,"EmptyStatement");default:var f=p,m=Ct();if(e===R&&"Identifier"===m.type&&pt(ue)){for(s=0;s<b.length;++s)b[s].name===f&&I(m.start,"Label '"+f+"' is already declared");var _=d.isLoop?"loop":d===$?"switch":null;return b.push({name:f,kind:_}),n.body=bt(),b.pop(),n.label=m,ut(n,"LabeledStatement")}return n.expression=m,ft(),ut(n,"ExpressionStatement")}}function wt(){mt(ae);var e=Ct();return mt(ce),e}function Et(e){var t,i=lt(),n=!0,r=!1;for(i.body=[],mt(se);!pt(oe);){var s=bt();i.body.push(s),n&&e&&dt(s)&&(t=r,ot(r=!0)),n=!1}return r&&!t&&ot(!1),ut(i,"BlockStatement")}function It(e,t){return e.init=t,mt(he),e.test=d===he?null:Ct(),mt(he),e.update=d===ce?null:Ct(),mt(ce),e.body=bt(),b.pop(),ut(e,"ForStatement")}function kt(e,t){return e.left=t,e.right=Ct(),mt(ce),e.body=bt(),b.pop(),ut(e,"ForInStatement")}function Tt(e,t){for(e.declarations=[],e.kind="var";;){var i=lt();if(i.id=Bt(),w&&Ne(i.id.name)&&I(i.id.start,"Binding "+i.id.name+" in strict mode"),i.init=pt(fe)?Ct(!0,t):null,e.declarations.push(ut(i,"VariableDeclarator")),!pt(le))break}return e}function Ct(e,t){var i=xt(t);if(!e&&d===le){var n=ht(i);for(n.expressions=[i];pt(le);)n.expressions.push(xt(t));return ut(n,"SequenceExpression")}return i}function xt(e){var t=function(e){var t=function(e){return Rt(Ot(),-1,e)}(e);if(pt(pe)){var i=ht(t);return i.test=t,i.consequent=Ct(!0),mt(ue),i.alternate=Ct(!0,e),ut(i,"ConditionalExpression")}return t}(e);if(d.isAssign){var i=ht(t);return i.operator=p,i.left=t,st(),i.right=xt(e),yt(t),ut(i,"AssignmentExpression")}return t}function Rt(e,t,i){var n=d.binop;if(null!=n&&(!i||d!==te)&&n>t){var r=ht(e);r.left=e,r.operator=p;var s=d;return st(),r.right=Rt(Ot(),n,i),Rt(ut(r,s===_e||s===Se?"LogicalExpression":"BinaryExpression"),t,i)}return e}function Ot(){if(d.prefix){var e=lt(),t=d.isUpdate;return e.operator=p,e.prefix=!0,g=!0,st(),e.argument=Ot(),t?yt(e.argument):w&&"delete"===e.operator&&"Identifier"===e.argument.type&&I(e.start,"Deleting local variable in strict mode"),ut(e,t?"UpdateExpression":"UnaryExpression")}for(var i=At(Pt());d.postfix&&!gt();)(e=ht(i)).operator=p,e.prefix=!1,e.argument=i,yt(i),st(),i=ut(e,"UpdateExpression");return i}function At(e,t){var i;return pt(de)?((i=ht(e)).object=e,i.property=Bt(!0),i.computed=!1,At(ut(i,"MemberExpression"),t)):pt(ne)?((i=ht(e)).object=e,i.property=Ct(),i.computed=!0,mt(re),At(ut(i,"MemberExpression"),t)):!t&&pt(ae)?((i=ht(e)).callee=e,i.arguments=Nt(ce,!1),At(ut(i,"CallExpression"),t)):e}function Pt(){switch(d){case Q:var e=lt();return st(),ut(e,"ThisExpression");case R:return Bt();case T:case x:case C:return(e=lt()).value=p,e.raw=i.slice(c,l),st(),ut(e,"Literal");case X:case Z:case ee:return(e=lt()).value=d.atomValue,e.raw=d.keyword,st(),ut(e,"Literal");case ae:var n=h,r=c;st();var s=Ct();return s.start=r,s.end=l,t.locations&&(s.loc.start=n,s.loc.end=u),t.ranges&&(s.range=[r,l]),mt(ce),s;case ne:return e=lt(),st(),e.elements=Nt(re,!0,!0),ut(e,"ArrayExpression");case se:return function(){var e=lt(),i=!0,n=!1;for(e.properties=[],st();!pt(oe);){if(i)i=!1;else if(mt(le),t.allowTrailingCommas&&pt(oe))break;var r,s={key:Dt()},o=!1;if(pt(ue)?(s.value=Ct(!0),r=s.kind="init"):t.ecmaVersion>=5&&"Identifier"===s.key.type&&("get"===s.key.name||"set"===s.key.name)?(o=n=!0,r=s.kind=s.key.name,s.key=Dt(),d!==ae&&vt(),s.value=Mt(lt(),!1)):vt(),"Identifier"===s.key.type&&(w||n))for(var a=0;a<e.properties.length;++a){var c=e.properties[a];if(c.key.name===s.key.name){var l=r==c.kind||o&&"init"===c.kind||"init"===r&&("get"===c.kind||"set"===c.kind);l&&!w&&"init"===r&&"init"===c.kind&&(l=!1),l&&I(s.key.start,"Redefinition of property")}}e.properties.push(s)}return ut(e,"ObjectExpression")}();case F:return e=lt(),st(),Mt(e,!1);case J:return function(){var e=lt();return st(),e.callee=At(Pt(),!0),pt(ae)?e.arguments=Nt(ce,!1):e.arguments=k,ut(e,"NewExpression")}();default:vt()}}function Dt(){return d===T||d===x?Pt():Bt(!0)}function Mt(e,t){d===R?e.id=Bt():t?vt():e.id=null,e.params=[];var i=!0;for(mt(ae);!pt(ce);)i?i=!1:mt(le),e.params.push(Bt());var n=S,r=b;if(S=!0,b=[],e.body=Et(!0),S=n,b=r,w||e.body.body.length&&dt(e.body.body[0]))for(var s=e.id?-1:0;s<e.params.length;++s){var o=s<0?e.id:e.params[s];if((Me(o.name)||Ne(o.name))&&I(o.start,"Defining '"+o.name+"' in strict mode"),s>=0)for(var a=0;a<s;++a)o.name===e.params[a].name&&I(o.start,"Argument name clash in strict mode")}return ut(e,t?"FunctionDeclaration":"FunctionExpression")}function Nt(e,i,n){for(var r=[],s=!0;!pt(e);){if(s)s=!1;else if(mt(le),i&&t.allowTrailingCommas&&pt(e))break;n&&d===le?r.push(null):r.push(Ct(!0))}return r}function Bt(e){var n=lt();return e&&"everywhere"==t.forbidReserved&&(e=!1),d===R?(!e&&(t.forbidReserved&&(3===t.ecmaVersion?Pe:De)(p)||w&&Me(p))&&-1==i.slice(c,l).indexOf("\\")&&I(c,"The keyword '"+p+"' is reserved"),n.name=p):e&&d.keyword?n.name=d.keyword:vt(),g=!1,st(),ut(n,"Identifier")}},"object"==typeof e&&"object"==typeof t?u(e):(n=[e],(s="function"==typeof(r=u)?r.apply(e,n):r)===a||(t.exports=s)),g.version||(g=null));var m={"+":"__add","-":"__subtract","*":"__multiply","/":"__divide","%":"__modulo","==":"__equals","!=":"__equals"},v={"-":"__negate","+":"__self"},_=h.each(["add","subtract","multiply","divide","modulo","equals","negate"],(function(e){this["__"+e]="#"+e}),{__self:function(){return this}});function b(e,t,i){var n=m[t];if(e&&e[n]){var r=e[n](i);return"!="===t?!r:r}switch(t){case"+":return e+i;case"-":return e-i;case"*":return e*i;case"/":return e/i;case"%":return e%i;case"==":return e==i;case"!=":return e!=i}}function w(e,t){var i=v[e];if(t&&t[i])return t[i]();switch(e){case"+":return+t;case"-":return-t}}function E(e,t){if(!e)return"";var i=[];function n(e){for(var t=0,n=i.length;t<n;t++){var r=i[t];if(r[0]>=e)break;e+=r[1]}return e}function r(t){return e.substring(n(t.range[0]),n(t.range[1]))}function s(t,r){for(var s=n(t.range[0]),o=n(t.range[1]),a=0,c=i.length-1;c>=0;c--)if(s>i[c][0]){a=c+1;break}i.splice(a,0,[s,r.length-o+s]),e=e.substring(0,s)+r+e.substring(o)}var a,h=(t=t||{}).url||"",u=t.sourceMaps,d=t.paperFeatures||{},p=t.source||e,g=t.offset||0,y=de.agent,_=y.versionNumber,S=!1,b=/\r\n|\n|\r/gm;if(u&&(y.chrome&&_>=30||y.webkit&&_>=537.76||y.firefox&&_>=23||y.node)){if(y.node)g-=2;else if(c&&h&&!c.location.href.indexOf(h)){var w=l.getElementsByTagName("html")[0].innerHTML;g=w.substr(0,w.indexOf(e)+1).match(b).length+1}var E=["AA"+function(e){var t="";for(e=(Math.abs(e)<<1)+(e<0?1:0);e||!t;){var i=31&e;(e>>=5)&&(i|=32),t+="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/"[i]}return t}((S=g>0&&!(y.chrome&&_>=36||y.safari&&_>=600||y.firefox&&_>=40||y.node))?0:g)+"A"];E.length=(e.match(b)||[]).length+1+(S?g:0),a={version:3,file:h,names:[],mappings:E.join(";AACA"),sourceRoot:"",sources:[h],sourcesContent:[p]}}return!1===d.operatorOverloading&&!1===d.moduleExports||function t(i,o,a){if(i){for(var c in i)if("range"!==c&&"loc"!==c){var l=i[c];if(Array.isArray(l))for(var h=0,u=l.length;h<u;h++)t(l[h],i,a);else l&&"object"==typeof l&&t(l,i,a)}!1!==a.operatorOverloading&&function(t,i){switch(t.type){case"UnaryExpression":if(t.operator in v&&"Literal"!==t.argument.type){var o=r(t.argument);s(t,'$__("'+t.operator+'", '+o+")")}break;case"BinaryExpression":if(t.operator in m&&"Literal"!==t.left.type){var a=r(t.left),c=r(t.right),l=function(t,i){return e.substring(n(t.range[1]),n(i.range[0]))}(t.left,t.right),h=t.operator;s(t,"__$__("+a+","+l.replace(new RegExp("\\"+h),'"'+h+'"')+", "+c+")")}break;case"UpdateExpression":case"AssignmentExpression":var u=i&&i.type;if(!("ForStatement"===u||"BinaryExpression"===u&&/^[=!<>]/.test(i.operator)||"MemberExpression"===u&&i.computed))if("UpdateExpression"===t.type){var d=(o=r(t.argument))+" = "+(p="__$__("+o+', "'+t.operator[0]+'", 1)');t.prefix?d="("+d+")":"AssignmentExpression"!==u&&"VariableDeclarator"!==u&&"BinaryExpression"!==u||(r(i.left||i.id)===o&&(d=p),d=o+"; "+d),s(t,d)}else if(/^.=$/.test(t.operator)&&"Literal"!==t.left.type){a=r(t.left),c=r(t.right);var p=a+" = __$__("+a+', "'+t.operator[0]+'", '+c+")";s(t,/^\(.*\)$/.test(r(t))?"("+p+")":p)}}}(i,o),!1!==a.moduleExports&&function(e){switch(e.type){case"ExportDefaultDeclaration":s({range:[e.start,e.declaration.start]},"module.exports = ");break;case"ExportNamedDeclaration":var t=e.declaration,i=e.specifiers;if(t){var n=t.declarations;n&&(n.forEach((function(e){s(e,"module.exports."+r(e))})),s({range:[e.start,t.start+t.kind.length]},""))}else if(i){var o=i.map((function(e){var t=r(e);return"module.exports."+t+" = "+t+"; "})).join("");o&&s(e,o)}}}(i)}}(f(e,{ranges:!0,preserveParens:!0,sourceType:"module"}),null,d),a&&(S&&(e=new Array(g+1).join("\n")+e),/^(inline|both)$/.test(u)&&(e+="\n//# sourceMappingURL=data:application/json;base64,"+o.btoa(unescape(encodeURIComponent(JSON.stringify(a))))),e+="\n//# sourceURL="+(h||"paperscript")),{url:h,source:p,code:e,map:a}}function I(e,t,i){de=t;var n,r=t.getView(),s=/\btool\.\w+|\s+on(?:Key|Mouse)(?:Up|Down|Move|Drag)\b/.test(e)&&!/\bnew\s+Tool\b/.test(e)?new se:null,o=s?s._events:[],a=["onFrame","onResize"].concat(o),c=[],u=[],d="object"==typeof e?e:E(e,i);function p(t,i){for(var n in t)!i&&/^_/.test(n)||!new RegExp("([\\b\\s\\W]|^)"+n.replace(/\$/g,"\\$")+"\\b").test(e)||(c.push(n),u.push(t[n]))}e=d.code,p({__$__:b,$__:w,paper:t,tool:s},!0),p(t),e="var module = { exports: {} }; "+e,(v=h.each(a,(function(t){new RegExp("\\s+"+t+"\\b").test(e)&&(c.push(t),this.push("module.exports."+t+" = "+t+";"))}),[]).join("\n"))&&(e+="\n"+v),e+="\nreturn module.exports;";var g=de.agent;if(l&&(g.chrome||g.firefox&&g.versionNumber<40)){var f=l.createElement("script"),m=l.head||l.getElementsByTagName("head")[0];g.firefox&&(e="\n"+e),f.appendChild(l.createTextNode("document.__paperscript__ = function("+c+") {"+e+"\n}")),m.appendChild(f),n=l.__paperscript__,delete l.__paperscript__,m.removeChild(f)}else n=Function(c,e);var v,_=(v=n&&n.apply(t,u))||{};return h.each(o,(function(e){var t=_[e];t&&(s[e]=t)})),r&&(_.onResize&&r.setOnResize(_.onResize),r.emit("resize",{size:r.size,delta:new y}),_.onFrame&&r.setOnFrame(_.onFrame),r.requestUpdate()),v}function k(e){if(/^text\/(?:x-|)paperscript$/.test(e.type)&&"true"!==d.getAttribute(e,"ignore")){var t=d.getAttribute(e,"canvas"),i=l.getElementById(t),n=e.src||e.getAttribute("data-src"),r=d.hasAttribute(e,"async"),s="data-paper-scope";if(!i)throw new Error('Unable to find canvas with id "'+t+'"');var o=d.get(i.getAttribute(s))||(new d).setup(i);return i.setAttribute(s,o._id),n?ae({url:n,async:r,mimeType:"text/plain",onLoad:function(e){I(e,o,n)}}):I(e.innerHTML,o,e.baseURI),e.setAttribute("data-paper-ignore","true"),o}}function T(){h.each(l&&l.getElementsByTagName("script"),k)}return y.inject(_),S.inject(_),H.inject(_),c&&("complete"===l.readyState?setTimeout(T):Q.add(c,{load:T})),{compile:E,execute:I,load:function(e){return e?k(e):T()},parse:f,calculateBinary:b,calculateUnary:w}}.call(this);var de=new(d.inject(h.exports,{Base:h,Numerical:m,Key:ie,DomEvent:Q,DomElement:J,document:l,window:c,Symbol:D,PlacedSymbol:P}));return de.agent.node&&i(858)(de),(s="function"==typeof(r=de)?r.call(t,i,t,e):r)===a||(e.exports=s),de}).call(this,"object"==typeof self?self:null)},2587:e=>{"use strict";function t(e,t){return Object.prototype.hasOwnProperty.call(e,t)}e.exports=function(e,i,n,r){i=i||"&",n=n||"=";var s={};if("string"!=typeof e||0===e.length)return s;var o=/\+/g;e=e.split(i);var a=1e3;r&&"number"==typeof r.maxKeys&&(a=r.maxKeys);var c=e.length;a>0&&c>a&&(c=a);for(var l=0;l<c;++l){var h,u,d,p,g=e[l].replace(o,"%20"),f=g.indexOf(n);f>=0?(h=g.substr(0,f),u=g.substr(f+1)):(h=g,u=""),d=decodeURIComponent(h),p=decodeURIComponent(u),t(s,d)?Array.isArray(s[d])?s[d].push(p):s[d]=[s[d],p]:s[d]=p}return s}},2361:e=>{"use strict";var t=function(e){switch(typeof e){case"string":return e;case"boolean":return e?"true":"false";case"number":return isFinite(e)?e:"";default:return""}};e.exports=function(e,i,n,r){return i=i||"&",n=n||"=",null===e&&(e=void 0),"object"==typeof e?Object.keys(e).map((function(r){var s=encodeURIComponent(t(r))+n;return Array.isArray(e[r])?e[r].map((function(e){return s+encodeURIComponent(t(e))})).join(i):s+encodeURIComponent(t(e[r]))})).join(i):r?encodeURIComponent(t(r))+n+encodeURIComponent(t(e)):""}},7673:(e,t,i)=>{"use strict";t.decode=t.parse=i(2587),t.encode=t.stringify=i(2361)},9509:(e,t,i)=>{var n=i(8764),r=n.Buffer;function s(e,t){for(var i in e)t[i]=e[i]}function o(e,t,i){return r(e,t,i)}r.from&&r.alloc&&r.allocUnsafe&&r.allocUnsafeSlow?e.exports=n:(s(n,t),t.Buffer=o),o.prototype=Object.create(r.prototype),s(r,o),o.from=function(e,t,i){if("number"==typeof e)throw new TypeError("Argument must not be a number");return r(e,t,i)},o.alloc=function(e,t,i){if("number"!=typeof e)throw new TypeError("Argument must be a number");var n=r(e);return void 0!==t?"string"==typeof i?n.fill(t,i):n.fill(t):n.fill(0),n},o.allocUnsafe=function(e){if("number"!=typeof e)throw new TypeError("Argument must be a number");return r(e)},o.allocUnsafeSlow=function(e){if("number"!=typeof e)throw new TypeError("Argument must be a number");return n.SlowBuffer(e)}},7478:(e,t,i)=>{"use strict";var n=i(210),r=i(1924),s=i(631),o=n("%TypeError%"),a=n("%WeakMap%",!0),c=n("%Map%",!0),l=r("WeakMap.prototype.get",!0),h=r("WeakMap.prototype.set",!0),u=r("WeakMap.prototype.has",!0),d=r("Map.prototype.get",!0),p=r("Map.prototype.set",!0),g=r("Map.prototype.has",!0),f=function(e,t){for(var i,n=e;null!==(i=n.next);n=i)if(i.key===t)return n.next=i.next,i.next=e.next,e.next=i,i};e.exports=function(){var e,t,i,n={assert:function(e){if(!n.has(e))throw new o("Side channel does not contain "+s(e))},get:function(n){if(a&&n&&("object"==typeof n||"function"==typeof n)){if(e)return l(e,n)}else if(c){if(t)return d(t,n)}else if(i)return function(e,t){var i=f(e,t);return i&&i.value}(i,n)},has:function(n){if(a&&n&&("object"==typeof n||"function"==typeof n)){if(e)return u(e,n)}else if(c){if(t)return g(t,n)}else if(i)return function(e,t){return!!f(e,t)}(i,n);return!1},set:function(n,r){a&&n&&("object"==typeof n||"function"==typeof n)?(e||(e=new a),h(e,n,r)):c?(t||(t=new c),p(t,n,r)):(i||(i={key:{},next:null}),function(e,t,i){var n=f(e,t);n?n.value=i:e.next={key:t,next:e.next,value:i}}(i,n,r))}};return n}},5547:e=>{"use strict";e.exports=JSON.parse('{"0":"O","1":"l","֭":"֖","֮":"֘","֨":"֙","֤":"֚","᪴":"ۛ","⃛":"ۛ","ؙ":"̓","ࣳ":"̓","̓":"̓","̕":"̓","ُ":"̓","ٝ":"̔","֜":"́","֝":"́","ؘ":"́","݇":"́","́":"́","॔":"́","َ":"́","̀":"̀","॓":"̀","̌":"̆","꙼":"̆","٘":"̆","ٚ":"̆","ͮ":"̆","ۨ":"̆̇","̐":"̆̇","ँ":"̆̇","ঁ":"̆̇","ઁ":"̆̇","ଁ":"̆̇","ఀ":"̆̇","ಁ":"̆̇","ഁ":"̆̇","𑒿":"̆̇","᳐":"̂","̑":"̂","ٛ":"̂","߮":"̂","꛰":"̂","֯":"̊","۟":"̊","៓":"̊","゚":"̊","ْ":"̊","ஂ":"̊","ံ":"̊","ំ":"̊","𑌀":"̊","ํ":"̊","ໍ":"̊","ͦ":"̊","ⷪ":"̊","࣫":"̈","߳":"̈","ً":"̋","ࣰ":"̋","͂":"̃","ٓ":"̃","ׄ":"̇","۬":"̇","݀":"̇","࣪":"̇","݁":"̇","͘":"̇","ֹ":"̇","ֺ":"̇","ׂ":"̇","ׁ":"̇","߭":"̇","ं":"̇","ਂ":"̇","ં":"̇","்":"̇","̷":"̸","᪷":"̨","̢":"̨","ͅ":"̨","᳒":"̄","̅":"̄","ٙ":"̄","߫":"̄","꛱":"̄","᳚":"̎","ٗ":"̒","͗":"͐","ࣿ":"͐","ࣸ":"͐","ऀ":"͒","᳭":"̖","᳜":"̩","ٖ":"̩","᳕":"̫","͇":"̳","ࣹ":"͔","ࣺ":"͕","゛":"ﾞ","゜":"ﾟ","̶":"̵","〬":"̉","ׅ":"̣","࣭":"̣","᳝":"̣","ִ":"̣","ٜ":"̣","़":"̣","়":"̣","਼":"̣","઼":"̣","଼":"̣","𑇊":"̣","𑓃":"̣","𐨺":"̣","࣮":"̤","᳞":"̤","༷":"̥","〭":"̥","̧":"̦","̡":"̦","̹":"̦","᳙":"̭","᳘":"̮","॒":"̱","̠":"̱","ࣱ":"ٌ","ࣨ":"ٌ","ࣥ":"ٌ","ﱞ":"ﹲّ","ࣲ":"ٍ","ﱟ":"ﹴّ","ﳲ":"ﹷّ","ﱠ":"ﹶّ","ﳳ":"ﹹّ","ﱡ":"ﹸّ","ؚ":"ِ","̗":"ِ","ﳴ":"ﹻّ","ﱢ":"ﹺّ","ﱣ":"ﹼٰ","ٟ":"ٕ","̍":"ٰ","݂":"ܼ","ਃ":"ঃ","ః":"ঃ","ಃ":"ঃ","ഃ":"ঃ","ඃ":"ঃ","း":"ঃ","𑓁":"ঃ","់":"่","່":"่","້":"้","໊":"๊","໋":"๋","꙯":"⃩","\\u2028":" ","\\u2029":" "," ":" "," ":" "," ":" "," ":" "," ":" "," ":" "," ":" "," ":" "," ":" "," ":" "," ":" "," ":" "," ":" "," ":" "," ":" ","ߺ":"_","﹍":"_","﹎":"_","﹏":"_","‐":"-","‑":"-","‒":"-","–":"-","﹘":"-","۔":"-","⁃":"-","˗":"-","−":"-","➖":"-","Ⲻ":"-","⨩":"-̓","⸚":"-̈","﬩":"-̇","∸":"-̇","⨪":"-̣","꓾":"-.","～":"〜","؍":",","٫":",","‚":",","¸":",","ꓹ":",","⸲":"،","٬":"،",";":";","⸵":"؛","ः":":","ઃ":":","：":":","։":":","܃":":","܄":":","᛬":":","︰":":","᠃":":","᠉":":","⁚":":","׃":":","˸":":","꞉":":","∶":":","ː":":","ꓽ":":","⩴":"::=","⧴":":→","！":"!","ǃ":"!","ⵑ":"!","‼":"!!","⁉":"!?","ʔ":"?","Ɂ":"?","ॽ":"?","Ꭾ":"?","ꛫ":"?","⁈":"?!","⁇":"??","⸮":"؟","𝅭":".","․":".","܁":".","܂":".","꘎":".","𐩐":".","٠":".","۰":".","ꓸ":".","ꓻ":".,","‥":"..","ꓺ":"..","…":"...","꛴":"꛳꛳","・":"·","･":"·","᛫":"·","·":"·","⸱":"·","𐄁":"·","•":"·","‧":"·","∙":"·","⋅":"·","ꞏ":"·","ᐧ":"·","⋯":"···","ⵈ":"···","ᑄ":"·<","⋗":"·>","ᐷ":"·>","ᑀ":"·>","ᔯ":"·4","ᑾ":"·b","ᒀ":"·ḃ","ᑺ":"·d","ᒘ":"·J","ᒶ":"·L","ᑶ":"·P","ᑗ":"·U","ᐺ":"·V","ᐼ":"·Ʌ","ᒮ":"·Γ","ᐎ":"·Δ","ᑙ":"·Ո","ᐌ":"·ᐁ","ᐐ":"·ᐄ","ᐒ":"·ᐅ","ᐔ":"·ᐆ","ᐗ":"·ᐊ","ᐙ":"·ᐋ","ᐾ":"·ᐲ","ᑂ":"·ᐴ","ᑆ":"·ᐹ","ᑛ":"·ᑏ","ᑔ":"·ᑐ","ᑝ":"·ᑐ","ᑟ":"·ᑑ","ᑡ":"·ᑕ","ᑣ":"·ᑖ","ᑴ":"·ᑫ","ᑸ":"·ᑮ","ᑼ":"·ᑰ","ᒒ":"·ᒉ","ᒔ":"·ᒋ","ᒖ":"·ᒌ","ᒚ":"·ᒎ","ᒜ":"·ᒐ","ᒞ":"·ᒑ","ᒬ":"·ᒣ","ᒰ":"·ᒦ","ᒲ":"·ᒧ","ᒴ":"·ᒨ","ᒸ":"·ᒫ","ᓉ":"·ᓀ","ᣆ":"·ᓂ","ᣈ":"·ᓃ","ᣊ":"·ᓄ","ᣌ":"·ᓅ","ᓋ":"·ᓇ","ᓍ":"·ᓈ","ᓜ":"·ᓓ","ᓞ":"·ᓕ","ᓠ":"·ᓖ","ᓢ":"·ᓗ","ᓤ":"·ᓘ","ᓦ":"·ᓚ","ᓨ":"·ᓛ","ᓶ":"·ᓭ","ᓸ":"·ᓯ","ᓺ":"·ᓰ","ᓼ":"·ᓱ","ᓾ":"·ᓲ","ᔀ":"·ᓴ","ᔂ":"·ᓵ","ᔗ":"·ᔐ","ᔙ":"·ᔑ","ᔛ":"·ᔒ","ᔝ":"·ᔓ","ᔟ":"·ᔔ","ᔡ":"·ᔕ","ᔣ":"·ᔖ","ᔱ":"·ᔨ","ᔳ":"·ᔩ","ᔵ":"·ᔪ","ᔷ":"·ᔫ","ᔹ":"·ᔭ","ᔻ":"·ᔮ","ᣎ":"·ᕃ","ᣏ":"·ᕆ","ᣐ":"·ᕇ","ᣑ":"·ᕈ","ᣒ":"·ᕉ","ᣓ":"·ᕋ","ᕎ":"·ᕌ","ᕛ":"·ᕚ","ᕨ":"·ᕧ","ᢳ":"·ᢱ","ᢶ":"·ᢴ","ᢹ":"·ᢸ","ᣂ":"·ᣀ","꠰":"।","॥":"।।","᰼":"᰻᰻","။":"၊၊","᪩":"᪨᪨","᪫":"᪪᪨","᭟":"᭞᭞","𐩗":"𐩖𐩖","𑑌":"𑑋𑑋","𑙂":"𑙁𑙁","𑱂":"𑱁𑱁","᱿":"᱾᱾","՝":"\'","＇":"\'","‘":"\'","’":"\'","‛":"\'","′":"\'","‵":"\'","՚":"\'","׳":"\'","`":"\'","`":"\'","｀":"\'","´":"\'","΄":"\'","´":"\'","᾽":"\'","᾿":"\'","῾":"\'","ʹ":"\'","ʹ":"\'","ˈ":"\'","ˊ":"\'","ˋ":"\'","˴":"\'","ʻ":"\'","ʽ":"\'","ʼ":"\'","ʾ":"\'","ꞌ":"\'","י":"\'","ߴ":"\'","ߵ":"\'","ᑊ":"\'","ᛌ":"\'","𖽑":"\'","𖽒":"\'","᳓":"\'\'","\\"":"\'\'","＂":"\'\'","“":"\'\'","”":"\'\'","‟":"\'\'","″":"\'\'","‶":"\'\'","〃":"\'\'","״":"\'\'","˝":"\'\'","ʺ":"\'\'","˶":"\'\'","ˮ":"\'\'","ײ":"\'\'","‴":"\'\'\'","‷":"\'\'\'","⁗":"\'\'\'\'","Ɓ":"\'B","Ɗ":"\'D","ŉ":"\'n","Ƥ":"\'P","Ƭ":"\'T","Ƴ":"\'Y","［":"(","❨":"(","❲":"(","〔":"(","﴾":"(","⸨":"((","㈠":"(ー)","⑵":"(2)","⒇":"(2O)","⑶":"(3)","⑷":"(4)","⑸":"(5)","⑹":"(6)","⑺":"(7)","⑻":"(8)","⑼":"(9)","⒜":"(a)","🄐":"(A)","⒝":"(b)","🄑":"(B)","⒞":"(c)","🄒":"(C)","⒟":"(d)","🄓":"(D)","⒠":"(e)","🄔":"(E)","⒡":"(f)","🄕":"(F)","⒢":"(g)","🄖":"(G)","⒣":"(h)","🄗":"(H)","⒤":"(i)","⒥":"(j)","🄙":"(J)","⒦":"(k)","🄚":"(K)","⑴":"(l)","🄘":"(l)","⒧":"(l)","🄛":"(L)","⑿":"(l2)","⒀":"(l3)","⒁":"(l4)","⒂":"(l5)","⒃":"(l6)","⒄":"(l7)","⒅":"(l8)","⒆":"(l9)","⑾":"(ll)","⑽":"(lO)","🄜":"(M)","⒩":"(n)","🄝":"(N)","⒪":"(o)","🄞":"(O)","⒫":"(p)","🄟":"(P)","⒬":"(q)","🄠":"(Q)","⒭":"(r)","🄡":"(R)","⒨":"(rn)","⒮":"(s)","🄢":"(S)","🄪":"(S)","⒯":"(t)","🄣":"(T)","⒰":"(u)","🄤":"(U)","⒱":"(v)","🄥":"(V)","⒲":"(w)","🄦":"(W)","⒳":"(x)","🄧":"(X)","⒴":"(y)","🄨":"(Y)","⒵":"(z)","🄩":"(Z)","㈀":"(ᄀ)","㈎":"(가)","㈁":"(ᄂ)","㈏":"(나)","㈂":"(ᄃ)","㈐":"(다)","㈃":"(ᄅ)","㈑":"(라)","㈄":"(ᄆ)","㈒":"(마)","㈅":"(ᄇ)","㈓":"(바)","㈆":"(ᄉ)","㈔":"(사)","㈇":"(ᄋ)","㈕":"(아)","㈝":"(오전)","㈞":"(오후)","㈈":"(ᄌ)","㈖":"(자)","㈜":"(주)","㈉":"(ᄎ)","㈗":"(차)","㈊":"(ᄏ)","㈘":"(카)","㈋":"(ᄐ)","㈙":"(타)","㈌":"(ᄑ)","㈚":"(파)","㈍":"(ᄒ)","㈛":"(하)","㈦":"(七)","㈢":"(三)","🉁":"(三)","㈨":"(九)","㈡":"(二)","🉂":"(二)","㈤":"(五)","㈹":"(代)","㈽":"(企)","㉁":"(休)","㈧":"(八)","㈥":"(六)","㈸":"(労)","🉇":"(勝)","㈩":"(十)","㈿":"(協)","㈴":"(名)","㈺":"(呼)","㈣":"(四)","㈯":"(土)","㈻":"(学)","🉃":"(安)","🉅":"(打)","🉈":"(敗)","㈰":"(日)","㈪":"(月)","㈲":"(有)","㈭":"(木)","🉀":"(本)","㈱":"(株)","㈬":"(水)","㈫":"(火)","🉄":"(点)","㈵":"(特)","🉆":"(盗)","㈼":"(監)","㈳":"(社)","㈷":"(祝)","㉀":"(祭)","㉂":"(自)","㉃":"(至)","㈶":"(財)","㈾":"(資)","㈮":"(金)","］":")","❩":")","❳":")","〕":")","﴿":")","⸩":"))","❴":"{","𝄔":"{","❵":"}","〚":"⟦","〛":"⟧","⟨":"❬","〈":"❬","〈":"❬","㇛":"❬","く":"❬","𡿨":"❬","⟩":"❭","〉":"❭","〉":"❭","＾":"︿","⸿":"¶","⁎":"*","٭":"*","∗":"*","𐌟":"*","᜵":"/","⁁":"/","∕":"/","⁄":"/","╱":"/","⟋":"/","⧸":"/","𝈺":"/","㇓":"/","〳":"/","Ⳇ":"/","ノ":"/","丿":"/","⼃":"/","⧶":"/̄","⫽":"//","⫻":"///","＼":"\\\\","﹨":"\\\\","∖":"\\\\","⟍":"\\\\","⧵":"\\\\","⧹":"\\\\","𝈏":"\\\\","𝈻":"\\\\","㇔":"\\\\","丶":"\\\\","⼂":"\\\\","⳹":"\\\\\\\\","⑊":"\\\\\\\\","⟈":"\\\\ᑕ","ꝸ":"&","૰":"॰","𑂻":"॰","𑇇":"॰","⚬":"॰","𑇛":"꣼","៙":"๏","៕":"๚","៚":"๛","༌":"་","༎":"།།","˄":"^","ˆ":"^","꙾":"ˇ","˘":"ˇ","‾":"ˉ","﹉":"ˉ","﹊":"ˉ","﹋":"ˉ","﹌":"ˉ","¯":"ˉ","￣":"ˉ","▔":"ˉ","ъ":"ˉb","ꙑ":"ˉbi","͵":"ˏ","˻":"˪","꜖":"˪","꜔":"˫","。":"˳","⸰":"°","˚":"°","∘":"°","○":"°","◦":"°","⍜":"°̲","⍤":"°̈","℃":"°C","℉":"°F","௵":"௳","༛":"༚༚","༟":"༚༝","࿎":"༝༚","༞":"༝༝","Ⓒ":"©","Ⓡ":"®","Ⓟ":"℗","𝈛":"⅄","⯬":"↞","⯭":"↟","⯮":"↠","⯯":"↡","↵":"↲","⥥":"⇃⇂","⥯":"⇃ᛚ","𝛛":"∂","𝜕":"∂","𝝏":"∂","𝞉":"∂","𝟃":"∂","𞣌":"∂","𞣍":"∂̵","ð":"∂̵","⌀":"∅","𝛁":"∇","𝛻":"∇","𝜵":"∇","𝝯":"∇","𝞩":"∇","𑢨":"∇","⍢":"∇̈","⍫":"∇̴","█":"∎","■":"∎","⨿":"∐","᛭":"+","➕":"+","𐊛":"+","⨣":"+̂","⨢":"+̊","⨤":"+̃","∔":"+̇","⨥":"+̣","⨦":"+̰","⨧":"+₂","➗":"÷","‹":"<","❮":"<","˂":"<","𝈶":"<","ᐸ":"<","ᚲ":"<","⋖":"<·","Ⲵ":"<·","ᑅ":"<·","≪":"<<","⋘":"<<<","᐀":"=","⹀":"=","゠":"=","꓿":"=","≚":"=̆","≙":"=̂","≗":"=̊","≐":"=̇","≑":"=̣̇","⩮":"=⃰","⩵":"==","⩶":"===","≞":"=ͫ","›":">","❯":">","˃":">","𝈷":">","ᐳ":">","𖼿":">","ᑁ":">·","⪥":"><","≫":">>","⨠":">>","⋙":">>>","⁓":"~","˜":"~","῀":"~","∼":"~","⍨":"~̈","⸞":"~̇","⩪":"~̇","⸟":"~̣","𞣈":"∠","⋀":"∧","∯":"∮∮","∰":"∮∮∮","⸫":"∴","⸪":"∵","⸬":"∷","𑇞":"≈","♎":"≏","🝞":"≏","≣":"≡","⨃":"⊍","⨄":"⊎","𝈸":"⊏","𝈹":"⊐","⨅":"⊓","⨆":"⊔","⨂":"⊗","⍟":"⊛","🝱":"⊠","🝕":"⊡","◁":"⊲","▷":"⊳","⍣":"⋆̈","︴":"⌇","◠":"⌒","⨽":"⌙","⌥":"⌤","⧇":"⌻","◎":"⌾","⦾":"⌾","⧅":"⍂","⦰":"⍉","⏃":"⍋","⏂":"⍎","⏁":"⍕","⏆":"⍭","☸":"⎈","︵":"⏜","︶":"⏝","︷":"⏞","︸":"⏟","︹":"⏠","︺":"⏡","▱":"⏥","⏼":"⏻","︱":"│","｜":"│","┃":"│","┏":"┌","┣":"├","▐":"▌","▗":"▖","▝":"▘","☐":"□","￭":"▪","▸":"▶","►":"▶","⳩":"☧","🜊":"☩","🌒":"☽","🌙":"☽","⏾":"☾","🌘":"☾","⧙":"⦚","🜺":"⧟","⨾":"⨟","𐆠":"⳨","♩":"𝅘𝅥","♪":"𝅘𝅥𝅮","⓪":"🄍","↺":"🄎","˙":"ॱ","ൎ":"ॱ","－":"ー","—":"ー","―":"ー","─":"ー","━":"ー","㇐":"ー","ꟷ":"ー","ᅳ":"ー","ㅡ":"ー","一":"ー","⼀":"ー","ᆖ":"ーー","ힹ":"ーᅡ","ힺ":"ーᅥ","ힻ":"ーᅥ丨","ힼ":"ーᅩ","ᆕ":"ーᅮ","ᅴ":"ー丨","ㅢ":"ー丨","ᆗ":"ー丨ᅮ","🄏":"$⃠","₤":"£","〒":"₸","〶":"₸","᭜":"᭐","꧆":"꧐","𑓑":"১","೧":"౧","ၥ":"၁","①":"➀","⑩":"➉","⏨":"₁₀","𝟐":"2","𝟚":"2","𝟤":"2","𝟮":"2","𝟸":"2","🯲":"2","Ꝛ":"2","Ƨ":"2","Ϩ":"2","Ꙅ":"2","ᒿ":"2","ꛯ":"2","ꧏ":"٢","۲":"٢","૨":"२","𑓒":"২","೨":"౨","②":"➁","ƻ":"2̵","🄃":"2,","⒉":"2.","㏵":"22日","㍮":"22点","㏶":"23日","㍯":"23点","㏷":"24日","㍰":"24点","㏸":"25日","㏹":"26日","㏺":"27日","㏻":"28日","㏼":"29日","㏴":"2l日","㍭":"2l点","⒛":"2O.","㏳":"2O日","㍬":"2O点","෩":"෨ා","෯":"෨ී","㏡":"2日","㋁":"2月","㍚":"2点","𝈆":"3","𝟑":"3","𝟛":"3","𝟥":"3","𝟯":"3","𝟹":"3","🯳":"3","Ɜ":"3","Ȝ":"3","Ʒ":"3","Ꝫ":"3","Ⳍ":"3","З":"3","Ӡ":"3","𖼻":"3","𑣊":"3","۳":"٣","𞣉":"٣","૩":"३","③":"➂","Ҙ":"3̦","🄄":"3,","⒊":"3.","㏾":"3l日","㏽":"3O日","㏢":"3日","㋂":"3月","㍛":"3点","𝟒":"4","𝟜":"4","𝟦":"4","𝟰":"4","𝟺":"4","🯴":"4","Ꮞ":"4","𑢯":"4","۴":"٤","૪":"४","④":"➃","🄅":"4,","⒋":"4.","ᔰ":"4·","㏣":"4日","㋃":"4月","㍜":"4点","𝟓":"5","𝟝":"5","𝟧":"5","𝟱":"5","𝟻":"5","🯵":"5","Ƽ":"5","𑢻":"5","⑤":"➄","🄆":"5,","⒌":"5.","㏤":"5日","㋄":"5月","㍝":"5点","𝟔":"6","𝟞":"6","𝟨":"6","𝟲":"6","𝟼":"6","🯶":"6","Ⳓ":"6","б":"6","Ꮾ":"6","𑣕":"6","۶":"٦","𑓖":"৬","⑥":"➅","🄇":"6,","⒍":"6.","㏥":"6日","㋅":"6月","㍞":"6点","𝈒":"7","𝟕":"7","𝟟":"7","𝟩":"7","𝟳":"7","𝟽":"7","🯷":"7","𐓒":"7","𑣆":"7","⑦":"➆","🄈":"7,","⒎":"7.","㏦":"7日","㋆":"7月","㍟":"7点","ଃ":"8","৪":"8","੪":"8","𞣋":"8","𝟖":"8","𝟠":"8","𝟪":"8","𝟴":"8","𝟾":"8","🯸":"8","ȣ":"8","Ȣ":"8","𐌚":"8","૮":"८","⑧":"➇","🄉":"8,","⒏":"8.","㏧":"8日","㋇":"8月","㍠":"8点","੧":"9","୨":"9","৭":"9","൭":"9","𝟗":"9","𝟡":"9","𝟫":"9","𝟵":"9","𝟿":"9","🯹":"9","Ꝯ":"9","Ⳋ":"9","𑣌":"9","𑢬":"9","𑣖":"9","१":"٩","𑣤":"٩","۹":"٩","೯":"౯","⑨":"➈","🄊":"9,","⒐":"9.","㏨":"9日","㋈":"9月","㍡":"9点","⍺":"a","ａ":"a","𝐚":"a","𝑎":"a","𝒂":"a","𝒶":"a","𝓪":"a","𝔞":"a","𝕒":"a","𝖆":"a","𝖺":"a","𝗮":"a","𝘢":"a","𝙖":"a","𝚊":"a","ɑ":"a","α":"a","𝛂":"a","𝛼":"a","𝜶":"a","𝝰":"a","𝞪":"a","а":"a","ⷶ":"ͣ","Ａ":"A","𝐀":"A","𝐴":"A","𝑨":"A","𝒜":"A","𝓐":"A","𝔄":"A","𝔸":"A","𝕬":"A","𝖠":"A","𝗔":"A","𝘈":"A","𝘼":"A","𝙰":"A","Α":"A","𝚨":"A","𝛢":"A","𝜜":"A","𝝖":"A","𝞐":"A","А":"A","Ꭺ":"A","ᗅ":"A","ꓮ":"A","𖽀":"A","𐊠":"A","⍶":"a̲","ǎ":"ă","Ǎ":"Ă","ȧ":"å","Ȧ":"Å","ẚ":"ả","℀":"a/c","℁":"a/s","ꜳ":"aa","Ꜳ":"AA","æ":"ae","ӕ":"ae","Æ":"AE","Ӕ":"AE","ꜵ":"ao","Ꜵ":"AO","🜇":"AR","ꜷ":"au","Ꜷ":"AU","ꜹ":"av","ꜻ":"av","Ꜹ":"AV","Ꜻ":"AV","ꜽ":"ay","Ꜽ":"AY","ꭺ":"ᴀ","∀":"Ɐ","𝈗":"Ɐ","ᗄ":"Ɐ","ꓯ":"Ɐ","𐐟":"Ɒ","𝐛":"b","𝑏":"b","𝒃":"b","𝒷":"b","𝓫":"b","𝔟":"b","𝕓":"b","𝖇":"b","𝖻":"b","𝗯":"b","𝘣":"b","𝙗":"b","𝚋":"b","Ƅ":"b","Ь":"b","Ꮟ":"b","ᑲ":"b","ᖯ":"b","Ｂ":"B","ℬ":"B","𝐁":"B","𝐵":"B","𝑩":"B","𝓑":"B","𝔅":"B","𝔹":"B","𝕭":"B","𝖡":"B","𝗕":"B","𝘉":"B","𝘽":"B","𝙱":"B","Ꞵ":"B","Β":"B","𝚩":"B","𝛣":"B","𝜝":"B","𝝗":"B","𝞑":"B","В":"B","Ᏼ":"B","ᗷ":"B","ꓐ":"B","𐊂":"B","𐊡":"B","𐌁":"B","ɓ":"b̔","ᑳ":"ḃ","ƃ":"b̄","Ƃ":"b̄","Б":"b̄","ƀ":"b̵","ҍ":"b̵","Ҍ":"b̵","ѣ":"b̵","Ѣ":"b̵","ᑿ":"b·","ᒁ":"ḃ·","ᒈ":"b\'","Ы":"bl","в":"ʙ","ᏼ":"ʙ","ｃ":"c","ⅽ":"c","𝐜":"c","𝑐":"c","𝒄":"c","𝒸":"c","𝓬":"c","𝔠":"c","𝕔":"c","𝖈":"c","𝖼":"c","𝗰":"c","𝘤":"c","𝙘":"c","𝚌":"c","ᴄ":"c","ϲ":"c","ⲥ":"c","с":"c","ꮯ":"c","𐐽":"c","ⷭ":"ͨ","🝌":"C","𑣲":"C","𑣩":"C","Ｃ":"C","Ⅽ":"C","ℂ":"C","ℭ":"C","𝐂":"C","𝐶":"C","𝑪":"C","𝒞":"C","𝓒":"C","𝕮":"C","𝖢":"C","𝗖":"C","𝘊":"C","𝘾":"C","𝙲":"C","Ϲ":"C","Ⲥ":"C","С":"C","Ꮯ":"C","ꓚ":"C","𐊢":"C","𐌂":"C","𐐕":"C","𐔜":"C","¢":"c̸","ȼ":"c̸","₡":"C⃫","🅮":"C⃠","ç":"c̦","ҫ":"c̦","Ç":"C̦","Ҫ":"C̦","Ƈ":"C\'","℅":"c/o","℆":"c/u","🅭":"㏄\\t⃝","⋴":"ꞓ","ɛ":"ꞓ","ε":"ꞓ","ϵ":"ꞓ","𝛆":"ꞓ","𝛜":"ꞓ","𝜀":"ꞓ","𝜖":"ꞓ","𝜺":"ꞓ","𝝐":"ꞓ","𝝴":"ꞓ","𝞊":"ꞓ","𝞮":"ꞓ","𝟄":"ꞓ","ⲉ":"ꞓ","є":"ꞓ","ԑ":"ꞓ","ꮛ":"ꞓ","𑣎":"ꞓ","𐐩":"ꞓ","€":"Ꞓ","Ⲉ":"Ꞓ","Є":"Ꞓ","⍷":"ꞓ̲","ͽ":"ꜿ","Ͽ":"Ꜿ","ⅾ":"d","ⅆ":"d","𝐝":"d","𝑑":"d","𝒅":"d","𝒹":"d","𝓭":"d","𝔡":"d","𝕕":"d","𝖉":"d","𝖽":"d","𝗱":"d","𝘥":"d","𝙙":"d","𝚍":"d","ԁ":"d","Ꮷ":"d","ᑯ":"d","ꓒ":"d","Ⅾ":"D","ⅅ":"D","𝐃":"D","𝐷":"D","𝑫":"D","𝒟":"D","𝓓":"D","𝔇":"D","𝔻":"D","𝕯":"D","𝖣":"D","𝗗":"D","𝘋":"D","𝘿":"D","𝙳":"D","Ꭰ":"D","ᗞ":"D","ᗪ":"D","ꓓ":"D","ɗ":"d̔","ɖ":"d̨","ƌ":"d̄","đ":"d̵","Đ":"D̵","Ð":"D̵","Ɖ":"D̵","₫":"ḏ̵","ꝺ":"Ꝺ","ᑻ":"d·","ᒇ":"d\'","ʤ":"dȝ","ǳ":"dz","ʣ":"dz","ǲ":"Dz","Ǳ":"DZ","ǆ":"dž","ǅ":"Dž","Ǆ":"DŽ","ʥ":"dʑ","ꭰ":"ᴅ","⸹":"ẟ","δ":"ẟ","𝛅":"ẟ","𝛿":"ẟ","𝜹":"ẟ","𝝳":"ẟ","𝞭":"ẟ","ծ":"ẟ","ᕷ":"ẟ","℮":"e","ｅ":"e","ℯ":"e","ⅇ":"e","𝐞":"e","𝑒":"e","𝒆":"e","𝓮":"e","𝔢":"e","𝕖":"e","𝖊":"e","𝖾":"e","𝗲":"e","𝘦":"e","𝙚":"e","𝚎":"e","ꬲ":"e","е":"e","ҽ":"e","ⷷ":"ͤ","⋿":"E","Ｅ":"E","ℰ":"E","𝐄":"E","𝐸":"E","𝑬":"E","𝓔":"E","𝔈":"E","𝔼":"E","𝕰":"E","𝖤":"E","𝗘":"E","𝘌":"E","𝙀":"E","𝙴":"E","Ε":"E","𝚬":"E","𝛦":"E","𝜠":"E","𝝚":"E","𝞔":"E","Е":"E","ⴹ":"E","Ꭼ":"E","ꓰ":"E","𑢦":"E","𑢮":"E","𐊆":"E","ě":"ĕ","Ě":"Ĕ","ɇ":"e̸","Ɇ":"E̸","ҿ":"ę","ꭼ":"ᴇ","ə":"ǝ","ә":"ǝ","∃":"Ǝ","ⴺ":"Ǝ","ꓱ":"Ǝ","ɚ":"ǝ˞","ᴔ":"ǝo","ꭁ":"ǝo̸","ꭂ":"ǝo̵","Ә":"Ə","𝈡":"Ɛ","ℇ":"Ɛ","Ԑ":"Ɛ","Ꮛ":"Ɛ","𖼭":"Ɛ","𐐁":"Ɛ","ᶟ":"ᵋ","ᴈ":"ɜ","з":"ɜ","ҙ":"ɜ̦","𐑂":"ɞ","ꞝ":"ʚ","𐐪":"ʚ","𝐟":"f","𝑓":"f","𝒇":"f","𝒻":"f","𝓯":"f","𝔣":"f","𝕗":"f","𝖋":"f","𝖿":"f","𝗳":"f","𝘧":"f","𝙛":"f","𝚏":"f","ꬵ":"f","ꞙ":"f","ſ":"f","ẝ":"f","ք":"f","𝈓":"F","ℱ":"F","𝐅":"F","𝐹":"F","𝑭":"F","𝓕":"F","𝔉":"F","𝔽":"F","𝕱":"F","𝖥":"F","𝗙":"F","𝘍":"F","𝙁":"F","𝙵":"F","Ꞙ":"F","Ϝ":"F","𝟊":"F","ᖴ":"F","ꓝ":"F","𑣂":"F","𑢢":"F","𐊇":"F","𐊥":"F","𐔥":"F","ƒ":"f̦","Ƒ":"F̦","ᵮ":"f̴","℻":"FAX","ﬀ":"ff","ﬃ":"ffi","ﬄ":"ffl","ﬁ":"fi","ﬂ":"fl","ʩ":"fŋ","ᖵ":"Ⅎ","ꓞ":"Ⅎ","𝈰":"ꟻ","ᖷ":"ꟻ","ｇ":"g","ℊ":"g","𝐠":"g","𝑔":"g","𝒈":"g","𝓰":"g","𝔤":"g","𝕘":"g","𝖌":"g","𝗀":"g","𝗴":"g","𝘨":"g","𝙜":"g","𝚐":"g","ɡ":"g","ᶃ":"g","ƍ":"g","ց":"g","𝐆":"G","𝐺":"G","𝑮":"G","𝒢":"G","𝓖":"G","𝔊":"G","𝔾":"G","𝕲":"G","𝖦":"G","𝗚":"G","𝘎":"G","𝙂":"G","𝙶":"G","Ԍ":"G","Ꮐ":"G","Ᏻ":"G","ꓖ":"G","ᶢ":"ᵍ","ɠ":"g̔","ǧ":"ğ","Ǧ":"Ğ","ǵ":"ģ","ǥ":"g̵","Ǥ":"G̵","Ɠ":"G\'","ԍ":"ɢ","ꮐ":"ɢ","ᏻ":"ɢ","ｈ":"h","ℎ":"h","𝐡":"h","𝒉":"h","𝒽":"h","𝓱":"h","𝔥":"h","𝕙":"h","𝖍":"h","𝗁":"h","𝗵":"h","𝘩":"h","𝙝":"h","𝚑":"h","һ":"h","հ":"h","Ꮒ":"h","Ｈ":"H","ℋ":"H","ℌ":"H","ℍ":"H","𝐇":"H","𝐻":"H","𝑯":"H","𝓗":"H","𝕳":"H","𝖧":"H","𝗛":"H","𝘏":"H","𝙃":"H","𝙷":"H","Η":"H","𝚮":"H","𝛨":"H","𝜢":"H","𝝜":"H","𝞖":"H","Ⲏ":"H","Н":"H","Ꮋ":"H","ᕼ":"H","ꓧ":"H","𐋏":"H","ᵸ":"ᴴ","ɦ":"h̔","ꚕ":"h̔","Ᏺ":"h̔","Ⱨ":"H̩","Ң":"H̩","ħ":"h̵","ℏ":"h̵","ћ":"h̵","Ħ":"H̵","Ӊ":"H̦","Ӈ":"H̦","н":"ʜ","ꮋ":"ʜ","ң":"ʜ̩","ӊ":"ʜ̦","ӈ":"ʜ̦","Ԋ":"Ƕ","ꮀ":"ⱶ","Ͱ":"Ⱶ","Ꭸ":"Ⱶ","Ꮀ":"Ⱶ","ꚱ":"Ⱶ","ꞕ":"ꜧ","˛":"i","⍳":"i","ｉ":"i","ⅰ":"i","ℹ":"i","ⅈ":"i","𝐢":"i","𝑖":"i","𝒊":"i","𝒾":"i","𝓲":"i","𝔦":"i","𝕚":"i","𝖎":"i","𝗂":"i","𝗶":"i","𝘪":"i","𝙞":"i","𝚒":"i","ı":"i","𝚤":"i","ɪ":"i","ɩ":"i","ι":"i","ι":"i","ͺ":"i","𝛊":"i","𝜄":"i","𝜾":"i","𝝸":"i","𝞲":"i","і":"i","ꙇ":"i","ӏ":"i","ꭵ":"i","Ꭵ":"i","𑣃":"i","ⓛ":"Ⓘ","⍸":"i̲","ǐ":"ĭ","Ǐ":"Ĭ","ɨ":"i̵","ᵻ":"i̵","ᵼ":"i̵","ⅱ":"ii","ⅲ":"iii","ĳ":"ij","ⅳ":"iv","ⅸ":"ix","ｊ":"j","ⅉ":"j","𝐣":"j","𝑗":"j","𝒋":"j","𝒿":"j","𝓳":"j","𝔧":"j","𝕛":"j","𝖏":"j","𝗃":"j","𝗷":"j","𝘫":"j","𝙟":"j","𝚓":"j","ϳ":"j","ј":"j","Ｊ":"J","𝐉":"J","𝐽":"J","𝑱":"J","𝒥":"J","𝓙":"J","𝔍":"J","𝕁":"J","𝕵":"J","𝖩":"J","𝗝":"J","𝘑":"J","𝙅":"J","𝙹":"J","Ʝ":"J","Ϳ":"J","Ј":"J","Ꭻ":"J","ᒍ":"J","ꓙ":"J","ɉ":"j̵","Ɉ":"J̵","ᒙ":"J·","𝚥":"ȷ","յ":"ȷ","ꭻ":"ᴊ","𝐤":"k","𝑘":"k","𝒌":"k","𝓀":"k","𝓴":"k","𝔨":"k","𝕜":"k","𝖐":"k","𝗄":"k","𝗸":"k","𝘬":"k","𝙠":"k","𝚔":"k","K":"K","Ｋ":"K","𝐊":"K","𝐾":"K","𝑲":"K","𝒦":"K","𝓚":"K","𝔎":"K","𝕂":"K","𝕶":"K","𝖪":"K","𝗞":"K","𝘒":"K","𝙆":"K","𝙺":"K","Κ":"K","𝚱":"K","𝛫":"K","𝜥":"K","𝝟":"K","𝞙":"K","Ⲕ":"K","К":"K","Ꮶ":"K","ᛕ":"K","ꓗ":"K","𐔘":"K","ƙ":"k̔","Ⱪ":"K̩","Қ":"K̩","₭":"K̵","Ꝁ":"K̵","Ҟ":"K̵","Ƙ":"K\'","׀":"l","|":"l","∣":"l","⏽":"l","￨":"l","١":"l","۱":"l","𐌠":"l","𞣇":"l","𝟏":"l","𝟙":"l","𝟣":"l","𝟭":"l","𝟷":"l","🯱":"l","I":"l","Ｉ":"l","Ⅰ":"l","ℐ":"l","ℑ":"l","𝐈":"l","𝐼":"l","𝑰":"l","𝓘":"l","𝕀":"l","𝕴":"l","𝖨":"l","𝗜":"l","𝘐":"l","𝙄":"l","𝙸":"l","Ɩ":"l","ｌ":"l","ⅼ":"l","ℓ":"l","𝐥":"l","𝑙":"l","𝒍":"l","𝓁":"l","𝓵":"l","𝔩":"l","𝕝":"l","𝖑":"l","𝗅":"l","𝗹":"l","𝘭":"l","𝙡":"l","𝚕":"l","ǀ":"l","Ι":"l","𝚰":"l","𝛪":"l","𝜤":"l","𝝞":"l","𝞘":"l","Ⲓ":"l","І":"l","Ӏ":"l","ו":"l","ן":"l","ا":"l","𞸀":"l","𞺀":"l","ﺎ":"l","ﺍ":"l","ߊ":"l","ⵏ":"l","ᛁ":"l","ꓲ":"l","𖼨":"l","𐊊":"l","𐌉":"l","𝈪":"L","Ⅼ":"L","ℒ":"L","𝐋":"L","𝐿":"L","𝑳":"L","𝓛":"L","𝔏":"L","𝕃":"L","𝕷":"L","𝖫":"L","𝗟":"L","𝘓":"L","𝙇":"L","𝙻":"L","Ⳑ":"L","Ꮮ":"L","ᒪ":"L","ꓡ":"L","𖼖":"L","𑢣":"L","𑢲":"L","𐐛":"L","𐔦":"L","ﴼ":"l̋","ﴽ":"l̋","ł":"l̸","Ł":"L̸","ɭ":"l̨","Ɨ":"l̵","ƚ":"l̵","ɫ":"l̴","إ":"lٕ","ﺈ":"lٕ","ﺇ":"lٕ","ٳ":"lٕ","ŀ":"l·","Ŀ":"l·","ᒷ":"l·","🄂":"l,","⒈":"l.","ױ":"l\'","⒓":"l2.","㏫":"l2日","㋋":"l2月","㍤":"l2点","⒔":"l3.","㏬":"l3日","㍥":"l3点","⒕":"l4.","㏭":"l4日","㍦":"l4点","⒖":"l5.","㏮":"l5日","㍧":"l5点","⒗":"l6.","㏯":"l6日","㍨":"l6点","⒘":"l7.","㏰":"l7日","㍩":"l7点","⒙":"l8.","㏱":"l8日","㍪":"l8点","⒚":"l9.","㏲":"l9日","㍫":"l9点","ǉ":"lj","Ĳ":"lJ","ǈ":"Lj","Ǉ":"LJ","‖":"ll","∥":"ll","Ⅱ":"ll","ǁ":"ll","װ":"ll","𐆙":"l̵l̵","⒒":"ll.","Ⅲ":"lll","𐆘":"l̵l̵S̵","㏪":"ll日","㋊":"ll月","㍣":"ll点","Ю":"lO","⒑":"lO.","㏩":"lO日","㋉":"lO月","㍢":"lO点","ʪ":"ls","₶":"lt","Ⅳ":"lV","Ⅸ":"lX","ɮ":"lȝ","ʫ":"lz","أ":"lٴ","ﺄ":"lٴ","ﺃ":"lٴ","ٲ":"lٴ","ٵ":"lٴ","ﷳ":"lكبر","ﷲ":"lللّٰo","㏠":"l日","㋀":"l月","㍙":"l点","ⳑ":"ʟ","ꮮ":"ʟ","𐑃":"ʟ","Ｍ":"M","Ⅿ":"M","ℳ":"M","𝐌":"M","𝑀":"M","𝑴":"M","𝓜":"M","𝔐":"M","𝕄":"M","𝕸":"M","𝖬":"M","𝗠":"M","𝘔":"M","𝙈":"M","𝙼":"M","Μ":"M","𝚳":"M","𝛭":"M","𝜧":"M","𝝡":"M","𝞛":"M","Ϻ":"M","Ⲙ":"M","М":"M","Ꮇ":"M","ᗰ":"M","ᛖ":"M","ꓟ":"M","𐊰":"M","𐌑":"M","Ӎ":"M̦","🝫":"MB","ⷨ":"ᷟ","𝐧":"n","𝑛":"n","𝒏":"n","𝓃":"n","𝓷":"n","𝔫":"n","𝕟":"n","𝖓":"n","𝗇":"n","𝗻":"n","𝘯":"n","𝙣":"n","𝚗":"n","ո":"n","ռ":"n","Ｎ":"N","ℕ":"N","𝐍":"N","𝑁":"N","𝑵":"N","𝒩":"N","𝓝":"N","𝔑":"N","𝕹":"N","𝖭":"N","𝗡":"N","𝘕":"N","𝙉":"N","𝙽":"N","Ν":"N","𝚴":"N","𝛮":"N","𝜨":"N","𝝢":"N","𝞜":"N","Ⲛ":"N","ꓠ":"N","𐔓":"N","𐆎":"N̊","ɳ":"n̨","ƞ":"n̩","η":"n̩","𝛈":"n̩","𝜂":"n̩","𝜼":"n̩","𝝶":"n̩","𝞰":"n̩","Ɲ":"N̦","ᵰ":"n̴","ǌ":"nj","ǋ":"Nj","Ǌ":"NJ","№":"No","ͷ":"ᴎ","и":"ᴎ","𐑍":"ᴎ","ņ":"ɲ","ం":"o","ಂ":"o","ം":"o","ං":"o","०":"o","੦":"o","૦":"o","௦":"o","౦":"o","೦":"o","൦":"o","๐":"o","໐":"o","၀":"o","٥":"o","۵":"o","ｏ":"o","ℴ":"o","𝐨":"o","𝑜":"o","𝒐":"o","𝓸":"o","𝔬":"o","𝕠":"o","𝖔":"o","𝗈":"o","𝗼":"o","𝘰":"o","𝙤":"o","𝚘":"o","ᴏ":"o","ᴑ":"o","ꬽ":"o","ο":"o","𝛐":"o","𝜊":"o","𝝄":"o","𝝾":"o","𝞸":"o","σ":"o","𝛔":"o","𝜎":"o","𝝈":"o","𝞂":"o","𝞼":"o","ⲟ":"o","о":"o","ჿ":"o","օ":"o","ס":"o","ه":"o","𞸤":"o","𞹤":"o","𞺄":"o","ﻫ":"o","ﻬ":"o","ﻪ":"o","ﻩ":"o","ھ":"o","ﮬ":"o","ﮭ":"o","ﮫ":"o","ﮪ":"o","ہ":"o","ﮨ":"o","ﮩ":"o","ﮧ":"o","ﮦ":"o","ە":"o","ഠ":"o","ဝ":"o","𐓪":"o","𑣈":"o","𑣗":"o","𐐬":"o","߀":"O","০":"O","୦":"O","〇":"O","𑓐":"O","𑣠":"O","𝟎":"O","𝟘":"O","𝟢":"O","𝟬":"O","𝟶":"O","🯰":"O","Ｏ":"O","𝐎":"O","𝑂":"O","𝑶":"O","𝒪":"O","𝓞":"O","𝔒":"O","𝕆":"O","𝕺":"O","𝖮":"O","𝗢":"O","𝘖":"O","𝙊":"O","𝙾":"O","Ο":"O","𝚶":"O","𝛰":"O","𝜪":"O","𝝤":"O","𝞞":"O","Ⲟ":"O","О":"O","Օ":"O","ⵔ":"O","ዐ":"O","ଠ":"O","𐓂":"O","ꓳ":"O","𑢵":"O","𐊒":"O","𐊫":"O","𐐄":"O","𐔖":"O","⁰":"º","ᵒ":"º","ǒ":"ŏ","Ǒ":"Ŏ","ۿ":"ô","Ő":"Ö","ø":"o̸","ꬾ":"o̸","Ø":"O̸","ⵁ":"O̸","Ǿ":"Ó̸","ɵ":"o̵","ꝋ":"o̵","ө":"o̵","ѳ":"o̵","ꮎ":"o̵","ꮻ":"o̵","⊖":"O̵","⊝":"O̵","⍬":"O̵","𝈚":"O̵","🜔":"O̵","Ɵ":"O̵","Ꝋ":"O̵","θ":"O̵","ϑ":"O̵","𝛉":"O̵","𝛝":"O̵","𝜃":"O̵","𝜗":"O̵","𝜽":"O̵","𝝑":"O̵","𝝷":"O̵","𝞋":"O̵","𝞱":"O̵","𝟅":"O̵","Θ":"O̵","ϴ":"O̵","𝚯":"O̵","𝚹":"O̵","𝛩":"O̵","𝛳":"O̵","𝜣":"O̵","𝜭":"O̵","𝝝":"O̵","𝝧":"O̵","𝞗":"O̵","𝞡":"O̵","Ө":"O̵","Ѳ":"O̵","ⴱ":"O̵","Ꮎ":"O̵","Ꮻ":"O̵","ꭴ":"ơ","ﳙ":"oٰ","🄁":"O,","🄀":"O.","ơ":"o\'","Ơ":"O\'","Ꭴ":"O\'","%":"º/₀","٪":"º/₀","⁒":"º/₀","‰":"º/₀₀","؉":"º/₀₀","‱":"º/₀₀₀","؊":"º/₀₀₀","œ":"oe","Œ":"OE","ɶ":"oᴇ","∞":"oo","ꝏ":"oo","ꚙ":"oo","Ꝏ":"OO","Ꚙ":"OO","ﳗ":"oج","ﱑ":"oج","ﳘ":"oم","ﱒ":"oم","ﶓ":"oمج","ﶔ":"oمم","ﱓ":"oى","ﱔ":"oى","ൟ":"oരo","တ":"oာ","㍘":"O点","ↄ":"ɔ","ᴐ":"ɔ","ͻ":"ɔ","𐑋":"ɔ","Ↄ":"Ɔ","Ͻ":"Ɔ","ꓛ":"Ɔ","𐐣":"Ɔ","ꬿ":"ɔ̸","ꭢ":"ɔe","𐐿":"ɷ","⍴":"p","ｐ":"p","𝐩":"p","𝑝":"p","𝒑":"p","𝓅":"p","𝓹":"p","𝔭":"p","𝕡":"p","𝖕":"p","𝗉":"p","𝗽":"p","𝘱":"p","𝙥":"p","𝚙":"p","ρ":"p","ϱ":"p","𝛒":"p","𝛠":"p","𝜌":"p","𝜚":"p","𝝆":"p","𝝔":"p","𝞀":"p","𝞎":"p","𝞺":"p","𝟈":"p","ⲣ":"p","р":"p","Ｐ":"P","ℙ":"P","𝐏":"P","𝑃":"P","𝑷":"P","𝒫":"P","𝓟":"P","𝔓":"P","𝕻":"P","𝖯":"P","𝗣":"P","𝘗":"P","𝙋":"P","𝙿":"P","Ρ":"P","𝚸":"P","𝛲":"P","𝜬":"P","𝝦":"P","𝞠":"P","Ⲣ":"P","Р":"P","Ꮲ":"P","ᑭ":"P","ꓑ":"P","𐊕":"P","ƥ":"p̔","ᵽ":"p̵","ᑷ":"p·","ᒆ":"P\'","ᴩ":"ᴘ","ꮲ":"ᴘ","φ":"ɸ","ϕ":"ɸ","𝛗":"ɸ","𝛟":"ɸ","𝜑":"ɸ","𝜙":"ɸ","𝝋":"ɸ","𝝓":"ɸ","𝞅":"ɸ","𝞍":"ɸ","𝞿":"ɸ","𝟇":"ɸ","ⲫ":"ɸ","ф":"ɸ","𝐪":"q","𝑞":"q","𝒒":"q","𝓆":"q","𝓺":"q","𝔮":"q","𝕢":"q","𝖖":"q","𝗊":"q","𝗾":"q","𝘲":"q","𝙦":"q","𝚚":"q","ԛ":"q","գ":"q","զ":"q","ℚ":"Q","𝐐":"Q","𝑄":"Q","𝑸":"Q","𝒬":"Q","𝓠":"Q","𝔔":"Q","𝕼":"Q","𝖰":"Q","𝗤":"Q","𝘘":"Q","𝙌":"Q","𝚀":"Q","ⵕ":"Q","ʠ":"q̔","🜀":"QE","ᶐ":"ɋ","ᴋ":"ĸ","κ":"ĸ","ϰ":"ĸ","𝛋":"ĸ","𝛞":"ĸ","𝜅":"ĸ","𝜘":"ĸ","𝜿":"ĸ","𝝒":"ĸ","𝝹":"ĸ","𝞌":"ĸ","𝞳":"ĸ","𝟆":"ĸ","ⲕ":"ĸ","к":"ĸ","ꮶ":"ĸ","қ":"ĸ̩","ҟ":"ĸ̵","𝐫":"r","𝑟":"r","𝒓":"r","𝓇":"r","𝓻":"r","𝔯":"r","𝕣":"r","𝖗":"r","𝗋":"r","𝗿":"r","𝘳":"r","𝙧":"r","𝚛":"r","ꭇ":"r","ꭈ":"r","ᴦ":"r","ⲅ":"r","г":"r","ꮁ":"r","𝈖":"R","ℛ":"R","ℜ":"R","ℝ":"R","𝐑":"R","𝑅":"R","𝑹":"R","𝓡":"R","𝕽":"R","𝖱":"R","𝗥":"R","𝘙":"R","𝙍":"R","𝚁":"R","Ʀ":"R","Ꭱ":"R","Ꮢ":"R","𐒴":"R","ᖇ":"R","ꓣ":"R","𖼵":"R","ɽ":"r̨","ɼ":"r̩","ɍ":"r̵","ғ":"r̵","ᵲ":"r̴","ґ":"r\'","𑣣":"rn","m":"rn","ⅿ":"rn","𝐦":"rn","𝑚":"rn","𝒎":"rn","𝓂":"rn","𝓶":"rn","𝔪":"rn","𝕞":"rn","𝖒":"rn","𝗆":"rn","𝗺":"rn","𝘮":"rn","𝙢":"rn","𝚖":"rn","𑜀":"rn","₥":"rn̸","ɱ":"rn̦","ᵯ":"rn̴","₨":"Rs","ꭱ":"ʀ","ꮢ":"ʀ","я":"ᴙ","ᵳ":"ɾ̴","℩":"ɿ","ｓ":"s","𝐬":"s","𝑠":"s","𝒔":"s","𝓈":"s","𝓼":"s","𝔰":"s","𝕤":"s","𝖘":"s","𝗌":"s","𝘀":"s","𝘴":"s","𝙨":"s","𝚜":"s","ꜱ":"s","ƽ":"s","ѕ":"s","ꮪ":"s","𑣁":"s","𐑈":"s","Ｓ":"S","𝐒":"S","𝑆":"S","𝑺":"S","𝒮":"S","𝓢":"S","𝔖":"S","𝕊":"S","𝕾":"S","𝖲":"S","𝗦":"S","𝘚":"S","𝙎":"S","𝚂":"S","Ѕ":"S","Տ":"S","Ꮥ":"S","Ꮪ":"S","ꓢ":"S","𖼺":"S","𐊖":"S","𐐠":"S","ʂ":"s̨","ᵴ":"s̴","ꞵ":"ß","β":"ß","ϐ":"ß","𝛃":"ß","𝛽":"ß","𝜷":"ß","𝝱":"ß","𝞫":"ß","Ᏸ":"ß","🝜":"sss","ﬆ":"st","∫":"ʃ","ꭍ":"ʃ","∑":"Ʃ","⅀":"Ʃ","Σ":"Ʃ","𝚺":"Ʃ","𝛴":"Ʃ","𝜮":"Ʃ","𝝨":"Ʃ","𝞢":"Ʃ","ⵉ":"Ʃ","∬":"ʃʃ","∭":"ʃʃʃ","⨌":"ʃʃʃʃ","𝐭":"t","𝑡":"t","𝒕":"t","𝓉":"t","𝓽":"t","𝔱":"t","𝕥":"t","𝖙":"t","𝗍":"t","𝘁":"t","𝘵":"t","𝙩":"t","𝚝":"t","⊤":"T","⟙":"T","🝨":"T","Ｔ":"T","𝐓":"T","𝑇":"T","𝑻":"T","𝒯":"T","𝓣":"T","𝔗":"T","𝕋":"T","𝕿":"T","𝖳":"T","𝗧":"T","𝘛":"T","𝙏":"T","𝚃":"T","Τ":"T","𝚻":"T","𝛵":"T","𝜯":"T","𝝩":"T","𝞣":"T","Ⲧ":"T","Т":"T","Ꭲ":"T","ꓔ":"T","𖼊":"T","𑢼":"T","𐊗":"T","𐊱":"T","𐌕":"T","ƭ":"t̔","⍡":"T̈","Ⱦ":"T̸","Ț":"Ţ","Ʈ":"T̨","Ҭ":"T̩","₮":"T⃫","ŧ":"t̵","Ŧ":"T̵","ᵵ":"t̴","Ⴀ":"Ꞇ","Ꜩ":"T3","ʨ":"tɕ","℡":"TEL","ꝷ":"tf","ʦ":"ts","ʧ":"tʃ","ꜩ":"tȝ","τ":"ᴛ","𝛕":"ᴛ","𝜏":"ᴛ","𝝉":"ᴛ","𝞃":"ᴛ","𝞽":"ᴛ","т":"ᴛ","ꭲ":"ᴛ","ҭ":"ᴛ̩","ţ":"ƫ","ț":"ƫ","Ꮏ":"ƫ","𝐮":"u","𝑢":"u","𝒖":"u","𝓊":"u","𝓾":"u","𝔲":"u","𝕦":"u","𝖚":"u","𝗎":"u","𝘂":"u","𝘶":"u","𝙪":"u","𝚞":"u","ꞟ":"u","ᴜ":"u","ꭎ":"u","ꭒ":"u","ʋ":"u","υ":"u","𝛖":"u","𝜐":"u","𝝊":"u","𝞄":"u","𝞾":"u","ս":"u","𐓶":"u","𑣘":"u","∪":"U","⋃":"U","𝐔":"U","𝑈":"U","𝑼":"U","𝒰":"U","𝓤":"U","𝔘":"U","𝕌":"U","𝖀":"U","𝖴":"U","𝗨":"U","𝘜":"U","𝙐":"U","𝚄":"U","Ս":"U","ሀ":"U","𐓎":"U","ᑌ":"U","ꓴ":"U","𖽂":"U","𑢸":"U","ǔ":"ŭ","Ǔ":"Ŭ","ᵾ":"u̵","ꮜ":"u̵","Ʉ":"U̵","Ꮜ":"U̵","ᑘ":"U·","ᑧ":"U\'","ᵫ":"ue","ꭣ":"uo","ṃ":"ꭑ","պ":"ɰ","ሣ":"ɰ","℧":"Ʊ","ᘮ":"Ʊ","ᘴ":"Ʊ","ᵿ":"ʊ̵","∨":"v","⋁":"v","ｖ":"v","ⅴ":"v","𝐯":"v","𝑣":"v","𝒗":"v","𝓋":"v","𝓿":"v","𝔳":"v","𝕧":"v","𝖛":"v","𝗏":"v","𝘃":"v","𝘷":"v","𝙫":"v","𝚟":"v","ᴠ":"v","ν":"v","𝛎":"v","𝜈":"v","𝝂":"v","𝝼":"v","𝞶":"v","ѵ":"v","ט":"v","𑜆":"v","ꮩ":"v","𑣀":"v","𝈍":"V","٧":"V","۷":"V","Ⅴ":"V","𝐕":"V","𝑉":"V","𝑽":"V","𝒱":"V","𝓥":"V","𝔙":"V","𝕍":"V","𝖁":"V","𝖵":"V","𝗩":"V","𝘝":"V","𝙑":"V","𝚅":"V","Ѵ":"V","ⴸ":"V","Ꮩ":"V","ᐯ":"V","ꛟ":"V","ꓦ":"V","𖼈":"V","𑢠":"V","𐔝":"V","𐆗":"V̵","ᐻ":"V·","🝬":"VB","ⅵ":"vi","ⅶ":"vii","ⅷ":"viii","Ⅵ":"Vl","Ⅶ":"Vll","Ⅷ":"Vlll","🜈":"Vᷤ","ᴧ":"ʌ","𐓘":"ʌ","٨":"Ʌ","۸":"Ʌ","Λ":"Ʌ","𝚲":"Ʌ","𝛬":"Ʌ","𝜦":"Ʌ","𝝠":"Ʌ","𝞚":"Ʌ","Л":"Ʌ","ⴷ":"Ʌ","𐒰":"Ʌ","ᐱ":"Ʌ","ꛎ":"Ʌ","ꓥ":"Ʌ","𖼽":"Ʌ","𐊍":"Ʌ","Ӆ":"Ʌ̦","ᐽ":"Ʌ·","ɯ":"w","𝐰":"w","𝑤":"w","𝒘":"w","𝓌":"w","𝔀":"w","𝔴":"w","𝕨":"w","𝖜":"w","𝗐":"w","𝘄":"w","𝘸":"w","𝙬":"w","𝚠":"w","ᴡ":"w","ѡ":"w","ԝ":"w","ա":"w","𑜊":"w","𑜎":"w","𑜏":"w","ꮃ":"w","𑣯":"W","𑣦":"W","𝐖":"W","𝑊":"W","𝑾":"W","𝒲":"W","𝓦":"W","𝔚":"W","𝕎":"W","𝖂":"W","𝖶":"W","𝗪":"W","𝘞":"W","𝙒":"W","𝚆":"W","Ԝ":"W","Ꮃ":"W","Ꮤ":"W","ꓪ":"W","ѽ":"w҆҇","𑓅":"ẇ","₩":"W̵","ꝡ":"w̦","ᴍ":"ʍ","м":"ʍ","ꮇ":"ʍ","ӎ":"ʍ̦","᙮":"x","×":"x","⤫":"x","⤬":"x","⨯":"x","ｘ":"x","ⅹ":"x","𝐱":"x","𝑥":"x","𝒙":"x","𝓍":"x","𝔁":"x","𝔵":"x","𝕩":"x","𝖝":"x","𝗑":"x","𝘅":"x","𝘹":"x","𝙭":"x","𝚡":"x","х":"x","ᕁ":"x","ᕽ":"x","ⷯ":"ͯ","᙭":"X","╳":"X","𐌢":"X","𑣬":"X","Ｘ":"X","Ⅹ":"X","𝐗":"X","𝑋":"X","𝑿":"X","𝒳":"X","𝓧":"X","𝔛":"X","𝕏":"X","𝖃":"X","𝖷":"X","𝗫":"X","𝘟":"X","𝙓":"X","𝚇":"X","Ꭓ":"X","Χ":"X","𝚾":"X","𝛸":"X","𝜲":"X","𝝬":"X","𝞦":"X","Ⲭ":"X","Х":"X","ⵝ":"X","ᚷ":"X","ꓫ":"X","𐊐":"X","𐊴":"X","𐌗":"X","𐔧":"X","⨰":"ẋ","Ҳ":"X̩","𐆖":"X̵","ⅺ":"xi","ⅻ":"xii","Ⅺ":"Xl","Ⅻ":"Xll","ɣ":"y","ᶌ":"y","ｙ":"y","𝐲":"y","𝑦":"y","𝒚":"y","𝓎":"y","𝔂":"y","𝔶":"y","𝕪":"y","𝖞":"y","𝗒":"y","𝘆":"y","𝘺":"y","𝙮":"y","𝚢":"y","ʏ":"y","ỿ":"y","ꭚ":"y","γ":"y","ℽ":"y","𝛄":"y","𝛾":"y","𝜸":"y","𝝲":"y","𝞬":"y","у":"y","ү":"y","ყ":"y","𑣜":"y","Ｙ":"Y","𝐘":"Y","𝑌":"Y","𝒀":"Y","𝒴":"Y","𝓨":"Y","𝔜":"Y","𝕐":"Y","𝖄":"Y","𝖸":"Y","𝗬":"Y","𝘠":"Y","𝙔":"Y","𝚈":"Y","Υ":"Y","ϒ":"Y","𝚼":"Y","𝛶":"Y","𝜰":"Y","𝝪":"Y","𝞤":"Y","Ⲩ":"Y","У":"Y","Ү":"Y","Ꭹ":"Y","Ꮍ":"Y","ꓬ":"Y","𖽃":"Y","𑢤":"Y","𐊲":"Y","ƴ":"y̔","ɏ":"y̵","ұ":"y̵","¥":"Y̵","Ɏ":"Y̵","Ұ":"Y̵","ʒ":"ȝ","ꝫ":"ȝ","ⳍ":"ȝ","ӡ":"ȝ","ჳ":"ȝ","𝐳":"z","𝑧":"z","𝒛":"z","𝓏":"z","𝔃":"z","𝔷":"z","𝕫":"z","𝖟":"z","𝗓":"z","𝘇":"z","𝘻":"z","𝙯":"z","𝚣":"z","ᴢ":"z","ꮓ":"z","𑣄":"z","𐋵":"Z","𑣥":"Z","Ｚ":"Z","ℤ":"Z","ℨ":"Z","𝐙":"Z","𝑍":"Z","𝒁":"Z","𝒵":"Z","𝓩":"Z","𝖅":"Z","𝖹":"Z","𝗭":"Z","𝘡":"Z","𝙕":"Z","𝚉":"Z","Ζ":"Z","𝚭":"Z","𝛧":"Z","𝜡":"Z","𝝛":"Z","𝞕":"Z","Ꮓ":"Z","ꓜ":"Z","𑢩":"Z","ʐ":"z̨","ƶ":"z̵","Ƶ":"Z̵","ȥ":"z̦","Ȥ":"Z̦","ᵶ":"z̴","ƿ":"þ","ϸ":"þ","Ϸ":"Þ","𐓄":"Þ","⁹":"ꝰ","ᴤ":"ƨ","ϩ":"ƨ","ꙅ":"ƨ","ь":"ƅ","ꮟ":"ƅ","ы":"ƅi","ꭾ":"ɂ","ˤ":"ˁ","ꛍ":"ʡ","⊙":"ʘ","☉":"ʘ","⨀":"ʘ","Ꙩ":"ʘ","ⵙ":"ʘ","𐓃":"ʘ","ℾ":"Γ","𝚪":"Γ","𝛤":"Γ","𝜞":"Γ","𝝘":"Γ","𝞒":"Γ","Ⲅ":"Γ","Г":"Γ","Ꮁ":"Γ","ᒥ":"Γ","𖼇":"Γ","Ғ":"Γ̵","ᒯ":"Γ·","Ґ":"Γ\'","∆":"Δ","△":"Δ","🜂":"Δ","𝚫":"Δ","𝛥":"Δ","𝜟":"Δ","𝝙":"Δ","𝞓":"Δ","Ⲇ":"Δ","ⵠ":"Δ","ᐃ":"Δ","𖼚":"Δ","𐊅":"Δ","𐊣":"Δ","⍙":"Δ̲","ᐏ":"Δ·","ᐬ":"Δᐠ","𝟋":"ϝ","𝛇":"ζ","𝜁":"ζ","𝜻":"ζ","𝝵":"ζ","𝞯":"ζ","ⳤ":"ϗ","𝛌":"λ","𝜆":"λ","𝝀":"λ","𝝺":"λ","𝞴":"λ","Ⲗ":"λ","𐓛":"λ","µ":"μ","𝛍":"μ","𝜇":"μ","𝝁":"μ","𝝻":"μ","𝞵":"μ","𝛏":"ξ","𝜉":"ξ","𝝃":"ξ","𝝽":"ξ","𝞷":"ξ","𝚵":"Ξ","𝛯":"Ξ","𝜩":"Ξ","𝝣":"Ξ","𝞝":"Ξ","ϖ":"π","ℼ":"π","𝛑":"π","𝛡":"π","𝜋":"π","𝜛":"π","𝝅":"π","𝝕":"π","𝝿":"π","𝞏":"π","𝞹":"π","𝟉":"π","ᴨ":"π","п":"π","∏":"Π","ℿ":"Π","𝚷":"Π","𝛱":"Π","𝜫":"Π","𝝥":"Π","𝞟":"Π","Ⲡ":"Π","П":"Π","ꛛ":"Π","𐊭":"Ϙ","𐌒":"Ϙ","ϛ":"ς","𝛓":"ς","𝜍":"ς","𝝇":"ς","𝞁":"ς","𝞻":"ς","𝚽":"Φ","𝛷":"Φ","𝜱":"Φ","𝝫":"Φ","𝞥":"Φ","Ⲫ":"Φ","Ф":"Φ","Փ":"Φ","ቀ":"Φ","ᛰ":"Φ","𐊳":"Φ","ꭓ":"χ","ꭕ":"χ","𝛘":"χ","𝜒":"χ","𝝌":"χ","𝞆":"χ","𝟀":"χ","ⲭ":"χ","𝛙":"ψ","𝜓":"ψ","𝝍":"ψ","𝞇":"ψ","𝟁":"ψ","ѱ":"ψ","𐓹":"ψ","𝚿":"Ψ","𝛹":"Ψ","𝜳":"Ψ","𝝭":"Ψ","𝞧":"Ψ","Ⲯ":"Ψ","Ѱ":"Ψ","𐓑":"Ψ","ᛘ":"Ψ","𐊵":"Ψ","⍵":"ω","ꞷ":"ω","𝛚":"ω","𝜔":"ω","𝝎":"ω","𝞈":"ω","𝟂":"ω","ⲱ":"ω","ꙍ":"ω","Ω":"Ω","𝛀":"Ω","𝛺":"Ω","𝜴":"Ω","𝝮":"Ω","𝞨":"Ω","ᘯ":"Ω","ᘵ":"Ω","𐊶":"Ω","⍹":"ω̲","ώ":"ῴ","☰":"Ⲷ","Ⳝ":"Ϭ","җ":"ж̩","Җ":"Ж̩","𝈋":"И","Ͷ":"И","ꚡ":"И","𐐥":"И","Й":"Ѝ","Ҋ":"Ѝ̦","ѝ":"й","ҋ":"й̦","𐒼":"Ӄ","ᴫ":"л","ӆ":"л̦","ꭠ":"љ","𐓫":"ꙩ","ᷮ":"ⷬ","𐓍":"Ћ","𝈂":"Ӿ","𝈢":"Ѡ","Ꮗ":"Ѡ","ᗯ":"Ѡ","Ѽ":"Ѡ҆҇","ᣭ":"Ѡ·","Ꞷ":"Ꙍ","ӌ":"ҷ","Ӌ":"Ҷ","Ҿ":"Ҽ̨","ⲽ":"ш","Ⲽ":"Ш","Ꙑ":"Ъl","℈":"Э","🜁":"Ꙙ","𖼜":"Ꙙ","ꦒ":"ⰿ","և":"եւ","ኔ":"ձ","ﬔ":"մե","ﬕ":"մի","ﬗ":"մխ","ﬓ":"մն","∩":"Ո","⋂":"Ո","𝉅":"Ո","በ":"Ո","ᑎ":"Ո","ꓵ":"Ո","ᑚ":"Ո·","ᑨ":"Ո\'","ﬖ":"վն","₽":"Ք","˓":"ՙ","ʿ":"ՙ","ℵ":"א","ﬡ":"א","אָ":"אַ","אּ":"אַ","ﭏ":"אל","ℶ":"ב","ℷ":"ג","ℸ":"ד","ﬢ":"ד","ﬣ":"ה","יּ":"יִ","ﬤ":"כ","ﬥ":"ל","ﬦ":"ם","ﬠ":"ע","ﬧ":"ר","שׂ":"שׁ","שּ":"שׁ","שּׂ":"שּׁ","ﬨ":"ת","ﺀ":"ء","۽":"ء͈","ﺂ":"آ","ﺁ":"آ","ﭑ":"ٱ","ﭐ":"ٱ","𞸁":"ب","𞸡":"ب","𞹡":"ب","𞺁":"ب","𞺡":"ب","ﺑ":"ب","ﺒ":"ب","ﺐ":"ب","ﺏ":"ب","ݑ":"بۛ","ࢶ":"بۢ","ࢡ":"بٔ","ﲠ":"بo","ﳢ":"بo","ﲜ":"بج","ﰅ":"بج","ﲝ":"بح","ﰆ":"بح","ﷂ":"بحى","ﲞ":"بخ","ﰇ":"بخ","ﳒ":"بخ","ﱋ":"بخ","ﶞ":"بخى","ﱪ":"بر","ﱫ":"بز","ﲟ":"بم","ﳡ":"بم","ﱬ":"بم","ﰈ":"بم","ﱭ":"بن","ﱮ":"بى","ﰉ":"بى","ﱯ":"بى","ﰊ":"بى","ﭔ":"ٻ","ﭕ":"ٻ","ﭓ":"ٻ","ﭒ":"ٻ","ې":"ٻ","ﯦ":"ٻ","ﯧ":"ٻ","ﯥ":"ٻ","ﯤ":"ٻ","ﭜ":"ڀ","ﭝ":"ڀ","ﭛ":"ڀ","ﭚ":"ڀ","ࢩ":"ݔ","ݧ":"ݔ","⍥":"ة","ö":"ة","ﺔ":"ة","ﺓ":"ة","ۃ":"ة","𞸕":"ت","𞸵":"ت","𞹵":"ت","𞺕":"ت","𞺵":"ت","ﺗ":"ت","ﺘ":"ت","ﺖ":"ت","ﺕ":"ت","ﲥ":"تo","ﳤ":"تo","ﲡ":"تج","ﰋ":"تج","ﵐ":"تجم","ﶠ":"تجى","ﶟ":"تجى","ﲢ":"تح","ﰌ":"تح","ﵒ":"تحج","ﵑ":"تحج","ﵓ":"تحم","ﲣ":"تخ","ﰍ":"تخ","ﵔ":"تخم","ﶢ":"تخى","ﶡ":"تخى","ﱰ":"تر","ﱱ":"تز","ﲤ":"تم","ﳣ":"تم","ﱲ":"تم","ﰎ":"تم","ﵕ":"تمج","ﵖ":"تمح","ﵗ":"تمخ","ﶤ":"تمى","ﶣ":"تمى","ﱳ":"تن","ﱴ":"تى","ﰏ":"تى","ﱵ":"تى","ﰐ":"تى","ﭠ":"ٺ","ﭡ":"ٺ","ﭟ":"ٺ","ﭞ":"ٺ","ﭤ":"ٿ","ﭥ":"ٿ","ﭣ":"ٿ","ﭢ":"ٿ","𞸂":"ج","𞸢":"ج","𞹂":"ج","𞹢":"ج","𞺂":"ج","𞺢":"ج","ﺟ":"ج","ﺠ":"ج","ﺞ":"ج","ﺝ":"ج","ﲧ":"جح","ﰕ":"جح","ﶦ":"جحى","ﶾ":"جحى","ﷻ":"جل جلlلo","ﲨ":"جم","ﰖ":"جم","ﵙ":"جمح","ﵘ":"جمح","ﶧ":"جمى","ﶥ":"جمى","ﴝ":"جى","ﴁ":"جى","ﴞ":"جى","ﴂ":"جى","ﭸ":"ڃ","ﭹ":"ڃ","ﭷ":"ڃ","ﭶ":"ڃ","ﭴ":"ڄ","ﭵ":"ڄ","ﭳ":"ڄ","ﭲ":"ڄ","ﭼ":"چ","ﭽ":"چ","ﭻ":"چ","ﭺ":"چ","ﮀ":"ڇ","ﮁ":"ڇ","ﭿ":"ڇ","ﭾ":"ڇ","𞸇":"ح","𞸧":"ح","𞹇":"ح","𞹧":"ح","𞺇":"ح","𞺧":"ح","ﺣ":"ح","ﺤ":"ح","ﺢ":"ح","ﺡ":"ح","څ":"حۛ","ځ":"حٔ","ݲ":"حٔ","ﲩ":"حج","ﰗ":"حج","ﶿ":"حجى","ﲪ":"حم","ﰘ":"حم","ﵛ":"حمى","ﵚ":"حمى","ﴛ":"حى","ﳿ":"حى","ﴜ":"حى","ﴀ":"حى","𞸗":"خ","𞸷":"خ","𞹗":"خ","𞹷":"خ","𞺗":"خ","𞺷":"خ","ﺧ":"خ","ﺨ":"خ","ﺦ":"خ","ﺥ":"خ","ﲫ":"خج","ﰙ":"خج","ﰚ":"خح","ﲬ":"خم","ﰛ":"خم","ﴟ":"خى","ﴃ":"خى","ﴠ":"خى","ﴄ":"خى","𐋡":"د","𞸃":"د","𞺃":"د","𞺣":"د","ﺪ":"د","ﺩ":"د","ڈ":"دؕ","ﮉ":"دؕ","ﮈ":"دؕ","ڎ":"دۛ","ﮇ":"دۛ","ﮆ":"دۛ","ۮ":"د̂","ࢮ":"د̤̣","𞸘":"ذ","𞺘":"ذ","𞺸":"ذ","ﺬ":"ذ","ﺫ":"ذ","ﱛ":"ذٰ","ڋ":"ڊؕ","ﮅ":"ڌ","ﮄ":"ڌ","ﮃ":"ڍ","ﮂ":"ڍ","𞸓":"ر","𞺓":"ر","𞺳":"ر","ﺮ":"ر","ﺭ":"ر","ڑ":"رؕ","ﮍ":"رؕ","ﮌ":"رؕ","ژ":"رۛ","ﮋ":"رۛ","ﮊ":"رۛ","ڒ":"ر̆","ࢹ":"ر̆̇","ۯ":"ر̂","ݬ":"رٔ","ﱜ":"رٰ","ﷶ":"رسول","﷼":"رىlل","𞸆":"ز","𞺆":"ز","𞺦":"ز","ﺰ":"ز","ﺯ":"ز","ࢲ":"ز̂","ݱ":"ڗؕ","𞸎":"س","𞸮":"س","𞹎":"س","𞹮":"س","𞺎":"س","𞺮":"س","ﺳ":"س","ﺴ":"س","ﺲ":"س","ﺱ":"س","ش":"سۛ","𞸔":"سۛ","𞸴":"سۛ","𞹔":"سۛ","𞹴":"سۛ","𞺔":"سۛ","𞺴":"سۛ","ﺷ":"سۛ","ﺸ":"سۛ","ﺶ":"سۛ","ﺵ":"سۛ","ݾ":"س̂","ﴱ":"سo","ﳨ":"سo","ﴲ":"سۛo","ﳪ":"سۛo","ﲭ":"سج","ﴴ":"سج","ﰜ":"سج","ﴭ":"سۛج","ﴷ":"سۛج","ﴥ":"سۛج","ﴉ":"سۛج","ﵝ":"سجح","ﵞ":"سجى","ﵩ":"سۛجى","ﲮ":"سح","ﴵ":"سح","ﰝ":"سح","ﴮ":"سۛح","ﴸ":"سۛح","ﴦ":"سۛح","ﴊ":"سۛح","ﵜ":"سحج","ﵨ":"سۛحم","ﵧ":"سۛحم","ﶪ":"سۛحى","ﲯ":"سخ","ﴶ":"سخ","ﰞ":"سخ","ﴯ":"سۛخ","ﴹ":"سۛخ","ﴧ":"سۛخ","ﴋ":"سۛخ","ﶨ":"سخى","ﷆ":"سخى","ﴪ":"سر","ﴎ":"سر","ﴩ":"سۛر","ﴍ":"سۛر","ﲰ":"سم","ﳧ":"سم","ﰟ":"سم","ﴰ":"سۛم","ﳩ":"سۛم","ﴨ":"سۛم","ﴌ":"سۛم","ﵡ":"سمج","ﵠ":"سمح","ﵟ":"سمح","ﵫ":"سۛمخ","ﵪ":"سۛمخ","ﵣ":"سمم","ﵢ":"سمم","ﵭ":"سۛمم","ﵬ":"سۛمم","ﴗ":"سى","ﳻ":"سى","ﴘ":"سى","ﳼ":"سى","ﴙ":"سۛى","ﳽ":"سۛى","ﴚ":"سۛى","ﳾ":"سۛى","𐋲":"ص","𞸑":"ص","𞸱":"ص","𞹑":"ص","𞹱":"ص","𞺑":"ص","𞺱":"ص","ﺻ":"ص","ﺼ":"ص","ﺺ":"ص","ﺹ":"ص","ڞ":"صۛ","ࢯ":"ص̤̣","ﲱ":"صح","ﰠ":"صح","ﵥ":"صحح","ﵤ":"صحح","ﶩ":"صحى","ﲲ":"صخ","ﴫ":"صر","ﴏ":"صر","ﷵ":"صلعم","ﷹ":"صلى","ﷰ":"صلى","ﷺ":"صلى lللo علىo وسلم","ﲳ":"صم","ﰡ":"صم","ﷅ":"صمم","ﵦ":"صمم","ﴡ":"صى","ﴅ":"صى","ﴢ":"صى","ﴆ":"صى","𞸙":"ض","𞸹":"ض","𞹙":"ض","𞹹":"ض","𞺙":"ض","𞺹":"ض","ﺿ":"ض","ﻀ":"ض","ﺾ":"ض","ﺽ":"ض","ﲴ":"ضج","ﰢ":"ضج","ﲵ":"ضح","ﰣ":"ضح","ﵮ":"ضحى","ﶫ":"ضحى","ﲶ":"ضخ","ﰤ":"ضخ","ﵰ":"ضخم","ﵯ":"ضخم","ﴬ":"ضر","ﴐ":"ضر","ﲷ":"ضم","ﰥ":"ضم","ﴣ":"ضى","ﴇ":"ضى","ﴤ":"ضى","ﴈ":"ضى","𐋨":"ط","𞸈":"ط","𞹨":"ط","𞺈":"ط","𞺨":"ط","ﻃ":"ط","ﻄ":"ط","ﻂ":"ط","ﻁ":"ط","ڟ":"طۛ","ﲸ":"طح","ﰦ":"طح","ﴳ":"طم","ﴺ":"طم","ﰧ":"طم","ﵲ":"طمح","ﵱ":"طمح","ﵳ":"طمم","ﵴ":"طمى","ﴑ":"طى","ﳵ":"طى","ﴒ":"طى","ﳶ":"طى","𞸚":"ظ","𞹺":"ظ","𞺚":"ظ","𞺺":"ظ","ﻇ":"ظ","ﻈ":"ظ","ﻆ":"ظ","ﻅ":"ظ","ﲹ":"ظم","ﴻ":"ظم","ﰨ":"ظم","؏":"ع","𞸏":"ع","𞸯":"ع","𞹏":"ع","𞹯":"ع","𞺏":"ع","𞺯":"ع","ﻋ":"ع","ﻌ":"ع","ﻊ":"ع","ﻉ":"ع","ﲺ":"عج","ﰩ":"عج","ﷄ":"عجم","ﵵ":"عجم","ﷷ":"علىo","ﲻ":"عم","ﰪ":"عم","ﵷ":"عمم","ﵶ":"عمم","ﵸ":"عمى","ﶶ":"عمى","ﴓ":"عى","ﳷ":"عى","ﴔ":"عى","ﳸ":"عى","𞸛":"غ","𞸻":"غ","𞹛":"غ","𞹻":"غ","𞺛":"غ","𞺻":"غ","ﻏ":"غ","ﻐ":"غ","ﻎ":"غ","ﻍ":"غ","ﲼ":"غج","ﰫ":"غج","ﲽ":"غم","ﰬ":"غم","ﵹ":"غمم","ﵻ":"غمى","ﵺ":"غمى","ﴕ":"غى","ﳹ":"غى","ﴖ":"غى","ﳺ":"غى","𞸐":"ف","𞸰":"ف","𞹰":"ف","𞺐":"ف","𞺰":"ف","ﻓ":"ف","ﻔ":"ف","ﻒ":"ف","ﻑ":"ف","ڧ":"ف","ﲾ":"فج","ﰭ":"فج","ﲿ":"فح","ﰮ":"فح","ﳀ":"فخ","ﰯ":"فخ","ﵽ":"فخم","ﵼ":"فخم","ﳁ":"فم","ﰰ":"فم","ﷁ":"فمى","ﱼ":"فى","ﰱ":"فى","ﱽ":"فى","ﰲ":"فى","𞸞":"ڡ","𞹾":"ڡ","ࢻ":"ڡ","ٯ":"ڡ","𞸟":"ڡ","𞹟":"ڡ","ࢼ":"ڡ","ڤ":"ڡۛ","ﭬ":"ڡۛ","ﭭ":"ڡۛ","ﭫ":"ڡۛ","ﭪ":"ڡۛ","ڨ":"ڡۛ","ࢤ":"ڢۛ","ﭰ":"ڦ","ﭱ":"ڦ","ﭯ":"ڦ","ﭮ":"ڦ","𞸒":"ق","𞸲":"ق","𞹒":"ق","𞹲":"ق","𞺒":"ق","𞺲":"ق","ﻗ":"ق","ﻘ":"ق","ﻖ":"ق","ﻕ":"ق","ﳂ":"قح","ﰳ":"قح","ﷱ":"قلى","ﳃ":"قم","ﰴ":"قم","ﶴ":"قمح","ﵾ":"قمح","ﵿ":"قمم","ﶲ":"قمى","ﱾ":"قى","ﰵ":"قى","ﱿ":"قى","ﰶ":"قى","𞸊":"ك","𞸪":"ك","𞹪":"ك","ﻛ":"ك","ﻜ":"ك","ﻚ":"ك","ﻙ":"ك","ک":"ك","ﮐ":"ك","ﮑ":"ك","ﮏ":"ك","ﮎ":"ك","ڪ":"ك","ڭ":"كۛ","ﯕ":"كۛ","ﯖ":"كۛ","ﯔ":"كۛ","ﯓ":"كۛ","ݣ":"كۛ","ﲀ":"كl","ﰷ":"كl","ﳄ":"كج","ﰸ":"كج","ﳅ":"كح","ﰹ":"كح","ﳆ":"كخ","ﰺ":"كخ","ﳇ":"كل","ﳫ":"كل","ﲁ":"كل","ﰻ":"كل","ﳈ":"كم","ﳬ":"كم","ﲂ":"كم","ﰼ":"كم","ﷃ":"كمم","ﶻ":"كمم","ﶷ":"كمى","ﲃ":"كى","ﰽ":"كى","ﲄ":"كى","ﰾ":"كى","ݢ":"ڬ","ﮔ":"گ","ﮕ":"گ","ﮓ":"گ","ﮒ":"گ","ࢰ":"گ","ڴ":"گۛ","ﮜ":"ڱ","ﮝ":"ڱ","ﮛ":"ڱ","ﮚ":"ڱ","ﮘ":"ڳ","ﮙ":"ڳ","ﮗ":"ڳ","ﮖ":"ڳ","𞸋":"ل","𞸫":"ل","𞹋":"ل","𞺋":"ل","𞺫":"ل","ﻟ":"ل","ﻠ":"ل","ﻞ":"ل","ﻝ":"ل","ڷ":"لۛ","ڵ":"ل̆","ﻼ":"لl","ﻻ":"لl","ﻺ":"لlٕ","ﻹ":"لlٕ","ﻸ":"لlٴ","ﻷ":"لlٴ","ﳍ":"لo","ﻶ":"لآ","ﻵ":"لآ","ﳉ":"لج","ﰿ":"لج","ﶃ":"لجج","ﶄ":"لجج","ﶺ":"لجم","ﶼ":"لجم","ﶬ":"لجى","ﳊ":"لح","ﱀ":"لح","ﶵ":"لحم","ﶀ":"لحم","ﶂ":"لحى","ﶁ":"لحى","ﳋ":"لخ","ﱁ":"لخ","ﶆ":"لخم","ﶅ":"لخم","ﳌ":"لم","ﳭ":"لم","ﲅ":"لم","ﱂ":"لم","ﶈ":"لمح","ﶇ":"لمح","ﶭ":"لمى","ﲆ":"لى","ﱃ":"لى","ﲇ":"لى","ﱄ":"لى","𞸌":"م","𞸬":"م","𞹬":"م","𞺌":"م","𞺬":"م","ﻣ":"م","ﻤ":"م","ﻢ":"م","ﻡ":"م","ࢧ":"مۛ","۾":"م͈","ﲈ":"مl","ﳎ":"مج","ﱅ":"مج","ﶌ":"مجح","ﶒ":"مجخ","ﶍ":"مجم","ﷀ":"مجى","ﳏ":"مح","ﱆ":"مح","ﶉ":"محج","ﶊ":"محم","ﷴ":"محمد","ﶋ":"محى","ﳐ":"مخ","ﱇ":"مخ","ﶎ":"مخج","ﶏ":"مخم","ﶹ":"مخى","ﳑ":"مم","ﲉ":"مم","ﱈ":"مم","ﶱ":"ممى","ﱉ":"مى","ﱊ":"مى","𞸍":"ن","𞸭":"ن","𞹍":"ن","𞹭":"ن","𞺍":"ن","𞺭":"ن","ﻧ":"ن","ﻨ":"ن","ﻦ":"ن","ﻥ":"ن","ݨ":"نؕ","ݩ":"ن̆","ﳖ":"نo","ﳯ":"نo","ﶸ":"نجح","ﶽ":"نجح","ﶘ":"نجم","ﶗ":"نجم","ﶙ":"نجى","ﷇ":"نجى","ﳓ":"نح","ﱌ":"نح","ﶕ":"نحم","ﶖ":"نحى","ﶳ":"نحى","ﳔ":"نخ","ﱍ":"نخ","ﲊ":"نر","ﲋ":"نز","ﳕ":"نم","ﳮ":"نم","ﲌ":"نم","ﱎ":"نم","ﶛ":"نمى","ﶚ":"نمى","ﲍ":"نن","ﲎ":"نى","ﱏ":"نى","ﲏ":"نى","ﱐ":"نى","ۂ":"ۀ","ﮥ":"ۀ","ﮤ":"ۀ","𐋤":"و","𞸅":"و","𞺅":"و","𞺥":"و","ﻮ":"و","ﻭ":"و","ࢱ":"و","ۋ":"وۛ","ﯟ":"وۛ","ﯞ":"وۛ","ۇ":"و̓","ﯘ":"و̓","ﯗ":"و̓","ۆ":"و̆","ﯚ":"و̆","ﯙ":"و̆","ۉ":"و̂","ﯣ":"و̂","ﯢ":"و̂","ۈ":"وٰ","ﯜ":"وٰ","ﯛ":"وٰ","ؤ":"وٴ","ﺆ":"وٴ","ﺅ":"وٴ","ٶ":"وٴ","ٷ":"و̓ٴ","ﯝ":"و̓ٴ","ﷸ":"وسلم","ﯡ":"ۅ","ﯠ":"ۅ","ٮ":"ى","𞸜":"ى","𞹼":"ى","ں":"ى","𞸝":"ى","𞹝":"ى","ﮟ":"ى","ﮞ":"ى","ࢽ":"ى","ﯨ":"ى","ﯩ":"ى","ﻰ":"ى","ﻯ":"ى","ي":"ى","𞸉":"ى","𞸩":"ى","𞹉":"ى","𞹩":"ى","𞺉":"ى","𞺩":"ى","ﻳ":"ى","ﻴ":"ى","ﻲ":"ى","ﻱ":"ى","ی":"ى","ﯾ":"ى","ﯿ":"ى","ﯽ":"ى","ﯼ":"ى","ے":"ى","ﮯ":"ى","ﮮ":"ى","ٹ":"ىؕ","ﭨ":"ىؕ","ﭩ":"ىؕ","ﭧ":"ىؕ","ﭦ":"ىؕ","ڻ":"ىؕ","ﮢ":"ىؕ","ﮣ":"ىؕ","ﮡ":"ىؕ","ﮠ":"ىؕ","پ":"ىۛ","ﭘ":"ىۛ","ﭙ":"ىۛ","ﭗ":"ىۛ","ﭖ":"ىۛ","ث":"ىۛ","𞸖":"ىۛ","𞸶":"ىۛ","𞹶":"ىۛ","𞺖":"ىۛ","𞺶":"ىۛ","ﺛ":"ىۛ","ﺜ":"ىۛ","ﺚ":"ىۛ","ﺙ":"ىۛ","ڽ":"ىۛ","ۑ":"ىۛ","ؿ":"ىۛ","ࢷ":"ىۛۢ","ݖ":"ى̆","ێ":"ى̆","ࢺ":"ى̆̇","ؽ":"ى̂","ࢨ":"ىٔ","ﲐ":"ىٰ","ﱝ":"ىٰ","ﳞ":"ىo","ﳱ":"ىo","ﳦ":"ىۛo","ئ":"ىٴ","ﺋ":"ىٴ","ﺌ":"ىٴ","ﺊ":"ىٴ","ﺉ":"ىٴ","ٸ":"ىٴ","ﯫ":"ىٴl","ﯪ":"ىٴl","ﲛ":"ىٴo","ﳠ":"ىٴo","ﯭ":"ىٴo","ﯬ":"ىٴo","ﯸ":"ىٴٻ","ﯷ":"ىٴٻ","ﯶ":"ىٴٻ","ﲗ":"ىٴج","ﰀ":"ىٴج","ﲘ":"ىٴح","ﰁ":"ىٴح","ﲙ":"ىٴخ","ﱤ":"ىٴر","ﱥ":"ىٴز","ﲚ":"ىٴم","ﳟ":"ىٴم","ﱦ":"ىٴم","ﰂ":"ىٴم","ﱧ":"ىٴن","ﯯ":"ىٴو","ﯮ":"ىٴو","ﯱ":"ىٴو̓","ﯰ":"ىٴو̓","ﯳ":"ىٴو̆","ﯲ":"ىٴو̆","ﯵ":"ىٴوٰ","ﯴ":"ىٴوٰ","ﯻ":"ىٴى","ﯺ":"ىٴى","ﱨ":"ىٴى","ﯹ":"ىٴى","ﰃ":"ىٴى","ﱩ":"ىٴى","ﰄ":"ىٴى","ﳚ":"ىج","ﱕ":"ىج","ﰑ":"ىۛج","ﶯ":"ىجى","ﳛ":"ىح","ﱖ":"ىح","ﶮ":"ىحى","ﳜ":"ىخ","ﱗ":"ىخ","ﲑ":"ىر","ﱶ":"ىۛر","ﲒ":"ىز","ﱷ":"ىۛز","ﳝ":"ىم","ﳰ":"ىم","ﲓ":"ىم","ﱘ":"ىم","ﲦ":"ىۛم","ﳥ":"ىۛم","ﱸ":"ىۛم","ﰒ":"ىۛم","ﶝ":"ىمم","ﶜ":"ىمم","ﶰ":"ىمى","ﲔ":"ىن","ﱹ":"ىۛن","ﲕ":"ىى","ﱙ":"ىى","ﲖ":"ىى","ﱚ":"ىى","ﱺ":"ىۛى","ﰓ":"ىۛى","ﱻ":"ىۛى","ﰔ":"ىۛى","ﮱ":"ۓ","ﮰ":"ۓ","𐊸":"ⵀ","⁞":"ⵂ","⸽":"ⵂ","⦙":"ⵂ","︙":"ⵗ","⁝":"ⵗ","⋮":"ⵗ","Մ":"ሆ","Ռ":"ቡ","Ի":"ኮ","Պ":"ጣ","आ":"अा","ऒ":"अाॆ","ओ":"अाे","औ":"अाै","ऄ":"अॆ","ऑ":"अॉ","ऍ":"एॅ","ऎ":"एॆ","ऐ":"एे","ई":"र्इ","ઽ":"ऽ","𑇜":"ꣻ","𑇋":"ऺ","ુ":"ु","ૂ":"ू","ੋ":"ॆ","੍":"्","્":"्","আ":"অা","ৠ":"ঋৃ","ৡ":"ঋৃ","𑒒":"ঘ","𑒔":"চ","𑒖":"জ","𑒘":"ঞ","𑒙":"ট","𑒛":"ড","𑒪":"ণ","𑒞":"ত","𑒟":"থ","𑒠":"দ","𑒡":"ধ","𑒢":"ন","𑒣":"প","𑒩":"ব","𑒧":"ম","𑒨":"য","𑒫":"র","𑒝":"ল","𑒭":"ষ","𑒮":"স","𑓄":"ঽ","𑒰":"া","𑒱":"ি","𑒹":"ে","𑒼":"ো","𑒾":"ৌ","𑓂":"্","𑒽":"ৗ","ਉ":"ੳੁ","ਊ":"ੳੂ","ਆ":"ਅਾ","ਐ":"ਅੈ","ਔ":"ਅੌ","ਇ":"ੲਿ","ਈ":"ੲੀ","ਏ":"ੲੇ","આ":"અા","ઑ":"અાૅ","ઓ":"અાે","ઔ":"અાૈ","ઍ":"અૅ","એ":"અે","ઐ":"અૈ","ଆ":"ଅା","௮":"அ","ர":"ஈ","ா":"ஈ","௫":"ஈு","௨":"உ","ഉ":"உ","ஊ":"உள","ഊ":"உൗ","௭":"எ","௷":"எவ","ஜ":"ஐ","ജ":"ஐ","௧":"க","௪":"ச","௬":"சு","௲":"சூ","ഺ":"டி","ണ":"ண","௺":"நீ","௴":"மீ","௰":"ய","ഴ":"ழ","ௗ":"ள","ை":"ன","ശ":"ஶ","௸":"ஷ","ി":"ி","ീ":"ி","ொ":"ெஈ","ௌ":"ெள","ோ":"ேஈ","ಅ":"అ","ಆ":"ఆ","ಇ":"ఇ","ౠ":"ఋా","ౡ":"ఌా","ಒ":"ఒ","ఔ":"ఒౌ","ಔ":"ఒౌ","ఓ":"ఒౕ","ಓ":"ఒౕ","ಜ":"జ","ಞ":"ఞ","ఢ":"డ̣","ಣ":"ణ","థ":"ధּ","భ":"బ̣","ಯ":"య","ఠ":"రּ","ಱ":"ఱ","ಲ":"ల","ష":"వ̣","హ":"వా","మ":"వు","ూ":"ుా","ౄ":"ృా","ೡ":"ಌಾ","ഈ":"ഇൗ","ഐ":"എെ","ഓ":"ഒാ","ഔ":"ഒൗ","ൡ":"ഞ","൫":"ദ്ര","൹":"നു","ഌ":"നു","ങ":"നു","൯":"ന്","ൻ":"ന്","൬":"ന്ന","൚":"ന്മ","റ":"ര","൪":"ര്","ർ":"ര്","൮":"വ്ര","൶":"ഹ്മ","ൂ":"ു","ൃ":"ു","ൈ":"െെ","෪":"ජ","෫":"ද","𑐓":"𑐴𑑂𑐒","𑐙":"𑐴𑑂𑐘","𑐤":"𑐴𑑂𑐣","𑐪":"𑐴𑑂𑐩","𑐭":"𑐴𑑂𑐬","𑐯":"𑐴𑑂𑐮","𑗘":"𑖂","𑗙":"𑖂","𑗚":"𑖃","𑗛":"𑖄","𑗜":"𑖲","𑗝":"𑖳","ฃ":"ข","ด":"ค","ต":"ค","ม":"ฆ","ຈ":"จ","ซ":"ช","ฏ":"ฎ","ท":"ฑ","ບ":"บ","ປ":"ป","ຝ":"ฝ","ພ":"พ","ຟ":"ฟ","ฦ":"ภ","ຍ":"ย","។":"ฯ","ๅ":"า","ำ":"̊า","ិ":"ิ","ី":"ี","ឹ":"ึ","ឺ":"ื","ຸ":"ุ","ູ":"ู","แ":"เเ","ໜ":"ຫນ","ໝ":"ຫມ","ຳ":"̊າ","༂":"འུྂཿ","༃":"འུྂ༔","ཪ":"ར","ༀ":"ཨོཾ","ཷ":"ྲཱྀ","ཹ":"ླཱྀ","𑲲":"𑲪","ႁ":"ဂှ","က":"ဂာ","ၰ":"ဃှ","ၦ":"ပှ","ဟ":"ပာ","ၯ":"ပာှ","ၾ":"ၽှ","ဩ":"သြ","ဪ":"သြော်","႞":"ႃ̊","ឣ":"អ","᧐":"ᦞ","᧑":"ᦱ","᪀":"ᩅ","᪐":"ᩅ","꩓":"ꨁ","꩖":"ꨣ","᭒":"ᬍ","᭓":"ᬑ","᭘":"ᬨ","ꦣ":"ꦝ","ᢖ":"ᡜ","ᡕ":"ᠵ","ῶ":"Ꮿ","ᐍ":"ᐁ·","ᐫ":"ᐁᐠ","ᐑ":"ᐄ·","ᐓ":"ᐅ·","ᐭ":"ᐅᐠ","ᐕ":"ᐆ·","ᐘ":"ᐊ·","ᐮ":"ᐊᐠ","ᐚ":"ᐋ·","ᣝ":"ᐞᣟ","ᓑ":"ᐡ","ᕀ":"ᐩ","ᐿ":"ᐲ·","ᑃ":"ᐴ·","⍩":"ᐵ","ᑇ":"ᐹ·","ᑜ":"ᑏ·","⸧":"ᑐ","⊃":"ᑐ","ᑞ":"ᑐ·","ᑩ":"ᑐ\'","⟉":"ᑐ/","⫗":"ᑐᑕ","ᑠ":"ᑑ·","⸦":"ᑕ","⊂":"ᑕ","ᑢ":"ᑕ·","ᑪ":"ᑕ\'","ᑤ":"ᑖ·","ᑵ":"ᑫ·","ᒅ":"ᑫ\'","ᑹ":"ᑮ·","ᑽ":"ᑰ·","ᘃ":"ᒉ","ᒓ":"ᒉ·","ᒕ":"ᒋ·","ᒗ":"ᒌ·","ᒛ":"ᒎ·","ᘂ":"ᒐ","ᒝ":"ᒐ·","ᒟ":"ᒑ·","ᒭ":"ᒣ·","ᒱ":"ᒦ·","ᒳ":"ᒧ·","ᒵ":"ᒨ·","ᒹ":"ᒫ·","ᓊ":"ᓀ·","ᣇ":"ᓂ·","ᣉ":"ᓃ·","ᣋ":"ᓄ·","ᣍ":"ᓅ·","ᓌ":"ᓇ·","ᓎ":"ᓈ·","ᘄ":"ᓓ","ᓝ":"ᓓ·","ᓟ":"ᓕ·","ᓡ":"ᓖ·","ᓣ":"ᓗ·","ᓥ":"ᓘ·","ᘇ":"ᓚ","ᓧ":"ᓚ·","ᓩ":"ᓛ·","ᓷ":"ᓭ·","ᓹ":"ᓯ·","ᓻ":"ᓰ·","ᓽ":"ᓱ·","ᓿ":"ᓲ·","ᔁ":"ᓴ·","ᔃ":"ᓵ·","ᔌ":"ᔋ<","ᔎ":"ᔋb","ᔍ":"ᔋᑕ","ᔏ":"ᔋᒐ","ᔘ":"ᔐ·","ᔚ":"ᔑ·","ᔜ":"ᔒ·","ᔞ":"ᔓ·","ᔠ":"ᔔ·","ᔢ":"ᔕ·","ᔤ":"ᔖ·","ᔲ":"ᔨ·","ᔴ":"ᔩ·","ᔶ":"ᔪ·","ᔸ":"ᔫ·","ᔺ":"ᔭ·","ᔼ":"ᔮ·","ᘢ":"ᕃ","ᣠ":"ᕃ·","ᘣ":"ᕆ","ᘤ":"ᕊ","ᕏ":"ᕌ·","ᖃ":"ᕐb","ᖄ":"ᕐḃ","ᖁ":"ᕐd","ᕿ":"ᕐP","ᙯ":"ᕐᑫ","ᕾ":"ᕐᑬ","ᖀ":"ᕐᑮ","ᖂ":"ᕐᑰ","ᖅ":"ᕐᒃ","ᕜ":"ᕚ·","ᣣ":"ᕞ·","ᣤ":"ᕦ·","ᕩ":"ᕧ·","ᣥ":"ᕫ·","ᣨ":"ᖆ·","ᖑ":"ᖕJ","ᙰ":"ᖕᒉ","ᖎ":"ᖕᒊ","ᖏ":"ᖕᒋ","ᖐ":"ᖕᒌ","ᖒ":"ᖕᒎ","ᖓ":"ᖕᒐ","ᖔ":"ᖕᒑ","ᙳ":"ᖖJ","ᙱ":"ᖖᒋ","ᙲ":"ᖖᒌ","ᙴ":"ᖖᒎ","ᙵ":"ᖖᒐ","ᙶ":"ᖖᒑ","ᣪ":"ᖗ·","ᙷ":"ᖧ·","ᙸ":"ᖨ·","ᙹ":"ᖩ·","ᙺ":"ᖪ·","ᙻ":"ᖫ·","ᙼ":"ᖬ·","ᙽ":"ᖭ·","⪫":"ᗒ","⪪":"ᗕ","ꓷ":"ᗡ","ᣰ":"ᗴ·","ᣲ":"ᘛ·","ᶻ":"ᙆ","ꓭ":"ᙠ","ᶺ":"ᣔ","ᴾ":"ᣖ","ᣜ":"ᣟᐞ","ˡ":"ᣳ","ʳ":"ᣴ","ˢ":"ᣵ","ᣛ":"ᣵ","ꚰ":"ᚹ","ᛡ":"ᚼ","⍿":"ᚽ","ᛂ":"ᚽ","𝈿":"ᛋ","↑":"ᛏ","↿":"ᛐ","⥮":"ᛐ⇂","⥣":"ᛐᛚ","ⵣ":"ᛯ","↾":"ᛚ","⨡":"ᛚ","⋄":"ᛜ","◇":"ᛜ","◊":"ᛜ","♢":"ᛜ","🝔":"ᛜ","𑢷":"ᛜ","𐊔":"ᛜ","⍚":"ᛜ̲","⋈":"ᛞ","⨝":"ᛞ","𐓐":"ᛦ","↕":"ᛨ","𐳼":"𐲂","𐳺":"𐲥","ㄱ":"ᄀ","ᆨ":"ᄀ","ᄁ":"ᄀᄀ","ㄲ":"ᄀᄀ","ᆩ":"ᄀᄀ","ᇺ":"ᄀᄂ","ᅚ":"ᄀᄃ","ᇃ":"ᄀᄅ","ᇻ":"ᄀᄇ","ᆪ":"ᄀᄉ","ㄳ":"ᄀᄉ","ᇄ":"ᄀᄉᄀ","ᇼ":"ᄀᄎ","ᇽ":"ᄀᄏ","ᇾ":"ᄀᄒ","ㄴ":"ᄂ","ᆫ":"ᄂ","ᄓ":"ᄂᄀ","ᇅ":"ᄂᄀ","ᄔ":"ᄂᄂ","ㅥ":"ᄂᄂ","ᇿ":"ᄂᄂ","ᄕ":"ᄂᄃ","ㅦ":"ᄂᄃ","ᇆ":"ᄂᄃ","ퟋ":"ᄂᄅ","ᄖ":"ᄂᄇ","ᅛ":"ᄂᄉ","ᇇ":"ᄂᄉ","ㅧ":"ᄂᄉ","ᅜ":"ᄂᄌ","ᆬ":"ᄂᄌ","ㄵ":"ᄂᄌ","ퟌ":"ᄂᄎ","ᇉ":"ᄂᄐ","ᅝ":"ᄂᄒ","ᆭ":"ᄂᄒ","ㄶ":"ᄂᄒ","ᇈ":"ᄂᅀ","ㅨ":"ᄂᅀ","ㄷ":"ᄃ","ᆮ":"ᄃ","ᄗ":"ᄃᄀ","ᇊ":"ᄃᄀ","ᄄ":"ᄃᄃ","ㄸ":"ᄃᄃ","ퟍ":"ᄃᄃ","ퟎ":"ᄃᄃᄇ","ᅞ":"ᄃᄅ","ᇋ":"ᄃᄅ","ꥠ":"ᄃᄆ","ꥡ":"ᄃᄇ","ퟏ":"ᄃᄇ","ꥢ":"ᄃᄉ","ퟐ":"ᄃᄉ","ퟑ":"ᄃᄉᄀ","ꥣ":"ᄃᄌ","ퟒ":"ᄃᄌ","ퟓ":"ᄃᄎ","ퟔ":"ᄃᄐ","ㄹ":"ᄅ","ᆯ":"ᄅ","ꥤ":"ᄅᄀ","ᆰ":"ᄅᄀ","ㄺ":"ᄅᄀ","ꥥ":"ᄅᄀᄀ","ퟕ":"ᄅᄀᄀ","ᇌ":"ᄅᄀᄉ","ㅩ":"ᄅᄀᄉ","ퟖ":"ᄅᄀᄒ","ᄘ":"ᄅᄂ","ᇍ":"ᄅᄂ","ꥦ":"ᄅᄃ","ᇎ":"ᄅᄃ","ㅪ":"ᄅᄃ","ꥧ":"ᄅᄃᄃ","ᇏ":"ᄅᄃᄒ","ᄙ":"ᄅᄅ","ᇐ":"ᄅᄅ","ퟗ":"ᄅᄅᄏ","ꥨ":"ᄅᄆ","ᆱ":"ᄅᄆ","ㄻ":"ᄅᄆ","ᇑ":"ᄅᄆᄀ","ᇒ":"ᄅᄆᄉ","ퟘ":"ᄅᄆᄒ","ꥩ":"ᄅᄇ","ᆲ":"ᄅᄇ","ㄼ":"ᄅᄇ","ퟙ":"ᄅᄇᄃ","ꥪ":"ᄅᄇᄇ","ᇓ":"ᄅᄇᄉ","ㅫ":"ᄅᄇᄉ","ꥫ":"ᄅᄇᄋ","ᇕ":"ᄅᄇᄋ","ퟚ":"ᄅᄇᄑ","ᇔ":"ᄅᄇᄒ","ꥬ":"ᄅᄉ","ᆳ":"ᄅᄉ","ㄽ":"ᄅᄉ","ᇖ":"ᄅᄉᄉ","ᄛ":"ᄅᄋ","ퟝ":"ᄅᄋ","ꥭ":"ᄅᄌ","ꥮ":"ᄅᄏ","ᇘ":"ᄅᄏ","ᆴ":"ᄅᄐ","ㄾ":"ᄅᄐ","ᆵ":"ᄅᄑ","ㄿ":"ᄅᄑ","ᄚ":"ᄅᄒ","ㅀ":"ᄅᄒ","ᄻ":"ᄅᄒ","ᆶ":"ᄅᄒ","ퟲ":"ᄅᄒ","ᇗ":"ᄅᅀ","ㅬ":"ᄅᅀ","ퟛ":"ᄅᅌ","ᇙ":"ᄅᅙ","ㅭ":"ᄅᅙ","ퟜ":"ᄅᅙᄒ","ㅁ":"ᄆ","ᆷ":"ᄆ","ꥯ":"ᄆᄀ","ᇚ":"ᄆᄀ","ퟞ":"ᄆᄂ","ퟟ":"ᄆᄂᄂ","ꥰ":"ᄆᄃ","ᇛ":"ᄆᄅ","ퟠ":"ᄆᄆ","ᄜ":"ᄆᄇ","ㅮ":"ᄆᄇ","ᇜ":"ᄆᄇ","ퟡ":"ᄆᄇᄉ","ꥱ":"ᄆᄉ","ᇝ":"ᄆᄉ","ㅯ":"ᄆᄉ","ᇞ":"ᄆᄉᄉ","ᄝ":"ᄆᄋ","ㅱ":"ᄆᄋ","ᇢ":"ᄆᄋ","ퟢ":"ᄆᄌ","ᇠ":"ᄆᄎ","ᇡ":"ᄆᄒ","ᇟ":"ᄆᅀ","ㅰ":"ᄆᅀ","ㅂ":"ᄇ","ᆸ":"ᄇ","ᄞ":"ᄇᄀ","ㅲ":"ᄇᄀ","ᄟ":"ᄇᄂ","ᄠ":"ᄇᄃ","ㅳ":"ᄇᄃ","ퟣ":"ᄇᄃ","ᇣ":"ᄇᄅ","ퟤ":"ᄇᄅᄑ","ퟥ":"ᄇᄆ","ᄈ":"ᄇᄇ","ㅃ":"ᄇᄇ","ퟦ":"ᄇᄇ","ᄬ":"ᄇᄇᄋ","ㅹ":"ᄇᄇᄋ","ᄡ":"ᄇᄉ","ㅄ":"ᄇᄉ","ᆹ":"ᄇᄉ","ᄢ":"ᄇᄉᄀ","ㅴ":"ᄇᄉᄀ","ᄣ":"ᄇᄉᄃ","ㅵ":"ᄇᄉᄃ","ퟧ":"ᄇᄉᄃ","ᄤ":"ᄇᄉᄇ","ᄥ":"ᄇᄉᄉ","ᄦ":"ᄇᄉᄌ","ꥲ":"ᄇᄉᄐ","ᄫ":"ᄇᄋ","ㅸ":"ᄇᄋ","ᇦ":"ᄇᄋ","ᄧ":"ᄇᄌ","ㅶ":"ᄇᄌ","ퟨ":"ᄇᄌ","ᄨ":"ᄇᄎ","ퟩ":"ᄇᄎ","ꥳ":"ᄇᄏ","ᄩ":"ᄇᄐ","ㅷ":"ᄇᄐ","ᄪ":"ᄇᄑ","ᇤ":"ᄇᄑ","ꥴ":"ᄇᄒ","ᇥ":"ᄇᄒ","ㅅ":"ᄉ","ᆺ":"ᄉ","ᄭ":"ᄉᄀ","ㅺ":"ᄉᄀ","ᇧ":"ᄉᄀ","ᄮ":"ᄉᄂ","ㅻ":"ᄉᄂ","ᄯ":"ᄉᄃ","ㅼ":"ᄉᄃ","ᇨ":"ᄉᄃ","ᄰ":"ᄉᄅ","ᇩ":"ᄉᄅ","ᄱ":"ᄉᄆ","ퟪ":"ᄉᄆ","ᄲ":"ᄉᄇ","ㅽ":"ᄉᄇ","ᇪ":"ᄉᄇ","ᄳ":"ᄉᄇᄀ","ퟫ":"ᄉᄇᄋ","ᄊ":"ᄉᄉ","ㅆ":"ᄉᄉ","ᆻ":"ᄉᄉ","ퟬ":"ᄉᄉᄀ","ퟭ":"ᄉᄉᄃ","ꥵ":"ᄉᄉᄇ","ᄴ":"ᄉᄉᄉ","ᄵ":"ᄉᄋ","ᄶ":"ᄉᄌ","ㅾ":"ᄉᄌ","ퟯ":"ᄉᄌ","ᄷ":"ᄉᄎ","ퟰ":"ᄉᄎ","ᄸ":"ᄉᄏ","ᄹ":"ᄉᄐ","ퟱ":"ᄉᄐ","ᄺ":"ᄉᄑ","ퟮ":"ᄉᅀ","ㅇ":"ᄋ","ᆼ":"ᄋ","ᅁ":"ᄋᄀ","ᇬ":"ᄋᄀ","ᇭ":"ᄋᄀᄀ","ᅂ":"ᄋᄃ","ꥶ":"ᄋᄅ","ᅃ":"ᄋᄆ","ᅄ":"ᄋᄇ","ᅅ":"ᄋᄉ","ᇱ":"ᄋᄉ","ㆂ":"ᄋᄉ","ᅇ":"ᄋᄋ","ㆀ":"ᄋᄋ","ᇮ":"ᄋᄋ","ᅈ":"ᄋᄌ","ᅉ":"ᄋᄎ","ᇯ":"ᄋᄏ","ᅊ":"ᄋᄐ","ᅋ":"ᄋᄑ","ꥷ":"ᄋᄒ","ᅆ":"ᄋᅀ","ᇲ":"ᄋᅀ","ㆃ":"ᄋᅀ","ㅈ":"ᄌ","ᆽ":"ᄌ","ퟷ":"ᄌᄇ","ퟸ":"ᄌᄇᄇ","ᅍ":"ᄌᄋ","ᄍ":"ᄌᄌ","ㅉ":"ᄌᄌ","ퟹ":"ᄌᄌ","ꥸ":"ᄌᄌᄒ","ㅊ":"ᄎ","ᆾ":"ᄎ","ᅒ":"ᄎᄏ","ᅓ":"ᄎᄒ","ㅋ":"ᄏ","ᆿ":"ᄏ","ㅌ":"ᄐ","ᇀ":"ᄐ","ꥹ":"ᄐᄐ","ㅍ":"ᄑ","ᇁ":"ᄑ","ᅖ":"ᄑᄇ","ᇳ":"ᄑᄇ","ퟺ":"ᄑᄉ","ᅗ":"ᄑᄋ","ㆄ":"ᄑᄋ","ᇴ":"ᄑᄋ","ퟻ":"ᄑᄐ","ꥺ":"ᄑᄒ","ㅎ":"ᄒ","ᇂ":"ᄒ","ᇵ":"ᄒᄂ","ᇶ":"ᄒᄅ","ᇷ":"ᄒᄆ","ᇸ":"ᄒᄇ","ꥻ":"ᄒᄉ","ᅘ":"ᄒᄒ","ㆅ":"ᄒᄒ","ᄽ":"ᄼᄼ","ᄿ":"ᄾᄾ","ㅿ":"ᅀ","ᇫ":"ᅀ","ퟳ":"ᅀᄇ","ퟴ":"ᅀᄇᄋ","ㆁ":"ᅌ","ᇰ":"ᅌ","ퟵ":"ᅌᄆ","ퟶ":"ᅌᄒ","ᅏ":"ᅎᅎ","ᅑ":"ᅐᅐ","ㆆ":"ᅙ","ᇹ":"ᅙ","ꥼ":"ᅙᅙ","ㅤ":"ᅠ","ㅏ":"ᅡ","ᆣ":"ᅡー","ᅶ":"ᅡᅩ","ᅷ":"ᅡᅮ","ᅢ":"ᅡ丨","ㅐ":"ᅡ丨","ㅑ":"ᅣ","ᅸ":"ᅣᅩ","ᅹ":"ᅣᅭ","ᆤ":"ᅣᅮ","ᅤ":"ᅣ丨","ㅒ":"ᅣ丨","ㅓ":"ᅥ","ᅼ":"ᅥー","ᅺ":"ᅥᅩ","ᅻ":"ᅥᅮ","ᅦ":"ᅥ丨","ㅔ":"ᅥ丨","ㅕ":"ᅧ","ᆥ":"ᅧᅣ","ᅽ":"ᅧᅩ","ᅾ":"ᅧᅮ","ᅨ":"ᅧ丨","ㅖ":"ᅧ丨","ㅗ":"ᅩ","ᅪ":"ᅩᅡ","ㅘ":"ᅩᅡ","ᅫ":"ᅩᅡ丨","ㅙ":"ᅩᅡ丨","ᆦ":"ᅩᅣ","ᆧ":"ᅩᅣ丨","ᅿ":"ᅩᅥ","ᆀ":"ᅩᅥ丨","ힰ":"ᅩᅧ","ᆁ":"ᅩᅧ丨","ᆂ":"ᅩᅩ","ힱ":"ᅩᅩ丨","ᆃ":"ᅩᅮ","ᅬ":"ᅩ丨","ㅚ":"ᅩ丨","ㅛ":"ᅭ","ힲ":"ᅭᅡ","ힳ":"ᅭᅡ丨","ᆄ":"ᅭᅣ","ㆇ":"ᅭᅣ","ᆆ":"ᅭᅣ","ᆅ":"ᅭᅣ丨","ㆈ":"ᅭᅣ丨","ힴ":"ᅭᅥ","ᆇ":"ᅭᅩ","ᆈ":"ᅭ丨","ㆉ":"ᅭ丨","ㅜ":"ᅮ","ᆉ":"ᅮᅡ","ᆊ":"ᅮᅡ丨","ᅯ":"ᅮᅥ","ㅝ":"ᅮᅥ","ᆋ":"ᅮᅥー","ᅰ":"ᅮᅥ丨","ㅞ":"ᅮᅥ丨","ힵ":"ᅮᅧ","ᆌ":"ᅮᅧ丨","ᆍ":"ᅮᅮ","ᅱ":"ᅮ丨","ㅟ":"ᅮ丨","ힶ":"ᅮ丨丨","ㅠ":"ᅲ","ᆎ":"ᅲᅡ","ힷ":"ᅲᅡ丨","ᆏ":"ᅲᅥ","ᆐ":"ᅲᅥ丨","ᆑ":"ᅲᅧ","ㆊ":"ᅲᅧ","ᆒ":"ᅲᅧ丨","ㆋ":"ᅲᅧ丨","ힸ":"ᅲᅩ","ᆓ":"ᅲᅮ","ᆔ":"ᅲ丨","ㆌ":"ᅲ丨","ㆍ":"ᆞ","ퟅ":"ᆞᅡ","ᆟ":"ᆞᅥ","ퟆ":"ᆞᅥ丨","ᆠ":"ᆞᅮ","ᆢ":"ᆞᆞ","ᆡ":"ᆞ丨","ㆎ":"ᆞ丨","ヘ":"へ","⍁":"〼","⧄":"〼","꒞":"ꁊ","꒬":"ꁐ","꒜":"ꃀ","꒨":"ꄲ","꒿":"ꉙ","꒾":"ꊱ","꒔":"ꋍ","꓀":"ꎫ","꓂":"ꎵ","꒺":"ꎿ","꒰":"ꏂ","꒧":"ꑘ","⊥":"ꓕ","⟂":"ꓕ","𝈜":"ꓕ","Ʇ":"ꓕ","Ꞟ":"ꓤ","⅁":"ꓨ","⅂":"ꓶ","𝈕":"ꓶ","𝈫":"ꓶ","𖼦":"ꓶ","𐐑":"ꓶ","⅃":"𖼀","𑫦":"𑫥𑫯","𑫨":"𑫥𑫥","𑫩":"𑫥𑫥𑫯","𑫪":"𑫥𑫥𑫰","𑫧":"𑫥𑫰","𑫴":"𑫳𑫯","𑫶":"𑫳𑫳","𑫷":"𑫳𑫳𑫯","𑫸":"𑫳𑫳𑫰","𑫵":"𑫳𑫰","𑫬":"𑫫𑫯","𑫭":"𑫫𑫫","𑫮":"𑫫𑫫𑫯","⊕":"𐊨","⨁":"𐊨","🜨":"𐊨","Ꚛ":"𐊨","▽":"𐊼","𝈔":"𐊼","🜄":"𐊼","⧖":"𐋀","ꞛ":"𐐺","Ꞛ":"𐐒","𐒠":"𐒆","𐏑":"𐎂","𐏓":"𐎓","𒀸":"𐎚","☥":"𐦞","𓋹":"𐦞","〹":"卄","不":"不","丽":"丽","並":"並","⎜":"丨","⎟":"丨","⎢":"丨","⎥":"丨","⎪":"丨","⎮":"丨","㇑":"丨","ᅵ":"丨","ㅣ":"丨","⼁":"丨","ᆜ":"丨ー","ᆘ":"丨ᅡ","ᆙ":"丨ᅣ","ힽ":"丨ᅣᅩ","ힾ":"丨ᅣ丨","ힿ":"丨ᅧ","ퟀ":"丨ᅧ丨","ᆚ":"丨ᅩ","ퟁ":"丨ᅩ丨","ퟂ":"丨ᅭ","ᆛ":"丨ᅮ","ퟃ":"丨ᅲ","ᆝ":"丨ᆞ","ퟄ":"丨丨","串":"串","丸":"丸","丹":"丹","乁":"乁","㇠":"乙","⼄":"乙","㇟":"乚","⺃":"乚","㇖":"乛","⺂":"乛","⻲":"亀","亂":"亂","㇚":"亅","⼅":"亅","了":"了","ニ":"二","⼆":"二","𠄢":"𠄢","⼇":"亠","亮":"亮","⼈":"人","イ":"亻","⺅":"亻","什":"什","仌":"仌","令":"令","你":"你","倂":"併","倂":"併","侀":"侀","來":"來","例":"例","侮":"侮","侮":"侮","侻":"侻","便":"便","值":"値","倫":"倫","偺":"偺","備":"備","像":"像","僚":"僚","僧":"僧","僧":"僧","㒞":"㒞","⼉":"儿","兀":"兀","⺎":"兀","充":"充","免":"免","免":"免","兔":"兔","兤":"兤","⼊":"入","內":"內","全":"全","兩":"兩","ハ":"八","⼋":"八","六":"六","具":"具","𠔜":"𠔜","𠔥":"𠔥","冀":"冀","㒹":"㒹","⼌":"冂","再":"再","𠕋":"𠕋","冒":"冒","冕":"冕","㒻":"㒻","最":"最","⼍":"冖","冗":"冗","冤":"冤","⼎":"冫","冬":"冬","况":"况","况":"况","冷":"冷","凉":"凉","凌":"凌","凜":"凜","凞":"凞","⼏":"几","𠘺":"𠘺","凵":"凵","⼐":"凵","⼑":"刀","⺉":"刂","刃":"刃","切":"切","切":"切","列":"列","利":"利","㓟":"㓟","刺":"刺","刻":"刻","剆":"剆","割":"割","剷":"剷","劉":"劉","𠠄":"𠠄","カ":"力","力":"力","⼒":"力","劣":"劣","㔕":"㔕","劳":"劳","勇":"勇","勇":"勇","勉":"勉","勉":"勉","勒":"勒","勞":"勞","勤":"勤","勤":"勤","勵":"勵","⼓":"勹","勺":"勺","勺":"勺","包":"包","匆":"匆","𠣞":"𠣞","⼔":"匕","北":"北","北":"北","⼕":"匚","⼖":"匸","匿":"匿","⼗":"十","〸":"十","〺":"卅","卉":"卉","࿖":"卍","࿕":"卐","卑":"卑","卑":"卑","博":"博","ト":"卜","⼘":"卜","⼙":"卩","⺋":"㔾","即":"即","卵":"卵","卽":"卽","卿":"卿","卿":"卿","卿":"卿","⼚":"厂","𠨬":"𠨬","⼛":"厶","參":"參","⼜":"又","及":"及","叟":"叟","𠭣":"𠭣","ロ":"口","⼝":"口","囗":"口","⼞":"口","句":"句","叫":"叫","叱":"叱","吆":"吆","吏":"吏","吝":"吝","吸":"吸","呂":"呂","呈":"呈","周":"周","咞":"咞","咢":"咢","咽":"咽","䎛":"㖈","哶":"哶","唐":"唐","啓":"啓","啟":"啓","啕":"啕","啣":"啣","善":"善","善":"善","喇":"喇","喙":"喙","喙":"喙","喝":"喝","喝":"喝","喫":"喫","喳":"喳","嗀":"嗀","嗂":"嗂","嗢":"嗢","嘆":"嘆","嘆":"嘆","噑":"噑","噴":"噴","器":"器","囹":"囹","圖":"圖","圗":"圗","⼟":"土","士":"土","⼠":"土","型":"型","城":"城","㦳":"㘽","埴":"埴","堍":"堍","報":"報","堲":"堲","塀":"塀","塚":"塚","塚":"塚","塞":"塞","填":"塡","壿":"墫","墬":"墬","墳":"墳","壘":"壘","壟":"壟","𡓤":"𡓤","壮":"壮","売":"売","壷":"壷","⼡":"夂","夆":"夆","⼢":"夊","タ":"夕","⼣":"夕","多":"多","夢":"夢","⼤":"大","奄":"奄","奈":"奈","契":"契","奔":"奔","奢":"奢","女":"女","⼥":"女","𡚨":"𡚨","𡛪":"𡛪","姘":"姘","姬":"姬","娛":"娛","娧":"娧","婢":"婢","婦":"婦","嬀":"媯","㛮":"㛮","㛼":"㛼","媵":"媵","嬈":"嬈","嬨":"嬨","嬾":"嬾","嬾":"嬾","⼦":"子","⼧":"宀","宅":"宅","𡧈":"𡧈","寃":"寃","寘":"寘","寧":"寧","寧":"寧","寧":"寧","寮":"寮","寳":"寳","𡬘":"𡬘","⼨":"寸","寿":"寿","将":"将","⼩":"小","尢":"尢","⺐":"尢","⼪":"尢","⺏":"尣","㞁":"㞁","⼫":"尸","尿":"尿","屠":"屠","屢":"屢","層":"層","履":"履","屮":"屮","屮":"屮","⼬":"屮","𡴋":"𡴋","⼭":"山","峀":"峀","岍":"岍","𡷤":"𡷤","𡷦":"𡷦","崙":"崙","嵃":"嵃","嵐":"嵐","嵫":"嵫","嵮":"嵮","嵼":"嵼","嶲":"嶲","嶺":"嶺","⼮":"巛","巢":"巢","エ":"工","⼯":"工","⼰":"己","⺒":"巳","㠯":"㠯","巽":"巽","⼱":"巾","帲":"帡","帨":"帨","帽":"帽","幩":"幩","㡢":"㡢","𢆃":"𢆃","⼲":"干","年":"年","𢆟":"𢆟","⺓":"幺","⼳":"幺","⼴":"广","度":"度","㡼":"㡼","庰":"庰","庳":"庳","庶":"庶","廊":"廊","廊":"廊","廉":"廉","廒":"廒","廓":"廓","廙":"廙","廬":"廬","⼵":"廴","廾":"廾","⼶":"廾","𢌱":"𢌱","𢌱":"𢌱","弄":"弄","⼷":"弋","⼸":"弓","弢":"弢","弢":"弢","⼹":"彐","⺔":"彑","当":"当","㣇":"㣇","⼺":"彡","形":"形","彩":"彩","彫":"彫","⼻":"彳","律":"律","㣣":"㣣","徚":"徚","復":"復","徭":"徭","⼼":"心","⺖":"忄","⺗":"㣺","忍":"忍","志":"志","念":"念","忹":"忹","怒":"怒","怜":"怜","恵":"恵","㤜":"㤜","㤺":"㤺","悁":"悁","悔":"悔","悔":"悔","惇":"惇","惘":"惘","惡":"惡","𢛔":"𢛔","愈":"愈","慨":"慨","慄":"慄","慈":"慈","慌":"慌","慌":"慌","慎":"慎","慎":"慎","慠":"慠","慺":"慺","憎":"憎","憎":"憎","憎":"憎","憐":"憐","憤":"憤","憯":"憯","憲":"憲","𢡄":"𢡄","𢡊":"𢡊","懞":"懞","懲":"懲","懲":"懲","懲":"懲","懶":"懶","懶":"懶","戀":"戀","⼽":"戈","成":"成","戛":"戛","戮":"戮","戴":"戴","⼾":"戶","戸":"戶","⼿":"手","⺘":"扌","扝":"扝","抱":"抱","拉":"拉","拏":"拏","拓":"拓","拔":"拔","拼":"拼","拾":"拾","𢬌":"𢬌","挽":"挽","捐":"捐","捨":"捨","捻":"捻","掃":"掃","掠":"掠","掩":"掩","揄":"揄","揤":"揤","摒":"摒","𢯱":"𢯱","搜":"搜","搢":"搢","揅":"揅","摩":"摩","摷":"摷","摾":"摾","㨮":"㨮","搉":"㩁","撚":"撚","撝":"撝","擄":"擄","㩬":"㩬","⽀":"支","⽁":"攴","⺙":"攵","敏":"敏","敏":"敏","敖":"敖","敬":"敬","數":"數","𣀊":"𣀊","⽂":"文","⻫":"斉","⽃":"斗","料":"料","⽄":"斤","⽅":"方","旅":"旅","⽆":"无","⺛":"旡","既":"既","旣":"旣","⽇":"日","易":"易","曶":"㫚","㫤":"㫤","晉":"晉","晩":"晚","晴":"晴","晴":"晴","暑":"暑","暑":"暑","暈":"暈","㬈":"㬈","暜":"暜","暴":"暴","曆":"曆","㬙":"㬙","𣊸":"𣊸","⽈":"曰","更":"更","書":"書","⽉":"月","𣍟":"𣍟","肦":"朌","胐":"朏","胊":"朐","脁":"朓","胶":"㬵","朗":"朗","朗":"朗","朗":"朗","脧":"朘","望":"望","望":"望","幐":"㬺","䐠":"㬻","𣎓":"𣎓","膧":"朣","𣎜":"𣎜","⽊":"木","李":"李","杓":"杓","杖":"杖","杞":"杞","𣏃":"𣏃","柿":"杮","杻":"杻","枅":"枅","林":"林","㭉":"㭉","𣏕":"𣏕","柳":"柳","柺":"柺","栗":"栗","栟":"栟","桒":"桒","𣑭":"𣑭","梁":"梁","梅":"梅","梅":"梅","梎":"梎","梨":"梨","椔":"椔","楂":"楂","㮝":"㮝","㮝":"㮝","槩":"㮣","樧":"榝","榣":"榣","槪":"槪","樂":"樂","樂":"樂","樂":"樂","樓":"樓","𣚣":"𣚣","檨":"檨","櫓":"櫓","櫛":"櫛","欄":"欄","㰘":"㰘","⽋":"欠","次":"次","𣢧":"𣢧","歔":"歔","㱎":"㱎","⽌":"止","⻭":"歯","歲":"歲","歷":"歷","歹":"歹","⽍":"歹","⺞":"歺","殟":"殟","殮":"殮","⽎":"殳","殺":"殺","殺":"殺","殺":"殺","殻":"殻","𣪍":"𣪍","⽏":"毋","⺟":"母","𣫺":"𣫺","⽐":"比","⽑":"毛","⽒":"氏","⺠":"民","⽓":"气","⽔":"水","⺡":"氵","⺢":"氺","汎":"汎","汧":"汧","沈":"沈","沿":"沿","泌":"泌","泍":"泍","泥":"泥","𣲼":"𣲼","洛":"洛","洞":"洞","洴":"洴","派":"派","流":"流","流":"流","流":"流","洖":"洖","浩":"浩","浪":"浪","海":"海","海":"海","浸":"浸","涅":"涅","𣴞":"𣴞","淋":"淋","淚":"淚","淪":"淪","淹":"淹","渚":"渚","港":"港","湮":"湮","潙":"溈","滋":"滋","滋":"滋","溜":"溜","溺":"溺","滇":"滇","滑":"滑","滛":"滛","㴳":"㴳","漏":"漏","漢":"漢","漢":"漢","漣":"漣","𣻑":"𣻑","潮":"潮","𣽞":"𣽞","𣾎":"𣾎","濆":"濆","濫":"濫","濾":"濾","瀛":"瀛","瀞":"瀞","瀞":"瀞","瀹":"瀹","灊":"灊","㶖":"㶖","⽕":"火","⺣":"灬","灰":"灰","灷":"灷","災":"災","炙":"炙","炭":"炭","烈":"烈","烙":"烙","煮":"煮","煮":"煮","𤉣":"𤉣","煅":"煅","煉":"煉","𤋮":"𤋮","熜":"熜","燎":"燎","燐":"燐","𤎫":"𤎫","爐":"爐","爛":"爛","爨":"爨","⽖":"爪","爫":"爫","⺤":"爫","爵":"爵","爵":"爵","⽗":"父","⽘":"爻","⺦":"丬","⽙":"爿","⽚":"片","牐":"牐","⽛":"牙","𤘈":"𤘈","⽜":"牛","牢":"牢","犀":"犀","犕":"犕","⽝":"犬","⺨":"犭","犯":"犯","狀":"狀","𤜵":"𤜵","狼":"狼","猪":"猪","猪":"猪","𤠔":"𤠔","獵":"獵","獺":"獺","⽞":"玄","率":"率","率":"率","⽟":"玉","王":"王","㺬":"㺬","玥":"玥","玲":"玲","㺸":"㺸","㺸":"㺸","珞":"珞","琉":"琉","理":"理","琢":"琢","瑇":"瑇","瑜":"瑜","瑩":"瑩","瑱":"瑱","瑱":"瑱","璅":"璅","璉":"璉","璘":"璘","瓊":"瓊","⽠":"瓜","⽡":"瓦","㼛":"㼛","甆":"甆","⽢":"甘","⽣":"生","甤":"甤","⽤":"用","⽥":"田","画":"画","甾":"甾","𤰶":"𤰶","留":"留","略":"略","異":"異","異":"異","𤲒":"𤲒","⽦":"疋","⽧":"疒","痢":"痢","瘐":"瘐","瘟":"瘟","瘝":"瘝","療":"療","癩":"癩","⽨":"癶","⽩":"白","𤾡":"𤾡","𤾸":"𤾸","⽪":"皮","⽫":"皿","𥁄":"𥁄","㿼":"㿼","益":"益","益":"益","盛":"盛","盧":"盧","䀈":"䀈","⽬":"目","直":"直","直":"直","𥃲":"𥃲","𥃳":"𥃳","省":"省","䀘":"䀘","𥄙":"𥄙","眞":"眞","真":"真","真":"真","𥄳":"𥄳","着":"着","睊":"睊","睊":"睊","鿃":"䀹","䀹":"䀹","䀹":"䀹","晣":"䀿","䁆":"䁆","瞋":"瞋","𥉉":"𥉉","瞧":"瞧","⽭":"矛","⽮":"矢","⽯":"石","䂖":"䂖","𥐝":"𥐝","硏":"研","硎":"硎","硫":"硫","碌":"碌","碌":"碌","碑":"碑","磊":"磊","磌":"磌","磌":"磌","磻":"磻","䃣":"䃣","礪":"礪","⽰":"示","⺭":"礻","礼":"礼","社":"社","祈":"祈","祉":"祉","𥘦":"𥘦","祐":"祐","祖":"祖","祖":"祖","祝":"祝","神":"神","祥":"祥","視":"視","視":"視","祿":"祿","𥚚":"𥚚","禍":"禍","禎":"禎","福":"福","福":"福","𥛅":"𥛅","禮":"禮","⽱":"禸","⽲":"禾","秊":"秊","䄯":"䄯","秫":"秫","稜":"稜","穊":"穊","穀":"穀","穀":"穀","穏":"穏","⽳":"穴","突":"突","𥥼":"𥥼","窱":"窱","立":"立","⽴":"立","⻯":"竜","𥪧":"𥪧","𥪧":"𥪧","竮":"竮","⽵":"竹","笠":"笠","節":"節","節":"節","䈂":"䈂","𥮫":"𥮫","篆":"篆","䈧":"䈧","築":"築","𥲀":"𥲀","𥳐":"𥳐","簾":"簾","籠":"籠","⽶":"米","类":"类","粒":"粒","精":"精","糒":"糒","糖":"糖","糨":"糨","䊠":"䊠","糣":"糣","糧":"糧","⽷":"糸","⺯":"糹","𥾆":"𥾆","紀":"紀","紐":"紐","索":"索","累":"累","絶":"絕","絣":"絣","絛":"絛","綠":"綠","綾":"綾","緇":"緇","練":"練","練":"練","練":"練","縂":"縂","䌁":"䌁","縉":"縉","縷":"縷","繁":"繁","繅":"繅","𦇚":"𦇚","䌴":"䌴","⽸":"缶","𦈨":"𦈨","缾":"缾","𦉇":"𦉇","⽹":"网","⺫":"罒","⺲":"罒","⺱":"罓","䍙":"䍙","署":"署","𦋙":"𦋙","罹":"罹","罺":"罺","羅":"羅","𦌾":"𦌾","⽺":"羊","羕":"羕","羚":"羚","羽":"羽","⽻":"羽","翺":"翺","老":"老","⽼":"老","⺹":"耂","者":"者","者":"者","者":"者","⽽":"而","𦓚":"𦓚","⽾":"耒","𦔣":"𦔣","⽿":"耳","聆":"聆","聠":"聠","𦖨":"𦖨","聯":"聯","聰":"聰","聾":"聾","⾀":"聿","⺺":"肀","⾁":"肉","肋":"肋","肭":"肭","育":"育","䏕":"䏕","䏙":"䏙","腁":"胼","脃":"脃","脾":"脾","䐋":"䐋","朡":"朡","𦞧":"𦞧","𦞵":"𦞵","朦":"䑃","臘":"臘","⾂":"臣","臨":"臨","⾃":"自","臭":"臭","⾄":"至","⾅":"臼","舁":"舁","舁":"舁","舄":"舄","⾆":"舌","舘":"舘","⾇":"舛","⾈":"舟","䑫":"䑫","⾉":"艮","良":"良","⾊":"色","⾋":"艸","艹":"艹","艹":"艹","⺾":"艹","⺿":"艹","⻀":"艹","芋":"芋","芑":"芑","芝":"芝","花":"花","芳":"芳","芽":"芽","若":"若","若":"若","苦":"苦","𦬼":"𦬼","茶":"茶","荒":"荒","荣":"荣","茝":"茝","茣":"茣","莽":"莽","荓":"荓","菉":"菉","菊":"菊","菌":"菌","菜":"菜","菧":"菧","華":"華","菱":"菱","著":"著","著":"著","𦰶":"𦰶","莭":"莭","落":"落","葉":"葉","蔿":"蒍","𦳕":"𦳕","𦵫":"𦵫","蓮":"蓮","蓱":"蓱","蓳":"蓳","蓼":"蓼","蔖":"蔖","䔫":"䔫","蕤":"蕤","𦼬":"𦼬","藍":"藍","䕝":"䕝","𦾱":"𦾱","䕡":"䕡","藺":"藺","蘆":"蘆","䕫":"䕫","蘒":"蘒","蘭":"蘭","𧃒":"𧃒","虁":"蘷","蘿":"蘿","⾌":"虍","⻁":"虎","虐":"虐","虜":"虜","虜":"虜","虧":"虧","虩":"虩","⾍":"虫","蚩":"蚩","蚈":"蚈","蛢":"蛢","蜎":"蜎","蜨":"蜨","蝫":"蝫","蟡":"蟡","蝹":"蝹","蝹":"蝹","螆":"螆","䗗":"䗗","𧏊":"𧏊","螺":"螺","蠁":"蠁","䗹":"䗹","蠟":"蠟","⾎":"血","行":"行","⾏":"行","衠":"衠","衣":"衣","⾐":"衣","⻂":"衤","裂":"裂","𧙧":"𧙧","裏":"裏","裗":"裗","裞":"裞","裡":"裡","裸":"裸","裺":"裺","䘵":"䘵","褐":"褐","襁":"襁","襤":"襤","⾑":"襾","⻄":"西","⻃":"覀","覆":"覆","見":"見","⾒":"見","𧢮":"𧢮","⻅":"见","⾓":"角","⾔":"言","𧥦":"𧥦","詽":"訮","訞":"䚶","䚾":"䚾","䛇":"䛇","誠":"誠","說":"說","說":"說","調":"調","請":"請","諒":"諒","論":"論","諭":"諭","諭":"諭","諸":"諸","諸":"諸","諾":"諾","諾":"諾","謁":"謁","謁":"謁","謹":"謹","謹":"謹","識":"識","讀":"讀","讏":"讆","變":"變","變":"變","⻈":"讠","⾕":"谷","⾖":"豆","豈":"豈","豕":"豕","⾗":"豕","豣":"豜","⾘":"豸","𧲨":"𧲨","⾙":"貝","貫":"貫","賁":"賁","賂":"賂","賈":"賈","賓":"賓","贈":"贈","贈":"贈","贛":"贛","⻉":"贝","⾚":"赤","⾛":"走","起":"起","趆":"赿","𧻓":"𧻓","𧼯":"𧼯","⾜":"足","跋":"跋","趼":"趼","跺":"跥","路":"路","跰":"跰","躛":"躗","⾝":"身","車":"車","⾞":"車","軔":"軔","輧":"軿","輦":"輦","輪":"輪","輸":"輸","輸":"輸","輻":"輻","轢":"轢","⻋":"车","⾟":"辛","辞":"辞","辰":"辰","⾠":"辰","⾡":"辵","辶":"辶","⻌":"辶","⻍":"辶","巡":"巡","連":"連","逸":"逸","逸":"逸","遲":"遲","遼":"遼","𨗒":"𨗒","𨗭":"𨗭","邏":"邏","⾢":"邑","邔":"邔","郎":"郎","郞":"郎","郞":"郎","郱":"郱","都":"都","𨜮":"𨜮","鄑":"鄑","鄛":"鄛","⾣":"酉","酪":"酪","醙":"醙","醴":"醴","⾤":"釆","里":"里","⾥":"里","量":"量","金":"金","⾦":"金","鈴":"鈴","鈸":"鈸","鉶":"鉶","鋗":"鋗","鋘":"鋘","鉼":"鉼","錄":"錄","鍊":"鍊","鎮":"鎭","鏹":"鏹","鐕":"鐕","𨯺":"𨯺","⻐":"钅","⻑":"長","⾧":"長","⻒":"镸","⻓":"长","⾨":"門","開":"開","䦕":"䦕","閭":"閭","閷":"閷","𨵷":"𨵷","⻔":"门","⾩":"阜","⻏":"阝","⻖":"阝","阮":"阮","陋":"陋","降":"降","陵":"陵","陸":"陸","陼":"陼","隆":"隆","隣":"隣","䧦":"䧦","⾪":"隶","隷":"隷","隸":"隷","隸":"隷","⾫":"隹","雃":"雃","離":"離","難":"難","難":"難","⾬":"雨","零":"零","雷":"雷","霣":"霣","𩅅":"𩅅","露":"露","靈":"靈","⾭":"靑","⻘":"青","靖":"靖","靖":"靖","𩇟":"𩇟","⾮":"非","⾯":"面","𩈚":"𩈚","⾰":"革","䩮":"䩮","䩶":"䩶","⾱":"韋","韛":"韛","韠":"韠","⻙":"韦","⾲":"韭","𩐊":"𩐊","⾳":"音","響":"響","響":"響","⾴":"頁","䪲":"䪲","頋":"頋","頋":"頋","頋":"頋","領":"領","頩":"頩","𩒖":"𩒖","頻":"頻","頻":"頻","類":"類","⻚":"页","⾵":"風","𩖶":"𩖶","⻛":"风","⾶":"飛","⻜":"飞","⻝":"食","⾷":"食","⻟":"飠","飢":"飢","飯":"飯","飼":"飼","䬳":"䬳","館":"館","餩":"餩","⻠":"饣","⾸":"首","⾹":"香","馧":"馧","⾺":"馬","駂":"駂","駱":"駱","駾":"駾","驪":"驪","⻢":"马","⾻":"骨","䯎":"䯎","⾼":"高","⾽":"髟","𩬰":"𩬰","鬒":"鬒","鬒":"鬒","⾾":"鬥","⾿":"鬯","⿀":"鬲","⿁":"鬼","⻤":"鬼","⿂":"魚","魯":"魯","鱀":"鱀","鱗":"鱗","⻥":"鱼","⿃":"鳥","鳽":"鳽","䳎":"䳎","鵧":"鵧","䳭":"䳭","𪃎":"𪃎","鶴":"鶴","𪄅":"𪄅","䳸":"䳸","鷺":"鷺","𪈎":"𪈎","鸞":"鸞","鹃":"鹂","⿄":"鹵","鹿":"鹿","⿅":"鹿","𪊑":"𪊑","麗":"麗","麟":"麟","⿆":"麥","⻨":"麦","麻":"麻","⿇":"麻","𪎒":"𪎒","⿈":"黃","⻩":"黄","⿉":"黍","黎":"黎","䵖":"䵖","⿊":"黑","黒":"黑","墨":"墨","黹":"黹","⿋":"黹","⿌":"黽","鼅":"鼅","黾":"黾","⿍":"鼎","鼏":"鼏","⿎":"鼓","鼖":"鼖","⿏":"鼠","鼻":"鼻","⿐":"鼻","齃":"齃","⿑":"齊","⻬":"齐","⿒":"齒","𪘀":"𪘀","⻮":"齿","龍":"龍","⿓":"龍","龎":"龎","⻰":"龙","龜":"龜","龜":"龜","龜":"龜","⿔":"龜","⻳":"龟","⿕":"龠"}')},5067:(e,t,i)=>{"use strict";var n=i(5547),r=RegExp(Object.keys(n).map((function(e){return e.replace(/([.?*+^$[\]\\(){}|-])/g,"\\$1")})).join("|"),"g");function s(e){return n[e]}e.exports=function(e){return e.replace(r,s)}},2511:function(e,t,i){var n;e=i.nmd(e),function(r){t&&t.nodeType,e&&e.nodeType;var s="object"==typeof i.g&&i.g;s.global!==s&&s.window!==s&&s.self;var o,a=2147483647,c=36,l=/^xn--/,h=/[^\x20-\x7E]/,u=/[\x2E\u3002\uFF0E\uFF61]/g,d={overflow:"Overflow: input needs wider integers to process","not-basic":"Illegal input >= 0x80 (not a basic code point)","invalid-input":"Invalid input"},p=Math.floor,g=String.fromCharCode;function f(e){throw RangeError(d[e])}function m(e,t){for(var i=e.length,n=[];i--;)n[i]=t(e[i]);return n}function v(e,t){var i=e.split("@"),n="";return i.length>1&&(n=i[0]+"@",e=i[1]),n+m((e=e.replace(u,".")).split("."),t).join(".")}function y(e){for(var t,i,n=[],r=0,s=e.length;r<s;)(t=e.charCodeAt(r++))>=55296&&t<=56319&&r<s?56320==(64512&(i=e.charCodeAt(r++)))?n.push(((1023&t)<<10)+(1023&i)+65536):(n.push(t),r--):n.push(t);return n}function _(e){return m(e,(function(e){var t="";return e>65535&&(t+=g((e-=65536)>>>10&1023|55296),e=56320|1023&e),t+g(e)})).join("")}function S(e,t){return e+22+75*(e<26)-((0!=t)<<5)}function b(e,t,i){var n=0;for(e=i?p(e/700):e>>1,e+=p(e/t);e>455;n+=c)e=p(e/35);return p(n+36*e/(e+38))}function w(e){var t,i,n,r,s,o,l,h,u,d,g,m=[],v=e.length,y=0,S=128,w=72;for((i=e.lastIndexOf("-"))<0&&(i=0),n=0;n<i;++n)e.charCodeAt(n)>=128&&f("not-basic"),m.push(e.charCodeAt(n));for(r=i>0?i+1:0;r<v;){for(s=y,o=1,l=c;r>=v&&f("invalid-input"),((h=(g=e.charCodeAt(r++))-48<10?g-22:g-65<26?g-65:g-97<26?g-97:c)>=c||h>p((a-y)/o))&&f("overflow"),y+=h*o,!(h<(u=l<=w?1:l>=w+26?26:l-w));l+=c)o>p(a/(d=c-u))&&f("overflow"),o*=d;w=b(y-s,t=m.length+1,0==s),p(y/t)>a-S&&f("overflow"),S+=p(y/t),y%=t,m.splice(y++,0,S)}return _(m)}function E(e){var t,i,n,r,s,o,l,h,u,d,m,v,_,w,E,I=[];for(v=(e=y(e)).length,t=128,i=0,s=72,o=0;o<v;++o)(m=e[o])<128&&I.push(g(m));for(n=r=I.length,r&&I.push("-");n<v;){for(l=a,o=0;o<v;++o)(m=e[o])>=t&&m<l&&(l=m);for(l-t>p((a-i)/(_=n+1))&&f("overflow"),i+=(l-t)*_,t=l,o=0;o<v;++o)if((m=e[o])<t&&++i>a&&f("overflow"),m==t){for(h=i,u=c;!(h<(d=u<=s?1:u>=s+26?26:u-s));u+=c)E=h-d,w=c-d,I.push(g(S(d+E%w,0))),h=p(E/w);I.push(g(S(h,0))),s=b(i,_,n==r),i=0,++n}++i,++t}return I.join("")}o={version:"1.3.2",ucs2:{decode:y,encode:_},decode:w,encode:E,toASCII:function(e){return v(e,(function(e){return h.test(e)?"xn--"+E(e):e}))},toUnicode:function(e){return v(e,(function(e){return l.test(e)?w(e.slice(4).toLowerCase()):e}))}},void 0===(n=function(){return o}.call(t,i,t,e))||(e.exports=n)}()},8575:(e,t,i)=>{"use strict";var n=i(2511),r=i(2502);function s(){this.protocol=null,this.slashes=null,this.auth=null,this.host=null,this.port=null,this.hostname=null,this.hash=null,this.search=null,this.query=null,this.pathname=null,this.path=null,this.href=null}t.parse=_,t.resolve=function(e,t){return _(e,!1,!0).resolve(t)},t.resolveObject=function(e,t){return e?_(e,!1,!0).resolveObject(t):t},t.format=function(e){return r.isString(e)&&(e=_(e)),e instanceof s?e.format():s.prototype.format.call(e)},t.Url=s;var o=/^([a-z0-9.+-]+:)/i,a=/:[0-9]*$/,c=/^(\/\/?(?!\/)[^\?\s]*)(\?[^\s]*)?$/,l=["{","}","|","\\","^","`"].concat(["<",">",'"',"`"," ","\r","\n","\t"]),h=["'"].concat(l),u=["%","/","?",";","#"].concat(h),d=["/","?","#"],p=/^[+a-z0-9A-Z_-]{0,63}$/,g=/^([+a-z0-9A-Z_-]{0,63})(.*)$/,f={javascript:!0,"javascript:":!0},m={javascript:!0,"javascript:":!0},v={http:!0,https:!0,ftp:!0,gopher:!0,file:!0,"http:":!0,"https:":!0,"ftp:":!0,"gopher:":!0,"file:":!0},y=i(7673);function _(e,t,i){if(e&&r.isObject(e)&&e instanceof s)return e;var n=new s;return n.parse(e,t,i),n}s.prototype.parse=function(e,t,i){if(!r.isString(e))throw new TypeError("Parameter 'url' must be a string, not "+typeof e);var s=e.indexOf("?"),a=-1!==s&&s<e.indexOf("#")?"?":"#",l=e.split(a);l[0]=l[0].replace(/\\/g,"/");var _=e=l.join(a);if(_=_.trim(),!i&&1===e.split("#").length){var S=c.exec(_);if(S)return this.path=_,this.href=_,this.pathname=S[1],S[2]?(this.search=S[2],this.query=t?y.parse(this.search.substr(1)):this.search.substr(1)):t&&(this.search="",this.query={}),this}var b=o.exec(_);if(b){var w=(b=b[0]).toLowerCase();this.protocol=w,_=_.substr(b.length)}if(i||b||_.match(/^\/\/[^@\/]+@[^@\/]+/)){var E="//"===_.substr(0,2);!E||b&&m[b]||(_=_.substr(2),this.slashes=!0)}if(!m[b]&&(E||b&&!v[b])){for(var I,k,T=-1,C=0;C<d.length;C++)-1!==(x=_.indexOf(d[C]))&&(-1===T||x<T)&&(T=x);for(-1!==(k=-1===T?_.lastIndexOf("@"):_.lastIndexOf("@",T))&&(I=_.slice(0,k),_=_.slice(k+1),this.auth=decodeURIComponent(I)),T=-1,C=0;C<u.length;C++){var x;-1!==(x=_.indexOf(u[C]))&&(-1===T||x<T)&&(T=x)}-1===T&&(T=_.length),this.host=_.slice(0,T),_=_.slice(T),this.parseHost(),this.hostname=this.hostname||"";var R="["===this.hostname[0]&&"]"===this.hostname[this.hostname.length-1];if(!R)for(var O=this.hostname.split(/\./),A=(C=0,O.length);C<A;C++){var P=O[C];if(P&&!P.match(p)){for(var D="",M=0,N=P.length;M<N;M++)P.charCodeAt(M)>127?D+="x":D+=P[M];if(!D.match(p)){var B=O.slice(0,C),U=O.slice(C+1),L=P.match(g);L&&(B.push(L[1]),U.unshift(L[2])),U.length&&(_="/"+U.join(".")+_),this.hostname=B.join(".");break}}}this.hostname.length>255?this.hostname="":this.hostname=this.hostname.toLowerCase(),R||(this.hostname=n.toASCII(this.hostname));var K=this.port?":"+this.port:"",j=this.hostname||"";this.host=j+K,this.href+=this.host,R&&(this.hostname=this.hostname.substr(1,this.hostname.length-2),"/"!==_[0]&&(_="/"+_))}if(!f[w])for(C=0,A=h.length;C<A;C++){var F=h[C];if(-1!==_.indexOf(F)){var q=encodeURIComponent(F);q===F&&(q=escape(F)),_=_.split(F).join(q)}}var V=_.indexOf("#");-1!==V&&(this.hash=_.substr(V),_=_.slice(0,V));var $=_.indexOf("?");if(-1!==$?(this.search=_.substr($),this.query=_.substr($+1),t&&(this.query=y.parse(this.query)),_=_.slice(0,$)):t&&(this.search="",this.query={}),_&&(this.pathname=_),v[w]&&this.hostname&&!this.pathname&&(this.pathname="/"),this.pathname||this.search){K=this.pathname||"";var G=this.search||"";this.path=K+G}return this.href=this.format(),this},s.prototype.format=function(){var e=this.auth||"";e&&(e=(e=encodeURIComponent(e)).replace(/%3A/i,":"),e+="@");var t=this.protocol||"",i=this.pathname||"",n=this.hash||"",s=!1,o="";this.host?s=e+this.host:this.hostname&&(s=e+(-1===this.hostname.indexOf(":")?this.hostname:"["+this.hostname+"]"),this.port&&(s+=":"+this.port)),this.query&&r.isObject(this.query)&&Object.keys(this.query).length&&(o=y.stringify(this.query));var a=this.search||o&&"?"+o||"";return t&&":"!==t.substr(-1)&&(t+=":"),this.slashes||(!t||v[t])&&!1!==s?(s="//"+(s||""),i&&"/"!==i.charAt(0)&&(i="/"+i)):s||(s=""),n&&"#"!==n.charAt(0)&&(n="#"+n),a&&"?"!==a.charAt(0)&&(a="?"+a),t+s+(i=i.replace(/[?#]/g,(function(e){return encodeURIComponent(e)})))+(a=a.replace("#","%23"))+n},s.prototype.resolve=function(e){return this.resolveObject(_(e,!1,!0)).format()},s.prototype.resolveObject=function(e){if(r.isString(e)){var t=new s;t.parse(e,!1,!0),e=t}for(var i=new s,n=Object.keys(this),o=0;o<n.length;o++){var a=n[o];i[a]=this[a]}if(i.hash=e.hash,""===e.href)return i.href=i.format(),i;if(e.slashes&&!e.protocol){for(var c=Object.keys(e),l=0;l<c.length;l++){var h=c[l];"protocol"!==h&&(i[h]=e[h])}return v[i.protocol]&&i.hostname&&!i.pathname&&(i.path=i.pathname="/"),i.href=i.format(),i}if(e.protocol&&e.protocol!==i.protocol){if(!v[e.protocol]){for(var u=Object.keys(e),d=0;d<u.length;d++){var p=u[d];i[p]=e[p]}return i.href=i.format(),i}if(i.protocol=e.protocol,e.host||m[e.protocol])i.pathname=e.pathname;else{for(var g=(e.pathname||"").split("/");g.length&&!(e.host=g.shift()););e.host||(e.host=""),e.hostname||(e.hostname=""),""!==g[0]&&g.unshift(""),g.length<2&&g.unshift(""),i.pathname=g.join("/")}if(i.search=e.search,i.query=e.query,i.host=e.host||"",i.auth=e.auth,i.hostname=e.hostname||e.host,i.port=e.port,i.pathname||i.search){var f=i.pathname||"",y=i.search||"";i.path=f+y}return i.slashes=i.slashes||e.slashes,i.href=i.format(),i}var _=i.pathname&&"/"===i.pathname.charAt(0),S=e.host||e.pathname&&"/"===e.pathname.charAt(0),b=S||_||i.host&&e.pathname,w=b,E=i.pathname&&i.pathname.split("/")||[],I=(g=e.pathname&&e.pathname.split("/")||[],i.protocol&&!v[i.protocol]);if(I&&(i.hostname="",i.port=null,i.host&&(""===E[0]?E[0]=i.host:E.unshift(i.host)),i.host="",e.protocol&&(e.hostname=null,e.port=null,e.host&&(""===g[0]?g[0]=e.host:g.unshift(e.host)),e.host=null),b=b&&(""===g[0]||""===E[0])),S)i.host=e.host||""===e.host?e.host:i.host,i.hostname=e.hostname||""===e.hostname?e.hostname:i.hostname,i.search=e.search,i.query=e.query,E=g;else if(g.length)E||(E=[]),E.pop(),E=E.concat(g),i.search=e.search,i.query=e.query;else if(!r.isNullOrUndefined(e.search))return I&&(i.hostname=i.host=E.shift(),(R=!!(i.host&&i.host.indexOf("@")>0)&&i.host.split("@"))&&(i.auth=R.shift(),i.host=i.hostname=R.shift())),i.search=e.search,i.query=e.query,r.isNull(i.pathname)&&r.isNull(i.search)||(i.path=(i.pathname?i.pathname:"")+(i.search?i.search:"")),i.href=i.format(),i;if(!E.length)return i.pathname=null,i.search?i.path="/"+i.search:i.path=null,i.href=i.format(),i;for(var k=E.slice(-1)[0],T=(i.host||e.host||E.length>1)&&("."===k||".."===k)||""===k,C=0,x=E.length;x>=0;x--)"."===(k=E[x])?E.splice(x,1):".."===k?(E.splice(x,1),C++):C&&(E.splice(x,1),C--);if(!b&&!w)for(;C--;C)E.unshift("..");!b||""===E[0]||E[0]&&"/"===E[0].charAt(0)||E.unshift(""),T&&"/"!==E.join("/").substr(-1)&&E.push("");var R,O=""===E[0]||E[0]&&"/"===E[0].charAt(0);return I&&(i.hostname=i.host=O?"":E.length?E.shift():"",(R=!!(i.host&&i.host.indexOf("@")>0)&&i.host.split("@"))&&(i.auth=R.shift(),i.host=i.hostname=R.shift())),(b=b||i.host&&E.length)&&!O&&E.unshift(""),E.length?i.pathname=E.join("/"):(i.pathname=null,i.path=null),r.isNull(i.pathname)&&r.isNull(i.search)||(i.path=(i.pathname?i.pathname:"")+(i.search?i.search:"")),i.auth=e.auth||i.auth,i.slashes=i.slashes||e.slashes,i.href=i.format(),i},s.prototype.parseHost=function(){var e=this.host,t=a.exec(e);t&&(":"!==(t=t[0])&&(this.port=t.substr(1)),e=e.substr(0,e.length-t.length)),e&&(this.hostname=e)}},2502:e=>{"use strict";e.exports={isString:function(e){return"string"==typeof e},isObject:function(e){return"object"==typeof e&&null!==e},isNull:function(e){return null===e},isNullOrUndefined:function(e){return null==e}}},4654:()=>{},858:()=>{},4158:()=>{}},i={};function n(e){var r=i[e];if(void 0!==r)return r.exports;var s=i[e]={id:e,loaded:!1,exports:{}};return t[e].call(s.exports,s,s.exports,n),s.loaded=!0,s.exports}n.m=t,e=[],n.O=(t,i,r,s)=>{if(!i){var o=1/0;for(h=0;h<e.length;h++){for(var[i,r,s]=e[h],a=!0,c=0;c<i.length;c++)(!1&s||o>=s)&&Object.keys(n.O).every((e=>n.O[e](i[c])))?i.splice(c--,1):(a=!1,s<o&&(o=s));if(a){e.splice(h--,1);var l=r();void 0!==l&&(t=l)}}return t}s=s||0;for(var h=e.length;h>0&&e[h-1][2]>s;h--)e[h]=e[h-1];e[h]=[i,r,s]},n.d=(e,t)=>{for(var i in t)n.o(t,i)&&!n.o(e,i)&&Object.defineProperty(e,i,{enumerable:!0,get:t[i]})},n.g=function(){if("object"==typeof globalThis)return globalThis;try{return this||new Function("return this")()}catch(e){if("object"==typeof window)return window}}(),n.o=(e,t)=>Object.prototype.hasOwnProperty.call(e,t),n.nmd=e=>(e.paths=[],e.children||(e.children=[]),e),(()=>{var e;n.g.importScripts&&(e=n.g.location+"");var t=n.g.document;if(!e&&t&&(t.currentScript&&(e=t.currentScript.src),!e)){var i=t.getElementsByTagName("script");i.length&&(e=i[i.length-1].src)}if(!e)throw new Error("Automatic publicPath is not supported in this browser");e=e.replace(/#.*$/,"").replace(/\?.*$/,"").replace(/\/[^\/]+$/,"/"),n.p=e})(),(()=>{var e={712:0};n.O.j=t=>0===e[t];var t=(t,i)=>{var r,s,[o,a,c]=i,l=0;for(r in a)n.o(a,r)&&(n.m[r]=a[r]);if(c)var h=c(n);for(t&&t(i);l<o.length;l++)s=o[l],n.o(e,s)&&e[s]&&e[s][0](),e[o[l]]=0;return n.O(h)},i=self.webpackChunktheboard_matrix=self.webpackChunktheboard_matrix||[];i.forEach(t.bind(null,0)),i.push=t.bind(null,i.push.bind(i))})(),n(3267);var r=n(8743);r=n.O(r)})();
//# sourceMappingURL=shared.bundle.js.map